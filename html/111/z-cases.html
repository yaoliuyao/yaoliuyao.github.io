<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2021-12-27 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>一万行代码</title>
<meta name="generator" content="Org mode">
<meta name="author" content="悟饭">
<link rel='stylesheet' href='/html/asset/common.css?3344' />
<link rel='stylesheet' href='/yaoliuyao/html/asset/common.css?3344' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/html/asset/common.js'></script>
<script src='/yaoliuyao/html/asset/common.js'></script>

<style>
 /* From: https://endlessparentheses.com/public/css/endless.css */
 .special-kbd {
   color: #333;
   background-color: #f7f7f7;
   border: 1px solid #ccc;
   border-radius: 6px;
   box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
   display: inline-block;
   font-family: 'Droid Sans Mono', monospace;
   font-size: 80%;
   font-weight: normal;
   line-height: inherit;
   margin: 2px .1em;
   padding: .04em .4em;
   text-shadow: 0 1px 0 #fff;
   word-spacing: -3px;
 }
</style>
</head>
<body>
<div id="content">
<header>
<h1 class="title">一万行代码</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org9041619">1. 分数录入工具</a>
<ul>
<li><a href="#org92a7baa">1.1. 参考答案</a></li>
<li><a href="#org60cc87b">1.2. 新的要求</a>
<ul>
<li><a href="#orgc645b22">1.2.1. 示例代码</a></li>
<li><a href="#org3a056f0">1.2.2. 另一个版本</a></li>
<li><a href="#org6340988">1.2.3. 补充</a></li>
<li><a href="#org39abb33">1.2.4. Question and Answer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb48f98e">2. 过滤字符串 (委托使用)</a>
<ul>
<li><a href="#orgb67f508">2.1. 基本实现</a></li>
<li><a href="#org1877074">2.2. 使用扩展机制为类添加功能</a></li>
</ul>
</li>
<li><a href="#org1081231">3. 语音点名系统</a>
<ul>
<li><a href="#orgb012619">3.1. 参考实现</a></li>
<li><a href="#orgebe2f15">3.2. 进阶实现</a></li>
</ul>
</li>
<li><a href="#orgddb9864">4. 加密、解密 (rot13)</a>
<ul>
<li><a href="#orgc2b094d">4.1. 分析</a></li>
<li><a href="#orgaae2243">4.2. 实现</a></li>
<li><a href="#orgdcd59b3">4.3. 落地</a></li>
<li><a href="#orgde4b67a">4.4. 导出并使用</a></li>
</ul>
</li>
<li><a href="#orgc047c87">5. 游戏祖玛</a>
<ul>
<li><a href="#org36ba6a0">5.1. 游戏描述</a></li>
<li><a href="#orgefca718">5.2. 预备知识</a>
<ul>
<li><a href="#orgef611e1">5.2.1. 如何避免 ReadLine 阻塞</a></li>
<li><a href="#orgc243a6e">5.2.2. Console 的定点输出</a></li>
<li><a href="#orge04e9d2">5.2.3. 随机字符串的生成逻辑</a></li>
<li><a href="#orgabe8df9">5.2.4. 消除字符串的基本逻辑</a></li>
</ul>
</li>
<li><a href="#orgc3acba5">5.3. 分析</a></li>
<li><a href="#org8263fe4">5.4. 程序概览</a></li>
<li><a href="#org644c81b">5.5. Code Example</a></li>
<li><a href="#org7ac2d9a">5.6. 其他</a></li>
<li><a href="#org09a25a9">5.7. 小结</a></li>
</ul>
</li>
<li><a href="#org664c376">6. 导出为 Excel 的总结</a>
<ul>
<li><a href="#orgb6ec1ba">6.1. Repeat Yourself</a></li>
<li><a href="#orgfac97a8">6.2. 当逻辑在不同方法中 Repeat，将其 <b>分离</b> 为单独的方法</a></li>
<li><a href="#org567bd89">6.3. 当方法在不同类中 Repeat</a>
<ul>
<li><a href="#orge296b33">6.3.1. 在类中 Repeat Yourself</a></li>
<li><a href="#org6eeed7a">6.3.2. 首先将重复的方法 <b>分离</b> 到单独的类中</a></li>
<li><a href="#orgbf74fc9">6.3.3. 然后可以 <b>组合</b></a></li>
<li><a href="#orge161f16">6.3.4. 或者可以 <b>继承</b></a></li>
</ul>
</li>
<li><a href="#org7239fd8">6.4. 更进一步的 DRY</a>
<ul>
<li><a href="#org44a4258">6.4.1. 使用 <b>组合</b> 方式实现</a></li>
<li><a href="#org122cb2b">6.4.2. 使用 <b>继承</b> 方式实现 (你的是我的)</a></li>
<li><a href="#org1ffa4fb">6.4.3. 使用 <b>继承</b> 方式实现 (公共的字段)</a></li>
<li><a href="#orged5f856">6.4.4. 使用 <b>继承</b> 方式实现 (化虚为实)</a></li>
<li><a href="#org866fe03">6.4.5. 使用 <b>继承</b> 方式实现 (进击的继承)</a></li>
</ul>
</li>
<li><a href="#org8aa064b">6.5. 珠联璧合: 组合 + 继承</a>
<ul>
<li><a href="#orgbd9e150">6.5.1. ConsoleHelper</a></li>
<li><a href="#org62851f1">6.5.2. ExcelHelper</a></li>
<li><a href="#orgd6644f0">6.5.3. Calculator</a></li>
<li><a href="#org1c6e753">6.5.4. Main</a></li>
</ul>
</li>
<li><a href="#orgb1329e9">6.6. 不仅有权利还有义务，强制的规则: 抽象方法</a></li>
<li><a href="#org5de54a0">6.7. 有了接口，就有了 <del>工业</del> 标准，就有了分工和协作</a></li>
</ul>
</li>
<li><a href="#org8b59fca">7. 阶梯电费计算</a>
<ul>
<li><a href="#orgcdc956a">7.1. 第一种解决方案</a></li>
<li><a href="#orge0499e9">7.2. 第一种方案的优化版</a></li>
<li><a href="#org87022c0">7.3. 第二种方案</a></li>
<li><a href="#org6730ea1">7.4. 第二种方案的英文变量版本</a></li>
<li><a href="#org3f5da9d">7.5. 学习怎么使用别人的封装 (Console)</a></li>
<li><a href="#org12b0fdd">7.6. 学习怎么使用别人的封装 (ExportToExcel)</a></li>
<li><a href="#org886dfe1">7.7. 优化 ExportToExcel 为直接使用已存在的文件</a></li>
</ul>
</li>
<li><a href="#org9c3454e">8. 个税计算器 (简化版) 源</a>
<ul>
<li><a href="#orga8de1a8">8.1. 原始版本，*顺序* 执行</a></li>
<li><a href="#orgd09fb09">8.2. 原始版本的批注</a></li>
<li><a href="#org3e506ca">8.3. 第四组优化版</a></li>
<li><a href="#orgf0945da">8.4. <b>分离</b> 计算跟输出，优化代码结构</a></li>
<li><a href="#orgf2eded1">8.5. 通过 <b>方法</b> 对逻辑进行提取</a></li>
<li><a href="#org427d6c5">8.6. 通过 <b>类</b> 对代码逻辑进行进一步分离</a></li>
<li><a href="#org64c0722">8.7. 让类中的各个方法，能 <b>共享数据</b></a></li>
<li><a href="#org0c46169">8.8. 引入 <b>对象</b> 保证调用的数据安全</a></li>
<li><a href="#org99be013">8.9. 通过 [private Field + public Method] 的方式，*保护数据* 安全</a></li>
<li><a href="#orgcab3e20">8.10. 减少代码冗余，*Lazy* and <b>Eager</b></a></li>
<li><a href="#org1c6173a">8.11. 来自语法糖的力量: 通过 <b>Property</b> 简化代码</a>
<ul>
<li><a href="#org814f8da">8.11.1. Eager Version</a></li>
<li><a href="#org9f3915f">8.11.2. Lazy Version</a></li>
</ul>
</li>
<li><a href="#orge446b07">8.12. 使用 <b>Constructor</b> 进行对象的个性化构建</a></li>
<li><a href="#orge51b682">8.13. 使用 <b>static</b> 将某些数据归属于类，达到数据共享的目的</a></li>
<li><a href="#org7bd9dc5">8.14. 小结</a></li>
</ul>
</li>
<li><a href="#org51b2636">9. 小费计算器</a>
<ul>
<li><a href="#org9914205">9.1. 核心代码</a></li>
<li><a href="#orgb539204">9.2. 在核心代码上进行优化</a></li>
<li><a href="#org93ab691">9.3. 结构化重构</a></li>
</ul>
</li>
</ul>
</div>
</nav>



<section id="outline-container-org9041619" class="outline-2">
<h2 id="org9041619"><span class="section-number-2">1.</span> 分数录入工具</h2>
<div class="outline-text-2" id="text-1">
<p>
ScoreRecord:
</p>
<ul class="org-ul">
<li>sr["xm"] = 23.5</li>
<li>Console.Write(sr["xh"])</li>
<li>sr.Print()</li>
<li>sr.Export()</li>
</ul>

<p>
加入交互。
</p>
</div>

<div id="outline-container-org92a7baa" class="outline-3">
<h3 id="org92a7baa"><span class="section-number-3">1.1.</span> 参考答案</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">
<pre class="src src-cs"><span class="linenr">  1: </span><span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">ScoreRecorder</span>
<span class="linenr">  2: </span><span style="color: #707183;">{</span>
<span class="linenr">  3: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span class="linenr">  4: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">  5: </span>        <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #909183;">)</span>
<span class="linenr">  6: </span>        <span style="color: #909183;">{</span>
<span class="linenr">  7: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">sr</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ScoreRecorder</span><span style="color: #709870;">()</span>;
<span class="linenr">  8: </span>            sr.<span style="color: #0000ff;">Startup</span><span style="color: #709870;">()</span>;
<span class="linenr">  9: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 10: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 11: </span>
<span class="linenr"> 12: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ScoreRecorder</span>
<span class="linenr"> 13: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 14: </span>        <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">Dictionary</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">string</span>, <span style="color: #228b22;">double</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">_scores</span> = <span style="color: #a020f0;">new</span><span style="color: #909183;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25968;&#25454;&#28304;&#65292;&#26680;&#24515;</span>
<span class="linenr"> 15: </span>
<span class="linenr"> 16: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span>? <span style="color: #a020f0;">this</span><span style="color: #909183;">[</span><span style="color: #228b22;">string</span> name<span style="color: #909183;">]</span>
<span class="linenr"> 17: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 18: </span>            <span style="color: #a020f0;">get</span>
<span class="linenr"> 19: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 20: </span>                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>_scores.<span style="color: #0000ff;">ContainsKey</span><span style="color: #6276ba;">(</span><span style="color: #228b22;">name</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
<span class="linenr"> 21: </span>                <span style="color: #907373;">{</span>
<span class="linenr"> 22: </span>                    <span style="color: #a020f0;">return</span> _scores<span style="color: #6276ba;">[</span>name<span style="color: #6276ba;">]</span>;
<span class="linenr"> 23: </span>                <span style="color: #907373;">}</span>
<span class="linenr"> 24: </span>
<span class="linenr"> 25: </span>                <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">null</span>;
<span class="linenr"> 26: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 27: </span>            <span style="color: #a020f0;">set</span>
<span class="linenr"> 28: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 29: </span>                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span><span style="color: #008b8b;">value</span> == <span style="color: #008b8b;">null</span><span style="color: #907373;">)</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524; sr[x] = null, &#37027;&#20040;&#24403;&#20316;&#21024;&#38500;</span>
<span class="linenr"> 30: </span>                <span style="color: #907373;">{</span>
<span class="linenr"> 31: </span>                    _scores.<span style="color: #0000ff;">Remove</span><span style="color: #6276ba;">(</span><span style="color: #228b22;">name</span><span style="color: #6276ba;">)</span>;
<span class="linenr"> 32: </span>                <span style="color: #907373;">}</span>
<span class="linenr"> 33: </span>                <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span><span style="color: #008b8b;">value</span> &gt; 100 || <span style="color: #008b8b;">value</span> &lt;0<span style="color: #907373;">)</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#19981;&#21512;&#27861;&#30340;&#36755;&#20837;</span>
<span class="linenr"> 34: </span>                <span style="color: #907373;">{</span>
<span class="linenr"> 35: </span>                    <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Exception</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"&#20998;&#25968;&#24517;&#39035;&#26159; 0 ~ 100 &#20043;&#38388;"</span><span style="color: #6276ba;">)</span>;
<span class="linenr"> 36: </span>                <span style="color: #907373;">}</span>
<span class="linenr"> 37: </span>                <span style="color: #a020f0;">else</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#28155;&#21152;</span>
<span class="linenr"> 38: </span>                <span style="color: #907373;">{</span>
<span class="linenr"> 39: </span>                    _scores<span style="color: #6276ba;">[</span>name<span style="color: #6276ba;">]</span> = <span style="color: #6276ba;">(</span><span style="color: #228b22;">double</span><span style="color: #6276ba;">)</span><span style="color: #008b8b;">value</span>;
<span class="linenr"> 40: </span>                <span style="color: #907373;">}</span>
<span class="linenr"> 41: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 42: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 43: </span>
<span class="linenr"> 44: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Print</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span><span style="color: #909183;">)</span>
<span class="linenr"> 45: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 46: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
<span class="linenr"> 47: </span>            <span style="color: #228b22;">double</span>? <span style="color: #a0522d;">score</span> = <span style="color: #a020f0;">this</span><span style="color: #709870;">[</span>name<span style="color: #709870;">]</span>;
<span class="linenr"> 48: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>score == <span style="color: #008b8b;">null</span> ? $<span style="color: #8b2252;">"{name} &#30340;&#25104;&#32489;&#19981;&#23384;&#22312;"</span> : $<span style="color: #8b2252;">"{name}: {score}"</span><span style="color: #709870;">)</span>;
<span class="linenr"> 49: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 50: </span>
<span class="linenr"> 51: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintAll</span><span style="color: #909183;">()</span>
<span class="linenr"> 52: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 53: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
<span class="linenr"> 54: </span>
<span class="linenr"> 55: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>_scores.Count == 0<span style="color: #709870;">)</span>
<span class="linenr"> 56: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 57: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#24403;&#21069;&#19981;&#23384;&#22312;&#20219;&#20309;&#25104;&#32489;&#65292;&#35831;&#20808;&#24405;&#20837;&#12290;"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 58: </span>                <span style="color: #a020f0;">return</span>;
<span class="linenr"> 59: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 60: </span>
<span class="linenr"> 61: </span>            <span style="color: #a020f0;">foreach</span> <span style="color: #709870;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">score</span> <span style="color: #a020f0;">in</span> _scores<span style="color: #709870;">)</span>
<span class="linenr"> 62: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 63: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"{score.Key} &#30340;&#25104;&#32489;&#20026;: {score.Value}"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 64: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 65: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 66: </span>
<span class="linenr"> 67: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Export</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">path</span><span style="color: #909183;">)</span>
<span class="linenr"> 68: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 69: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">sb</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #709870;">()</span>;
<span class="linenr"> 70: </span>            <span style="color: #a020f0;">foreach</span> <span style="color: #709870;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">score</span> <span style="color: #a020f0;">in</span> _scores<span style="color: #709870;">)</span>
<span class="linenr"> 71: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 72: </span>                sb.<span style="color: #0000ff;">Append</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"\n\n{score.Key} -- {score.Value}\n"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 73: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 74: </span>
<span class="linenr"> 75: </span>            File.<span style="color: #0000ff;">WriteAllText</span><span style="color: #709870;">(</span><span style="color: #228b22;">path</span>, sb.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
<span class="linenr"> 76: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 77: </span>
<span class="linenr"> 78: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20132;&#20114;&#26041;&#27861;</span>
<span class="linenr"> 79: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Record</span><span style="color: #909183;">()</span>
<span class="linenr"> 80: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 81: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#22995;&#21517;: "</span><span style="color: #709870;">)</span>;
<span class="linenr"> 82: </span>            <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span> = Console.<span style="color: #0000ff;">ReadLine</span><span style="color: #709870;">()</span>;
<span class="linenr"> 83: </span>
<span class="linenr"> 84: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>_scores.<span style="color: #0000ff;">ContainsKey</span><span style="color: #907373;">(</span><span style="color: #228b22;">name</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
<span class="linenr"> 85: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 86: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24050;&#32463;&#23384;&#22312; {name} &#30340;&#25104;&#32489;&#65292;&#20026; {this[name]}"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 87: </span>                <span style="color: #a020f0;">return</span>;
<span class="linenr"> 88: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 89: </span>
<span class="linenr"> 90: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25104;&#32489;: "</span><span style="color: #709870;">)</span>;
<span class="linenr"> 91: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span><span style="color: #228b22;">double</span>.<span style="color: #0000ff;">TryParse</span><span style="color: #907373;">(</span>Console.<span style="color: #0000ff;">ReadLine</span><span style="color: #6276ba;">()</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">score</span><span style="color: #907373;">)</span>
<span class="linenr"> 92: </span>                &amp;&amp; score &lt;= 100 &amp;&amp; score &gt;= 0<span style="color: #709870;">)</span>
<span class="linenr"> 93: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 94: </span>                <span style="color: #a020f0;">this</span><span style="color: #907373;">[</span>name<span style="color: #907373;">]</span> = score;
<span class="linenr"> 95: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 96: </span>            <span style="color: #a020f0;">else</span>
<span class="linenr"> 97: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 98: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#36755;&#20837;&#26684;&#24335;&#26377;&#35823;&#65292;&#20998;&#25968;&#24517;&#39035;&#26159; 0 ~ 100 &#20043;&#38388;&#30340;&#25968;&#23383;"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 99: </span>            <span style="color: #709870;">}</span>
<span class="linenr">100: </span>        <span style="color: #909183;">}</span>
<span class="linenr">101: </span>
<span class="linenr">102: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">RecordLoop</span><span style="color: #909183;">()</span>
<span class="linenr">103: </span>        <span style="color: #909183;">{</span>
<span class="linenr">104: </span>            <span style="color: #a020f0;">while</span> <span style="color: #709870;">(</span><span style="color: #008b8b;">true</span><span style="color: #709870;">)</span>
<span class="linenr">105: </span>            <span style="color: #709870;">{</span>
<span class="linenr">106: </span>                <span style="color: #0000ff;">Record</span><span style="color: #907373;">()</span>;
<span class="linenr">107: </span>
<span class="linenr">108: </span>                Console.ForegroundColor = ConsoleColor.Gray;
<span class="linenr">109: </span>                Console.<span style="color: #0000ff;">Write</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#25353;&#20219;&#24847;&#38190;&#36755;&#20837;&#19979;&#19968;&#20010;&#25104;&#32489;&#65292;&#25353; N/Q &#36864;&#20986;..."</span><span style="color: #907373;">)</span>;
<span class="linenr">110: </span>                Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #907373;">()</span>;
<span class="linenr">111: </span>
<span class="linenr">112: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">key</span> = Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #907373;">()</span>;
<span class="linenr">113: </span>                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>key.Key == ConsoleKey.N || key.Key == ConsoleKey.Q<span style="color: #907373;">)</span>
<span class="linenr">114: </span>                <span style="color: #907373;">{</span>
<span class="linenr">115: </span>                    <span style="color: #a020f0;">return</span>;
<span class="linenr">116: </span>                <span style="color: #907373;">}</span>
<span class="linenr">117: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">()</span>;
<span class="linenr">118: </span>            <span style="color: #709870;">}</span>
<span class="linenr">119: </span>        <span style="color: #909183;">}</span>
<span class="linenr">120: </span>
<span class="linenr">121: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Query</span><span style="color: #909183;">()</span>
<span class="linenr">122: </span>        <span style="color: #909183;">{</span>
<span class="linenr">123: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#35831;&#36755;&#20837;&#24744;&#35201;&#26597;&#35810;&#30340;&#23398;&#29983;&#30340;&#22995;&#21517;: "</span><span style="color: #709870;">)</span>;
<span class="linenr">124: </span>            <span style="color: #0000ff;">Print</span><span style="color: #709870;">(</span>Console.<span style="color: #0000ff;">ReadLine</span><span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
<span class="linenr">125: </span>        <span style="color: #909183;">}</span>
<span class="linenr">126: </span>
<span class="linenr">127: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportTo</span><span style="color: #909183;">()</span>
<span class="linenr">128: </span>        <span style="color: #909183;">{</span>
<span class="linenr">129: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#35831;&#36755;&#20837;&#24744;&#35201;&#23548;&#20986;&#30340;&#36335;&#24452;: "</span><span style="color: #709870;">)</span>;
<span class="linenr">130: </span>            <span style="color: #0000ff;">Export</span><span style="color: #709870;">(</span>Console.<span style="color: #0000ff;">ReadLine</span><span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
<span class="linenr">131: </span>        <span style="color: #909183;">}</span>
<span class="linenr">132: </span>
<span class="linenr">133: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintMenu</span><span style="color: #909183;">()</span>
<span class="linenr">134: </span>        <span style="color: #909183;">{</span>
<span class="linenr">135: </span>            Console.ForegroundColor = ConsoleColor.DarkBlue;
<span class="linenr">136: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"\n\n=-= &#27426;&#36814;&#26469;&#21040;&#36825;&#37324; =-=\n"</span><span style="color: #709870;">)</span>;
<span class="linenr">137: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"1. &#24405;&#20837; 2. &#26597;&#35810; 3. &#25171;&#21360;&#25152;&#26377; 4. &#23548;&#20986;&#21040;&#25991;&#20214;\n\n"</span><span style="color: #709870;">)</span>;
<span class="linenr">138: </span>            Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #709870;">()</span>;
<span class="linenr">139: </span>        <span style="color: #909183;">}</span>
<span class="linenr">140: </span>
<span class="linenr">141: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Startup</span><span style="color: #909183;">()</span>
<span class="linenr">142: </span>        <span style="color: #909183;">{</span>
<span class="linenr">143: </span>            <span style="color: #a020f0;">while</span> <span style="color: #709870;">(</span><span style="color: #008b8b;">true</span><span style="color: #709870;">)</span>
<span class="linenr">144: </span>            <span style="color: #709870;">{</span>
<span class="linenr">145: </span>                <span style="color: #0000ff;">PrintMenu</span><span style="color: #907373;">()</span>;
<span class="linenr">146: </span>
<span class="linenr">147: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">key</span> = Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #907373;">()</span>;
<span class="linenr">148: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">()</span>;
<span class="linenr">149: </span>
<span class="linenr">150: </span>                <span style="color: #a020f0;">switch</span> <span style="color: #907373;">(</span>key.Key<span style="color: #907373;">)</span>
<span class="linenr">151: </span>                <span style="color: #907373;">{</span>
<span class="linenr">152: </span>                    <span style="color: #a020f0;">case</span> ConsoleKey.D1:
<span class="linenr">153: </span>                        <span style="color: #0000ff;">RecordLoop</span><span style="color: #6276ba;">()</span>;
<span class="linenr">154: </span>                        <span style="color: #a020f0;">break</span>;
<span class="linenr">155: </span>                    <span style="color: #a020f0;">case</span> ConsoleKey.D2:
<span class="linenr">156: </span>                        <span style="color: #0000ff;">Query</span><span style="color: #6276ba;">()</span>;
<span class="linenr">157: </span>                        <span style="color: #a020f0;">break</span>;
<span class="linenr">158: </span>                    <span style="color: #a020f0;">case</span> ConsoleKey.D3:
<span class="linenr">159: </span>                        <span style="color: #0000ff;">PrintAll</span><span style="color: #6276ba;">()</span>;
<span class="linenr">160: </span>                        <span style="color: #a020f0;">break</span>;
<span class="linenr">161: </span>                    <span style="color: #a020f0;">case</span> ConsoleKey.D4:
<span class="linenr">162: </span>                        <span style="color: #0000ff;">ExportTo</span><span style="color: #6276ba;">()</span>;
<span class="linenr">163: </span>                        <span style="color: #a020f0;">break</span>;
<span class="linenr">164: </span>                    <span style="color: #a020f0;">case</span> ConsoleKey.Q:
<span class="linenr">165: </span>                        <span style="color: #a020f0;">return</span>;
<span class="linenr">166: </span>                    <span style="color: #a020f0;">default</span>:
<span class="linenr">167: </span>                        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"&#36755;&#20837;&#26377;&#35823;...."</span><span style="color: #6276ba;">)</span>;
<span class="linenr">168: </span>                        <span style="color: #a020f0;">break</span>;
<span class="linenr">169: </span>                <span style="color: #907373;">}</span>
<span class="linenr">170: </span>            <span style="color: #709870;">}</span>
<span class="linenr">171: </span>        <span style="color: #909183;">}</span>
<span class="linenr">172: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">173: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org60cc87b" class="outline-3">
<h3 id="org60cc87b"><span class="section-number-3">1.2.</span> 新的要求</h3>
<div class="outline-text-3" id="text-1-2">
<p>
在上面的思路基础上，按如下逻辑重新实现:
</p>
<ol class="org-ol">
<li>创建一个 Excel 表格，在里面初始化好所有需要录入分数的学生名单</li>
<li>创建项目，编写逻辑，然后构建。使用如下:
<ul class="org-ul">
<li>如果执行 <code>程序 all</code> 那么将显式所有学生</li>
<li>如果执行 <code>程序 done</code> 那么将显式所有录完成绩的学生信息</li>
<li>如果执行 <code>程序 todo</code> 那么将显式所有未录成绩的学生信息</li>
<li>如果执行 <code>程序 update 学生</code> 将会更新某个学生的成绩。当这个学生成绩不存在，提示错误。如果这个学生以录入成绩，给出提醒是否覆盖。
更新的结果要保存进 Excel</li>
</ul></li>
</ol>

<p>
Excel 大体结构:
</p>
<table>


<colgroup>
<col  class="org-right">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">id</th>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-right">Score</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">zhangsan</td>
<td class="org-right">22</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">lisi</td>
<td class="org-right">&#xa0;</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">wangwu</td>
<td class="org-right">&#xa0;</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-orgc645b22" class="outline-4">
<h4 id="orgc645b22"><span class="section-number-4">1.2.1.</span> 示例代码</h4>
<div class="outline-text-4" id="text-1-2-1">
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr">  1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span class="linenr">  2: </span><span style="color: #707183;">{</span>
<span class="linenr">  3: </span>    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
<span class="linenr">  4: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">  5: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">sc2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ScoreRecorder2</span><span style="color: #909183;">()</span>;
<span class="linenr">  6: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span> == <span style="color: #8b2252;">"all"</span><span style="color: #909183;">)</span>
<span class="linenr">  7: </span>        <span style="color: #909183;">{</span>
<span class="linenr">  8: </span>            sc2.<span style="color: #0000ff;">PrintAll</span><span style="color: #709870;">()</span>;
<span class="linenr">  9: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 10: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span> == <span style="color: #8b2252;">"todo"</span><span style="color: #909183;">)</span>
<span class="linenr"> 11: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 12: </span>            sc2.<span style="color: #0000ff;">PrintTodo</span><span style="color: #709870;">()</span>;
<span class="linenr"> 13: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 14: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span> == <span style="color: #8b2252;">"done"</span><span style="color: #909183;">)</span>
<span class="linenr"> 15: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 16: </span>            sc2.<span style="color: #0000ff;">PrintDone</span><span style="color: #709870;">()</span>;
<span class="linenr"> 17: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 18: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span> == <span style="color: #8b2252;">"update"</span><span style="color: #909183;">)</span>
<span class="linenr"> 19: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 20: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">name</span> = args<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
<span class="linenr"> 21: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">scoreString</span> = args<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
<span class="linenr"> 22: </span>
<span class="linenr"> 23: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">score</span> = <span style="color: #228b22;">double</span>.<span style="color: #0000ff;">Parse</span><span style="color: #709870;">(</span><span style="color: #228b22;">scoreString</span><span style="color: #709870;">)</span>;
<span class="linenr"> 24: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{name}/{score}"</span><span style="color: #709870;">)</span>;
<span class="linenr"> 25: </span>            sc2.<span style="color: #0000ff;">Update</span><span style="color: #709870;">(</span><span style="color: #228b22;">name</span>, <span style="color: #228b22;">score</span><span style="color: #709870;">)</span>;
<span class="linenr"> 26: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 27: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr"> 28: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 29: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#20351;&#29992;&#30340;&#35821;&#27861;&#20026;&#65306; xxx update/all/done/todo"</span><span style="color: #709870;">)</span>;
<span class="linenr"> 30: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 31: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 32: </span><span style="color: #707183;">}</span>
<span class="linenr"> 33: </span>
<span class="linenr"> 34: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">ScoreRecorder2</span>
<span class="linenr"> 35: </span><span style="color: #707183;">{</span>
<span class="linenr"> 36: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Path</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>= @<span style="color: #8b2252;">"e:\chengji.xls"</span>;
<span class="linenr"> 37: </span>
<span class="linenr"> 38: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">Core</span>
<span class="linenr"> 39: </span>
<span class="linenr"> 40: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">rn</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">double</span>? <span style="color: #a0522d;">score</span><span style="color: #909183;">)</span><span style="color: #7388d6;">&gt;</span> <span style="color: #0000ff;">ReadAll</span><span style="color: #7388d6;">()</span>
<span class="linenr"> 41: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 42: </span>        <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #709870;">(</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span>, <span style="color: #228b22;">double</span>?<span style="color: #709870;">)</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">scores</span> = <span style="color: #a020f0;">new</span><span style="color: #909183;">()</span>;
<span class="linenr"> 43: </span>
<span class="linenr"> 44: </span>        <span style="color: #0000ff;">WithExcel</span><span style="color: #909183;">(</span>sheet =&gt;
<span class="linenr"> 45: </span>        <span style="color: #709870;">{</span>
<span class="linenr"> 46: </span>            <span style="color: #a020f0;">for</span> <span style="color: #907373;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">i</span> = 1; i &lt;= sheet.LastRowNum; i++<span style="color: #907373;">)</span>
<span class="linenr"> 47: </span>            <span style="color: #907373;">{</span>
<span class="linenr"> 48: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">GetRow</span><span style="color: #6276ba;">(</span><span style="color: #228b22;">i</span><span style="color: #6276ba;">)</span>;
<span class="linenr"> 49: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">name</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #6276ba;">(</span>0<span style="color: #6276ba;">)</span>.StringCellValue;
<span class="linenr"> 50: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">scoreCell</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #6276ba;">(</span>1<span style="color: #6276ba;">)</span>;
<span class="linenr"> 51: </span>                scores.<span style="color: #0000ff;">Add</span><span style="color: #6276ba;">(</span><span style="color: #858580;">(</span><span style="color: #228b22;">i</span>, <span style="color: #228b22;">name</span>, scoreCell?.NumericCellValue<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>;
<span class="linenr"> 52: </span>            <span style="color: #907373;">}</span>
<span class="linenr"> 53: </span>        <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
<span class="linenr"> 54: </span>
<span class="linenr"> 55: </span>        <span style="color: #a020f0;">return</span> scores;
<span class="linenr"> 56: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 57: </span>
<span class="linenr"> 58: </span>    <span style="color: #a020f0;">public</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">rn</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">double</span>? <span style="color: #a0522d;">score</span><span style="color: #7388d6;">)</span>? <span style="color: #0000ff;">Read</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 59: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 60: </span>        <span style="color: #909183;">(</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span>, <span style="color: #228b22;">double</span>?<span style="color: #909183;">)</span>? ss = <span style="color: #008b8b;">null</span>;
<span class="linenr"> 61: </span>
<span class="linenr"> 62: </span>        <span style="color: #0000ff;">WithExcel</span><span style="color: #909183;">(</span>sheet =&gt;
<span class="linenr"> 63: </span>        <span style="color: #709870;">{</span>
<span class="linenr"> 64: </span>            <span style="color: #a020f0;">for</span> <span style="color: #907373;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">i</span> = 1; i &lt;= sheet.LastRowNum; i++<span style="color: #907373;">)</span>
<span class="linenr"> 65: </span>            <span style="color: #907373;">{</span>
<span class="linenr"> 66: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">GetRow</span><span style="color: #6276ba;">(</span><span style="color: #228b22;">i</span><span style="color: #6276ba;">)</span>;
<span class="linenr"> 67: </span>                <span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>name != row.<span style="color: #0000ff;">GetCell</span><span style="color: #858580;">(</span>0<span style="color: #858580;">)</span>.StringCellValue<span style="color: #6276ba;">)</span> <span style="color: #a020f0;">continue</span>;
<span class="linenr"> 68: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">scoreCell</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #6276ba;">(</span>1<span style="color: #6276ba;">)</span>;
<span class="linenr"> 69: </span>                ss = <span style="color: #6276ba;">(</span><span style="color: #228b22;">i</span>, <span style="color: #228b22;">name</span>, scoreCell?.NumericCellValue<span style="color: #6276ba;">)</span>;
<span class="linenr"> 70: </span>            <span style="color: #907373;">}</span>
<span class="linenr"> 71: </span>        <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
<span class="linenr"> 72: </span>
<span class="linenr"> 73: </span>        <span style="color: #a020f0;">return</span> ss;
<span class="linenr"> 74: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 75: </span>
<span class="linenr"> 76: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">WriteScore</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">rn</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">cn</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">score</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 77: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 78: </span>        <span style="color: #0000ff;">WithExcel</span><span style="color: #909183;">(</span>sheet =&gt;
<span class="linenr"> 79: </span>        <span style="color: #709870;">{</span>
<span class="linenr"> 80: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">GetRow</span><span style="color: #907373;">(</span><span style="color: #228b22;">rn</span><span style="color: #907373;">)</span>;
<span class="linenr"> 81: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">cell</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #907373;">(</span><span style="color: #228b22;">cn</span><span style="color: #907373;">)</span> ?? row.<span style="color: #0000ff;">CreateCell</span><span style="color: #907373;">(</span>1<span style="color: #907373;">)</span>;
<span class="linenr"> 82: </span>            cell.<span style="color: #0000ff;">SetCellValue</span><span style="color: #907373;">(</span><span style="color: #228b22;">score</span><span style="color: #907373;">)</span>;
<span class="linenr"> 83: </span>        <span style="color: #709870;">}</span>, <span style="color: #008b8b;">true</span><span style="color: #909183;">)</span>;
<span class="linenr"> 84: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 85: </span>
<span class="linenr"> 86: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">Helper</span>
<span class="linenr"> 87: </span>
<span class="linenr"> 88: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">WithExcel</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Action</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">ISheet</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">act</span>, <span style="color: #228b22;">bool</span> <span style="color: #a0522d;">write</span> = <span style="color: #008b8b;">false</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 89: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 90: </span>        <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> file = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #909183;">(</span><span style="color: #228b22;">Path</span><span style="color: #909183;">)</span>;
<span class="linenr"> 91: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">xls</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">file</span><span style="color: #909183;">)</span>;
<span class="linenr"> 92: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">sheet</span> = xls.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr"> 93: </span>
<span class="linenr"> 94: </span>        <span style="color: #0000ff;">act</span><span style="color: #909183;">(</span><span style="color: #228b22;">sheet</span><span style="color: #909183;">)</span>;
<span class="linenr"> 95: </span>
<span class="linenr"> 96: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>write<span style="color: #909183;">)</span>
<span class="linenr"> 97: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 98: </span>            <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #709870;">(</span><span style="color: #228b22;">Path</span><span style="color: #709870;">)</span>;
<span class="linenr"> 99: </span>            xls.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #228b22;">sw</span><span style="color: #709870;">)</span>;
<span class="linenr">100: </span>        <span style="color: #909183;">}</span>
<span class="linenr">101: </span>
<span class="linenr">102: </span>        xls.<span style="color: #0000ff;">Close</span><span style="color: #909183;">()</span>;
<span class="linenr">103: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">104: </span>
<span class="linenr">105: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">Interactive</span>
<span class="linenr">106: </span>
<span class="linenr">107: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintAll</span><span style="color: #7388d6;">()</span>
<span class="linenr">108: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">109: </span>        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #0000ff;">s</span> <span style="color: #a020f0;">in</span> <span style="color: #0000ff;">ReadAll</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>
<span class="linenr">110: </span>        <span style="color: #909183;">{</span>
<span class="linenr">111: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>s.score.HasValue<span style="color: #709870;">)</span>
<span class="linenr">112: </span>            <span style="color: #709870;">{</span>
<span class="linenr">113: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"{s.name} &#30340;&#25104;&#32489;&#20026; {s.score}"</span><span style="color: #907373;">)</span>;
<span class="linenr">114: </span>            <span style="color: #709870;">}</span>
<span class="linenr">115: </span>            <span style="color: #a020f0;">else</span>
<span class="linenr">116: </span>            <span style="color: #709870;">{</span>
<span class="linenr">117: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"{s.name} &#30340;&#25104;&#32489;&#19981;&#23384;&#22312;"</span><span style="color: #907373;">)</span>;
<span class="linenr">118: </span>            <span style="color: #709870;">}</span>
<span class="linenr">119: </span>        <span style="color: #909183;">}</span>
<span class="linenr">120: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">121: </span>
<span class="linenr">122: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintDone</span><span style="color: #7388d6;">()</span>
<span class="linenr">123: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">124: </span>        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #0000ff;">s</span> <span style="color: #a020f0;">in</span> <span style="color: #0000ff;">ReadAll</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>
<span class="linenr">125: </span>        <span style="color: #909183;">{</span>
<span class="linenr">126: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>s.score.HasValue<span style="color: #709870;">)</span>
<span class="linenr">127: </span>            <span style="color: #709870;">{</span>
<span class="linenr">128: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"{s.name} &#30340;&#25104;&#32489;&#20026; {s.score}"</span><span style="color: #907373;">)</span>;
<span class="linenr">129: </span>            <span style="color: #709870;">}</span>
<span class="linenr">130: </span>        <span style="color: #909183;">}</span>
<span class="linenr">131: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">132: </span>
<span class="linenr">133: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintTodo</span><span style="color: #7388d6;">()</span>
<span class="linenr">134: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">135: </span>        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #0000ff;">s</span> <span style="color: #a020f0;">in</span> <span style="color: #0000ff;">ReadAll</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>
<span class="linenr">136: </span>        <span style="color: #909183;">{</span>
<span class="linenr">137: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>!s.score.HasValue<span style="color: #709870;">)</span>
<span class="linenr">138: </span>            <span style="color: #709870;">{</span>
<span class="linenr">139: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"{s.name} &#27809;&#26377;&#25104;&#32489;"</span><span style="color: #907373;">)</span>;
<span class="linenr">140: </span>            <span style="color: #709870;">}</span>
<span class="linenr">141: </span>        <span style="color: #909183;">}</span>
<span class="linenr">142: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">143: </span>
<span class="linenr">144: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Update</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">score</span><span style="color: #7388d6;">)</span>
<span class="linenr">145: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">146: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">info</span> = <span style="color: #0000ff;">Read</span><span style="color: #909183;">(</span><span style="color: #228b22;">name</span><span style="color: #909183;">)</span>;
<span class="linenr">147: </span>
<span class="linenr">148: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>info == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span>
<span class="linenr">149: </span>        <span style="color: #909183;">{</span>
<span class="linenr">150: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#23398;&#29983;&#19981;&#23384;&#22312;"</span><span style="color: #709870;">)</span>;
<span class="linenr">151: </span>            <span style="color: #a020f0;">return</span>;
<span class="linenr">152: </span>        <span style="color: #909183;">}</span>
<span class="linenr">153: </span>
<span class="linenr">154: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>info.Value.score.HasValue<span style="color: #909183;">)</span>
<span class="linenr">155: </span>        <span style="color: #909183;">{</span>
<span class="linenr">156: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#23398;&#29983;&#30340;&#25104;&#32489;&#24050;&#32463;&#23384;&#22312; ({info.Value.name} : {info.Value.score})&#65292;&#26159;&#21542;&#35206;&#30422; (Y)? "</span><span style="color: #709870;">)</span>;
<span class="linenr">157: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #907373;">()</span>.Key != ConsoleKey.Y<span style="color: #709870;">)</span> <span style="color: #a020f0;">return</span>;
<span class="linenr">158: </span>        <span style="color: #909183;">}</span>
<span class="linenr">159: </span>
<span class="linenr">160: </span>        <span style="color: #0000ff;">WriteScore</span><span style="color: #909183;">(</span>info.Value.<span style="color: #228b22;">rn</span>, 1, <span style="color: #228b22;">score</span><span style="color: #909183;">)</span>;
<span class="linenr">161: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">162: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a056f0" class="outline-4">
<h4 id="org3a056f0"><span class="section-number-4">1.2.2.</span> 另一个版本</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
稍微简化了一些。
</p>


<figure id="org13da2e8">
<img src="img/score-record.png" alt="score-record.png" width="300px">

</figure>


<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr">  1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span class="linenr">  2: </span><span style="color: #707183;">{</span>
<span class="linenr">  3: </span>    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
<span class="linenr">  4: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">  5: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">sc3</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ScoreRecorder3</span><span style="color: #909183;">()</span>;
<span class="linenr">  6: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span> == <span style="color: #8b2252;">"all"</span><span style="color: #909183;">)</span>
<span class="linenr">  7: </span>        <span style="color: #909183;">{</span>
<span class="linenr">  8: </span>            sc3.<span style="color: #0000ff;">PrintAll</span><span style="color: #709870;">()</span>;
<span class="linenr">  9: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 10: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span> == <span style="color: #8b2252;">"todo"</span><span style="color: #909183;">)</span>
<span class="linenr"> 11: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 12: </span>            sc3.<span style="color: #0000ff;">PrintTodo</span><span style="color: #709870;">()</span>;
<span class="linenr"> 13: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 14: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span> == <span style="color: #8b2252;">"done"</span><span style="color: #909183;">)</span>
<span class="linenr"> 15: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 16: </span>            sc3.<span style="color: #0000ff;">PrintDone</span><span style="color: #709870;">()</span>;
<span class="linenr"> 17: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 18: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span> == <span style="color: #8b2252;">"update"</span><span style="color: #909183;">)</span>
<span class="linenr"> 19: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 20: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">name</span> = args<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
<span class="linenr"> 21: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">scoreString</span> = args<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
<span class="linenr"> 22: </span>
<span class="linenr"> 23: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">score</span> = <span style="color: #228b22;">double</span>.<span style="color: #0000ff;">Parse</span><span style="color: #709870;">(</span><span style="color: #228b22;">scoreString</span><span style="color: #709870;">)</span>;
<span class="linenr"> 24: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{name}/{score}"</span><span style="color: #709870;">)</span>;
<span class="linenr"> 25: </span>            sc3.<span style="color: #0000ff;">Update</span><span style="color: #709870;">(</span><span style="color: #228b22;">name</span>, <span style="color: #228b22;">score</span><span style="color: #709870;">)</span>;
<span class="linenr"> 26: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 27: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr"> 28: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 29: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#20351;&#29992;&#30340;&#35821;&#27861;&#20026;&#65306; xxx update/all/done/todo"</span><span style="color: #709870;">)</span>;
<span class="linenr"> 30: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 31: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 32: </span><span style="color: #707183;">}</span>
<span class="linenr"> 33: </span>
<span class="linenr"> 34: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">ScoreRecorder3</span>
<span class="linenr"> 35: </span><span style="color: #707183;">{</span>
<span class="linenr"> 36: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Path</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>= @<span style="color: #8b2252;">"e:\chengji.xls"</span>;
<span class="linenr"> 37: </span>
<span class="linenr"> 38: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">Core</span>
<span class="linenr"> 39: </span>
<span class="linenr"> 40: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Dictionary</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">string</span>, <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">rn</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">double</span>? <span style="color: #a0522d;">score</span><span style="color: #909183;">)</span><span style="color: #7388d6;">&gt;</span> <span style="color: #0000ff;">ReadAll</span><span style="color: #7388d6;">()</span>
<span class="linenr"> 41: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 42: </span>        <span style="color: #228b22;">Dictionary</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">string</span>, <span style="color: #709870;">(</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span>, <span style="color: #228b22;">double</span>?<span style="color: #709870;">)</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">scores</span> = <span style="color: #a020f0;">new</span><span style="color: #909183;">()</span>;
<span class="linenr"> 43: </span>
<span class="linenr"> 44: </span>        <span style="color: #0000ff;">WithExcel</span><span style="color: #909183;">(</span>sheet =&gt;
<span class="linenr"> 45: </span>        <span style="color: #709870;">{</span>
<span class="linenr"> 46: </span>            <span style="color: #a020f0;">for</span> <span style="color: #907373;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">i</span> = 1; i &lt;= sheet.LastRowNum; i++<span style="color: #907373;">)</span>
<span class="linenr"> 47: </span>            <span style="color: #907373;">{</span>
<span class="linenr"> 48: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">GetRow</span><span style="color: #6276ba;">(</span><span style="color: #228b22;">i</span><span style="color: #6276ba;">)</span>;
<span class="linenr"> 49: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">name</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #6276ba;">(</span>0<span style="color: #6276ba;">)</span>.StringCellValue;
<span class="linenr"> 50: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">scoreCell</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #6276ba;">(</span>1<span style="color: #6276ba;">)</span>;
<span class="linenr"> 51: </span>                scores<span style="color: #6276ba;">[</span>name<span style="color: #6276ba;">]</span> = <span style="color: #6276ba;">(</span><span style="color: #228b22;">i</span>, <span style="color: #228b22;">name</span>, scoreCell?.NumericCellValue<span style="color: #6276ba;">)</span>;
<span class="linenr"> 52: </span>            <span style="color: #907373;">}</span>
<span class="linenr"> 53: </span>        <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
<span class="linenr"> 54: </span>
<span class="linenr"> 55: </span>        <span style="color: #a020f0;">return</span> scores;
<span class="linenr"> 56: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 57: </span>
<span class="linenr"> 58: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">WriteScore</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">rn</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">cn</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">score</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 59: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 60: </span>        <span style="color: #0000ff;">WithExcel</span><span style="color: #909183;">(</span>sheet =&gt;
<span class="linenr"> 61: </span>        <span style="color: #709870;">{</span>
<span class="linenr"> 62: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">GetRow</span><span style="color: #907373;">(</span><span style="color: #228b22;">rn</span><span style="color: #907373;">)</span>;
<span class="linenr"> 63: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">cell</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #907373;">(</span><span style="color: #228b22;">cn</span><span style="color: #907373;">)</span> ?? row.<span style="color: #0000ff;">CreateCell</span><span style="color: #907373;">(</span>1<span style="color: #907373;">)</span>;
<span class="linenr"> 64: </span>            cell.<span style="color: #0000ff;">SetCellValue</span><span style="color: #907373;">(</span><span style="color: #228b22;">score</span><span style="color: #907373;">)</span>;
<span class="linenr"> 65: </span>        <span style="color: #709870;">}</span>, <span style="color: #008b8b;">true</span><span style="color: #909183;">)</span>;
<span class="linenr"> 66: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 67: </span>
<span class="linenr"> 68: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">Helper</span>
<span class="linenr"> 69: </span>
<span class="linenr"> 70: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">WithExcel</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Action</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">ISheet</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">act</span>, <span style="color: #228b22;">bool</span> <span style="color: #a0522d;">write</span> = <span style="color: #008b8b;">false</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 71: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 72: </span>        <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> file = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #909183;">(</span><span style="color: #228b22;">Path</span><span style="color: #909183;">)</span>;
<span class="linenr"> 73: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">xls</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">file</span><span style="color: #909183;">)</span>;
<span class="linenr"> 74: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">sheet</span> = xls.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr"> 75: </span>
<span class="linenr"> 76: </span>        <span style="color: #0000ff;">act</span><span style="color: #909183;">(</span><span style="color: #228b22;">sheet</span><span style="color: #909183;">)</span>;
<span class="linenr"> 77: </span>
<span class="linenr"> 78: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>write<span style="color: #909183;">)</span>
<span class="linenr"> 79: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 80: </span>            <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #709870;">(</span><span style="color: #228b22;">Path</span><span style="color: #709870;">)</span>;
<span class="linenr"> 81: </span>            xls.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #228b22;">sw</span><span style="color: #709870;">)</span>;
<span class="linenr"> 82: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 83: </span>
<span class="linenr"> 84: </span>        xls.<span style="color: #0000ff;">Close</span><span style="color: #909183;">()</span>;
<span class="linenr"> 85: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 86: </span>
<span class="linenr"> 87: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">Interactive</span>
<span class="linenr"> 88: </span>
<span class="linenr"> 89: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintAll</span><span style="color: #7388d6;">()</span>
<span class="linenr"> 90: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 91: </span>        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #0000ff;">s</span> <span style="color: #a020f0;">in</span> <span style="color: #0000ff;">ReadAll</span><span style="color: #709870;">()</span>.Values<span style="color: #909183;">)</span>
<span class="linenr"> 92: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 93: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>s.score.HasValue<span style="color: #709870;">)</span>
<span class="linenr"> 94: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 95: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"{s.name} &#30340;&#25104;&#32489;&#20026; {s.score}"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 96: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 97: </span>            <span style="color: #a020f0;">else</span>
<span class="linenr"> 98: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 99: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"{s.name} &#30340;&#25104;&#32489;&#19981;&#23384;&#22312;"</span><span style="color: #907373;">)</span>;
<span class="linenr">100: </span>            <span style="color: #709870;">}</span>
<span class="linenr">101: </span>        <span style="color: #909183;">}</span>
<span class="linenr">102: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">103: </span>
<span class="linenr">104: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintDone</span><span style="color: #7388d6;">()</span>
<span class="linenr">105: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">106: </span>        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #0000ff;">s</span> <span style="color: #a020f0;">in</span> <span style="color: #0000ff;">ReadAll</span><span style="color: #709870;">()</span>.Values<span style="color: #909183;">)</span>
<span class="linenr">107: </span>        <span style="color: #909183;">{</span>
<span class="linenr">108: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>s.score.HasValue<span style="color: #709870;">)</span>
<span class="linenr">109: </span>            <span style="color: #709870;">{</span>
<span class="linenr">110: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"{s.name} &#30340;&#25104;&#32489;&#20026; {s.score}"</span><span style="color: #907373;">)</span>;
<span class="linenr">111: </span>            <span style="color: #709870;">}</span>
<span class="linenr">112: </span>        <span style="color: #909183;">}</span>
<span class="linenr">113: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">114: </span>
<span class="linenr">115: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintTodo</span><span style="color: #7388d6;">()</span>
<span class="linenr">116: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">117: </span>        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #0000ff;">s</span> <span style="color: #a020f0;">in</span> <span style="color: #0000ff;">ReadAll</span><span style="color: #709870;">()</span>.Values<span style="color: #909183;">)</span>
<span class="linenr">118: </span>        <span style="color: #909183;">{</span>
<span class="linenr">119: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>!s.score.HasValue<span style="color: #709870;">)</span>
<span class="linenr">120: </span>            <span style="color: #709870;">{</span>
<span class="linenr">121: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"{s.name} &#27809;&#26377;&#25104;&#32489;"</span><span style="color: #907373;">)</span>;
<span class="linenr">122: </span>            <span style="color: #709870;">}</span>
<span class="linenr">123: </span>        <span style="color: #909183;">}</span>
<span class="linenr">124: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">125: </span>
<span class="linenr">126: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Update</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">score</span><span style="color: #7388d6;">)</span>
<span class="linenr">127: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">128: </span>        <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>!<span style="color: #0000ff;">ReadAll</span><span style="color: #709870;">()</span>.<span style="color: #0000ff;">TryGetValue</span><span style="color: #709870;">(</span><span style="color: #228b22;">name</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">var</span> <span style="color: #a0522d;">info</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
<span class="linenr">129: </span>        <span style="color: #909183;">{</span>
<span class="linenr">130: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#23398;&#29983;&#19981;&#23384;&#22312;"</span><span style="color: #709870;">)</span>;
<span class="linenr">131: </span>            <span style="color: #a020f0;">return</span>;
<span class="linenr">132: </span>        <span style="color: #909183;">}</span>
<span class="linenr">133: </span>
<span class="linenr">134: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>info.score.HasValue<span style="color: #909183;">)</span>
<span class="linenr">135: </span>        <span style="color: #909183;">{</span>
<span class="linenr">136: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#23398;&#29983;&#30340;&#25104;&#32489;&#24050;&#32463;&#23384;&#22312; ({info.name} : {info.score})&#65292;&#26159;&#21542;&#35206;&#30422; (Y)? "</span><span style="color: #709870;">)</span>;
<span class="linenr">137: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #907373;">()</span>.Key != ConsoleKey.Y<span style="color: #709870;">)</span> <span style="color: #a020f0;">return</span>;
<span class="linenr">138: </span>        <span style="color: #909183;">}</span>
<span class="linenr">139: </span>
<span class="linenr">140: </span>        <span style="color: #0000ff;">WriteScore</span><span style="color: #909183;">(</span>info.<span style="color: #228b22;">rn</span>, 1, <span style="color: #228b22;">score</span><span style="color: #909183;">)</span>;
<span class="linenr">141: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">142: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6340988" class="outline-4">
<h4 id="org6340988"><span class="section-number-4">1.2.3.</span> 补充</h4>
<div class="outline-text-4" id="text-1-2-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">??</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">cell</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #707183;">(</span>cn<span style="color: #707183;">)</span> ?? row.<span style="color: #0000ff;">CreateCell</span><span style="color: #707183;">(</span>1<span style="color: #707183;">)</span>;
<span style="color: #b22222;">// </span><span style="color: #b22222;">----</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">cell</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #707183;">(</span>cn<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span>cell == <span style="color: #008b8b;">null</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    cell = row.<span style="color: #0000ff;">CreateCell</span><span style="color: #7388d6;">(</span>1<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">?.</span>
scores<span style="color: #707183;">[</span>name<span style="color: #707183;">]</span> = <span style="color: #707183;">(</span>i, name, scoreCell?.NumericCellValue<span style="color: #707183;">)</span>;
<span style="color: #b22222;">// </span><span style="color: #b22222;">----  </span>
scores<span style="color: #707183;">[</span>name<span style="color: #707183;">]</span> = <span style="color: #707183;">(</span>i, name, scoreCell != <span style="color: #008b8b;">null</span> ? scoreCell.NumericCellValue : <span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span>?<span style="color: #7388d6;">)</span> <span style="color: #008b8b;">null</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org39abb33" class="outline-4">
<h4 id="org39abb33"><span class="section-number-4">1.2.4.</span> Question and Answer</h4>
<div class="outline-text-4" id="text-1-2-4">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">public</span> <span style="color: #228b22;">Dictionary</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span>, <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">rn</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">double</span>? <span style="color: #a0522d;">score</span><span style="color: #7388d6;">)</span><span style="color: #707183;">&gt;</span> <span style="color: #0000ff;">ReadAll</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">Dictionary</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">string</span>, <span style="color: #909183;">(</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span>, <span style="color: #228b22;">double</span>?<span style="color: #909183;">)</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">scores</span> = <span style="color: #a020f0;">new</span><span style="color: #7388d6;">()</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#22768;&#26126;&#22996;&#25176;&#31867;&#22411;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">public delegate void Action(ISheet obj);</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#23454;&#20363;&#21270;</span>
    <span style="color: #228b22;">Action</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">ISheet</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">act</span> = sheet =&gt; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38544;&#24335;&#36716;&#25442;</span>
        <span style="color: #7388d6;">{</span>
            <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">i</span> = 1; i &lt;= sheet.LastRowNum; i++<span style="color: #909183;">)</span>
            <span style="color: #909183;">{</span>
                <span style="color: #228b22;">var</span> row = sheet.<span style="color: #0000ff;">GetRow</span><span style="color: #709870;">(</span>i<span style="color: #709870;">)</span>;
                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">name</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>.StringCellValue;
                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">scoreCell</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #709870;">(</span>1<span style="color: #709870;">)</span>;
                scores<span style="color: #709870;">[</span>name<span style="color: #709870;">]</span> = <span style="color: #709870;">(</span>i, name, scoreCell?.NumericCellValue<span style="color: #709870;">)</span>;
            <span style="color: #909183;">}</span>
        <span style="color: #7388d6;">}</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">3. &#20351;&#29992;</span>
    <span style="color: #0000ff;">WithExcel</span><span style="color: #7388d6;">(</span>act<span style="color: #7388d6;">)</span>;

    <span style="color: #a020f0;">return</span> scores;
<span style="color: #707183;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">public</span> <span style="color: #228b22;">Dictionary</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span>, <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">rn</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">double</span>? <span style="color: #a0522d;">score</span><span style="color: #7388d6;">)</span><span style="color: #707183;">&gt;</span> <span style="color: #0000ff;">ReadAll</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">Dictionary</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">string</span>, <span style="color: #909183;">(</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span>, <span style="color: #228b22;">double</span>?<span style="color: #909183;">)</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">scores</span> = <span style="color: #a020f0;">new</span><span style="color: #7388d6;">()</span>;

    <span style="color: #0000ff;">WithExcel</span><span style="color: #7388d6;">(</span>sheet =&gt; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312; C# &#20013;&#21487;&#20197;&#36890;&#36807;&#36825;&#31181;&#26041;&#24335;&#65292;&#20256;&#36882;&#36923;&#36753;/&#26041;&#27861;</span>
    <span style="color: #909183;">{</span>
        <span style="color: #a020f0;">for</span> <span style="color: #709870;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">i</span> = 1; i &lt;= sheet.LastRowNum; i++<span style="color: #709870;">)</span>
        <span style="color: #709870;">{</span>
            <span style="color: #228b22;">var</span> row = sheet.<span style="color: #0000ff;">GetRow</span><span style="color: #907373;">(</span>i<span style="color: #907373;">)</span>;
            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">name</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #907373;">(</span>0<span style="color: #907373;">)</span>.StringCellValue;
            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">scoreCell</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #907373;">(</span>1<span style="color: #907373;">)</span>;
            scores<span style="color: #907373;">[</span>name<span style="color: #907373;">]</span> = <span style="color: #907373;">(</span>i, name, scoreCell?.NumericCellValue<span style="color: #907373;">)</span>;
        <span style="color: #709870;">}</span>
    <span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>;

    <span style="color: #a020f0;">return</span> scores;
<span style="color: #707183;">}</span>

</pre>
</div>
</div>
</div>
</div>
</section>

<section id="outline-container-orgb48f98e" class="outline-2">
<h2 id="orgb48f98e"><span class="section-number-2">2.</span> 过滤字符串 (委托使用)</h2>
<div class="outline-text-2" id="text-2">
<p>
实现功能，将某个字符串的一些符合条件的字符，咔嚓掉。
</p>
</div>

<div id="outline-container-orgb67f508" class="outline-3">
<h3 id="orgb67f508"><span class="section-number-3">2.1.</span> 基本实现</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558;&#26576;&#20010;&#23383;&#31526;&#20018;&#30340;&#19968;&#20123;&#31526;&#21512;&#26465;&#20214;&#30340;&#23383;&#31526;&#65292;&#21652;&#22163;&#25481;</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">aaa</span> = <span style="color: #8b2252;">"hello, world, where &#26159; &#20320;"</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">a-z &#20043;&#22806;&#30340;&#23383;&#31526;&#65292;&#24178;&#25481;</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s1</span> = <span style="color: #0000ff;">GuolvZifuChuan</span><span style="color: #909183;">(</span><span style="color: #228b22;">aaa</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Rule</span><span style="color: #709870;">(</span><span style="color: #228b22;">RuleAZ</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s11</span> = <span style="color: #0000ff;">GuolvZifuChuan</span><span style="color: #909183;">(</span><span style="color: #228b22;">aaa</span>, <span style="color: #228b22;">RuleAZ</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25152;&#26377;&#30340;&#31354;&#26684;&#65292;&#24178;&#25481; (&#21311;&#21517;&#22996;&#25176;)</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s2</span> = <span style="color: #0000ff;">GuolvZifuChuan</span><span style="color: #909183;">(</span><span style="color: #228b22;">aaa</span>, <span style="color: #a020f0;">delegate</span><span style="color: #709870;">(</span><span style="color: #228b22;">char</span> <span style="color: #a0522d;">c</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span> <span style="color: #a020f0;">return</span> c != <span style="color: #8b2252;">' '</span>;<span style="color: #709870;">}</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25152;&#26377;&#30340; o &#24178;&#25481; (&#34920;&#36798;&#24335;&#35821;&#27861;)</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s3</span> = <span style="color: #0000ff;">GuolvZifuChuan</span><span style="color: #909183;">(</span><span style="color: #228b22;">aaa</span>, c =&gt; c != <span style="color: #8b2252;">'o'</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">GuolvZifuChuan</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">input</span>, <span style="color: #228b22;">Rule</span> <span style="color: #a0522d;">rule</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s</span> = <span style="color: #8b2252;">""</span>;
        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">c</span> <span style="color: #a020f0;">in</span> input<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">rule</span><span style="color: #907373;">(</span><span style="color: #228b22;">c</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                s += c;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">return</span> s;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">bool</span> <span style="color: #0000ff;">RuleAZ</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">char</span> <span style="color: #a0522d;">c</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> c &gt;= <span style="color: #8b2252;">'a'</span> &amp;&amp; c &lt;= <span style="color: #8b2252;">'z'</span>;

        <span style="color: #b22222;">//</span><span style="color: #b22222;">if (c &gt;= 'a' &amp;&amp; c &lt;= 'z')</span>
        <span style="color: #b22222;">//    </span><span style="color: #b22222;">return true;</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">else</span>
        <span style="color: #b22222;">//    </span><span style="color: #b22222;">return false;</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1877074" class="outline-3">
<h3 id="org1877074"><span class="section-number-3">2.2.</span> 使用扩展机制为类添加功能</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558;&#26576;&#20010;&#23383;&#31526;&#20018;&#30340;&#19968;&#20123;&#31526;&#21512;&#26465;&#20214;&#30340;&#23383;&#31526;&#65292;&#21652;&#22163;&#25481;</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">aaa</span> = <span style="color: #8b2252;">"hello, world, where &#26159; &#20320;"</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">a-z &#20043;&#22806;&#30340;&#23383;&#31526;&#65292;&#24178;&#25481;</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">string s1 = GuolvZifuChuan(aaa, new Rule(RuleAZ));</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s11</span> = aaa.<span style="color: #0000ff;">GoLv</span><span style="color: #909183;">(</span><span style="color: #228b22;">RuleAZ</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25152;&#26377;&#30340;&#31354;&#26684;&#65292;&#24178;&#25481; (&#21311;&#21517;&#22996;&#25176;)</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s2</span> = aaa.<span style="color: #0000ff;">GoLv</span><span style="color: #909183;">(</span><span style="color: #a020f0;">delegate</span><span style="color: #709870;">(</span><span style="color: #228b22;">char</span> <span style="color: #a0522d;">c</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span> <span style="color: #a020f0;">return</span> c != <span style="color: #8b2252;">' '</span>;<span style="color: #709870;">}</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25152;&#26377;&#30340; o &#24178;&#25481; (&#34920;&#36798;&#24335;&#35821;&#27861;)</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s3</span> = aaa.<span style="color: #0000ff;">GoLv</span><span style="color: #909183;">(</span>c =&gt; c != <span style="color: #8b2252;">'o'</span><span style="color: #909183;">)</span>;

        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>aaa.<span style="color: #0000ff;">Where</span><span style="color: #709870;">(</span><span style="color: #228b22;">RuleAZ</span><span style="color: #709870;">)</span>.<span style="color: #0000ff;">ToArray</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">bool</span> <span style="color: #0000ff;">RuleAZ</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">char</span> <span style="color: #a0522d;">c</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> c &gt;= <span style="color: #8b2252;">'a'</span> &amp;&amp; c &lt;= <span style="color: #8b2252;">'z'</span>;
        <span style="color: #b22222;">//</span><span style="color: #b22222;">if (c &gt;= 'a' &amp;&amp; c &lt;= 'z') return true; else return false;</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">SuibianQigemingzi</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">GoLv</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">this</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">input</span>, <span style="color: #228b22;">Func</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">char</span>, <span style="color: #228b22;">bool</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">rule</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s</span> = <span style="color: #8b2252;">""</span>;
        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">c</span> <span style="color: #a020f0;">in</span> input<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span><span style="color: #0000ff;">rule</span><span style="color: #907373;">(</span><span style="color: #228b22;">c</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                s += c;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">return</span> s;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org1081231" class="outline-2">
<h2 id="org1081231"><span class="section-number-2">3.</span> 语音点名系统</h2>
<div class="outline-text-2" id="text-3">
<p>
仿照我们上课点名的流程，创作一个工具，用于自动语音点名。
</p>

<p>
具体的产品逻辑，本着实用、简单的原则，自己思考并设计。
</p>

<p>
一些建议:
</p>
<ul class="org-ul">
<li>将人员名单保存到一个外部 txt 文本文件中 (其实，保存在 Excel 中，可以实现更灵活更强劲的功能)</li>
<li>学会将最后的程序导出 (publish) 为一个单独的 exe 文件</li>
<li>正常过程: 产品设计 -&gt; 功能划分 -&gt; 编码细节。使用 <b>面向对象、结构化编程</b> 的基本思路</li>
<li>大胆去实现，不要怕失败，不要怕。唯手熟尔</li>
</ul>
</div>

<div id="outline-container-orgb012619" class="outline-3">
<h3 id="orgb012619"><span class="section-number-3">3.1.</span> 参考实现</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-cs"><span class="linenr">  1: </span><span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">TeachAssist</span>
<span class="linenr">  2: </span><span style="color: #707183;">{</span>
<span class="linenr">  3: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span class="linenr">  4: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">  5: </span>        <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #909183;">)</span>
<span class="linenr">  6: </span>        <span style="color: #909183;">{</span>
<span class="linenr">  7: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ta</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TeachAssist</span><span style="color: #709870;">()</span>;
<span class="linenr">  8: </span>            ta.<span style="color: #0000ff;">Start</span><span style="color: #709870;">()</span>;
<span class="linenr">  9: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 10: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 11: </span>
<span class="linenr"> 12: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">TeachAssist</span>
<span class="linenr"> 13: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 14: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Path</span> <span style="color: #909183;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #909183;">}</span> = <span style="color: #8b2252;">"E:\\aaa.txt"</span>;
<span class="linenr"> 15: </span>
<span class="linenr"> 16: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Start</span><span style="color: #909183;">()</span>
<span class="linenr"> 17: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 18: </span>            <span style="color: #0000ff;">Menu</span><span style="color: #709870;">()</span>;
<span class="linenr"> 19: </span>            <span style="color: #0000ff;">Dispatch</span><span style="color: #709870;">()</span>;
<span class="linenr"> 20: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 21: </span>
<span class="linenr"> 22: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Menu</span><span style="color: #909183;">()</span>
<span class="linenr"> 23: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 24: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span>@<span style="color: #8b2252;">"</span>
<span class="linenr"> 25: </span><span style="color: #8b2252;">==== &#25945;&#23398;&#36741;&#21161; ====</span>
<span class="linenr"> 26: </span>
<span class="linenr"> 27: </span><span style="color: #8b2252;">1. &#35821;&#38899;&#28857;&#21517;</span>
<span class="linenr"> 28: </span><span style="color: #8b2252;">2. &#25552;&#38382;&#25277;&#26597;</span>
<span class="linenr"> 29: </span><span style="color: #8b2252;">3. &#35774;&#32622;&#21517;&#21333;&#36335;&#24452; ({0})</span>
<span class="linenr"> 30: </span>
<span class="linenr"> 31: </span><span style="color: #8b2252;">&#35831;&#25353;&#30456;&#24212;&#25968;&#23383;&#36827;&#20837;&#30456;&#24212;&#21151;&#33021;&#12290;</span>
<span class="linenr"> 32: </span>
<span class="linenr"> 33: </span><span style="color: #8b2252;">PRESS KEY CONTINUE.</span>
<span class="linenr"> 34: </span><span style="color: #8b2252;">"</span>, <span style="color: #228b22;">Path</span><span style="color: #709870;">)</span>;
<span class="linenr"> 35: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 36: </span>
<span class="linenr"> 37: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Dispatch</span><span style="color: #909183;">()</span>
<span class="linenr"> 38: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 39: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">key</span> = Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #709870;">()</span>.Key;
<span class="linenr"> 40: </span>            Console.<span style="color: #0000ff;">Clear</span><span style="color: #709870;">()</span>;
<span class="linenr"> 41: </span>            <span style="color: #a020f0;">switch</span> <span style="color: #709870;">(</span>key<span style="color: #709870;">)</span>
<span class="linenr"> 42: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 43: </span>                <span style="color: #a020f0;">case</span> ConsoleKey.D1:
<span class="linenr"> 44: </span>                    <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Rollcall</span><span style="color: #907373;">()</span>.<span style="color: #0000ff;">StartRoll</span><span style="color: #907373;">(</span><span style="color: #228b22;">Path</span><span style="color: #907373;">)</span>;
<span class="linenr"> 45: </span>                    <span style="color: #a020f0;">break</span>;
<span class="linenr"> 46: </span>                <span style="color: #a020f0;">case</span> ConsoleKey.D2:
<span class="linenr"> 47: </span>                    <span style="color: #a020f0;">break</span>;
<span class="linenr"> 48: </span>                <span style="color: #a020f0;">case</span> ConsoleKey.D3:
<span class="linenr"> 49: </span>                    <span style="color: #0000ff;">Menu</span><span style="color: #907373;">()</span>;
<span class="linenr"> 50: </span>                    <span style="color: #a020f0;">break</span>;
<span class="linenr"> 51: </span>                <span style="color: #a020f0;">default</span>:
<span class="linenr"> 52: </span>                    Environment.<span style="color: #0000ff;">Exit</span><span style="color: #907373;">(</span>1<span style="color: #907373;">)</span>;
<span class="linenr"> 53: </span>                    <span style="color: #a020f0;">break</span>;
<span class="linenr"> 54: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 55: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 56: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 57: </span>
<span class="linenr"> 58: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#35835;&#21462;&#21517;&#21333;</span>
<span class="linenr"> 59: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#36941;&#21382;&#21517;&#21333;</span>
<span class="linenr"> 60: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">3. &#28857;&#21517;&#26576;&#20154; (&#23631;&#24149;/&#35821;&#38899;/&#38190;&#30424;&#36755;&#20837;)</span>
<span class="linenr"> 61: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">4. &#36755;&#20986;&#32467;&#26524;</span>
<span class="linenr"> 62: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Rollcall</span>
<span class="linenr"> 63: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 64: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">Names</span> <span style="color: #909183;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #909183;">}</span>
<span class="linenr"> 65: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">Absents</span> <span style="color: #909183;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #909183;">}</span> = <span style="color: #909183;">{}</span>;
<span class="linenr"> 66: </span>
<span class="linenr"> 67: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">StartRoll</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">path</span><span style="color: #909183;">)</span>
<span class="linenr"> 68: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 69: </span>            <span style="color: #0000ff;">LoadNames</span><span style="color: #709870;">(</span><span style="color: #228b22;">path</span><span style="color: #709870;">)</span>;
<span class="linenr"> 70: </span>            <span style="color: #0000ff;">RollNames</span><span style="color: #709870;">()</span>;
<span class="linenr"> 71: </span>            <span style="color: #0000ff;">Report</span><span style="color: #709870;">()</span>;
<span class="linenr"> 72: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 73: </span>
<span class="linenr"> 74: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">RollNames</span><span style="color: #909183;">()</span>
<span class="linenr"> 75: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 76: </span>            <span style="color: #a020f0;">foreach</span> <span style="color: #709870;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">name</span> <span style="color: #a020f0;">in</span> Names<span style="color: #709870;">)</span>
<span class="linenr"> 77: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 78: </span>                <span style="color: #228b22;">bool</span> <span style="color: #a0522d;">repeat</span> = <span style="color: #008b8b;">false</span>;
<span class="linenr"> 79: </span>
<span class="linenr"> 80: </span>                <span style="color: #a020f0;">do</span>
<span class="linenr"> 81: </span>                <span style="color: #907373;">{</span>
<span class="linenr"> 82: </span>                    <span style="color: #0000ff;">Call</span><span style="color: #6276ba;">(</span><span style="color: #228b22;">name</span><span style="color: #6276ba;">)</span>;
<span class="linenr"> 83: </span>
<span class="linenr"> 84: </span>                    <span style="color: #a020f0;">switch</span> <span style="color: #6276ba;">(</span>Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #858580;">()</span>.Key<span style="color: #6276ba;">)</span>
<span class="linenr"> 85: </span>                    <span style="color: #6276ba;">{</span>
<span class="linenr"> 86: </span>                        <span style="color: #a020f0;">case</span> ConsoleKey.R:
<span class="linenr"> 87: </span>                            repeat = <span style="color: #008b8b;">true</span>;
<span class="linenr"> 88: </span>                            <span style="color: #a020f0;">break</span>;
<span class="linenr"> 89: </span>                        <span style="color: #a020f0;">case</span> ConsoleKey.B:
<span class="linenr"> 90: </span>                            repeat = <span style="color: #008b8b;">false</span>;
<span class="linenr"> 91: </span>                            <span style="color: #228b22;">string</span><span style="color: #858580;">[]</span> <span style="color: #a0522d;">arr</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">string</span><span style="color: #858580;">[</span>Absents.Length + 1<span style="color: #858580;">]</span>;
<span class="linenr"> 92: </span>                            <span style="color: #a020f0;">for</span> <span style="color: #858580;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">i</span> = 0; i &lt; Absents.Length; i++<span style="color: #858580;">)</span>
<span class="linenr"> 93: </span>                            <span style="color: #858580;">{</span>
<span class="linenr"> 94: </span>                                arr<span style="color: #80a880;">[</span>i<span style="color: #80a880;">]</span> = Absents<span style="color: #80a880;">[</span>i<span style="color: #80a880;">]</span>;
<span class="linenr"> 95: </span>                            <span style="color: #858580;">}</span>
<span class="linenr"> 96: </span>                            arr<span style="color: #858580;">[</span>Absents.Length<span style="color: #858580;">]</span> = name;
<span class="linenr"> 97: </span>                            Absents = arr;
<span class="linenr"> 98: </span>                            <span style="color: #a020f0;">break</span>;
<span class="linenr"> 99: </span>                        <span style="color: #a020f0;">default</span>:
<span class="linenr">100: </span>                            repeat = <span style="color: #008b8b;">false</span>;
<span class="linenr">101: </span>                            <span style="color: #a020f0;">break</span>;
<span class="linenr">102: </span>                    <span style="color: #6276ba;">}</span>
<span class="linenr">103: </span>                <span style="color: #907373;">}</span> <span style="color: #a020f0;">while</span> <span style="color: #907373;">(</span>repeat<span style="color: #907373;">)</span>;
<span class="linenr">104: </span>
<span class="linenr">105: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">()</span>;
<span class="linenr">106: </span>
<span class="linenr">107: </span>            <span style="color: #709870;">}</span>
<span class="linenr">108: </span>        <span style="color: #909183;">}</span>
<span class="linenr">109: </span>
<span class="linenr">110: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">LoadNames</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">file</span><span style="color: #909183;">)</span>
<span class="linenr">111: </span>        <span style="color: #909183;">{</span>
<span class="linenr">112: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#39318;&#20808;&#65292;&#35835;&#21462;</span>
<span class="linenr">113: </span>            <span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">names</span> = File.<span style="color: #0000ff;">ReadAllLines</span><span style="color: #709870;">(</span><span style="color: #228b22;">file</span><span style="color: #709870;">)</span>;
<span class="linenr">114: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20854;&#27425;&#65292;&#36807;&#28388; (&#19981;&#33021;&#20026;&#31354;&#65292;&#19981;&#33021;&#20197; - &#24320;&#22987;) Linq</span>
<span class="linenr">115: </span>            Names = names.<span style="color: #0000ff;">Where</span><span style="color: #709870;">(</span>name =&gt; !<span style="color: #228b22;">string</span>.<span style="color: #0000ff;">IsNullOrEmpty</span><span style="color: #907373;">(</span><span style="color: #228b22;">name</span><span style="color: #907373;">)</span> &amp;&amp; name<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span> != <span style="color: #8b2252;">'-'</span><span style="color: #709870;">)</span>.<span style="color: #0000ff;">ToArray</span><span style="color: #709870;">()</span>;
<span class="linenr">116: </span>        <span style="color: #909183;">}</span>
<span class="linenr">117: </span>
<span class="linenr">118: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Call</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span><span style="color: #909183;">)</span>
<span class="linenr">119: </span>        <span style="color: #909183;">{</span>
<span class="linenr">120: </span>            Console.ForegroundColor = ConsoleColor.DarkBlue;
<span class="linenr">121: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #228b22;">name</span><span style="color: #709870;">)</span>;
<span class="linenr">122: </span>            Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #709870;">()</span>;
<span class="linenr">123: </span>            <span style="color: #0000ff;">Speak</span><span style="color: #709870;">(</span><span style="color: #228b22;">name</span><span style="color: #709870;">)</span>;
<span class="linenr">124: </span>        <span style="color: #909183;">}</span>
<span class="linenr">125: </span>
<span class="linenr">126: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Speak</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">content</span><span style="color: #909183;">)</span>
<span class="linenr">127: </span>        <span style="color: #909183;">{</span>
<span class="linenr">128: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">speechSynthesizer</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SpeechSynthesizer</span><span style="color: #709870;">()</span>;
<span class="linenr">129: </span>            speechSynthesizer.<span style="color: #0000ff;">Speak</span><span style="color: #709870;">(</span><span style="color: #228b22;">content</span><span style="color: #709870;">)</span>;
<span class="linenr">130: </span>        <span style="color: #909183;">}</span>
<span class="linenr">131: </span>
<span class="linenr">132: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Report</span><span style="color: #909183;">()</span>
<span class="linenr">133: </span>        <span style="color: #909183;">{</span>
<span class="linenr">134: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
<span class="linenr">135: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#24635;&#20849;&#26377; {Names.Length} &#20154;&#65292;&#26410;&#21040;&#30340;&#26377; {Absents.Length} &#20154;"</span><span style="color: #709870;">)</span>;
<span class="linenr">136: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
<span class="linenr">137: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>Absents.Length == 0<span style="color: #709870;">)</span>
<span class="linenr">138: </span>            <span style="color: #709870;">{</span>
<span class="linenr">139: </span>                Console.ForegroundColor = ConsoleColor.Green;
<span class="linenr">140: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#20840;&#37117;&#21040;&#21862;!"</span><span style="color: #907373;">)</span>;
<span class="linenr">141: </span>                Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #907373;">()</span>;
<span class="linenr">142: </span>            <span style="color: #709870;">}</span>
<span class="linenr">143: </span>            <span style="color: #a020f0;">else</span>
<span class="linenr">144: </span>            <span style="color: #709870;">{</span>
<span class="linenr">145: </span>                Console.ForegroundColor = ConsoleColor.Red;
<span class="linenr">146: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#32570;&#24109;&#30340;&#21517;&#21333;&#20026;:\n"</span><span style="color: #907373;">)</span>;
<span class="linenr">147: </span>                Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #907373;">()</span>;
<span class="linenr">148: </span>                <span style="color: #a020f0;">foreach</span> <span style="color: #907373;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">n</span> <span style="color: #a020f0;">in</span> Absents<span style="color: #907373;">)</span>
<span class="linenr">149: </span>                <span style="color: #907373;">{</span>
<span class="linenr">150: </span>                    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #6276ba;">(</span>$<span style="color: #8b2252;">" - {n}"</span><span style="color: #6276ba;">)</span>;
<span class="linenr">151: </span>                <span style="color: #907373;">}</span>
<span class="linenr">152: </span>            <span style="color: #709870;">}</span>
<span class="linenr">153: </span>        <span style="color: #909183;">}</span>
<span class="linenr">154: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">155: </span><span style="color: #707183;">}</span>
</pre>
</div>

<p>
循环的另外一种写法:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">RollNames</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">foreach</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">name</span> <span style="color: #a020f0;">in</span> Names<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">while</span> <span style="color: #909183;">(</span><span style="color: #008b8b;">true</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #0000ff;">Call</span><span style="color: #709870;">(</span>name<span style="color: #709870;">)</span>;

            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">key</span> = Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #709870;">()</span>;
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.Key == ConsoleKey.B<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #228b22;">string</span><span style="color: #907373;">[]</span> <span style="color: #a0522d;">arr</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">string</span><span style="color: #907373;">[</span>Absents.Length + 1<span style="color: #907373;">]</span>;
                <span style="color: #a020f0;">for</span> <span style="color: #907373;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">i</span> = 0; i &lt; Absents.Length; i++<span style="color: #907373;">)</span>
                <span style="color: #907373;">{</span>
                    arr<span style="color: #6276ba;">[</span>i<span style="color: #6276ba;">]</span> = Absents<span style="color: #6276ba;">[</span>i<span style="color: #6276ba;">]</span>;
                <span style="color: #907373;">}</span>

                arr<span style="color: #907373;">[</span>Absents.Length<span style="color: #907373;">]</span> = name;
                Absents = arr;
                <span style="color: #a020f0;">break</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.Key == ConsoleKey.R<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">break</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>

        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgebe2f15" class="outline-3">
<h3 id="orgebe2f15"><span class="section-number-3">3.2.</span> 进阶实现</h3>
<div class="outline-text-3" id="text-3-2">
<p>
使用 Excel 代替 Txt 文本，存储名单信息。
并且将点名的结果，保存进 Excel 中。
</p>
</div>
</div>
</section>

<section id="outline-container-orgddb9864" class="outline-2">
<h2 id="orgddb9864"><span class="section-number-2">4.</span> 加密、解密 (rot13)</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgc2b094d" class="outline-3">
<h3 id="orgc2b094d"><span class="section-number-3">4.1.</span> 分析</h3>
<div class="outline-text-3" id="text-4-1">
<p>
解析问题，大事化小:
</p>
<ol class="org-ol">
<li><p>
需要完成一个方法 (最终目的):
</p>
<pre class="example">
string Rot13(string str);
</pre></li>
<li><p>
为了完成上一个方法。需要: 如何为某个字符，找到对应位置 (rot13) 的字符:
</p>
<pre class="example">
char CharAfter13 (char c);
</pre></li>
<li>为了进行字符的转换，需要准备知识: 类型的转换 (char / byte)</li>
</ol>

<p>
根据分析，初步代码:
</p>
<div class="org-src-container">
<pre class="src src-csx"><span style="color: #228b22;">fgevat</span> <span style="color: #a0522d;">f</span> = <span style="color: #8b2252;">"uryyb, jbeyq, Ubj ner Lbh. Ubj Qb Lbh qb."</span>;
Pbafbyr.<span style="color: #0000ff;">JevgrYvar</span><span style="color: #707183;">(</span><span style="color: #0000ff;">Ebg13</span><span style="color: #7388d6;">(</span>f<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
Pbafbyr.<span style="color: #0000ff;">JevgrYvar</span><span style="color: #707183;">(</span><span style="color: #0000ff;">Ebg13</span><span style="color: #7388d6;">(</span><span style="color: #0000ff;">Ebg13</span><span style="color: #909183;">(</span>f<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

fgngvp <span style="color: #228b22;">fgevat</span> <span style="color: #0000ff;">Ebg13</span> <span style="color: #707183;">(</span><span style="color: #228b22;">fgevat</span> <span style="color: #a0522d;">fge</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">erghea</span> <span style="color: #a0522d;">fge</span>;
<span style="color: #707183;">}</span>
fgngvp <span style="color: #228b22;">pune</span> <span style="color: #0000ff;">EbgPune</span> <span style="color: #707183;">(</span><span style="color: #228b22;">pune</span> <span style="color: #a0522d;">p</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">erghea</span> <span style="color: #a0522d;">p</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaae2243" class="outline-3">
<h3 id="orgaae2243"><span class="section-number-3">4.2.</span> 实现</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-csx" id="org4be0be9"><span style="color: #228b22;">pynff</span> <span style="color: #a0522d;">Cebtenz</span>
<span style="color: #707183;">{</span>
    fgngvp <span style="color: #228b22;">ibvq</span> <span style="color: #0000ff;">Znva</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">fgevat</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">netf</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        vs <span style="color: #909183;">(</span>netf.Yratgu == 0<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20132;&#20114;&#36755;&#20837;&#36755;&#20986;</span>
            juvyr <span style="color: #709870;">(</span>gehr<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                Pbafbyr.<span style="color: #0000ff;">Jevgr</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#35831;&#36755;&#20837;&#35201;&#21152;&#23494;(&#35299;&#23494;)&#30340;&#20869;&#23481;: "</span><span style="color: #907373;">)</span>;
                <span style="color: #228b22;">fgevat</span> <span style="color: #a0522d;">vachg</span> = Pbafbyr.<span style="color: #0000ff;">ErnqYvar</span><span style="color: #907373;">()</span>;
                <span style="color: #228b22;">fgevat</span> <span style="color: #a0522d;">erfhyg</span> = <span style="color: #0000ff;">EbgFgevat</span><span style="color: #907373;">(</span>vachg<span style="color: #907373;">)</span>;
                Pbafbyr.<span style="color: #0000ff;">JevgrYvar</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#21152;&#23494;&#30340;&#32467;&#26524;: {erfhyg}\a"</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>
        <span style="color: #228b22;">ryfr</span> <span style="color: #0000ff;">vs</span> <span style="color: #909183;">(</span>netf.Yratgu == 1 &amp;&amp; netf<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>.<span style="color: #0000ff;">Fhofgevat</span><span style="color: #709870;">(</span><span style="color: #228b22;">netf</span><span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>.<span style="color: #0000ff;">YnfgVaqrkBs</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"."</span><span style="color: #907373;">)</span> + 1<span style="color: #709870;">)</span> == <span style="color: #8b2252;">"gkg"</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21152;&#23494;&#25991;&#20214;</span>
            <span style="color: #0000ff;">EbgSvyr</span><span style="color: #709870;">(</span>netf<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        ryfr
        <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558;&#21442;&#25968;&#20316;&#20026;&#25991;&#26412;&#22788;&#29702;</span>
            <span style="color: #228b22;">FgevatOhvyqre</span> <span style="color: #a0522d;">fo</span> = arj <span style="color: #0000ff;">FgevatOhvyqre</span><span style="color: #709870;">()</span>;
            sbernpu <span style="color: #709870;">(</span>ine f <span style="color: #228b22;">va</span> <span style="color: #a0522d;">netf</span><span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                fo.<span style="color: #0000ff;">Nccraq</span><span style="color: #907373;">(</span>f<span style="color: #907373;">)</span>.<span style="color: #0000ff;">Nccraq</span><span style="color: #907373;">(</span><span style="color: #8b2252;">" "</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>

            <span style="color: #228b22;">fgevat</span> <span style="color: #a0522d;">e</span> = <span style="color: #0000ff;">EbgFgevat</span><span style="color: #709870;">(</span>fo.<span style="color: #0000ff;">GbFgevat</span><span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            Pbafbyr.<span style="color: #0000ff;">JevgrYvar</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#32763;&#35793;&#30340;&#32467;&#26524;&#26159;: {e}"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    fgngvp <span style="color: #228b22;">pune</span> <span style="color: #0000ff;">EbgPune</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">pune</span> <span style="color: #a0522d;">p</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#26159; n-m N-M &#20043;&#22806;&#30340;&#65292;&#37027;&#20040;&#21407;&#26679;&#36820;&#22238;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524; n-m +13 &#20043;&#21518;&#30340;&#23383;&#31526;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524; N-M +13 &#20043;&#21518;&#30340;&#23383;&#31526;</span>
        <span style="color: #228b22;">olgr</span> <span style="color: #a0522d;">pbqr</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">olgr</span><span style="color: #909183;">)</span>p;
        vs <span style="color: #909183;">(</span>p &gt;= <span style="color: #8b2252;">'n'</span> &amp;&amp; p &lt;= <span style="color: #8b2252;">'m'</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            erghea <span style="color: #709870;">(</span>pune<span style="color: #709870;">)(</span>pbqr + 13 &gt; 122 ? pbqr - 13 : pbqr + 13<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        vs <span style="color: #909183;">(</span>p &gt;= <span style="color: #8b2252;">'N'</span> &amp;&amp; p &lt;= <span style="color: #8b2252;">'M'</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            erghea <span style="color: #709870;">(</span>pune<span style="color: #709870;">)(</span>pbqr + 13 &gt; 90 ? pbqr - 13 : pbqr + 13<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #228b22;">erghea</span> <span style="color: #a0522d;">p</span>;
    <span style="color: #7388d6;">}</span>

    fgngvp <span style="color: #228b22;">fgevat</span> <span style="color: #0000ff;">EbgFgevat</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">fgevat</span> <span style="color: #a0522d;">fge</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">FgevatOhvyqre</span> <span style="color: #a0522d;">fo</span> = arj <span style="color: #0000ff;">FgevatOhvyqre</span><span style="color: #909183;">()</span>;
        sbernpu <span style="color: #909183;">(</span><span style="color: #228b22;">pune</span> p <span style="color: #228b22;">va</span> <span style="color: #a0522d;">fge</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            fo.<span style="color: #0000ff;">Nccraq</span><span style="color: #709870;">(</span><span style="color: #0000ff;">EbgPune</span><span style="color: #907373;">(</span>p<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #228b22;">erghea</span> fo.<span style="color: #0000ff;">GbFgevat</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    fgngvp <span style="color: #228b22;">ibvq</span> <span style="color: #0000ff;">EbgSvyr</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">fgevat</span> <span style="color: #a0522d;">cngu</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">fgevat</span> <span style="color: #a0522d;">pbagrag</span> = Svyr.<span style="color: #0000ff;">ErnqNyyGrkg</span><span style="color: #909183;">(</span>cngu<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">fgevat</span> <span style="color: #a0522d;">erfhyg</span> = <span style="color: #0000ff;">EbgFgevat</span><span style="color: #909183;">(</span>pbagrag<span style="color: #909183;">)</span>;
        Svyr.<span style="color: #0000ff;">JevgrNyyGrkg</span><span style="color: #909183;">(</span>cngu, erfhyg<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    fgngvp <span style="color: #228b22;">ibvq</span> <span style="color: #0000ff;">EbgQverpgbel</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">fgevat</span> <span style="color: #a0522d;">qve</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<pre class="example">
uryyb, jbeyq, Ubj ner Lbh. Ubj Qb Lbh qb.
hello, world, How are You. How Do You do.
</pre>
</div>
</div>

<div id="outline-container-orgdcd59b3" class="outline-3">
<h3 id="orgdcd59b3"><span class="section-number-3">4.3.</span> 落地</h3>
<div class="outline-text-3" id="text-4-3">
<p>
讨论:
</p>
<ul class="org-ul">
<li>编译输出程序 rot13.exe</li>
<li>执行 rot13: 通过 Readline 提醒用户输入，用户敲回车后，打印加密后的内容</li>
<li>执行 rot13 [一段文本] ，敲回车之后，打印加密之后的内容</li>
<li>执行 rot13 后的结果保存到系统的粘贴板中</li>
<li>执行 rot13 文件地址，对文件进行加密</li>
</ul>

<p>
小结:
</p>
<ul class="org-ul">
<li>输出程序，比如名字为 rot13</li>
<li><p>
如果直接调用，会提醒用户进行输入，用户输入之后，会将加密玩的内容打印到屏幕上。然后继续提醒:
</p>
<pre class="example">
rot13
</pre></li>
<li><p>
如果输入的时候，带参数，参数是一个普通的文本的话，那么会直接将加密完的内容打印到屏幕上，结束:
</p>
<pre class="example">
rot13 hello world how    are
</pre></li>
<li><p>
如果输入的时候，带参数，是一个文件路径，那么将文件的内容进行加密:
</p>
<pre class="example">
rot13 d:\aaa.txt
</pre></li>
</ul>
</div>
</div>

<div id="outline-container-orgde4b67a" class="outline-3">
<h3 id="orgde4b67a"><span class="section-number-3">4.4.</span> 导出并使用</h3>
<div class="outline-text-3" id="text-4-4">
<ul class="org-ul">
<li>使用 VS 带的发布 (publish) 功能</li>
<li>注意，需要将 <b>发布为单独文件</b> 选中</li>
<li><p>
使用时，直接调用路径就可以了:
</p>
<pre class="example">
E:\rot13.exe 参数
</pre></li>
</ul>

<p>
为了方便使用:
</p>
<ol class="org-ol">
<li><p>
将 rot13.exe 的文件夹，添加到 Path 环境变量中
</p>
<pre class="example">
cmd
$ rot13
</pre></li>
<li><p>
可以将加密的命令添加到注册表，从而方便使用。比如，将下面语句保存为 .reg 格式，然后双击导入:
</p>
<div class="org-src-container">
<pre class="src src-conf">Windows Registry Editor Version 5.00

[<span style="color: #228b22;">HKEY_LOCAL_MACHINE\SOFTWARE\Classes\txtfile\shell\ROT13</span>]

[<span style="color: #228b22;">HKEY_LOCAL_MACHINE\SOFTWARE\Classes\txtfile\shell\ROT13\command</span>]
<span style="color: #a0522d;">@</span>=<span style="color: #8b2252;">"\"E:\\wodechengxu\\rot13.exe\" \"%1\""</span>
</pre>
</div></li>
</ol>
</div>
</div>
</section>

<section id="outline-container-orgc047c87" class="outline-2">
<h2 id="orgc047c87"><span class="section-number-2">5.</span> 游戏祖玛</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org36ba6a0" class="outline-3">
<h3 id="org36ba6a0"><span class="section-number-3">5.1.</span> 游戏描述</h3>
<div class="outline-text-3" id="text-5-1">
<p>
实现游戏祖玛!
</p>
<ul class="org-ul">
<li>核心是一个 <b>字符串</b> 代码的所谓祖玛</li>
<li>若干方法，都围绕这个字符串:</li>
<li>初始化这个随机字符串的方法</li>
<li>绘制这个字符串到屏幕上的方法</li>
<li>不停让字符串增加长度的任务方法</li>
<li>通过 ReadLine 交互将某个字符插入到这个字符串的方法</li>
<li>每次有字符插入到字符串之后，进行消除相同字符的方法</li>
<li>每次有字符插入到字符串之后，根据长度判断游戏是否结束的方法</li>
</ul>

<p>
除了这个叫祖玛的字符串，类中还可以具备其他状态:
</p>
<ul class="org-ul">
<li>比如定义祖玛字符串所需要用到的所有字符</li>
<li>比如定义祖玛自增长的时间间隔</li>
<li>比如记录游戏开始的时间</li>
<li>比如用户名字、分数等个性化数据</li>
</ul>

<p>
因此，我们需要的，至少是两个类:
</p>
<ul class="org-ul">
<li>祖玛类型，封装了祖玛字符串和其行为</li>
<li>游戏主循环，用来调用祖玛并将其行为有效展示出来</li>
</ul>
</div>
</div>

<div id="outline-container-orgefca718" class="outline-3">
<h3 id="orgefca718"><span class="section-number-3">5.2.</span> 预备知识</h3>
<div class="outline-text-3" id="text-5-2">
</div>
<div id="outline-container-orgef611e1" class="outline-4">
<h4 id="orgef611e1"><span class="section-number-4">5.2.1.</span> 如何避免 ReadLine 阻塞</h4>
<div class="outline-text-4" id="text-5-2-1">
<p>
不完美，但是足够简单的方法:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">while</span> <span style="color: #707183;">(</span><span style="color: #008b8b;">true</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"..."</span><span style="color: #7388d6;">)</span>;
    Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #7388d6;">(</span>500<span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>Console.KeyAvailable<span style="color: #7388d6;">)</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#29992;&#25143;&#26377;&#27809;&#26377;&#25970;&#38190;&#30424;</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">a</span> = Console.<span style="color: #0000ff;">ReadLine</span><span style="color: #909183;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31561;&#24453;&#29992;&#25143;&#36755;&#20837;&#28857;&#21861;</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#36755;&#20837;&#26159;: "</span> + a<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
使用多线程(多任务) 的方式进行实现:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">System.Threading.Tasks;</span>

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">a</span> = <span style="color: #008b8b;">null</span>;

Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">while</span> <span style="color: #909183;">(</span><span style="color: #008b8b;">true</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        a = Console.<span style="color: #0000ff;">ReadLine</span><span style="color: #709870;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31561;&#24453;&#29992;&#25143;&#36755;&#20837;&#28857;&#21861;</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#36755;&#20837;&#26159;: "</span> + a<span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #909183;">(</span>5000<span style="color: #909183;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">",,,"</span><span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20027;&#32447;&#31243;</span>
<span style="color: #a020f0;">while</span> <span style="color: #707183;">(</span><span style="color: #008b8b;">true</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"..."</span><span style="color: #7388d6;">)</span>;
    Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #7388d6;">(</span>500<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

</pre>
</div>
</div>
</div>

<div id="outline-container-orgc243a6e" class="outline-4">
<h4 id="orgc243a6e"><span class="section-number-4">5.2.2.</span> Console 的定点输出</h4>
<div class="outline-text-4" id="text-5-2-2">
<div class="org-src-container">
<pre class="src src-csharp">Console.<span style="color: #0000ff;">Clear</span><span style="color: #707183;">()</span>;

<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 15; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.ForegroundColor = ConsoleColor.DarkGray;
    Console.<span style="color: #0000ff;">SetCursorPosition</span><span style="color: #7388d6;">(</span>0, i<span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"{0,3}"</span>, i + 1<span style="color: #7388d6;">)</span>;
    Console.ForegroundColor = ConsoleColor.Black;
<span style="color: #707183;">}</span>

Console.<span style="color: #0000ff;">SetCursorPosition</span><span style="color: #707183;">(</span>10, 5<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"hello, world"</span><span style="color: #707183;">)</span>;

Console.<span style="color: #0000ff;">SetCursorPosition</span><span style="color: #707183;">(</span>4, 10<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">Write</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#35831;&#36755;&#20837;&#24744;&#30340;&#30041;&#35328;: "</span><span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">ReadLine</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge04e9d2" class="outline-4">
<h4 id="orge04e9d2"><span class="section-number-4">5.2.3.</span> 随机字符串的生成逻辑</h4>
<div class="outline-text-4" id="text-5-2-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">r</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Random</span><span style="color: #707183;">()</span>;

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">"oO0iL1lI"</span>;

<span style="color: #228b22;">StringBuilder</span> <span style="color: #a0522d;">sb</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #707183;">()</span>;
<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 5; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    sb.<span style="color: #0000ff;">Append</span><span style="color: #7388d6;">(</span>a<span style="color: #909183;">[</span>r.<span style="color: #0000ff;">Next</span><span style="color: #709870;">(</span>a.Length - 1<span style="color: #709870;">)</span><span style="color: #909183;">]</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>sb.<span style="color: #0000ff;">ToString</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgabe8df9" class="outline-4">
<h4 id="orgabe8df9"><span class="section-number-4">5.2.4.</span> 消除字符串的基本逻辑</h4>
<div class="outline-text-4" id="text-5-2-4">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">xiaochu</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">Clear</span><span style="color: #7388d6;">()</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>x<span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; x.Length - 2; i++<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>x<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span> == x<span style="color: #709870;">[</span>i + 1<span style="color: #709870;">]</span> &amp;&amp; x<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span> == x<span style="color: #709870;">[</span>i + 2<span style="color: #709870;">]</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.ForegroundColor = ConsoleColor.Magenta;
            Console.<span style="color: #0000ff;">SetCursorPosition</span><span style="color: #709870;">(</span>i, 0<span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span>x.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>.<span style="color: #0000ff;">Substring</span><span style="color: #907373;">(</span>i, 3<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #709870;">()</span>;

            Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #709870;">(</span>800<span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">SetCursorPosition</span><span style="color: #709870;">(</span>i, 0<span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"   "</span><span style="color: #709870;">)</span>;
            x.<span style="color: #0000ff;">Remove</span><span style="color: #709870;">(</span>i, 3<span style="color: #709870;">)</span>;

            Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #709870;">(</span>200<span style="color: #709870;">)</span>;
            <span style="color: #0000ff;">xiaochu</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc3acba5" class="outline-3">
<h3 id="orgc3acba5"><span class="section-number-3">5.3.</span> 分析</h3>
<div class="outline-text-3" id="text-5-3">
<ul class="org-ul">
<li>显示一排小猪 (初始化若干个、会定时加入若干个小猪、随着用户交互小猪加入队伍)</li>
<li>// 显示其他游戏相关信息 (时间、分数、消除多少个&#x2026;.)</li>
<li>提醒用户: 当前你分配到的是一个什么样的随机小猪，您想让它到哪儿</li>
</ul>

<hr>

<p>
结构化:
</p>
<pre class="example" id="org4243c07">
string pigs;
void InitPigs(int len);
void JiaruPig();
void FirePig(char c, int position);
void CleanPigs();
void PrintPigs();
</pre>
</div>
</div>

<div id="outline-container-org8263fe4" class="outline-3">
<h3 id="org8263fe4"><span class="section-number-3">5.4.</span> 程序概览</h3>
<div class="outline-text-3" id="text-5-4">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#26680;&#24515;&#23646;&#24615;</span>
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Pigs</span> <span style="color: #707183;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #707183;">}</span>
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">State</span> <span style="color: #707183;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #707183;">}</span> = 0;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#31169;&#26377;&#29366;&#24577;</span>
<span style="color: #a020f0;">private</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">pigSource</span> = <span style="color: #8b2252;">"ABCDE"</span>;
<span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">initLen</span> = 6;
<span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">finalLen</span> = 20;
<span style="color: #a020f0;">private</span> <span style="color: #228b22;">char</span> <span style="color: #a0522d;">currentPig</span> = <span style="color: #8b2252;">'0'</span>;
<span style="color: #a020f0;">private</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">currentInput</span> = String.Empty;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#26680;&#24515;&#26041;&#27861;</span>
<span style="color: #228b22;">char</span> <span style="color: #0000ff;">GetOneRandomPig</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">InitPigs</span><span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">len</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">JiaruPig</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">FirePig</span><span style="color: #707183;">(</span><span style="color: #228b22;">char</span> <span style="color: #a0522d;">c</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">position</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">CleanPigs</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintPigs</span><span style="color: #707183;">()</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20132;&#20114;&#36923;&#36753;</span>
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">InitConsole</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">Play</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">Check</span><span style="color: #707183;">()</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20132;&#20114;&#25509;&#21475;</span>
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">InitGame</span><span style="color: #707183;">()</span>;
<span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">MainLoop</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org644c81b" class="outline-3">
<h3 id="org644c81b"><span class="section-number-3">5.5.</span> Code Example</h3>
<div class="outline-text-3" id="text-5-5">
<p>
注意:  <span style="color: red; font-size: 1.5em">解题方法千万种，这里的代码仅作参考。要尊重你自己的思考</span> !
</p>

<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>.<span style="color: #a0522d;">Media</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>.<span style="color: #a0522d;">Text</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>.<span style="color: #a0522d;">Threading</span>;

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Zuma</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Pigs</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26680;&#24515;&#25968;&#25454;&#12289;&#26680;&#24515;&#29366;&#24577;</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">State</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span> = 0; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#28216;&#25103;&#26159;&#21542;&#32467;&#26463;&#30340;&#26631;&#24535;</span>

    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">pigSource</span> = <span style="color: #8b2252;">"ABCDE"</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">initLen</span> = 3;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">finalLen</span> = 15;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">char</span> <span style="color: #a0522d;">currentPig</span> = <span style="color: #8b2252;">'0'</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">currentInput</span> = String.Empty;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">SoundPlayer</span> <span style="color: #a0522d;">player</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SoundPlayer</span><span style="color: #7388d6;">()</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26680;&#24515;&#30340;&#26041;&#27861;</span>

    <span style="color: #228b22;">char</span> <span style="color: #0000ff;">GetOneRandomPig</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23383;&#31526;&#20018;&#19979;&#26631;&#35775;&#38382;</span>
        <span style="color: #228b22;">Random</span> <span style="color: #a0522d;">random</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Random</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">xiabiao</span> = random.<span style="color: #0000ff;">Next</span><span style="color: #909183;">(</span>pigSource.<span style="color: #228b22;">Length</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">char</span> <span style="color: #a0522d;">pig</span> = pigSource<span style="color: #909183;">[</span>xiabiao<span style="color: #909183;">]</span>;
        <span style="color: #a020f0;">return</span> pig;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">InitPigs</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">len</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23383;&#31526;&#20018;&#30340;&#25340;&#25509;</span>
        <span style="color: #228b22;">StringBuilder</span> <span style="color: #a0522d;">sb</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #909183;">()</span>;
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; len; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #228b22;">char</span> <span style="color: #a0522d;">pig</span> = <span style="color: #0000ff;">GetOneRandomPig</span><span style="color: #709870;">()</span>;
            sb.<span style="color: #0000ff;">Append</span><span style="color: #709870;">(</span><span style="color: #228b22;">pig</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        Pigs = sb.<span style="color: #0000ff;">ToString</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">JiaruPig</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">+ &#36827;&#34892;&#23383;&#31526;&#20018;&#30340;&#25340;&#25509;</span>
        <span style="color: #228b22;">char</span> <span style="color: #a0522d;">pig</span> = <span style="color: #0000ff;">GetOneRandomPig</span><span style="color: #909183;">()</span>;
        Pigs = pig + Pigs;

        <span style="color: #0000ff;">Check</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">FirePig</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">char</span> <span style="color: #a0522d;">c</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">position</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23383;&#31526;&#20018;&#30340; Insert&#12290;&#27880;&#24847;&#23383;&#31526;&#20018;&#30340;&#19981;&#21487;&#21464;&#24615;</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>position &lt; Pigs.Length &amp;&amp; position &gt;= 0<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Pigs = Pigs.<span style="color: #0000ff;">Insert</span><span style="color: #709870;">(</span><span style="color: #228b22;">position</span>, c.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        Console.<span style="color: #0000ff;">Beep</span><span style="color: #909183;">(</span>400, 333<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CleanPigs</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23376;&#23383;&#31526;&#20018;&#30340;&#33719;&#21462;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#29983;&#25104;&#22810;&#20010;&#30456;&#21516;&#23383;&#31526;&#30340;&#23383;&#31526;&#20018;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">API: Remove &#20351;&#29992;</span>
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; Pigs.Length - 2; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">for</span> <span style="color: #709870;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">len</span> = Pigs.Length - i; len &gt;= 3; len--<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>Pigs.<span style="color: #0000ff;">Substring</span><span style="color: #6276ba;">(</span><span style="color: #228b22;">i</span>, <span style="color: #228b22;">len</span><span style="color: #6276ba;">)</span> == <span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadLeft</span><span style="color: #6276ba;">(</span><span style="color: #228b22;">len</span>, <span style="color: #228b22;">Pigs</span><span style="color: #858580;">[</span>i<span style="color: #858580;">]</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                <span style="color: #907373;">{</span>
                    Pigs = Pigs.<span style="color: #0000ff;">Remove</span><span style="color: #6276ba;">(</span><span style="color: #228b22;">i</span>, <span style="color: #228b22;">len</span><span style="color: #6276ba;">)</span>;
                    <span style="color: #0000ff;">CleanPigs</span><span style="color: #6276ba;">()</span>;
                <span style="color: #907373;">}</span>
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>

        <span style="color: #0000ff;">Check</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintPig</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">char</span> <span style="color: #a0522d;">c</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.ForegroundColor = c <span style="color: #a020f0;">switch</span>
        <span style="color: #909183;">{</span>
            <span style="color: #8b2252;">'A'</span> =&gt; ConsoleColor.Red,
            <span style="color: #8b2252;">'B'</span> =&gt; ConsoleColor.Yellow,
            <span style="color: #8b2252;">'C'</span> =&gt; ConsoleColor.Green,
            <span style="color: #8b2252;">'D'</span> =&gt; ConsoleColor.Blue,
            _ =&gt; ConsoleColor.Black
        <span style="color: #909183;">}</span>;
        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #8b2252;">'&#9675;'</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintPigs</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">SetCursorPosition</span><span style="color: #909183;">(</span>1, 1<span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; Pigs.Length; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #0000ff;">PrintPig</span><span style="color: #709870;">(</span><span style="color: #228b22;">Pigs</span><span style="color: #907373;">[</span>i<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"{0,50}\n"</span>, <span style="color: #8b2252;">' '</span><span style="color: #909183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992;&#31354;&#26684;&#35206;&#30422;&#25481;&#21407;&#26469;&#26377;&#30340;&#22810;&#20313;&#23383;&#31526;</span>
        Console.<span style="color: #0000ff;">SetCursorPosition</span><span style="color: #909183;">(</span>1, 5<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#28216;&#25103;&#30340;&#20132;&#20114;&#36923;&#36753;</span>

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">InitConsole</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">Clear</span><span style="color: #909183;">()</span>;
        Console.CursorVisible = <span style="color: #008b8b;">false</span>;
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 5; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">SetCursorPosition</span><span style="color: #709870;">(</span>i * 8, 0<span style="color: #709870;">)</span>;
            Console.ForegroundColor = ConsoleColor.DarkGray;
            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">" "</span> + <span style="color: #907373;">(</span>i + 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">InitBGMusic</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        player.SoundLocation = <span style="color: #8b2252;">"e:/Audio/mysterygobrrrrr.wav"</span>;
        player.<span style="color: #0000ff;">PlayLooping</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ResetGame</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        State = 0;
        currentPig = <span style="color: #8b2252;">'0'</span>;
        currentInput = <span style="color: #228b22;">string</span>.Empty;
        player.<span style="color: #0000ff;">Dispose</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintCurrentInput</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">SetCursorPosition</span><span style="color: #909183;">(</span>35, 3<span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #228b22;">currentInput</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"    "</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Play</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>currentPig == <span style="color: #8b2252;">'0'</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            currentPig = <span style="color: #0000ff;">GetOneRandomPig</span><span style="color: #709870;">()</span>;
            Console.<span style="color: #0000ff;">SetCursorPosition</span><span style="color: #709870;">(</span>1, 3<span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24403;&#21069;&#23567;&#29482; "</span><span style="color: #709870;">)</span>;
            <span style="color: #0000ff;">PrintPig</span><span style="color: #709870;">(</span><span style="color: #228b22;">currentPig</span><span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">" &#36755;&#20837;&#20301;&#32622;&#21457;&#23556;: "</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Console.KeyAvailable<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">key</span> = Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #709870;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#19981;&#22581;&#22622;</span>
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.Key == ConsoleKey.D0
                || key.Key == ConsoleKey.D1
                || key.Key == ConsoleKey.D2
                || key.Key == ConsoleKey.D3
                || key.Key == ConsoleKey.D4
                || key.Key == ConsoleKey.D5
                || key.Key == ConsoleKey.D6
                || key.Key == ConsoleKey.D7
                || key.Key == ConsoleKey.D8
                || key.Key == ConsoleKey.D9
            <span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                currentInput += key.KeyChar;
                <span style="color: #0000ff;">PrintCurrentInput</span><span style="color: #907373;">()</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.Key == ConsoleKey.Backspace<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>!<span style="color: #228b22;">string</span>.<span style="color: #0000ff;">IsNullOrEmpty</span><span style="color: #6276ba;">(</span><span style="color: #228b22;">currentInput</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                <span style="color: #907373;">{</span>
                    currentInput = currentInput.<span style="color: #0000ff;">Substring</span><span style="color: #6276ba;">(</span>0, currentInput.Length - 1<span style="color: #6276ba;">)</span>;
                    <span style="color: #0000ff;">PrintCurrentInput</span><span style="color: #6276ba;">()</span>;
                <span style="color: #907373;">}</span>
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.Key == ConsoleKey.Spacebar<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                player.<span style="color: #0000ff;">Stop</span><span style="color: #907373;">()</span>;
                Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #907373;">()</span>;
                player.<span style="color: #0000ff;">PlayLooping</span><span style="color: #907373;">()</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.Key == ConsoleKey.Enter<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>!<span style="color: #228b22;">string</span>.<span style="color: #0000ff;">IsNullOrWhiteSpace</span><span style="color: #6276ba;">(</span><span style="color: #228b22;">currentInput</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>
                <span style="color: #907373;">{</span>
                    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">index</span> = <span style="color: #228b22;">int</span>.<span style="color: #0000ff;">Parse</span><span style="color: #6276ba;">(</span><span style="color: #228b22;">currentInput</span><span style="color: #6276ba;">)</span>;
                    <span style="color: #0000ff;">FirePig</span><span style="color: #6276ba;">(</span><span style="color: #228b22;">currentPig</span>, index - 1<span style="color: #6276ba;">)</span>;
                    <span style="color: #0000ff;">CleanPigs</span><span style="color: #6276ba;">()</span>;
                    currentPig = <span style="color: #8b2252;">'0'</span>;
                    currentInput = String.Empty;

                    <span style="color: #0000ff;">PrintCurrentInput</span><span style="color: #6276ba;">()</span>;
                <span style="color: #907373;">}</span>
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Check</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Pigs.Length == 0<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            State = 1;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Pigs.Length &gt;= finalLen<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            State = -1;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">InitGame</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #0000ff;">ResetGame</span><span style="color: #909183;">()</span>;
        <span style="color: #0000ff;">InitConsole</span><span style="color: #909183;">()</span>;
        <span style="color: #0000ff;">InitPigs</span><span style="color: #909183;">(</span><span style="color: #228b22;">initLen</span><span style="color: #909183;">)</span>;
        <span style="color: #0000ff;">InitBGMusic</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">MainLoop</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0;
        <span style="color: #a020f0;">while</span> <span style="color: #909183;">(</span>State == 0<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            i = i &gt; 10 ? 0 : i + 1; <span style="color: #b22222;">// </span><span style="color: #b22222;">flag</span>

            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>i == 0<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #0000ff;">JiaruPig</span><span style="color: #907373;">()</span>;
            <span style="color: #709870;">}</span>

            <span style="color: #0000ff;">Play</span><span style="color: #709870;">()</span>;

            <span style="color: #0000ff;">PrintPigs</span><span style="color: #709870;">()</span>;
            Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #709870;">(</span>100<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        player.<span style="color: #0000ff;">Stop</span><span style="color: #909183;">()</span>;

        Console.<span style="color: #0000ff;">SetCursorPosition</span><span style="color: #909183;">(</span>1, 3<span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"{0,50}"</span>, <span style="color: #8b2252;">' '</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">SetCursorPosition</span><span style="color: #909183;">(</span>1, 3<span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>State == 1<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25104;&#21151;&#20102;."</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>State == -1<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#21191;&#22763;&#65292;&#35831;&#24744;&#19981;&#35201;&#25918;&#24323;!"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"\n &#28857;&#20987; Y &#20877;&#26469;&#19968;&#27425;&#65292;&#25110;&#25353;&#20219;&#24847;&#38190;&#36864;&#20986;&#12290;"</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #709870;">()</span>.Key == ConsoleKey.Y<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #0000ff;">InitGame</span><span style="color: #709870;">()</span>;
            <span style="color: #0000ff;">MainLoop</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">zuma</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Zuma</span><span style="color: #909183;">()</span>;
        zuma.<span style="color: #0000ff;">InitGame</span><span style="color: #909183;">()</span>;
        zuma.<span style="color: #0000ff;">MainLoop</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7ac2d9a" class="outline-3">
<h3 id="org7ac2d9a"><span class="section-number-3">5.6.</span> 其他</h3>
<div class="outline-text-3" id="text-5-6">
<p>
做一只有颜色的猪
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintPig</span><span style="color: #707183;">(</span><span style="color: #228b22;">char</span> <span style="color: #a0522d;">c</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">ConsoleColor</span> <span style="color: #a0522d;">color</span>;
    <span style="color: #a020f0;">switch</span> <span style="color: #7388d6;">(</span>c<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">case</span> <span style="color: #8b2252;">'A'</span>:
            color = ConsoleColor.Red;
            <span style="color: #a020f0;">break</span>;
        <span style="color: #a020f0;">case</span> <span style="color: #8b2252;">'B'</span>:
            color = ConsoleColor.Yellow;
            <span style="color: #a020f0;">break</span>;
        <span style="color: #a020f0;">case</span> <span style="color: #8b2252;">'C'</span>:
            color = ConsoleColor.Green;
            <span style="color: #a020f0;">break</span>;
        <span style="color: #a020f0;">case</span> <span style="color: #8b2252;">'D'</span>:
            color = ConsoleColor.Blue;
            <span style="color: #a020f0;">break</span>;
        <span style="color: #a020f0;">default</span>:
            color = ConsoleColor.Black;
            <span style="color: #a020f0;">break</span>;
    <span style="color: #7388d6;">}</span>

    Console.ForegroundColor = color;
    Console.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">'&#9675;'</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>

<span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintPigs</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">SetCursorPosition</span><span style="color: #7388d6;">(</span>1, 1<span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; Pigs.Length; i++<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #0000ff;">PrintPig</span><span style="color: #909183;">(</span><span style="color: #228b22;">Pigs</span><span style="color: #709870;">[</span>i<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    Console.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"                                   "</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
Read/阻塞:
</p>
<div class="org-src-container">
<pre class="src src-csharp">Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36755;&#20986;</span>
<span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span>Console.KeyAvailable<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">//</span><span style="color: #b22222;">string s = Console.ReadLine(); // &#29992;&#25143;&#36755;&#20837;</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">c</span> = Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"world"</span><span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36755;&#20986;</span>
</pre>
</div>

<p>
零宽度空格 (0x200b):
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">"&#8203;&#8203;&#8203;&#8203;&#8203;&#8203;"</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">b</span> = <span style="color: #8b2252;">""</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">c</span> = <span style="color: #228b22;">string</span>.Empty;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"{a.Length}/{b.Length}/{c.Length}  {a == b}/{b == c}"</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org09a25a9" class="outline-3">
<h3 id="org09a25a9"><span class="section-number-3">5.7.</span> 小结</h3>
<div class="outline-text-3" id="text-5-7">
<p>
通过这个游戏，达到的目的:
</p>
<ul class="org-ul">
<li>熟悉字符串的 API 调用</li>
<li>了解游戏的基本开发逻辑</li>
</ul>

<p>
包含的知识点:
</p>
<ul class="org-ul">
<li>字符串的基本操作</li>
<li>随机字符串生成的技巧</li>
<li>控制台的基本 API，尤其如何获取用户输入</li>
<li>播放音乐</li>
<li><b>递归方法</b> 的使用</li>
</ul>

<p>
可以扩展的点:
</p>
<ul class="org-ul">
<li>如何去使用 <b>异步任务</b></li>
<li>如何去启用 <b>定时任务</b></li>
</ul>
</div>
</div>
</section>

<section id="outline-container-org664c376" class="outline-2">
<h2 id="org664c376"><span class="section-number-2">6.</span> 导出为 Excel 的总结</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgb6ec1ba" class="outline-3">
<h3 id="orgb6ec1ba"><span class="section-number-3">6.1.</span> Repeat Yourself</h3>
<div class="outline-text-3" id="text-6-1">
<p>
电费:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #707183;">)</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span>;
<span class="linenr"> 4: </span>    <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span>;
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span>    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #909183;">(</span>fileName<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#25991;&#20214;&#23384;&#22312;&#65292;&#37027;&#20040;&#25171;&#24320;&#20351;&#29992;&#23427;</span>
<span class="linenr"> 7: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 8: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#25171;&#24320;..."</span><span style="color: #909183;">)</span>;
<span class="linenr"> 9: </span>        <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sr = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #909183;">(</span>fileName<span style="color: #909183;">)</span>;
<span class="linenr">10: </span>        workbook = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #909183;">(</span>sr<span style="color: #909183;">)</span>;
<span class="linenr">11: </span>        sheet = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">12: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">13: </span>    <span style="color: #a020f0;">else</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#25991;&#20214;&#19981;&#23384;&#22312;&#65292;&#21019;&#24314;&#24182;&#20351;&#29992;&#23427;</span>
<span class="linenr">14: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">15: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#21019;&#24314;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">16: </span>        workbook = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #909183;">()</span>;
<span class="linenr">17: </span>        sheet = workbook.<span style="color: #0000ff;">CreateSheet</span><span style="color: #909183;">()</span>;
<span class="linenr">18: </span>
<span class="linenr">19: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#21021;&#22987;&#21270;&#22836;&#37096;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">20: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">heads</span> = <span style="color: #a020f0;">new</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> <span style="color: #8b2252;">"&#26376;&#20221;"</span>, <span style="color: #8b2252;">"&#24230;&#25968;"</span>, <span style="color: #8b2252;">"&#19968;&#26723;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#20108;&#25377;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#19977;&#26723;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#24635;&#36153;&#29992;"</span> <span style="color: #909183;">}</span>;
<span class="linenr">21: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">headRow</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">22: </span>        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; heads.Length; i++<span style="color: #909183;">)</span>
<span class="linenr">23: </span>        <span style="color: #909183;">{</span>
<span class="linenr">24: </span>            headRow.<span style="color: #0000ff;">CreateCell</span><span style="color: #709870;">(</span>i<span style="color: #709870;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #709870;">(</span>heads<span style="color: #907373;">[</span>i<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
<span class="linenr">25: </span>        <span style="color: #909183;">}</span>
<span class="linenr">26: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">27: </span>
<span class="linenr">28: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25554;&#20837;&#25968;&#25454;</span>
<span class="linenr">29: </span>    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#25554;&#20837;..."</span><span style="color: #7388d6;">)</span>;
<span class="linenr">30: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">values</span> = <span style="color: #a020f0;">new</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> _month, _used, Lv1Cost, Lv2Cost, Lv3Cost, Bill <span style="color: #7388d6;">}</span>;
<span class="linenr">31: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #7388d6;">(</span>sheet.LastRowNum + 1<span style="color: #7388d6;">)</span>;
<span class="linenr">32: </span>    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; values.Length; i++<span style="color: #7388d6;">)</span>
<span class="linenr">33: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">34: </span>        row.<span style="color: #0000ff;">CreateCell</span><span style="color: #909183;">(</span>i<span style="color: #909183;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #909183;">(</span>values<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;
<span class="linenr">35: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">36: </span>
<span class="linenr">37: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20445;&#23384; Excel</span>
<span class="linenr">38: </span>    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#20445;&#23384;..."</span><span style="color: #7388d6;">)</span>;
<span class="linenr">39: </span>    <span style="color: #a020f0;">using</span> <span style="color: #008b8b;">FileStream</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #7388d6;">(</span>fileName<span style="color: #7388d6;">)</span>;
<span class="linenr">40: </span>    workbook.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span>sw<span style="color: #7388d6;">)</span>;
<span class="linenr">41: </span>
<span class="linenr">42: </span>    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#23548;&#20986;&#25104;&#21151;!"</span><span style="color: #7388d6;">)</span>;
<span class="linenr">43: </span><span style="color: #707183;">}</span>
</pre>
</div>

<p>
个税:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel2</span><span style="color: #707183;">()</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">fileName</span> = @<span style="color: #8b2252;">"D:\xxxx.xls"</span>;
<span class="linenr"> 4: </span>    <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span>;
<span class="linenr"> 5: </span>    <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span>;
<span class="linenr"> 6: </span>    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #909183;">(</span>fileName<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 8: </span>        <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sr = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #909183;">(</span>fileName<span style="color: #909183;">)</span>;
<span class="linenr"> 9: </span>        workbook = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #909183;">(</span>sr<span style="color: #909183;">)</span>;
<span class="linenr">10: </span>        sheet = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">11: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">12: </span>    <span style="color: #a020f0;">else</span>
<span class="linenr">13: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">14: </span>        workbook = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #909183;">()</span>;
<span class="linenr">15: </span>        sheet = workbook.<span style="color: #0000ff;">CreateSheet</span><span style="color: #909183;">()</span>;
<span class="linenr">16: </span>
<span class="linenr">17: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">head</span> = <span style="color: #a020f0;">new</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> <span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;"</span>, <span style="color: #8b2252;">"&#24212;&#20132;&#31246;"</span>, <span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;"</span> <span style="color: #909183;">}</span>;
<span class="linenr">18: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">headRow</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">19: </span>        <span style="color: #a020f0;">for</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; head.Length; i++<span style="color: #909183;">)</span>
<span class="linenr">20: </span>        <span style="color: #909183;">{</span>
<span class="linenr">21: </span>            headRow.<span style="color: #0000ff;">CreateCell</span><span style="color: #709870;">(</span>i<span style="color: #709870;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #709870;">(</span>head<span style="color: #907373;">[</span>i<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
<span class="linenr">22: </span>        <span style="color: #909183;">}</span>
<span class="linenr">23: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">24: </span>
<span class="linenr">25: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">heads</span> = <span style="color: #a020f0;">new</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> Money, Tax, Money - Tax <span style="color: #7388d6;">}</span>;
<span class="linenr">26: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #7388d6;">(</span>sheet.LastRowNum + 1<span style="color: #7388d6;">)</span>;
<span class="linenr">27: </span>    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; heads.Length; i++<span style="color: #7388d6;">)</span>
<span class="linenr">28: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">29: </span>        row.<span style="color: #0000ff;">CreateCell</span><span style="color: #909183;">(</span>i<span style="color: #909183;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #909183;">(</span>heads<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;
<span class="linenr">30: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">31: </span>
<span class="linenr">32: </span>    <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #7388d6;">(</span>fileName<span style="color: #7388d6;">)</span>;
<span class="linenr">33: </span>    workbook.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span>sw<span style="color: #7388d6;">)</span>;
<span class="linenr">34: </span><span style="color: #707183;">}</span>
</pre>
</div>

<p>
小费:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExcelExcel</span><span style="color: #707183;">()</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">fileName</span> = @<span style="color: #8b2252;">"D:\eee.xls"</span>;
<span class="linenr"> 4: </span>    <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span>;
<span class="linenr"> 5: </span>    <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span>;
<span class="linenr"> 6: </span>    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #909183;">(</span>fileName<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 8: </span>        <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sr = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #909183;">(</span>fileName<span style="color: #909183;">)</span>;
<span class="linenr"> 9: </span>        workbook = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #909183;">(</span>sr<span style="color: #909183;">)</span>;
<span class="linenr">10: </span>        sheet = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">11: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">12: </span>    <span style="color: #a020f0;">else</span>
<span class="linenr">13: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">14: </span>        workbook = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #909183;">()</span>;
<span class="linenr">15: </span>        sheet = workbook.<span style="color: #0000ff;">CreateSheet</span><span style="color: #909183;">()</span>;
<span class="linenr">16: </span>
<span class="linenr">17: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">headValues</span> = <span style="color: #a020f0;">new</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> <span style="color: #8b2252;">"&#36134;&#21333;&#24635;&#39069;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;&#25968;&#39069;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;&#31246;&#29575;"</span>, <span style="color: #8b2252;">"&#36134;&#21333;&#23454;&#20184;"</span> <span style="color: #909183;">}</span>;
<span class="linenr">18: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">head</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">19: </span>        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; headValues.Length; i++<span style="color: #909183;">)</span>
<span class="linenr">20: </span>        <span style="color: #909183;">{</span>
<span class="linenr">21: </span>            head.<span style="color: #0000ff;">CreateCell</span><span style="color: #709870;">(</span>i<span style="color: #709870;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #709870;">(</span>headValues<span style="color: #907373;">[</span>i<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
<span class="linenr">22: </span>        <span style="color: #909183;">}</span>
<span class="linenr">23: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">24: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row1Values</span> = <span style="color: #a020f0;">new</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> Bill, Tip, RATE, Bill + Tip <span style="color: #7388d6;">}</span>;
<span class="linenr">25: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row1</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #7388d6;">(</span>sheet.LastRowNum + 1<span style="color: #7388d6;">)</span>;
<span class="linenr">26: </span>    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; row1Values.Length; i++<span style="color: #7388d6;">)</span>
<span class="linenr">27: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">28: </span>        row1.<span style="color: #0000ff;">CreateCell</span><span style="color: #909183;">(</span>i<span style="color: #909183;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #909183;">(</span>row1Values<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;
<span class="linenr">29: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">30: </span>    <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #7388d6;">(</span>fileName<span style="color: #7388d6;">)</span>;
<span class="linenr">31: </span>    workbook.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span>sw<span style="color: #7388d6;">)</span>;
<span class="linenr">32: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfac97a8" class="outline-3">
<h3 id="orgfac97a8"><span class="section-number-3">6.2.</span> 当逻辑在不同方法中 Repeat，将其 <b>分离</b> 为单独的方法</h3>
<div class="outline-text-3" id="text-6-2">
<p>
分离的目的，是为了共享，是为了复用。是为了减少代码量，减小创作成本。
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCalc</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20998;&#31163;&#20986;&#26469;&#30340;&#36923;&#36753;</span>
<span class="linenr"> 6: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IWorkbook</span> <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 8: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
<span class="linenr"> 9: </span>        <span style="color: #909183;">{</span>
<span class="linenr">10: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#25171;&#24320;..."</span><span style="color: #709870;">)</span>;
<span class="linenr">11: </span>            <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sr = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr">12: </span>            <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #709870;">(</span><span style="color: #228b22;">sr</span><span style="color: #709870;">)</span>;
<span class="linenr">13: </span>        <span style="color: #909183;">}</span>
<span class="linenr">14: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr">15: </span>        <span style="color: #909183;">{</span>
<span class="linenr">16: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#19981;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#21019;&#24314;&#26032;&#30340; WOrkbook &#23545;&#35937;"</span><span style="color: #709870;">)</span>;
<span class="linenr">17: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #709870;">()</span>;
<span class="linenr">18: </span>            workbook.<span style="color: #0000ff;">CreateSheet</span><span style="color: #709870;">()</span>;
<span class="linenr">19: </span>            <span style="color: #a020f0;">return</span> workbook;
<span class="linenr">20: </span>        <span style="color: #909183;">}</span>
<span class="linenr">21: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">22: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr">23: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">24: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#20445;&#23384;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">25: </span>        <span style="color: #a020f0;">try</span>
<span class="linenr">26: </span>        <span style="color: #909183;">{</span>
<span class="linenr">27: </span>            <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr">28: </span>            workbook.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #228b22;">sw</span><span style="color: #709870;">)</span>;
<span class="linenr">29: </span>        <span style="color: #909183;">}</span>
<span class="linenr">30: </span>        <span style="color: #a020f0;">catch</span>
<span class="linenr">31: </span>        <span style="color: #909183;">{</span>
<span class="linenr">32: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#20445;&#23384;&#20986;&#38169;"</span><span style="color: #709870;">)</span>;
<span class="linenr">33: </span>        <span style="color: #909183;">}</span>
<span class="linenr">34: </span>        <span style="color: #a020f0;">finally</span>
<span class="linenr">35: </span>        <span style="color: #909183;">{</span>
<span class="linenr">36: </span>            workbook.<span style="color: #0000ff;">Close</span><span style="color: #709870;">()</span>;
<span class="linenr">37: </span>        <span style="color: #909183;">}</span>
<span class="linenr">38: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">39: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rownum</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">data</span><span style="color: #7388d6;">)</span>
<span class="linenr">40: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">41: </span>        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#25554;&#20837;&#25968;&#25454;&#34892;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">42: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #909183;">(</span><span style="color: #228b22;">rownum</span><span style="color: #909183;">)</span>;
<span class="linenr">43: </span>
<span class="linenr">44: </span>        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; data.Length; i++<span style="color: #909183;">)</span>
<span class="linenr">45: </span>        <span style="color: #909183;">{</span>
<span class="linenr">46: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{i}  "</span><span style="color: #709870;">)</span>;
<span class="linenr">47: </span>            row.<span style="color: #0000ff;">CreateCell</span><span style="color: #709870;">(</span><span style="color: #228b22;">i</span><span style="color: #709870;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #709870;">(</span><span style="color: #228b22;">data</span><span style="color: #907373;">[</span>i<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
<span class="linenr">48: </span>        <span style="color: #909183;">}</span>
<span class="linenr">49: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr">50: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">51: </span>
<span class="linenr">52: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21487;&#20197;&#28165;&#29245;&#22320;&#35843;&#29992;</span>
<span class="linenr">53: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Export1</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr">54: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">55: </span>        <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">56: </span>        <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">57: </span>
<span class="linenr">58: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22836;</span>
<span class="linenr">59: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>sheet.LastRowNum == 0<span style="color: #909183;">)</span> <span style="color: #909183;">{</span> <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #709870;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> <span style="color: #8b2252;">"&#36134;&#21333;&#24635;&#39069;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;&#25968;&#39069;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;&#31246;&#29575;"</span>, <span style="color: #8b2252;">"&#36134;&#21333;&#23454;&#20184;"</span> <span style="color: #907373;">}</span><span style="color: #709870;">)</span>; <span style="color: #909183;">}</span>
<span class="linenr">60: </span>
<span class="linenr">61: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25968;&#25454;</span>
<span class="linenr">62: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">data</span> = <span style="color: #a020f0;">new</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> Bill, Tip, RATE, Bill + Tip <span style="color: #909183;">}</span>;
<span class="linenr">63: </span>        <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #909183;">(</span><span style="color: #228b22;">sheet</span>, sheet.LastRowNum + 1, <span style="color: #709870;">(</span><span style="color: #a020f0;">from</span> i <span style="color: #a020f0;">in</span> data <span style="color: #a020f0;">select</span> i.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span><span style="color: #709870;">)</span>.<span style="color: #0000ff;">ToArray</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
<span class="linenr">64: </span>
<span class="linenr">65: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20445;&#23384;</span>
<span class="linenr">66: </span>        <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">workbook</span>, <span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">67: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">68: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Export2</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr">69: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">70: </span>        <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">71: </span>        <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">72: </span>
<span class="linenr">73: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>sheet.LastRowNum == 0<span style="color: #909183;">)</span>
<span class="linenr">74: </span>            <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #909183;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> <span style="color: #8b2252;">"Bill"</span>, <span style="color: #8b2252;">"Fee"</span>, <span style="color: #8b2252;">"Payment"</span> <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
<span class="linenr">75: </span>        <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #909183;">(</span><span style="color: #228b22;">sheet</span>, sheet.LastRowNum + 1, <span style="color: #709870;">(</span><span style="color: #a020f0;">from</span> i <span style="color: #a020f0;">in</span> <span style="color: #907373;">(</span><span style="color: #a020f0;">new</span><span style="color: #6276ba;">[]</span> <span style="color: #6276ba;">{</span> Bill, Tip, Bill + Tip <span style="color: #6276ba;">}</span><span style="color: #907373;">)</span> <span style="color: #a020f0;">select</span> i.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span><span style="color: #709870;">)</span>.<span style="color: #0000ff;">ToArray</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
<span class="linenr">76: </span>        <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">workbook</span>, <span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">77: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">78: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org567bd89" class="outline-3">
<h3 id="org567bd89"><span class="section-number-3">6.3.</span> 当方法在不同类中 Repeat</h3>
<div class="outline-text-3" id="text-6-3">
</div>
<div id="outline-container-orge296b33" class="outline-4">
<h4 id="orge296b33"><span class="section-number-4">6.3.1.</span> 在类中 Repeat Yourself</h4>
<div class="outline-text-4" id="text-6-3-1">
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr">  1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCalc</span>
<span class="linenr">  2: </span><span style="color: #707183;">{</span>
<span class="linenr">  3: </span>    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">TipCalc</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">bill</span><span style="color: #7388d6;">)</span>
<span class="linenr">  4: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">  5: </span>        Bill = bill;
<span class="linenr">  6: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">  7: </span>
<span class="linenr">  8: </span>    <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">RATE</span> = 0.18;
<span class="linenr">  9: </span>
<span class="linenr"> 10: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Bill</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span class="linenr"> 11: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Tip</span>
<span class="linenr"> 12: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 13: </span>        <span style="color: #a020f0;">get</span> <span style="color: #909183;">{</span> <span style="color: #a020f0;">return</span> Bill * RATE; <span style="color: #909183;">}</span>
<span class="linenr"> 14: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 15: </span>
<span class="linenr"> 16: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Print</span><span style="color: #7388d6;">()</span>
<span class="linenr"> 17: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 18: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr"> 19: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#36134;&#21333;&#24635;&#39069;: {Bill,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr"> 20: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#23567;&#36153;&#25968;&#39069;: {Tip,10:C} ({RATE:P1})"</span><span style="color: #909183;">)</span>;
<span class="linenr"> 21: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
<span class="linenr"> 22: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#36134;&#21333;&#23454;&#20184;: {Bill + Tip,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr"> 23: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 24: </span>
<span class="linenr"> 25: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintFantasy</span><span style="color: #7388d6;">()</span>
<span class="linenr"> 26: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 27: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr"> 28: </span>        <span style="color: #a020f0;">while</span> <span style="color: #909183;">(</span><span style="color: #008b8b;">true</span><span style="color: #909183;">)</span>
<span class="linenr"> 29: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 30: </span>            <span style="color: #228b22;">ConsoleKeyInfo</span> <span style="color: #a0522d;">key</span> = Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #709870;">(</span><span style="color: #008b8b;">true</span><span style="color: #709870;">)</span>;
<span class="linenr"> 31: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.Key == ConsoleKey.D1<span style="color: #709870;">)</span>
<span class="linenr"> 32: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 33: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#24744;&#36755;&#20837;&#20102;&#19968;&#20010; 1"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 34: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 35: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.Key == ConsoleKey.S<span style="color: #709870;">)</span>
<span class="linenr"> 36: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 37: </span>                Console.<span style="color: #0000ff;">Beep</span><span style="color: #907373;">()</span>;
<span class="linenr"> 38: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 39: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.KeyChar == <span style="color: #8b2252;">'d'</span><span style="color: #709870;">)</span>
<span class="linenr"> 40: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 41: </span>                Console.<span style="color: #0000ff;">Beep</span><span style="color: #907373;">(</span>600, 200<span style="color: #907373;">)</span>;
<span class="linenr"> 42: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 43: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.KeyChar == <span style="color: #8b2252;">'f'</span><span style="color: #709870;">)</span>
<span class="linenr"> 44: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 45: </span>                Console.<span style="color: #0000ff;">Beep</span><span style="color: #907373;">(</span>200, 200<span style="color: #907373;">)</span>;
<span class="linenr"> 46: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 47: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.Key == ConsoleKey.Enter<span style="color: #709870;">)</span>
<span class="linenr"> 48: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 49: </span>                <span style="color: #a020f0;">break</span>;
<span class="linenr"> 50: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 51: </span>            <span style="color: #a020f0;">else</span>
<span class="linenr"> 52: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 53: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"{key}, keyChar: {key.KeyChar}, key: {key.Key}"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 54: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 55: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 56: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 57: </span>
<span class="linenr"> 58: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IWorkbook</span> <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 59: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 60: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
<span class="linenr"> 61: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 62: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#25171;&#24320;..."</span><span style="color: #709870;">)</span>;
<span class="linenr"> 63: </span>            <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sr = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr"> 64: </span>            <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #709870;">(</span><span style="color: #228b22;">sr</span><span style="color: #709870;">)</span>;
<span class="linenr"> 65: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 66: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr"> 67: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 68: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#19981;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#21019;&#24314;&#26032;&#30340; WOrkbook &#23545;&#35937;"</span><span style="color: #709870;">)</span>;
<span class="linenr"> 69: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #709870;">()</span>;
<span class="linenr"> 70: </span>            workbook.<span style="color: #0000ff;">CreateSheet</span><span style="color: #709870;">()</span>;
<span class="linenr"> 71: </span>            <span style="color: #a020f0;">return</span> workbook;
<span class="linenr"> 72: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 73: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 74: </span>
<span class="linenr"> 75: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 76: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 77: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#20445;&#23384;..."</span><span style="color: #909183;">)</span>;
<span class="linenr"> 78: </span>        <span style="color: #a020f0;">try</span>
<span class="linenr"> 79: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 80: </span>            <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr"> 81: </span>            workbook.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #228b22;">sw</span><span style="color: #709870;">)</span>;
<span class="linenr"> 82: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 83: </span>        <span style="color: #a020f0;">catch</span>
<span class="linenr"> 84: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 85: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#20445;&#23384;&#20986;&#38169;"</span><span style="color: #709870;">)</span>;
<span class="linenr"> 86: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 87: </span>        <span style="color: #a020f0;">finally</span>
<span class="linenr"> 88: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 89: </span>            workbook.<span style="color: #0000ff;">Close</span><span style="color: #709870;">()</span>;
<span class="linenr"> 90: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 91: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 92: </span>
<span class="linenr"> 93: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rownum</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">data</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 94: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 95: </span>        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#25554;&#20837;&#25968;&#25454;&#34892;..."</span><span style="color: #909183;">)</span>;
<span class="linenr"> 96: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #909183;">(</span><span style="color: #228b22;">rownum</span><span style="color: #909183;">)</span>;
<span class="linenr"> 97: </span>
<span class="linenr"> 98: </span>        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; data.Length; i++<span style="color: #909183;">)</span>
<span class="linenr"> 99: </span>        <span style="color: #909183;">{</span>
<span class="linenr">100: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{i}  "</span><span style="color: #709870;">)</span>;
<span class="linenr">101: </span>            row.<span style="color: #0000ff;">CreateCell</span><span style="color: #709870;">(</span><span style="color: #228b22;">i</span><span style="color: #709870;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #709870;">(</span><span style="color: #228b22;">data</span><span style="color: #907373;">[</span>i<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
<span class="linenr">102: </span>        <span style="color: #909183;">}</span>
<span class="linenr">103: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr">104: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">105: </span>
<span class="linenr">106: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExcelExcel</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr">107: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">108: </span>        <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">109: </span>        <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">110: </span>
<span class="linenr">111: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22836;</span>
<span class="linenr">112: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>sheet.LastRowNum == 0<span style="color: #909183;">)</span>
<span class="linenr">113: </span>        <span style="color: #909183;">{</span>
<span class="linenr">114: </span>            <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #709870;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> <span style="color: #8b2252;">"&#36134;&#21333;&#24635;&#39069;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;&#25968;&#39069;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;&#31246;&#29575;"</span>, <span style="color: #8b2252;">"&#36134;&#21333;&#23454;&#20184;"</span> <span style="color: #907373;">}</span><span style="color: #709870;">)</span>;
<span class="linenr">115: </span>        <span style="color: #909183;">}</span>
<span class="linenr">116: </span>
<span class="linenr">117: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25968;&#25454;</span>
<span class="linenr">118: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">data</span> = <span style="color: #a020f0;">new</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> Bill, Tip, RATE, Bill + Tip <span style="color: #909183;">}</span>;
<span class="linenr">119: </span>        <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #909183;">(</span><span style="color: #228b22;">sheet</span>, sheet.LastRowNum + 1, <span style="color: #709870;">(</span><span style="color: #a020f0;">from</span> i <span style="color: #a020f0;">in</span> data <span style="color: #a020f0;">select</span> i.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span><span style="color: #709870;">)</span>.<span style="color: #0000ff;">ToArray</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
<span class="linenr">120: </span>
<span class="linenr">121: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20445;&#23384;</span>
<span class="linenr">122: </span>        <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">workbook</span>, <span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">123: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">124: </span><span style="color: #707183;">}</span>
<span class="linenr">125: </span>
<span class="linenr">126: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCalc</span>
<span class="linenr">127: </span><span style="color: #707183;">{</span>
<span class="linenr">128: </span>    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">TaxCalc</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">m</span><span style="color: #7388d6;">)</span>
<span class="linenr">129: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">130: </span>        Money = m;
<span class="linenr">131: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">132: </span>
<span class="linenr">133: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">_money</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#29992;&#26469;&#25215;&#36733;&#21518;&#38754;&#30340;&#25968;&#25454;&#65292;&#31246;&#21069;&#25910;&#20837;</span>
<span class="linenr">134: </span>    <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #7388d6;">}</span>;
<span class="linenr">135: </span>
<span class="linenr">136: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Money</span>
<span class="linenr">137: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">138: </span>        <span style="color: #a020f0;">get</span> =&gt; _money; <span style="color: #b22222;">// </span><span style="color: #b22222;">xxxx.Money</span>
<span class="linenr">139: </span>        <span style="color: #a020f0;">set</span>                    <span style="color: #b22222;">// </span><span style="color: #b22222;">xxxx.Money = 3333;</span>
<span class="linenr">140: </span>        <span style="color: #909183;">{</span>
<span class="linenr">141: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span><span style="color: #008b8b;">value</span> &lt; 0<span style="color: #709870;">)</span>
<span class="linenr">142: </span>            <span style="color: #709870;">{</span>
<span class="linenr">143: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"\n&#21442;&#25968;&#36755;&#20837;&#26684;&#24335;&#19981;&#27491;&#30830;&#65281;"</span><span style="color: #907373;">)</span>;
<span class="linenr">144: </span>                Environment.<span style="color: #0000ff;">Exit</span><span style="color: #907373;">(</span>0<span style="color: #907373;">)</span>;
<span class="linenr">145: </span>            <span style="color: #709870;">}</span>
<span class="linenr">146: </span>            _money = <span style="color: #008b8b;">value</span>;
<span class="linenr">147: </span>            <span style="color: #0000ff;">CalculateTax</span><span style="color: #709870;">()</span>;
<span class="linenr">148: </span>        <span style="color: #909183;">}</span>
<span class="linenr">149: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">150: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Rate</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">151: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Tax</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">152: </span>
<span class="linenr">153: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CalculateTax</span><span style="color: #7388d6;">()</span>
<span class="linenr">154: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">155: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt;= 5000<span style="color: #909183;">)</span>
<span class="linenr">156: </span>        <span style="color: #909183;">{</span>
<span class="linenr">157: </span>            Rate = 0;
<span class="linenr">158: </span>            Tax = 0;
<span class="linenr">159: </span>        <span style="color: #909183;">}</span>
<span class="linenr">160: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 10000<span style="color: #909183;">)</span>
<span class="linenr">161: </span>        <span style="color: #909183;">{</span>
<span class="linenr">162: </span>            Rate = rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
<span class="linenr">163: </span>            Tax = <span style="color: #709870;">(</span>Money - 5000<span style="color: #709870;">)</span> * Rate;
<span class="linenr">164: </span>        <span style="color: #909183;">}</span>
<span class="linenr">165: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 20000<span style="color: #909183;">)</span>
<span class="linenr">166: </span>        <span style="color: #909183;">{</span>
<span class="linenr">167: </span>            Rate = rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
<span class="linenr">168: </span>            Tax = <span style="color: #709870;">(</span>Money - 10000<span style="color: #709870;">)</span> * Rate + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
<span class="linenr">169: </span>        <span style="color: #909183;">}</span>
<span class="linenr">170: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 100000<span style="color: #909183;">)</span>
<span class="linenr">171: </span>        <span style="color: #909183;">{</span>
<span class="linenr">172: </span>            Rate = rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
<span class="linenr">173: </span>            Tax = <span style="color: #709870;">(</span>Money - 20000<span style="color: #709870;">)</span> * Rate + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
<span class="linenr">174: </span>        <span style="color: #909183;">}</span>
<span class="linenr">175: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr">176: </span>        <span style="color: #909183;">{</span>
<span class="linenr">177: </span>            Rate = rates<span style="color: #709870;">[</span>3<span style="color: #709870;">]</span>;
<span class="linenr">178: </span>            Tax = <span style="color: #709870;">(</span>Money - 100000<span style="color: #709870;">)</span> * Rate + 80000 * rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span> + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
<span class="linenr">179: </span>        <span style="color: #909183;">}</span>
<span class="linenr">180: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">181: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
<span class="linenr">182: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">183: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr">184: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">185: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
<span class="linenr">186: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
<span class="linenr">187: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">188: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">189: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">()</span>
<span class="linenr">190: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">191: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr">192: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excle&#36755;&#20986;&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">193: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excle&#36755;&#20986;&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
<span class="linenr">194: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
<span class="linenr">195: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excle&#36755;&#20986;&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">196: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">197: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ShowRates</span><span style="color: #7388d6;">()</span>
<span class="linenr">198: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">199: </span>        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">r</span> <span style="color: #a020f0;">in</span> rates<span style="color: #909183;">)</span>
<span class="linenr">200: </span>        <span style="color: #909183;">{</span>
<span class="linenr">201: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"- {r}"</span><span style="color: #709870;">)</span>;
<span class="linenr">202: </span>        <span style="color: #909183;">}</span>
<span class="linenr">203: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">204: </span>
<span class="linenr">205: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel2</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr">206: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">207: </span>        <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">208: </span>        <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">209: </span>
<span class="linenr">210: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>sheet.LastRowNum == 0<span style="color: #909183;">)</span>
<span class="linenr">211: </span>        <span style="color: #909183;">{</span>
<span class="linenr">212: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">head</span> = <span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> <span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;"</span>, <span style="color: #8b2252;">"&#24212;&#20132;&#31246;"</span>, <span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;"</span> <span style="color: #709870;">}</span>;
<span class="linenr">213: </span>            <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #709870;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #228b22;">head</span><span style="color: #709870;">)</span>;
<span class="linenr">214: </span>        <span style="color: #909183;">}</span>
<span class="linenr">215: </span>
<span class="linenr">216: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">heads</span> = <span style="color: #a020f0;">new</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> Money.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span>, Tax.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span>, <span style="color: #709870;">(</span>Money - Tax<span style="color: #709870;">)</span>.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span> <span style="color: #909183;">}</span>;
<span class="linenr">217: </span>        <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #909183;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #228b22;">heads</span><span style="color: #909183;">)</span>;
<span class="linenr">218: </span>
<span class="linenr">219: </span>        <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">workbook</span>, <span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">220: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">221: </span>
<span class="linenr">222: </span>
<span class="linenr">223: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IWorkbook</span> <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr">224: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">225: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
<span class="linenr">226: </span>        <span style="color: #909183;">{</span>
<span class="linenr">227: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#25171;&#24320;..."</span><span style="color: #709870;">)</span>;
<span class="linenr">228: </span>            <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sr = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr">229: </span>            <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #709870;">(</span><span style="color: #228b22;">sr</span><span style="color: #709870;">)</span>;
<span class="linenr">230: </span>        <span style="color: #909183;">}</span>
<span class="linenr">231: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr">232: </span>        <span style="color: #909183;">{</span>
<span class="linenr">233: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#19981;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#21019;&#24314;&#26032;&#30340; WOrkbook &#23545;&#35937;"</span><span style="color: #709870;">)</span>;
<span class="linenr">234: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #709870;">()</span>;
<span class="linenr">235: </span>            workbook.<span style="color: #0000ff;">CreateSheet</span><span style="color: #709870;">()</span>;
<span class="linenr">236: </span>            <span style="color: #a020f0;">return</span> workbook;
<span class="linenr">237: </span>        <span style="color: #909183;">}</span>
<span class="linenr">238: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">239: </span>
<span class="linenr">240: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr">241: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">242: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#20445;&#23384;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">243: </span>        <span style="color: #a020f0;">try</span>
<span class="linenr">244: </span>        <span style="color: #909183;">{</span>
<span class="linenr">245: </span>            <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr">246: </span>            workbook.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #228b22;">sw</span><span style="color: #709870;">)</span>;
<span class="linenr">247: </span>        <span style="color: #909183;">}</span>
<span class="linenr">248: </span>        <span style="color: #a020f0;">catch</span>
<span class="linenr">249: </span>        <span style="color: #909183;">{</span>
<span class="linenr">250: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#20445;&#23384;&#20986;&#38169;"</span><span style="color: #709870;">)</span>;
<span class="linenr">251: </span>        <span style="color: #909183;">}</span>
<span class="linenr">252: </span>        <span style="color: #a020f0;">finally</span>
<span class="linenr">253: </span>        <span style="color: #909183;">{</span>
<span class="linenr">254: </span>            workbook.<span style="color: #0000ff;">Close</span><span style="color: #709870;">()</span>;
<span class="linenr">255: </span>        <span style="color: #909183;">}</span>
<span class="linenr">256: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">257: </span>
<span class="linenr">258: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rownum</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">data</span><span style="color: #7388d6;">)</span>
<span class="linenr">259: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">260: </span>        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#25554;&#20837;&#25968;&#25454;&#34892;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">261: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #909183;">(</span><span style="color: #228b22;">rownum</span><span style="color: #909183;">)</span>;
<span class="linenr">262: </span>
<span class="linenr">263: </span>        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; data.Length; i++<span style="color: #909183;">)</span>
<span class="linenr">264: </span>        <span style="color: #909183;">{</span>
<span class="linenr">265: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{i}  "</span><span style="color: #709870;">)</span>;
<span class="linenr">266: </span>            row.<span style="color: #0000ff;">CreateCell</span><span style="color: #709870;">(</span><span style="color: #228b22;">i</span><span style="color: #709870;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #709870;">(</span><span style="color: #228b22;">data</span><span style="color: #907373;">[</span>i<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
<span class="linenr">267: </span>        <span style="color: #909183;">}</span>
<span class="linenr">268: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr">269: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">270: </span>
<span class="linenr">271: </span><span style="color: #707183;">}</span>
<span class="linenr">272: </span>
<span class="linenr">273: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">ElectricBillCalc</span>
<span class="linenr">274: </span><span style="color: #707183;">{</span>
<span class="linenr">275: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22522;&#20934;&#25968;&#25454;</span>
<span class="linenr">276: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">int</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">SummerLevels</span> = <span style="color: #7388d6;">{</span> 260, 600 <span style="color: #7388d6;">}</span>;
<span class="linenr">277: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">int</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">WinterLevels</span> = <span style="color: #7388d6;">{</span> 200, 400 <span style="color: #7388d6;">}</span>;
<span class="linenr">278: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">Rates</span> = <span style="color: #7388d6;">{</span> 0.600, 0.650, 0.900 <span style="color: #7388d6;">}</span>;
<span class="linenr">279: </span>
<span class="linenr">280: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#30693;&#36947;&#30340;&#25968;&#25454;</span>
<span class="linenr">281: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">_month</span>;
<span class="linenr">282: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">_used</span>;
<span class="linenr">283: </span>
<span class="linenr">284: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#35745;&#31639;&#20986;&#26469;&#30340;&#25968;&#25454;</span>
<span class="linenr">285: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">lvUsed</span>;
<span class="linenr">286: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Lv1Cost</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span> =&gt; lvUsed<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span> * Rates<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">287: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Lv2Cost</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span> =&gt; lvUsed<span style="color: #909183;">[</span>1<span style="color: #909183;">]</span> * Rates<span style="color: #909183;">[</span>1<span style="color: #909183;">]</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">288: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Lv3Cost</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span> =&gt; lvUsed<span style="color: #909183;">[</span>2<span style="color: #909183;">]</span> * Rates<span style="color: #909183;">[</span>2<span style="color: #909183;">]</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">289: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Bill</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span> =&gt; Lv1Cost + Lv2Cost + Lv3Cost; <span style="color: #7388d6;">}</span>
<span class="linenr">290: </span>
<span class="linenr">291: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SetMonthAndUsed</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">month</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">used</span><span style="color: #7388d6;">)</span>
<span class="linenr">292: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">293: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>month &lt; 1 || month &gt; 12 || used &lt; 0<span style="color: #909183;">)</span> <span style="color: #0000ff;">QuitWithReason</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#21442;&#25968;&#36755;&#20837;&#38169;&#35823;"</span><span style="color: #909183;">)</span>;
<span class="linenr">294: </span>        <span style="color: #909183;">(</span><span style="color: #228b22;">_month</span>, <span style="color: #228b22;">_used</span><span style="color: #909183;">)</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">month</span>, <span style="color: #228b22;">used</span><span style="color: #909183;">)</span>;
<span class="linenr">295: </span>        <span style="color: #0000ff;">CalculateLvUsed</span><span style="color: #909183;">()</span>;
<span class="linenr">296: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">297: </span>
<span class="linenr">298: </span>    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CalculateLvUsed</span><span style="color: #7388d6;">()</span>
<span class="linenr">299: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">300: </span>        <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">p1</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">p2</span><span style="color: #909183;">)</span> = <span style="color: #0000ff;">IsSummer</span><span style="color: #909183;">()</span> ? <span style="color: #909183;">(</span><span style="color: #228b22;">SummerLevels</span><span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>, <span style="color: #228b22;">SummerLevels</span><span style="color: #709870;">[</span>1<span style="color: #709870;">]</span><span style="color: #909183;">)</span> : <span style="color: #909183;">(</span><span style="color: #228b22;">WinterLevels</span><span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>, <span style="color: #228b22;">WinterLevels</span><span style="color: #709870;">[</span>1<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;
<span class="linenr">301: </span>
<span class="linenr">302: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>_used &lt;= p1<span style="color: #909183;">)</span>
<span class="linenr">303: </span>        <span style="color: #909183;">{</span>
<span class="linenr">304: </span>            lvUsed = <span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> _used, 0, 0 <span style="color: #709870;">}</span>;
<span class="linenr">305: </span>        <span style="color: #909183;">}</span>
<span class="linenr">306: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>_used &lt;= p2<span style="color: #909183;">)</span>
<span class="linenr">307: </span>        <span style="color: #909183;">{</span>
<span class="linenr">308: </span>            lvUsed = <span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> p1, _used - p1, 0 <span style="color: #709870;">}</span>;
<span class="linenr">309: </span>        <span style="color: #909183;">}</span>
<span class="linenr">310: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr">311: </span>        <span style="color: #909183;">{</span>
<span class="linenr">312: </span>            lvUsed = <span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> p1, p2 - p1, _used - p2 <span style="color: #709870;">}</span>;
<span class="linenr">313: </span>        <span style="color: #909183;">}</span>
<span class="linenr">314: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">315: </span>
<span class="linenr">316: </span>    <span style="color: #228b22;">bool</span> <span style="color: #0000ff;">IsSummer</span><span style="color: #7388d6;">()</span> =&gt; _month &gt;= 5 &amp;&amp; _month &lt;= 10;
<span class="linenr">317: </span>
<span class="linenr">318: </span>    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">QuitWithReason</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">reason</span><span style="color: #7388d6;">)</span>
<span class="linenr">319: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">320: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">reason</span><span style="color: #909183;">)</span>;
<span class="linenr">321: </span>        Environment.<span style="color: #0000ff;">Exit</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">322: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">323: </span>
<span class="linenr">324: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintFantasy</span><span style="color: #7388d6;">()</span>
<span class="linenr">325: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">326: </span>        <span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>;
<span class="linenr">327: </span>        <span style="color: #a020f0;">while</span> <span style="color: #909183;">(</span><span style="color: #008b8b;">true</span><span style="color: #909183;">)</span>
<span class="linenr">328: </span>        <span style="color: #909183;">{</span>
<span class="linenr">329: </span>            <span style="color: #228b22;">ConsoleKeyInfo</span> <span style="color: #a0522d;">key</span> = Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #709870;">()</span>;
<span class="linenr">330: </span>            Console.<span style="color: #0000ff;">Clear</span><span style="color: #709870;">()</span>;
<span class="linenr">331: </span>
<span class="linenr">332: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.Key == ConsoleKey.D1<span style="color: #709870;">)</span>
<span class="linenr">333: </span>            <span style="color: #709870;">{</span>
<span class="linenr">334: </span>                <span style="color: #0000ff;">PrintToConsole</span><span style="color: #907373;">(</span>ConsoleColor.<span style="color: #228b22;">Red</span><span style="color: #907373;">)</span>;
<span class="linenr">335: </span>            <span style="color: #709870;">}</span>
<span class="linenr">336: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.Key == ConsoleKey.D2<span style="color: #709870;">)</span>
<span class="linenr">337: </span>            <span style="color: #709870;">{</span>
<span class="linenr">338: </span>                <span style="color: #0000ff;">PrintToConsole</span><span style="color: #907373;">(</span>ConsoleColor.<span style="color: #228b22;">Green</span><span style="color: #907373;">)</span>;
<span class="linenr">339: </span>            <span style="color: #709870;">}</span>
<span class="linenr">340: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.Key == ConsoleKey.D3<span style="color: #709870;">)</span>
<span class="linenr">341: </span>            <span style="color: #709870;">{</span>
<span class="linenr">342: </span>                <span style="color: #0000ff;">PrintToConsole</span><span style="color: #907373;">(</span>ConsoleColor.<span style="color: #228b22;">Yellow</span><span style="color: #907373;">)</span>;
<span class="linenr">343: </span>            <span style="color: #709870;">}</span>
<span class="linenr">344: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>key.Key == ConsoleKey.Enter<span style="color: #709870;">)</span>
<span class="linenr">345: </span>            <span style="color: #709870;">{</span>
<span class="linenr">346: </span>                <span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0;
<span class="linenr">347: </span>                <span style="color: #a020f0;">while</span> <span style="color: #907373;">(</span><span style="color: #008b8b;">true</span><span style="color: #907373;">)</span>
<span class="linenr">348: </span>                <span style="color: #907373;">{</span>
<span class="linenr">349: </span>                    <span style="color: #228b22;">ConsoleColor</span><span style="color: #6276ba;">[]</span> <span style="color: #a0522d;">colors</span> = <span style="color: #a020f0;">new</span><span style="color: #6276ba;">[]</span> <span style="color: #6276ba;">{</span> ConsoleColor.Red, ConsoleColor.Green, ConsoleColor.Blue <span style="color: #6276ba;">}</span>;
<span class="linenr">350: </span>                    i = <span style="color: #6276ba;">(</span>i + 1<span style="color: #6276ba;">)</span> % colors.Length;
<span class="linenr">351: </span>                    <span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>i == 1<span style="color: #6276ba;">)</span>
<span class="linenr">352: </span>                    <span style="color: #6276ba;">{</span>
<span class="linenr">353: </span>                        Console.<span style="color: #0000ff;">Beep</span><span style="color: #858580;">(</span>90, 50<span style="color: #858580;">)</span>;
<span class="linenr">354: </span>                    <span style="color: #6276ba;">}</span>
<span class="linenr">355: </span>                    <span style="color: #a020f0;">else</span>
<span class="linenr">356: </span>                    <span style="color: #6276ba;">{</span>
<span class="linenr">357: </span>                        Console.<span style="color: #0000ff;">Beep</span><span style="color: #858580;">(</span>40, 50<span style="color: #858580;">)</span>;
<span class="linenr">358: </span>                    <span style="color: #6276ba;">}</span>
<span class="linenr">359: </span>                    Console.<span style="color: #0000ff;">Clear</span><span style="color: #6276ba;">()</span>;
<span class="linenr">360: </span>                    <span style="color: #0000ff;">PrintToConsole</span><span style="color: #6276ba;">(</span><span style="color: #228b22;">colors</span><span style="color: #858580;">[</span>i<span style="color: #858580;">]</span><span style="color: #6276ba;">)</span>;
<span class="linenr">361: </span>                    Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #6276ba;">(</span>300<span style="color: #6276ba;">)</span>;
<span class="linenr">362: </span>                <span style="color: #907373;">}</span>
<span class="linenr">363: </span>            <span style="color: #709870;">}</span>
<span class="linenr">364: </span>            <span style="color: #a020f0;">else</span>
<span class="linenr">365: </span>            <span style="color: #709870;">{</span>
<span class="linenr">366: </span>                <span style="color: #0000ff;">PrintToConsole</span><span style="color: #907373;">()</span>;
<span class="linenr">367: </span>            <span style="color: #709870;">}</span>
<span class="linenr">368: </span>        <span style="color: #909183;">}</span>
<span class="linenr">369: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">370: </span>
<span class="linenr">371: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ConsoleColor</span> <span style="color: #a0522d;">color</span><span style="color: #7388d6;">)</span>
<span class="linenr">372: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">373: </span>        Console.ForegroundColor = color;
<span class="linenr">374: </span>        <span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>;
<span class="linenr">375: </span>        Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #909183;">()</span>;
<span class="linenr">376: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">377: </span>
<span class="linenr">378: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
<span class="linenr">379: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">380: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr">381: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{_month} &#26376;&#30340;&#29992;&#30005;&#37327;&#26159;: {_used} KWh"</span><span style="color: #909183;">)</span>;
<span class="linenr">382: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#19968;&#26723;&#30005;&#36153;: {Lv1Cost,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">383: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#20108;&#26723;&#30005;&#36153;: {Lv2Cost,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">384: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#19977;&#26723;&#30005;&#36153;: {Lv3Cost,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">385: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
<span class="linenr">386: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24635;&#35745;: {Bill,10:C} "</span><span style="color: #909183;">)</span>;
<span class="linenr">387: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">388: </span>
<span class="linenr">389: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr">390: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">391: </span>        <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">392: </span>        <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">393: </span>
<span class="linenr">394: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>sheet.LastRowNum == 0<span style="color: #909183;">)</span>
<span class="linenr">395: </span>        <span style="color: #909183;">{</span>
<span class="linenr">396: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">heads</span> = <span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> <span style="color: #8b2252;">"&#26376;&#20221;"</span>, <span style="color: #8b2252;">"&#24230;&#25968;"</span>, <span style="color: #8b2252;">"&#19968;&#26723;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#20108;&#25377;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#19977;&#26723;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#24635;&#36153;&#29992;"</span> <span style="color: #709870;">}</span>;
<span class="linenr">397: </span>            <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #709870;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #228b22;">heads</span><span style="color: #709870;">)</span>;
<span class="linenr">398: </span>        <span style="color: #909183;">}</span>
<span class="linenr">399: </span>
<span class="linenr">400: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">values</span> = <span style="color: #a020f0;">new</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> _month.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span>, _used.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span>, Lv1Cost.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span>, Lv2Cost.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span>, Lv3Cost.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span>, Bill.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span> <span style="color: #909183;">}</span>;
<span class="linenr">401: </span>        <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #909183;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #228b22;">values</span><span style="color: #909183;">)</span>;
<span class="linenr">402: </span>
<span class="linenr">403: </span>        <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">workbook</span>, <span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">404: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">405: </span>
<span class="linenr">406: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IWorkbook</span> <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr">407: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">408: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
<span class="linenr">409: </span>        <span style="color: #909183;">{</span>
<span class="linenr">410: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#25171;&#24320;..."</span><span style="color: #709870;">)</span>;
<span class="linenr">411: </span>            <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sr = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr">412: </span>            <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #709870;">(</span><span style="color: #228b22;">sr</span><span style="color: #709870;">)</span>;
<span class="linenr">413: </span>        <span style="color: #909183;">}</span>
<span class="linenr">414: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr">415: </span>        <span style="color: #909183;">{</span>
<span class="linenr">416: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#19981;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#21019;&#24314;&#26032;&#30340; WOrkbook &#23545;&#35937;"</span><span style="color: #709870;">)</span>;
<span class="linenr">417: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #709870;">()</span>;
<span class="linenr">418: </span>            workbook.<span style="color: #0000ff;">CreateSheet</span><span style="color: #709870;">()</span>;
<span class="linenr">419: </span>            <span style="color: #a020f0;">return</span> workbook;
<span class="linenr">420: </span>        <span style="color: #909183;">}</span>
<span class="linenr">421: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">422: </span>
<span class="linenr">423: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr">424: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">425: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#20445;&#23384;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">426: </span>        <span style="color: #a020f0;">try</span>
<span class="linenr">427: </span>        <span style="color: #909183;">{</span>
<span class="linenr">428: </span>            <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr">429: </span>            workbook.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #228b22;">sw</span><span style="color: #709870;">)</span>;
<span class="linenr">430: </span>        <span style="color: #909183;">}</span>
<span class="linenr">431: </span>        <span style="color: #a020f0;">catch</span>
<span class="linenr">432: </span>        <span style="color: #909183;">{</span>
<span class="linenr">433: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#20445;&#23384;&#20986;&#38169;"</span><span style="color: #709870;">)</span>;
<span class="linenr">434: </span>        <span style="color: #909183;">}</span>
<span class="linenr">435: </span>        <span style="color: #a020f0;">finally</span>
<span class="linenr">436: </span>        <span style="color: #909183;">{</span>
<span class="linenr">437: </span>            workbook.<span style="color: #0000ff;">Close</span><span style="color: #709870;">()</span>;
<span class="linenr">438: </span>        <span style="color: #909183;">}</span>
<span class="linenr">439: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">440: </span>
<span class="linenr">441: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rownum</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">data</span><span style="color: #7388d6;">)</span>
<span class="linenr">442: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">443: </span>        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#25554;&#20837;&#25968;&#25454;&#34892;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">444: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #909183;">(</span><span style="color: #228b22;">rownum</span><span style="color: #909183;">)</span>;
<span class="linenr">445: </span>
<span class="linenr">446: </span>        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; data.Length; i++<span style="color: #909183;">)</span>
<span class="linenr">447: </span>        <span style="color: #909183;">{</span>
<span class="linenr">448: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{i}  "</span><span style="color: #709870;">)</span>;
<span class="linenr">449: </span>            row.<span style="color: #0000ff;">CreateCell</span><span style="color: #709870;">(</span><span style="color: #228b22;">i</span><span style="color: #709870;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #709870;">(</span><span style="color: #228b22;">data</span><span style="color: #907373;">[</span>i<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
<span class="linenr">450: </span>        <span style="color: #909183;">}</span>
<span class="linenr">451: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr">452: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">453: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6eeed7a" class="outline-4">
<h4 id="org6eeed7a"><span class="section-number-4">6.3.2.</span> 首先将重复的方法 <b>分离</b> 到单独的类中</h4>
<div class="outline-text-4" id="text-6-3-2">
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">bool</span> <span style="color: #a0522d;">isShowMessage</span> = <span style="color: #008b8b;">true</span>;
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IWorkbook</span> <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 6: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 7: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 9: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>isShowMessage<span style="color: #709870;">)</span>
<span class="linenr">10: </span>            <span style="color: #709870;">{</span>
<span class="linenr">11: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#25171;&#24320;..."</span><span style="color: #907373;">)</span>;
<span class="linenr">12: </span>            <span style="color: #709870;">}</span>
<span class="linenr">13: </span>            <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sr = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr">14: </span>            <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #709870;">(</span><span style="color: #228b22;">sr</span><span style="color: #709870;">)</span>;
<span class="linenr">15: </span>        <span style="color: #909183;">}</span>
<span class="linenr">16: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr">17: </span>        <span style="color: #909183;">{</span>
<span class="linenr">18: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#19981;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#21019;&#24314;&#26032;&#30340; WOrkbook &#23545;&#35937;"</span><span style="color: #709870;">)</span>;
<span class="linenr">19: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #709870;">()</span>;
<span class="linenr">20: </span>            workbook.<span style="color: #0000ff;">CreateSheet</span><span style="color: #709870;">()</span>;
<span class="linenr">21: </span>            <span style="color: #a020f0;">return</span> workbook;
<span class="linenr">22: </span>        <span style="color: #909183;">}</span>
<span class="linenr">23: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">24: </span>
<span class="linenr">25: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr">26: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">27: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#20445;&#23384;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">28: </span>        <span style="color: #a020f0;">try</span>
<span class="linenr">29: </span>        <span style="color: #909183;">{</span>
<span class="linenr">30: </span>            <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr">31: </span>            workbook.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #228b22;">sw</span><span style="color: #709870;">)</span>;
<span class="linenr">32: </span>        <span style="color: #909183;">}</span>
<span class="linenr">33: </span>        <span style="color: #a020f0;">catch</span>
<span class="linenr">34: </span>        <span style="color: #909183;">{</span>
<span class="linenr">35: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#20445;&#23384;&#20986;&#38169;"</span><span style="color: #709870;">)</span>;
<span class="linenr">36: </span>        <span style="color: #909183;">}</span>
<span class="linenr">37: </span>        <span style="color: #a020f0;">finally</span>
<span class="linenr">38: </span>        <span style="color: #909183;">{</span>
<span class="linenr">39: </span>            workbook.<span style="color: #0000ff;">Close</span><span style="color: #709870;">()</span>;
<span class="linenr">40: </span>        <span style="color: #909183;">}</span>
<span class="linenr">41: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">42: </span>
<span class="linenr">43: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rownum</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">data</span><span style="color: #7388d6;">)</span>
<span class="linenr">44: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">45: </span>        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#25554;&#20837;&#25968;&#25454;&#34892;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">46: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #909183;">(</span><span style="color: #228b22;">rownum</span><span style="color: #909183;">)</span>;
<span class="linenr">47: </span>
<span class="linenr">48: </span>        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; data.Length; i++<span style="color: #909183;">)</span>
<span class="linenr">49: </span>        <span style="color: #909183;">{</span>
<span class="linenr">50: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{i}  "</span><span style="color: #709870;">)</span>;
<span class="linenr">51: </span>            row.<span style="color: #0000ff;">CreateCell</span><span style="color: #709870;">(</span><span style="color: #228b22;">i</span><span style="color: #709870;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #709870;">(</span><span style="color: #228b22;">data</span><span style="color: #907373;">[</span>i<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
<span class="linenr">52: </span>        <span style="color: #909183;">}</span>
<span class="linenr">53: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr">54: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">55: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf74fc9" class="outline-4">
<h4 id="orgbf74fc9"><span class="section-number-4">6.3.3.</span> 然后可以 <b>组合</b></h4>
<div class="outline-text-4" id="text-6-3-3">
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr">  1: </span><span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">X</span>
<span class="linenr">  2: </span><span style="color: #707183;">{</span>
<span class="linenr">  3: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr">  4: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">  5: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">bool</span> <span style="color: #a0522d;">isShowMessage</span> = <span style="color: #008b8b;">true</span>;
<span class="linenr">  6: </span>
<span class="linenr">  7: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IWorkbook</span> <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr">  8: </span>        <span style="color: #909183;">{</span>
<span class="linenr">  9: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #907373;">(</span><span style="color: #228b22;">fileName</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
<span class="linenr"> 10: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 11: </span>                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>isShowMessage<span style="color: #907373;">)</span>
<span class="linenr"> 12: </span>                <span style="color: #907373;">{</span>
<span class="linenr"> 13: </span>                    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#25171;&#24320;..."</span><span style="color: #6276ba;">)</span>;
<span class="linenr"> 14: </span>                <span style="color: #907373;">}</span>
<span class="linenr"> 15: </span>                <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sr = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #907373;">(</span><span style="color: #228b22;">fileName</span><span style="color: #907373;">)</span>;
<span class="linenr"> 16: </span>                <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #907373;">(</span><span style="color: #228b22;">sr</span><span style="color: #907373;">)</span>;
<span class="linenr"> 17: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 18: </span>            <span style="color: #a020f0;">else</span>
<span class="linenr"> 19: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 20: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#19981;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#21019;&#24314;&#26032;&#30340; WOrkbook &#23545;&#35937;"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 21: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #907373;">()</span>;
<span class="linenr"> 22: </span>                workbook.<span style="color: #0000ff;">CreateSheet</span><span style="color: #907373;">()</span>;
<span class="linenr"> 23: </span>                <span style="color: #a020f0;">return</span> workbook;
<span class="linenr"> 24: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 25: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 26: </span>
<span class="linenr"> 27: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr"> 28: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 29: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#20445;&#23384;..."</span><span style="color: #709870;">)</span>;
<span class="linenr"> 30: </span>            <span style="color: #a020f0;">try</span>
<span class="linenr"> 31: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 32: </span>                <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #907373;">(</span><span style="color: #228b22;">fileName</span><span style="color: #907373;">)</span>;
<span class="linenr"> 33: </span>                workbook.<span style="color: #0000ff;">Write</span><span style="color: #907373;">(</span><span style="color: #228b22;">sw</span><span style="color: #907373;">)</span>;
<span class="linenr"> 34: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 35: </span>            <span style="color: #a020f0;">catch</span>
<span class="linenr"> 36: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 37: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#20445;&#23384;&#20986;&#38169;"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 38: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 39: </span>            <span style="color: #a020f0;">finally</span>
<span class="linenr"> 40: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 41: </span>                workbook.<span style="color: #0000ff;">Close</span><span style="color: #907373;">()</span>;
<span class="linenr"> 42: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 43: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 44: </span>
<span class="linenr"> 45: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #909183;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rownum</span>, <span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">data</span><span style="color: #909183;">)</span>
<span class="linenr"> 46: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 47: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#25554;&#20837;&#25968;&#25454;&#34892;..."</span><span style="color: #709870;">)</span>;
<span class="linenr"> 48: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #709870;">(</span><span style="color: #228b22;">rownum</span><span style="color: #709870;">)</span>;
<span class="linenr"> 49: </span>
<span class="linenr"> 50: </span>            <span style="color: #a020f0;">for</span> <span style="color: #709870;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; data.Length; i++<span style="color: #709870;">)</span>
<span class="linenr"> 51: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 52: </span>                Console.<span style="color: #0000ff;">Write</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"{i}  "</span><span style="color: #907373;">)</span>;
<span class="linenr"> 53: </span>                row.<span style="color: #0000ff;">CreateCell</span><span style="color: #907373;">(</span><span style="color: #228b22;">i</span><span style="color: #907373;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #907373;">(</span><span style="color: #228b22;">data</span><span style="color: #6276ba;">[</span>i<span style="color: #6276ba;">]</span><span style="color: #907373;">)</span>;
<span class="linenr"> 54: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 55: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
<span class="linenr"> 56: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 57: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 58: </span>
<span class="linenr"> 59: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCalc</span>
<span class="linenr"> 60: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 61: </span>        <span style="color: #228b22;">ExcelHelper</span> <span style="color: #a0522d;">helper</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ExcelHelper</span><span style="color: #909183;">()</span>;
<span class="linenr"> 62: </span>
<span class="linenr"> 63: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr"> 64: </span>
<span class="linenr"> 65: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExcelExcel</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr"> 66: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 67: </span>            <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = helper.<span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr"> 68: </span>            <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
<span class="linenr"> 69: </span>
<span class="linenr"> 70: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22836;</span>
<span class="linenr"> 71: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>sheet.LastRowNum == 0<span style="color: #709870;">)</span>
<span class="linenr"> 72: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 73: </span>                helper.<span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #907373;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #a020f0;">new</span><span style="color: #6276ba;">[]</span> <span style="color: #6276ba;">{</span> <span style="color: #8b2252;">"&#36134;&#21333;&#24635;&#39069;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;&#25968;&#39069;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;&#31246;&#29575;"</span>, <span style="color: #8b2252;">"&#36134;&#21333;&#23454;&#20184;"</span> <span style="color: #6276ba;">}</span><span style="color: #907373;">)</span>;
<span class="linenr"> 74: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 75: </span>
<span class="linenr"> 76: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25968;&#25454;</span>
<span class="linenr"> 77: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">data</span> = <span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> Bill, Tip, RATE, Bill + Tip <span style="color: #709870;">}</span>;
<span class="linenr"> 78: </span>            helper.<span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #709870;">(</span><span style="color: #228b22;">sheet</span>, sheet.LastRowNum + 1, <span style="color: #907373;">(</span><span style="color: #a020f0;">from</span> i <span style="color: #a020f0;">in</span> data <span style="color: #a020f0;">select</span> i.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span><span style="color: #907373;">)</span>.<span style="color: #0000ff;">ToArray</span><span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
<span class="linenr"> 79: </span>
<span class="linenr"> 80: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20445;&#23384;</span>
<span class="linenr"> 81: </span>            helper.<span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #709870;">(</span><span style="color: #228b22;">workbook</span>, <span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr"> 82: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 83: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 84: </span>
<span class="linenr"> 85: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCalc</span>
<span class="linenr"> 86: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 87: </span>        <span style="color: #228b22;">ExcelHelper</span> <span style="color: #a0522d;">helper</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ExcelHelper</span><span style="color: #909183;">()</span>;
<span class="linenr"> 88: </span>
<span class="linenr"> 89: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr"> 90: </span>
<span class="linenr"> 91: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel2</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr"> 92: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 93: </span>            <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = helper.<span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr"> 94: </span>            <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
<span class="linenr"> 95: </span>
<span class="linenr"> 96: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>sheet.LastRowNum == 0<span style="color: #709870;">)</span>
<span class="linenr"> 97: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 98: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">head</span> = <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> <span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;"</span>, <span style="color: #8b2252;">"&#24212;&#20132;&#31246;"</span>, <span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;"</span> <span style="color: #907373;">}</span>;
<span class="linenr"> 99: </span>                helper.<span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #907373;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #228b22;">head</span><span style="color: #907373;">)</span>;
<span class="linenr">100: </span>            <span style="color: #709870;">}</span>
<span class="linenr">101: </span>
<span class="linenr">102: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">heads</span> = <span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> Money.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, Tax.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, <span style="color: #907373;">(</span>Money - Tax<span style="color: #907373;">)</span>.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span> <span style="color: #709870;">}</span>;
<span class="linenr">103: </span>            helper.<span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #709870;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #228b22;">heads</span><span style="color: #709870;">)</span>;
<span class="linenr">104: </span>
<span class="linenr">105: </span>            helper.<span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #709870;">(</span><span style="color: #228b22;">workbook</span>, <span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr">106: </span>        <span style="color: #909183;">}</span>
<span class="linenr">107: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">108: </span>
<span class="linenr">109: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ElectricBillCalc</span>
<span class="linenr">110: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">111: </span>        <span style="color: #228b22;">ExcelHelper</span> <span style="color: #a0522d;">helper</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ExcelHelper</span><span style="color: #909183;">()</span>;
<span class="linenr">112: </span>
<span class="linenr">113: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr">114: </span>
<span class="linenr">115: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr">116: </span>        <span style="color: #909183;">{</span>
<span class="linenr">117: </span>            <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = helper.<span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr">118: </span>            <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
<span class="linenr">119: </span>
<span class="linenr">120: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>sheet.LastRowNum == 0<span style="color: #709870;">)</span>
<span class="linenr">121: </span>            <span style="color: #709870;">{</span>
<span class="linenr">122: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">heads</span> = <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> <span style="color: #8b2252;">"&#26376;&#20221;"</span>, <span style="color: #8b2252;">"&#24230;&#25968;"</span>, <span style="color: #8b2252;">"&#19968;&#26723;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#20108;&#25377;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#19977;&#26723;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#24635;&#36153;&#29992;"</span> <span style="color: #907373;">}</span>;
<span class="linenr">123: </span>                helper.<span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #907373;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #228b22;">heads</span><span style="color: #907373;">)</span>;
<span class="linenr">124: </span>            <span style="color: #709870;">}</span>
<span class="linenr">125: </span>
<span class="linenr">126: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">values</span> = <span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> _month.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, _used.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, Lv1Cost.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, Lv2Cost.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, Lv3Cost.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, Bill.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span> <span style="color: #709870;">}</span>;
<span class="linenr">127: </span>            helper.<span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #709870;">(</span><span style="color: #228b22;">sheet</span>, sheet.LastRowNum + 1, <span style="color: #228b22;">values</span><span style="color: #709870;">)</span>;
<span class="linenr">128: </span>
<span class="linenr">129: </span>            helper.<span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #709870;">(</span><span style="color: #228b22;">workbook</span>, <span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr">130: </span>        <span style="color: #909183;">}</span>
<span class="linenr">131: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">132: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge161f16" class="outline-4">
<h4 id="orge161f16"><span class="section-number-4">6.3.4.</span> 或者可以 <b>继承</b></h4>
<div class="outline-text-4" id="text-6-3-4">
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr">  1: </span><span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">Y</span>
<span class="linenr">  2: </span><span style="color: #707183;">{</span>
<span class="linenr">  3: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr">  4: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">  5: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">bool</span> <span style="color: #a0522d;">isShowMessage</span> = <span style="color: #008b8b;">true</span>;
<span class="linenr">  6: </span>
<span class="linenr">  7: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IWorkbook</span> <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr">  8: </span>        <span style="color: #909183;">{</span>
<span class="linenr">  9: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #907373;">(</span><span style="color: #228b22;">fileName</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
<span class="linenr"> 10: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 11: </span>                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>isShowMessage<span style="color: #907373;">)</span>
<span class="linenr"> 12: </span>                <span style="color: #907373;">{</span>
<span class="linenr"> 13: </span>                    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#25171;&#24320;..."</span><span style="color: #6276ba;">)</span>;
<span class="linenr"> 14: </span>                <span style="color: #907373;">}</span>
<span class="linenr"> 15: </span>                <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sr = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #907373;">(</span><span style="color: #228b22;">fileName</span><span style="color: #907373;">)</span>;
<span class="linenr"> 16: </span>                <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #907373;">(</span><span style="color: #228b22;">sr</span><span style="color: #907373;">)</span>;
<span class="linenr"> 17: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 18: </span>            <span style="color: #a020f0;">else</span>
<span class="linenr"> 19: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 20: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#19981;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#21019;&#24314;&#26032;&#30340; WOrkbook &#23545;&#35937;"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 21: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #907373;">()</span>;
<span class="linenr"> 22: </span>                workbook.<span style="color: #0000ff;">CreateSheet</span><span style="color: #907373;">()</span>;
<span class="linenr"> 23: </span>                <span style="color: #a020f0;">return</span> workbook;
<span class="linenr"> 24: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 25: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 26: </span>
<span class="linenr"> 27: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr"> 28: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 29: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#20445;&#23384;..."</span><span style="color: #709870;">)</span>;
<span class="linenr"> 30: </span>            <span style="color: #a020f0;">try</span>
<span class="linenr"> 31: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 32: </span>                <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #907373;">(</span><span style="color: #228b22;">fileName</span><span style="color: #907373;">)</span>;
<span class="linenr"> 33: </span>                workbook.<span style="color: #0000ff;">Write</span><span style="color: #907373;">(</span><span style="color: #228b22;">sw</span><span style="color: #907373;">)</span>;
<span class="linenr"> 34: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 35: </span>            <span style="color: #a020f0;">catch</span>
<span class="linenr"> 36: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 37: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#20445;&#23384;&#20986;&#38169;"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 38: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 39: </span>            <span style="color: #a020f0;">finally</span>
<span class="linenr"> 40: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 41: </span>                workbook.<span style="color: #0000ff;">Close</span><span style="color: #907373;">()</span>;
<span class="linenr"> 42: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 43: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 44: </span>
<span class="linenr"> 45: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #909183;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rownum</span>, <span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">data</span><span style="color: #909183;">)</span>
<span class="linenr"> 46: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 47: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#25554;&#20837;&#25968;&#25454;&#34892;..."</span><span style="color: #709870;">)</span>;
<span class="linenr"> 48: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #709870;">(</span><span style="color: #228b22;">rownum</span><span style="color: #709870;">)</span>;
<span class="linenr"> 49: </span>
<span class="linenr"> 50: </span>            <span style="color: #a020f0;">for</span> <span style="color: #709870;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; data.Length; i++<span style="color: #709870;">)</span>
<span class="linenr"> 51: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 52: </span>                Console.<span style="color: #0000ff;">Write</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"{i}  "</span><span style="color: #907373;">)</span>;
<span class="linenr"> 53: </span>                row.<span style="color: #0000ff;">CreateCell</span><span style="color: #907373;">(</span><span style="color: #228b22;">i</span><span style="color: #907373;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #907373;">(</span><span style="color: #228b22;">data</span><span style="color: #6276ba;">[</span>i<span style="color: #6276ba;">]</span><span style="color: #907373;">)</span>;
<span class="linenr"> 54: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 55: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
<span class="linenr"> 56: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 57: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 58: </span>
<span class="linenr"> 59: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCalc</span> : <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr"> 60: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 61: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr"> 62: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExcelExcel</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr"> 63: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 64: </span>            <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #709870;">(</span>fileName<span style="color: #709870;">)</span>;
<span class="linenr"> 65: </span>            <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
<span class="linenr"> 66: </span>
<span class="linenr"> 67: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22836;</span>
<span class="linenr"> 68: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>sheet.LastRowNum == 0<span style="color: #709870;">)</span>
<span class="linenr"> 69: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 70: </span>                <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #907373;">(</span>sheet, 0, <span style="color: #a020f0;">new</span><span style="color: #6276ba;">[]</span> <span style="color: #6276ba;">{</span> <span style="color: #8b2252;">"&#36134;&#21333;&#24635;&#39069;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;&#25968;&#39069;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;&#31246;&#29575;"</span>, <span style="color: #8b2252;">"&#36134;&#21333;&#23454;&#20184;"</span> <span style="color: #6276ba;">}</span><span style="color: #907373;">)</span>;
<span class="linenr"> 71: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 72: </span>
<span class="linenr"> 73: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25968;&#25454;</span>
<span class="linenr"> 74: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">data</span> = <span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> Bill, Tip, RATE, Bill + Tip <span style="color: #709870;">}</span>;
<span class="linenr"> 75: </span>            <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #709870;">(</span>sheet, sheet.LastRowNum + 1, <span style="color: #907373;">(</span><span style="color: #a020f0;">from</span> i <span style="color: #a020f0;">in</span> data <span style="color: #a020f0;">select</span> i.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span><span style="color: #907373;">)</span>.<span style="color: #0000ff;">ToArray</span><span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
<span class="linenr"> 76: </span>
<span class="linenr"> 77: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20445;&#23384;</span>
<span class="linenr"> 78: </span>            <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #709870;">(</span>workbook, fileName<span style="color: #709870;">)</span>;
<span class="linenr"> 79: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 80: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 81: </span>
<span class="linenr"> 82: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCalc</span> : <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr"> 83: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 84: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr"> 85: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel2</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr"> 86: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 87: </span>            <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #709870;">(</span>fileName<span style="color: #709870;">)</span>;
<span class="linenr"> 88: </span>            <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
<span class="linenr"> 89: </span>
<span class="linenr"> 90: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>sheet.LastRowNum == 0<span style="color: #709870;">)</span>
<span class="linenr"> 91: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 92: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">head</span> = <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> <span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;"</span>, <span style="color: #8b2252;">"&#24212;&#20132;&#31246;"</span>, <span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;"</span> <span style="color: #907373;">}</span>;
<span class="linenr"> 93: </span>                <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #907373;">(</span>sheet, 0, head<span style="color: #907373;">)</span>;
<span class="linenr"> 94: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 95: </span>
<span class="linenr"> 96: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">heads</span> = <span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> Money.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, Tax.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, <span style="color: #907373;">(</span>Money - Tax<span style="color: #907373;">)</span>.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span> <span style="color: #709870;">}</span>;
<span class="linenr"> 97: </span>            <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #709870;">(</span>sheet, 0, heads<span style="color: #709870;">)</span>;
<span class="linenr"> 98: </span>
<span class="linenr"> 99: </span>            <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #709870;">(</span>workbook, fileName<span style="color: #709870;">)</span>;
<span class="linenr">100: </span>        <span style="color: #909183;">}</span>
<span class="linenr">101: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">102: </span>
<span class="linenr">103: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ElectricBillCalc</span> : <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr">104: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">105: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr">106: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr">107: </span>        <span style="color: #909183;">{</span>
<span class="linenr">108: </span>            <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #709870;">(</span>fileName<span style="color: #709870;">)</span>;
<span class="linenr">109: </span>            <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
<span class="linenr">110: </span>
<span class="linenr">111: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>sheet.LastRowNum == 0<span style="color: #709870;">)</span>
<span class="linenr">112: </span>            <span style="color: #709870;">{</span>
<span class="linenr">113: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">heads</span> = <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> <span style="color: #8b2252;">"&#26376;&#20221;"</span>, <span style="color: #8b2252;">"&#24230;&#25968;"</span>, <span style="color: #8b2252;">"&#19968;&#26723;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#20108;&#25377;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#19977;&#26723;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#24635;&#36153;&#29992;"</span> <span style="color: #907373;">}</span>;
<span class="linenr">114: </span>                <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #907373;">(</span>sheet, 0, heads<span style="color: #907373;">)</span>;
<span class="linenr">115: </span>            <span style="color: #709870;">}</span>
<span class="linenr">116: </span>
<span class="linenr">117: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">values</span> = <span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> _month.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, _used.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, Lv1Cost.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, Lv2Cost.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, Lv3Cost.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, Bill.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span> <span style="color: #709870;">}</span>;
<span class="linenr">118: </span>            <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #709870;">(</span>sheet, sheet.LastRowNum + 1, values<span style="color: #709870;">)</span>;
<span class="linenr">119: </span>
<span class="linenr">120: </span>            <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #709870;">(</span>workbook, fileName<span style="color: #709870;">)</span>;
<span class="linenr">121: </span>        <span style="color: #909183;">}</span>
<span class="linenr">122: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">123: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7239fd8" class="outline-3">
<h3 id="org7239fd8"><span class="section-number-3">6.4.</span> 更进一步的 DRY</h3>
<div class="outline-text-3" id="text-6-4">
<ul class="org-ul">
<li>上述代码中的 ExportToExcel 等方法，在整个结构上还是雷同的，还有进一步进行 <b>分离</b> 的空间</li>
<li>将重复的逻辑分离出去，基本的步骤是 (1) 抽出为某个类的某个方法 (2) 通过组合或继承的方式进行使用</li>
</ul>
</div>

<div id="outline-container-org44a4258" class="outline-4">
<h4 id="org44a4258"><span class="section-number-4">6.4.1.</span> 使用 <b>组合</b> 方式实现</h4>
<div class="outline-text-4" id="text-6-4-1">
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr">  1: </span><span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">X</span>
<span class="linenr">  2: </span><span style="color: #707183;">{</span>
<span class="linenr">  3: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr">  4: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">  5: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">bool</span> <span style="color: #a0522d;">isShowMessage</span> = <span style="color: #008b8b;">true</span>;
<span class="linenr">  6: </span>
<span class="linenr">  7: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IWorkbook</span> <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr">  8: </span>        <span style="color: #909183;">{</span>
<span class="linenr">  9: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #907373;">(</span><span style="color: #228b22;">fileName</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
<span class="linenr"> 10: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 11: </span>                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>isShowMessage<span style="color: #907373;">)</span>
<span class="linenr"> 12: </span>                <span style="color: #907373;">{</span>
<span class="linenr"> 13: </span>                    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#25171;&#24320;..."</span><span style="color: #6276ba;">)</span>;
<span class="linenr"> 14: </span>                <span style="color: #907373;">}</span>
<span class="linenr"> 15: </span>                <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sr = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #907373;">(</span><span style="color: #228b22;">fileName</span><span style="color: #907373;">)</span>;
<span class="linenr"> 16: </span>                <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #907373;">(</span><span style="color: #228b22;">sr</span><span style="color: #907373;">)</span>;
<span class="linenr"> 17: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 18: </span>            <span style="color: #a020f0;">else</span>
<span class="linenr"> 19: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 20: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#19981;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#21019;&#24314;&#26032;&#30340; WOrkbook &#23545;&#35937;"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 21: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #907373;">()</span>;
<span class="linenr"> 22: </span>                workbook.<span style="color: #0000ff;">CreateSheet</span><span style="color: #907373;">()</span>;
<span class="linenr"> 23: </span>                <span style="color: #a020f0;">return</span> workbook;
<span class="linenr"> 24: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 25: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 26: </span>
<span class="linenr"> 27: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr"> 28: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 29: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#20445;&#23384;..."</span><span style="color: #709870;">)</span>;
<span class="linenr"> 30: </span>            <span style="color: #a020f0;">try</span>
<span class="linenr"> 31: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 32: </span>                <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #907373;">(</span><span style="color: #228b22;">fileName</span><span style="color: #907373;">)</span>;
<span class="linenr"> 33: </span>                workbook.<span style="color: #0000ff;">Write</span><span style="color: #907373;">(</span><span style="color: #228b22;">sw</span><span style="color: #907373;">)</span>;
<span class="linenr"> 34: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 35: </span>            <span style="color: #a020f0;">catch</span>
<span class="linenr"> 36: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 37: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#20445;&#23384;&#20986;&#38169;"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 38: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 39: </span>            <span style="color: #a020f0;">finally</span>
<span class="linenr"> 40: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 41: </span>                workbook.<span style="color: #0000ff;">Close</span><span style="color: #907373;">()</span>;
<span class="linenr"> 42: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 43: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 44: </span>
<span class="linenr"> 45: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #909183;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rownum</span>, <span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">data</span><span style="color: #909183;">)</span>
<span class="linenr"> 46: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 47: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#25554;&#20837;&#25968;&#25454;&#34892;..."</span><span style="color: #709870;">)</span>;
<span class="linenr"> 48: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #709870;">(</span><span style="color: #228b22;">rownum</span><span style="color: #709870;">)</span>;
<span class="linenr"> 49: </span>
<span class="linenr"> 50: </span>            <span style="color: #a020f0;">for</span> <span style="color: #709870;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; data.Length; i++<span style="color: #709870;">)</span>
<span class="linenr"> 51: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 52: </span>                Console.<span style="color: #0000ff;">Write</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"{i}  "</span><span style="color: #907373;">)</span>;
<span class="linenr"> 53: </span>                row.<span style="color: #0000ff;">CreateCell</span><span style="color: #907373;">(</span><span style="color: #228b22;">i</span><span style="color: #907373;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #907373;">(</span><span style="color: #228b22;">data</span><span style="color: #6276ba;">[</span>i<span style="color: #6276ba;">]</span><span style="color: #907373;">)</span>;
<span class="linenr"> 54: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 55: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
<span class="linenr"> 56: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 57: </span>
<span class="linenr"> 58: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span>, <span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">heads</span>, <span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">values</span><span style="color: #909183;">)</span>
<span class="linenr"> 59: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 60: </span>            <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr"> 61: </span>            <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
<span class="linenr"> 62: </span>
<span class="linenr"> 63: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22836;</span>
<span class="linenr"> 64: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>sheet.LastRowNum == 0<span style="color: #709870;">)</span>
<span class="linenr"> 65: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 66: </span>                <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #907373;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #228b22;">heads</span><span style="color: #907373;">)</span>;
<span class="linenr"> 67: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 68: </span>
<span class="linenr"> 69: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25968;&#25454;</span>
<span class="linenr"> 70: </span>            <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #709870;">(</span><span style="color: #228b22;">sheet</span>, sheet.LastRowNum + 1, <span style="color: #228b22;">values</span><span style="color: #709870;">)</span>;
<span class="linenr"> 71: </span>
<span class="linenr"> 72: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20445;&#23384;</span>
<span class="linenr"> 73: </span>            <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #709870;">(</span><span style="color: #228b22;">workbook</span>, <span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr"> 74: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 75: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 76: </span>
<span class="linenr"> 77: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCalc</span>
<span class="linenr"> 78: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 79: </span>        <span style="color: #228b22;">ExcelHelper</span> <span style="color: #a0522d;">helper</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ExcelHelper</span><span style="color: #909183;">()</span>;
<span class="linenr"> 80: </span>
<span class="linenr"> 81: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr"> 82: </span>
<span class="linenr"> 83: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExcelExcel</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr"> 84: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 85: </span>            helper.<span style="color: #0000ff;">ExportToExcel</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span>,
<span class="linenr"> 86: </span>                <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span><span style="color: #8b2252;">"&#36134;&#21333;&#24635;&#39069;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;&#25968;&#39069;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;&#31246;&#29575;"</span>, <span style="color: #8b2252;">"&#36134;&#21333;&#23454;&#20184;"</span><span style="color: #907373;">}</span>,
<span class="linenr"> 87: </span>                <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span>Bill.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, Tip.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, RATE.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, <span style="color: #6276ba;">(</span>Bill + Tip<span style="color: #6276ba;">)</span>.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span><span style="color: #907373;">}</span>
<span class="linenr"> 88: </span>            <span style="color: #709870;">)</span>;
<span class="linenr"> 89: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 90: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 91: </span>
<span class="linenr"> 92: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCalc</span>
<span class="linenr"> 93: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 94: </span>        <span style="color: #228b22;">ExcelHelper</span> <span style="color: #a0522d;">helper</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ExcelHelper</span><span style="color: #909183;">()</span>;
<span class="linenr"> 95: </span>
<span class="linenr"> 96: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr"> 97: </span>
<span class="linenr"> 98: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel2</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr"> 99: </span>        <span style="color: #909183;">{</span>
<span class="linenr">100: </span>            helper.<span style="color: #0000ff;">ExportToExcel</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span>,
<span class="linenr">101: </span>                <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> <span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;"</span>, <span style="color: #8b2252;">"&#24212;&#20132;&#31246;"</span>, <span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;"</span> <span style="color: #907373;">}</span>,
<span class="linenr">102: </span>                <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> Money.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, Tax.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, <span style="color: #6276ba;">(</span>Money - Tax<span style="color: #6276ba;">)</span>.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span> <span style="color: #907373;">}</span>
<span class="linenr">103: </span>            <span style="color: #709870;">)</span>;
<span class="linenr">104: </span>        <span style="color: #909183;">}</span>
<span class="linenr">105: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">106: </span>
<span class="linenr">107: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ElectricBillCalc</span>
<span class="linenr">108: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">109: </span>        <span style="color: #228b22;">ExcelHelper</span> <span style="color: #a0522d;">helper</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ExcelHelper</span><span style="color: #909183;">()</span>;
<span class="linenr">110: </span>
<span class="linenr">111: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr">112: </span>
<span class="linenr">113: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr">114: </span>        <span style="color: #909183;">{</span>
<span class="linenr">115: </span>            helper.<span style="color: #0000ff;">ExportToExcel</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span>,
<span class="linenr">116: </span>                <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> <span style="color: #8b2252;">"&#26376;&#20221;"</span>, <span style="color: #8b2252;">"&#24230;&#25968;"</span>, <span style="color: #8b2252;">"&#19968;&#26723;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#20108;&#25377;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#19977;&#26723;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#24635;&#36153;&#29992;"</span> <span style="color: #907373;">}</span>,
<span class="linenr">117: </span>                <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> _month.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, _used.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, Lv1Cost.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, Lv2Cost.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, Lv3Cost.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, Bill.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span> <span style="color: #907373;">}</span>
<span class="linenr">118: </span>            <span style="color: #709870;">)</span>;
<span class="linenr">119: </span>        <span style="color: #909183;">}</span>
<span class="linenr">120: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">121: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org122cb2b" class="outline-4">
<h4 id="org122cb2b"><span class="section-number-4">6.4.2.</span> 使用 <b>继承</b> 方式实现 (你的是我的)</h4>
<div class="outline-text-4" id="text-6-4-2">
<p>
这是最简单，最基本的方式。跟组合的方式很像。
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCalc</span> : <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExcelExcel</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 4: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 5: </span>        <span style="color: #0000ff;">ExportToExcelCommon</span><span style="color: #909183;">(</span>fileName,
<span class="linenr"> 6: </span>            <span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span><span style="color: #8b2252;">"&#36134;&#21333;&#24635;&#39069;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;&#25968;&#39069;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;&#31246;&#29575;"</span>, <span style="color: #8b2252;">"&#36134;&#21333;&#23454;&#20184;"</span><span style="color: #709870;">}</span>,
<span class="linenr"> 7: </span>            <span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span>Bill.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, Tip.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, RATE.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, <span style="color: #907373;">(</span>Bill + Tip<span style="color: #907373;">)</span>.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span><span style="color: #709870;">}</span>
<span class="linenr"> 8: </span>        <span style="color: #909183;">)</span>;
<span class="linenr"> 9: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">10: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ffa4fb" class="outline-4">
<h4 id="org1ffa4fb"><span class="section-number-4">6.4.3.</span> 使用 <b>继承</b> 方式实现 (公共的字段)</h4>
<div class="outline-text-4" id="text-6-4-3">
<p>
充分利用继承的特性，将不同的部分抽出为字段:
</p>
<ul class="org-ul">
<li>优点是: 简单直接</li>
<li>缺点是: 非常不灵活，不实用。易出错</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">heads</span>;
<span class="linenr"> 6: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">values</span>;
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 9: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">10: </span>        <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">11: </span>        <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">12: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>sheet.LastRowNum == 0<span style="color: #909183;">)</span>
<span class="linenr">13: </span>        <span style="color: #909183;">{</span>
<span class="linenr">14: </span>            <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #709870;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #228b22;">heads</span><span style="color: #709870;">)</span>;
<span class="linenr">15: </span>        <span style="color: #909183;">}</span>
<span class="linenr">16: </span>        <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #909183;">(</span><span style="color: #228b22;">sheet</span>, sheet.LastRowNum + 1, <span style="color: #228b22;">values</span><span style="color: #909183;">)</span>;
<span class="linenr">17: </span>        <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">workbook</span>, <span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">18: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">19: </span><span style="color: #707183;">}</span>
<span class="linenr">20: </span>
<span class="linenr">21: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCalc</span> : <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr">22: </span><span style="color: #707183;">{</span>
<span class="linenr">23: </span>    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">TipCalc</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">bill</span><span style="color: #7388d6;">)</span>
<span class="linenr">24: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">25: </span>        Bill = bill;
<span class="linenr">26: </span>        heads = <span style="color: #a020f0;">new</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> <span style="color: #8b2252;">"&#24037;&#36164;"</span> <span style="color: #909183;">}</span>;
<span class="linenr">27: </span>        values = <span style="color: #a020f0;">new</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> Tip.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span> <span style="color: #909183;">}</span>;
<span class="linenr">28: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">29: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr">30: </span><span style="color: #707183;">}</span>
</pre>
</div>


<p>
图解:
</p>


<figure id="org614f8c5">
<img src="img/inherit-1.png" alt="inherit-1.png" width="400px">

</figure>
</div>
</div>

<div id="outline-container-orged5f856" class="outline-4">
<h4 id="orged5f856"><span class="section-number-4">6.4.4.</span> 使用 <b>继承</b> 方式实现 (化虚为实)</h4>
<div class="outline-text-4" id="text-6-4-4">
<p>
使用虚方法 (virtual/override)，让父类能访问派生类的方法。
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #0000ff;">GetHeads</span><span style="color: #7388d6;">()</span>
<span class="linenr"> 6: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 7: </span>        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">null</span>;
<span class="linenr"> 8: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 9: </span>
<span class="linenr">10: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #0000ff;">GetValues</span><span style="color: #7388d6;">()</span>
<span class="linenr">11: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">12: </span>        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">null</span>;
<span class="linenr">13: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr">16: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">17: </span>        <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">18: </span>        <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">19: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>sheet.LastRowNum == 0<span style="color: #909183;">)</span>
<span class="linenr">20: </span>        <span style="color: #909183;">{</span>
<span class="linenr">21: </span>            <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #709870;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #0000ff;">GetHeads</span><span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
<span class="linenr">22: </span>        <span style="color: #909183;">}</span>
<span class="linenr">23: </span>        <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #909183;">(</span><span style="color: #228b22;">sheet</span>, sheet.LastRowNum + 1, <span style="color: #0000ff;">GetValues</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
<span class="linenr">24: </span>        <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">workbook</span>, <span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">25: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">26: </span><span style="color: #707183;">}</span>
<span class="linenr">27: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCalc</span> : <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr">28: </span><span style="color: #707183;">{</span>
<span class="linenr">29: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr">30: </span>
<span class="linenr">31: </span>    <span style="color: #a020f0;">override</span> <span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #0000ff;">GetHeads</span><span style="color: #7388d6;">()</span> =&gt; <span style="color: #a020f0;">new</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> <span style="color: #8b2252;">"&#36134;&#21333;"</span>, <span style="color: #8b2252;">"&#36153;&#29575;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;"</span>, <span style="color: #8b2252;">"&#24212;&#20184;"</span> <span style="color: #7388d6;">}</span>;
<span class="linenr">32: </span>    <span style="color: #a020f0;">override</span> <span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #0000ff;">GetValues</span><span style="color: #7388d6;">()</span> =&gt; <span style="color: #a020f0;">new</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> Bill.<span style="color: #0000ff;">ToString</span><span style="color: #909183;">()</span>, RATE.<span style="color: #0000ff;">ToString</span><span style="color: #909183;">()</span>, Tip.<span style="color: #0000ff;">ToString</span><span style="color: #909183;">()</span>, <span style="color: #909183;">(</span>Bill + Tip<span style="color: #909183;">)</span>.<span style="color: #0000ff;">ToString</span><span style="color: #909183;">()</span> <span style="color: #7388d6;">}</span>;
<span class="linenr">33: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org866fe03" class="outline-4">
<h4 id="org866fe03"><span class="section-number-4">6.4.5.</span> 使用 <b>继承</b> 方式实现 (进击的继承)</h4>
<div class="outline-text-4" id="text-6-4-5">
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">bool</span> <span style="color: #a0522d;">isShowMessage</span> = <span style="color: #008b8b;">true</span>;
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IWorkbook</span> <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 6: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 7: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 9: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>isShowMessage<span style="color: #709870;">)</span>
<span class="linenr">10: </span>            <span style="color: #709870;">{</span>
<span class="linenr">11: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#25171;&#24320;..."</span><span style="color: #907373;">)</span>;
<span class="linenr">12: </span>            <span style="color: #709870;">}</span>
<span class="linenr">13: </span>            <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sr = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr">14: </span>            <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #709870;">(</span><span style="color: #228b22;">sr</span><span style="color: #709870;">)</span>;
<span class="linenr">15: </span>        <span style="color: #909183;">}</span>
<span class="linenr">16: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr">17: </span>        <span style="color: #909183;">{</span>
<span class="linenr">18: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#19981;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#21019;&#24314;&#26032;&#30340; WOrkbook &#23545;&#35937;"</span><span style="color: #709870;">)</span>;
<span class="linenr">19: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #709870;">()</span>;
<span class="linenr">20: </span>            workbook.<span style="color: #0000ff;">CreateSheet</span><span style="color: #709870;">()</span>;
<span class="linenr">21: </span>            <span style="color: #a020f0;">return</span> workbook;
<span class="linenr">22: </span>        <span style="color: #909183;">}</span>
<span class="linenr">23: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">24: </span>
<span class="linenr">25: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr">26: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">27: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#20445;&#23384;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">28: </span>        <span style="color: #a020f0;">try</span>
<span class="linenr">29: </span>        <span style="color: #909183;">{</span>
<span class="linenr">30: </span>            <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr">31: </span>            workbook.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #228b22;">sw</span><span style="color: #709870;">)</span>;
<span class="linenr">32: </span>        <span style="color: #909183;">}</span>
<span class="linenr">33: </span>        <span style="color: #a020f0;">catch</span>
<span class="linenr">34: </span>        <span style="color: #909183;">{</span>
<span class="linenr">35: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#20445;&#23384;&#20986;&#38169;"</span><span style="color: #709870;">)</span>;
<span class="linenr">36: </span>        <span style="color: #909183;">}</span>
<span class="linenr">37: </span>        <span style="color: #a020f0;">finally</span>
<span class="linenr">38: </span>        <span style="color: #909183;">{</span>
<span class="linenr">39: </span>            workbook.<span style="color: #0000ff;">Close</span><span style="color: #709870;">()</span>;
<span class="linenr">40: </span>        <span style="color: #909183;">}</span>
<span class="linenr">41: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">42: </span>
<span class="linenr">43: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IRow</span> <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rownum</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">data</span><span style="color: #7388d6;">)</span>
<span class="linenr">44: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">45: </span>        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#25554;&#20837;&#25968;&#25454;&#34892;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">46: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #909183;">(</span><span style="color: #228b22;">rownum</span><span style="color: #909183;">)</span>;
<span class="linenr">47: </span>
<span class="linenr">48: </span>        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; data.Length; i++<span style="color: #909183;">)</span>
<span class="linenr">49: </span>        <span style="color: #909183;">{</span>
<span class="linenr">50: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{i}  "</span><span style="color: #709870;">)</span>;
<span class="linenr">51: </span>            row.<span style="color: #0000ff;">CreateCell</span><span style="color: #709870;">(</span><span style="color: #228b22;">i</span><span style="color: #709870;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #709870;">(</span><span style="color: #228b22;">data</span><span style="color: #907373;">[</span>i<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
<span class="linenr">52: </span>        <span style="color: #909183;">}</span>
<span class="linenr">53: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr">54: </span>
<span class="linenr">55: </span>        <span style="color: #a020f0;">return</span> row;
<span class="linenr">56: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">57: </span>
<span class="linenr">58: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SetStyleForRow</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">IRow</span> <span style="color: #a0522d;">row</span>, <span style="color: #228b22;">ICellStyle</span> <span style="color: #a0522d;">style</span><span style="color: #7388d6;">)</span>
<span class="linenr">59: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">60: </span>        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; row.LastCellNum; i++<span style="color: #909183;">)</span>
<span class="linenr">61: </span>        <span style="color: #909183;">{</span>
<span class="linenr">62: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">cell</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #709870;">(</span><span style="color: #228b22;">i</span><span style="color: #709870;">)</span>;
<span class="linenr">63: </span>            cell.CellStyle = style;
<span class="linenr">64: </span>        <span style="color: #909183;">}</span>
<span class="linenr">65: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">66: </span>
<span class="linenr">67: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">public virtual string[] GetValues() { return null; }</span>
<span class="linenr">68: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #0000ff;">GetHeads</span><span style="color: #7388d6;">()</span> =&gt; <span style="color: #008b8b;">null</span>;
<span class="linenr">69: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #0000ff;">GetValues</span><span style="color: #7388d6;">()</span> =&gt; <span style="color: #008b8b;">null</span>;
<span class="linenr">70: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">IRow</span> <span style="color: #0000ff;">ExportToHead</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span><span style="color: #7388d6;">)</span> =&gt; <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">sheet</span>, 0, <span style="color: #0000ff;">GetHeads</span><span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;
<span class="linenr">71: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">IRow</span> <span style="color: #0000ff;">ExportToBody</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span><span style="color: #7388d6;">)</span> =&gt; <span style="color: #0000ff;">CreateRowForSheet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">sheet</span>, sheet.LastRowNum + 1, <span style="color: #0000ff;">GetValues</span><span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;
<span class="linenr">72: </span>
<span class="linenr">73: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr">74: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">75: </span>        <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #0000ff;">OpenOrCreateWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">76: </span>        <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">77: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>sheet.LastRowNum == 0<span style="color: #909183;">)</span>
<span class="linenr">78: </span>        <span style="color: #909183;">{</span>
<span class="linenr">79: </span>            <span style="color: #0000ff;">ExportToHead</span><span style="color: #709870;">(</span><span style="color: #228b22;">sheet</span><span style="color: #709870;">)</span>;
<span class="linenr">80: </span>        <span style="color: #909183;">}</span>
<span class="linenr">81: </span>        <span style="color: #0000ff;">ExportToBody</span><span style="color: #909183;">(</span><span style="color: #228b22;">sheet</span><span style="color: #909183;">)</span>;
<span class="linenr">82: </span>        <span style="color: #0000ff;">SaveAndCloseWorkbook</span><span style="color: #909183;">(</span><span style="color: #228b22;">workbook</span>, <span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">83: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">84: </span><span style="color: #707183;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr">67: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCalc</span> : <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr">68: </span><span style="color: #707183;">{</span>
<span class="linenr">69: </span>  <span style="color: #b22222;">// </span><span style="color: #b22222;">...</span>
<span class="linenr">70: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #0000ff;">GetHeads</span><span style="color: #7388d6;">()</span> =&gt; <span style="color: #a020f0;">new</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> <span style="color: #8b2252;">"&#36134;&#21333;"</span>, <span style="color: #8b2252;">"&#36153;&#29575;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;"</span>, <span style="color: #8b2252;">"&#24212;&#20184;"</span> <span style="color: #7388d6;">}</span>;
<span class="linenr">71: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #0000ff;">GetValues</span><span style="color: #7388d6;">()</span> =&gt; <span style="color: #a020f0;">new</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> Bill.<span style="color: #0000ff;">ToString</span><span style="color: #909183;">()</span>, RATE.<span style="color: #0000ff;">ToString</span><span style="color: #909183;">()</span>, Tip.<span style="color: #0000ff;">ToString</span><span style="color: #909183;">()</span>, <span style="color: #909183;">(</span>Bill + Tip<span style="color: #909183;">)</span>.<span style="color: #0000ff;">ToString</span><span style="color: #909183;">()</span> <span style="color: #7388d6;">}</span>;
<span class="linenr">72: </span>
<span class="linenr">73: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">IRow</span> <span style="color: #0000ff;">ExportToHead</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span><span style="color: #7388d6;">)</span>
<span class="linenr">74: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">75: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = <span style="color: #a020f0;">base</span>.<span style="color: #0000ff;">ExportToHead</span><span style="color: #909183;">(</span>sheet<span style="color: #909183;">)</span>;
<span class="linenr">76: </span>        <span style="color: #b22222;">//</span><span style="color: #b22222;">var row = CreateRowForSheet(sheet, 0, GetHeads());</span>
<span class="linenr">77: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">style</span> = sheet.Workbook.<span style="color: #0000ff;">CreateCellStyle</span><span style="color: #909183;">()</span>;
<span class="linenr">78: </span>        style.FillForegroundColor = NPOI.HSSF.Util.HSSFColor.Green.Index;
<span class="linenr">79: </span>        style.FillPattern = FillPattern.Diamonds;
<span class="linenr">80: </span>        <span style="color: #0000ff;">SetStyleForRow</span><span style="color: #909183;">(</span>row, style<span style="color: #909183;">)</span>;
<span class="linenr">81: </span>        <span style="color: #a020f0;">return</span> row;
<span class="linenr">82: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">83: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8aa064b" class="outline-3">
<h3 id="org8aa064b"><span class="section-number-3">6.5.</span> 珠联璧合: 组合 + 继承</h3>
<div class="outline-text-3" id="text-6-5">

<figure id="orgca22d96">
<img src="img/calcs-1.png" alt="calcs-1.png" width="400">

</figure>
</div>


<div id="outline-container-orgbd9e150" class="outline-4">
<h4 id="orgbd9e150"><span class="section-number-4">6.5.1.</span> ConsoleHelper</h4>
<div class="outline-text-4" id="text-6-5-1">
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">Nfit161</span>
<span class="linenr"> 4: </span><span style="color: #707183;">{</span>
<span class="linenr"> 5: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ConsoleHelper</span>
<span class="linenr"> 6: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 7: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">QuitWithReason</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">reason</span><span style="color: #909183;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 9: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #228b22;">reason</span><span style="color: #709870;">)</span>;
<span class="linenr">10: </span>            Environment.<span style="color: #0000ff;">Exit</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
<span class="linenr">11: </span>        <span style="color: #909183;">}</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">text</span>, <span style="color: #228b22;">ConsoleColor</span> <span style="color: #a0522d;">color</span><span style="color: #909183;">)</span>
<span class="linenr">14: </span>        <span style="color: #909183;">{</span>
<span class="linenr">15: </span>            Console.ForegroundColor = color;
<span class="linenr">16: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #228b22;">text</span><span style="color: #709870;">)</span>;
<span class="linenr">17: </span>            Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #709870;">()</span>;
<span class="linenr">18: </span>        <span style="color: #909183;">}</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">text</span>, <span style="color: #228b22;">ConsoleColor</span> <span style="color: #a0522d;">color</span><span style="color: #909183;">)</span>
<span class="linenr">21: </span>        <span style="color: #909183;">{</span>
<span class="linenr">22: </span>            <span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #228b22;">text</span>, <span style="color: #228b22;">color</span><span style="color: #709870;">)</span>;
<span class="linenr">23: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
<span class="linenr">24: </span>        <span style="color: #909183;">}</span>
<span class="linenr">25: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">26: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org62851f1" class="outline-4">
<h4 id="org62851f1"><span class="section-number-4">6.5.2.</span> ExcelHelper</h4>
<div class="outline-text-4" id="text-6-5-2">
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;
<span class="linenr"> 2: </span><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>.<span style="color: #a0522d;">IO</span>;
<span class="linenr"> 3: </span><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">NPOI</span>.<span style="color: #a0522d;">HSSF</span>.<span style="color: #a0522d;">UserModel</span>;
<span class="linenr"> 4: </span><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">NPOI</span>.<span style="color: #a0522d;">SS</span>.<span style="color: #a0522d;">UserModel</span>;
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">Nfit161</span>
<span class="linenr"> 7: </span><span style="color: #707183;">{</span>
<span class="linenr"> 8: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ExcelHelper</span>
<span class="linenr"> 9: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">10: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">bool</span> <span style="color: #a0522d;">IsShowMessage</span> = <span style="color: #008b8b;">true</span>;
<span class="linenr">11: </span>
<span class="linenr">12: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IWorkbook</span> <span style="color: #0000ff;">OpenOrCreate</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr">13: </span>        <span style="color: #909183;">{</span>
<span class="linenr">14: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #907373;">(</span><span style="color: #228b22;">fileName</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
<span class="linenr">15: </span>            <span style="color: #709870;">{</span>
<span class="linenr">16: </span>                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>IsShowMessage<span style="color: #907373;">)</span>
<span class="linenr">17: </span>                <span style="color: #907373;">{</span>
<span class="linenr">18: </span>                    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#25171;&#24320;..."</span><span style="color: #6276ba;">)</span>;
<span class="linenr">19: </span>                <span style="color: #907373;">}</span>
<span class="linenr">20: </span>                <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sr = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #907373;">(</span><span style="color: #228b22;">fileName</span><span style="color: #907373;">)</span>;
<span class="linenr">21: </span>                <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #907373;">(</span><span style="color: #228b22;">sr</span><span style="color: #907373;">)</span>;
<span class="linenr">22: </span>            <span style="color: #709870;">}</span>
<span class="linenr">23: </span>            <span style="color: #a020f0;">else</span>
<span class="linenr">24: </span>            <span style="color: #709870;">{</span>
<span class="linenr">25: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#19981;&#23384;&#22312;&#65292;&#29616;&#22312;&#24320;&#22987;&#21019;&#24314;&#26032;&#30340; Workbook &#23545;&#35937;"</span><span style="color: #907373;">)</span>;
<span class="linenr">26: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">workbook</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #907373;">()</span>;
<span class="linenr">27: </span>                workbook.<span style="color: #0000ff;">CreateSheet</span><span style="color: #907373;">()</span>;
<span class="linenr">28: </span>                <span style="color: #a020f0;">return</span> workbook;
<span class="linenr">29: </span>            <span style="color: #709870;">}</span>
<span class="linenr">30: </span>        <span style="color: #909183;">}</span>
<span class="linenr">31: </span>
<span class="linenr">32: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SaveAndClose</span><span style="color: #909183;">(</span><span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr">33: </span>        <span style="color: #909183;">{</span>
<span class="linenr">34: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#20445;&#23384;..."</span><span style="color: #709870;">)</span>;
<span class="linenr">35: </span>            <span style="color: #a020f0;">try</span>
<span class="linenr">36: </span>            <span style="color: #709870;">{</span>
<span class="linenr">37: </span>                <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #907373;">(</span><span style="color: #228b22;">fileName</span><span style="color: #907373;">)</span>;
<span class="linenr">38: </span>                workbook.<span style="color: #0000ff;">Write</span><span style="color: #907373;">(</span><span style="color: #228b22;">sw</span><span style="color: #907373;">)</span>;
<span class="linenr">39: </span>            <span style="color: #709870;">}</span>
<span class="linenr">40: </span>            <span style="color: #a020f0;">catch</span>
<span class="linenr">41: </span>            <span style="color: #709870;">{</span>
<span class="linenr">42: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#20445;&#23384;&#20986;&#38169;"</span><span style="color: #907373;">)</span>;
<span class="linenr">43: </span>            <span style="color: #709870;">}</span>
<span class="linenr">44: </span>            <span style="color: #a020f0;">finally</span>
<span class="linenr">45: </span>            <span style="color: #709870;">{</span>
<span class="linenr">46: </span>                workbook.<span style="color: #0000ff;">Close</span><span style="color: #907373;">()</span>;
<span class="linenr">47: </span>            <span style="color: #709870;">}</span>
<span class="linenr">48: </span>        <span style="color: #909183;">}</span>
<span class="linenr">49: </span>
<span class="linenr">50: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">InsertRow</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">data</span>, <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span>, <span style="color: #228b22;">int</span>? <span style="color: #a0522d;">rownum</span> = <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span>
<span class="linenr">51: </span>        <span style="color: #909183;">{</span>
<span class="linenr">52: </span>            Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#25554;&#20837;&#25968;&#25454;&#34892;..."</span><span style="color: #709870;">)</span>;
<span class="linenr">53: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #709870;">(</span><span style="color: #228b22;">rownum</span> ?? sheet.<span style="color: #a0522d;">LastRowNum</span> + 1<span style="color: #709870;">)</span>;
<span class="linenr">54: </span>
<span class="linenr">55: </span>            <span style="color: #a020f0;">for</span> <span style="color: #709870;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">i</span> = 0; i &lt; data.Length; i++<span style="color: #709870;">)</span>
<span class="linenr">56: </span>            <span style="color: #709870;">{</span>
<span class="linenr">57: </span>                Console.<span style="color: #0000ff;">Write</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"{i}  "</span><span style="color: #907373;">)</span>;
<span class="linenr">58: </span>                row.<span style="color: #0000ff;">CreateCell</span><span style="color: #907373;">(</span><span style="color: #228b22;">i</span><span style="color: #907373;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #907373;">(</span><span style="color: #228b22;">data</span><span style="color: #6276ba;">[</span>i<span style="color: #6276ba;">]</span><span style="color: #907373;">)</span>;
<span class="linenr">59: </span>            <span style="color: #709870;">}</span>
<span class="linenr">60: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
<span class="linenr">61: </span>        <span style="color: #909183;">}</span>
<span class="linenr">62: </span>
<span class="linenr">63: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SetStyleForRow</span><span style="color: #909183;">(</span><span style="color: #228b22;">IRow</span> <span style="color: #a0522d;">row</span>, <span style="color: #228b22;">ICellStyle</span> <span style="color: #a0522d;">style</span><span style="color: #909183;">)</span>
<span class="linenr">64: </span>        <span style="color: #909183;">{</span>
<span class="linenr">65: </span>            <span style="color: #a020f0;">for</span> <span style="color: #709870;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">i</span> = 0; i &lt; row.LastCellNum; i++<span style="color: #709870;">)</span>
<span class="linenr">66: </span>            <span style="color: #709870;">{</span>
<span class="linenr">67: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">cell</span> = row.<span style="color: #0000ff;">GetCell</span><span style="color: #907373;">(</span><span style="color: #228b22;">i</span><span style="color: #907373;">)</span>;
<span class="linenr">68: </span>                cell.CellStyle = style;
<span class="linenr">69: </span>            <span style="color: #709870;">}</span>
<span class="linenr">70: </span>        <span style="color: #909183;">}</span>
<span class="linenr">71: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">72: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd6644f0" class="outline-4">
<h4 id="orgd6644f0"><span class="section-number-4">6.5.3.</span> Calculator</h4>
<div class="outline-text-4" id="text-6-5-3">
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr">  1: </span><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;
<span class="linenr">  2: </span><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>.<span style="color: #a0522d;">Threading</span>;
<span class="linenr">  3: </span><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">NPOI</span>.<span style="color: #a0522d;">SS</span>.<span style="color: #a0522d;">UserModel</span>;
<span class="linenr">  4: </span>
<span class="linenr">  5: </span><span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">Nfit161</span>
<span class="linenr">  6: </span><span style="color: #707183;">{</span>
<span class="linenr">  7: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Calculator</span>
<span class="linenr">  8: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">  9: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">ExcelHelper</span> <span style="color: #a0522d;">ExcelHelper</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ExcelHelper</span><span style="color: #909183;">()</span>;
<span class="linenr"> 10: </span>
<span class="linenr"> 11: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToBody</span><span style="color: #909183;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span><span style="color: #909183;">)</span>
<span class="linenr"> 12: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 13: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 14: </span>
<span class="linenr"> 15: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr"> 16: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 17: </span>            <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = ExcelHelper.<span style="color: #0000ff;">OpenOrCreate</span><span style="color: #709870;">(</span><span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr"> 18: </span>            <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
<span class="linenr"> 19: </span>
<span class="linenr"> 20: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25554;&#20837;</span>
<span class="linenr"> 21: </span>            <span style="color: #0000ff;">ExportToBody</span><span style="color: #709870;">(</span><span style="color: #228b22;">sheet</span><span style="color: #709870;">)</span>;
<span class="linenr"> 22: </span>
<span class="linenr"> 23: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20445;&#23384;</span>
<span class="linenr"> 24: </span>            ExcelHelper.<span style="color: #0000ff;">SaveAndClose</span><span style="color: #709870;">(</span><span style="color: #228b22;">workbook</span>, <span style="color: #228b22;">fileName</span><span style="color: #709870;">)</span>;
<span class="linenr"> 25: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 26: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 27: </span>
<span class="linenr"> 28: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCalc</span> : <span style="color: #228b22;">Calculator</span>
<span class="linenr"> 29: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 30: </span>        <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">TipCalc</span><span style="color: #909183;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">bill</span><span style="color: #909183;">)</span> =&gt; Bill = bill;
<span class="linenr"> 31: </span>
<span class="linenr"> 32: </span>        <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">RATE</span> = 0.18;
<span class="linenr"> 33: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Bill</span> <span style="color: #909183;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #909183;">}</span>
<span class="linenr"> 34: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Tip</span> =&gt; Bill * RATE;
<span class="linenr"> 35: </span>
<span class="linenr"> 36: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Print</span><span style="color: #909183;">()</span>
<span class="linenr"> 37: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 38: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
<span class="linenr"> 39: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#36134;&#21333;&#24635;&#39069;: {Bill,10:C}"</span><span style="color: #709870;">)</span>;
<span class="linenr"> 40: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#23567;&#36153;&#25968;&#39069;: {Tip,10:C} ({RATE:P1})"</span><span style="color: #709870;">)</span>;
<span class="linenr"> 41: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #907373;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
<span class="linenr"> 42: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#36134;&#21333;&#23454;&#20184;: {Bill + Tip,10:C}"</span><span style="color: #709870;">)</span>;
<span class="linenr"> 43: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 44: </span>
<span class="linenr"> 45: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintFantasy</span><span style="color: #909183;">()</span>
<span class="linenr"> 46: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 47: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
<span class="linenr"> 48: </span>            <span style="color: #a020f0;">while</span> <span style="color: #709870;">(</span><span style="color: #008b8b;">true</span><span style="color: #709870;">)</span>
<span class="linenr"> 49: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 50: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">key</span> = Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #907373;">(</span><span style="color: #008b8b;">true</span><span style="color: #907373;">)</span>;
<span class="linenr"> 51: </span>                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>key.Key == ConsoleKey.D1<span style="color: #907373;">)</span>
<span class="linenr"> 52: </span>                <span style="color: #907373;">{</span>
<span class="linenr"> 53: </span>                    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"&#24744;&#36755;&#20837;&#20102;&#19968;&#20010; 1"</span><span style="color: #6276ba;">)</span>;
<span class="linenr"> 54: </span>                <span style="color: #907373;">}</span>
<span class="linenr"> 55: </span>                <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>key.Key == ConsoleKey.S<span style="color: #907373;">)</span>
<span class="linenr"> 56: </span>                <span style="color: #907373;">{</span>
<span class="linenr"> 57: </span>                    Console.<span style="color: #0000ff;">Beep</span><span style="color: #6276ba;">()</span>;
<span class="linenr"> 58: </span>                <span style="color: #907373;">}</span>
<span class="linenr"> 59: </span>                <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>key.KeyChar == <span style="color: #8b2252;">'d'</span><span style="color: #907373;">)</span>
<span class="linenr"> 60: </span>                <span style="color: #907373;">{</span>
<span class="linenr"> 61: </span>                    Console.<span style="color: #0000ff;">Beep</span><span style="color: #6276ba;">(</span>600, 200<span style="color: #6276ba;">)</span>;
<span class="linenr"> 62: </span>                <span style="color: #907373;">}</span>
<span class="linenr"> 63: </span>                <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>key.KeyChar == <span style="color: #8b2252;">'f'</span><span style="color: #907373;">)</span>
<span class="linenr"> 64: </span>                <span style="color: #907373;">{</span>
<span class="linenr"> 65: </span>                    Console.<span style="color: #0000ff;">Beep</span><span style="color: #6276ba;">(</span>200, 200<span style="color: #6276ba;">)</span>;
<span class="linenr"> 66: </span>                <span style="color: #907373;">}</span>
<span class="linenr"> 67: </span>                <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>key.Key == ConsoleKey.Enter<span style="color: #907373;">)</span>
<span class="linenr"> 68: </span>                <span style="color: #907373;">{</span>
<span class="linenr"> 69: </span>                    <span style="color: #a020f0;">break</span>;
<span class="linenr"> 70: </span>                <span style="color: #907373;">}</span>
<span class="linenr"> 71: </span>                <span style="color: #a020f0;">else</span>
<span class="linenr"> 72: </span>                <span style="color: #907373;">{</span>
<span class="linenr"> 73: </span>                    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #6276ba;">(</span>$<span style="color: #8b2252;">"{key}, keyChar: {key.KeyChar}, key: {key.Key}"</span><span style="color: #6276ba;">)</span>;
<span class="linenr"> 74: </span>                <span style="color: #907373;">}</span>
<span class="linenr"> 75: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 76: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 77: </span>
<span class="linenr"> 78: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToBody</span><span style="color: #909183;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span><span style="color: #909183;">)</span>
<span class="linenr"> 79: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 80: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>sheet.LastRowNum == 0<span style="color: #709870;">)</span>
<span class="linenr"> 81: </span>                ExcelHelper.<span style="color: #0000ff;">InsertRow</span><span style="color: #709870;">(</span><span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> <span style="color: #8b2252;">"&#36134;&#21333;"</span>, <span style="color: #8b2252;">"&#36153;&#29575;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;"</span>, <span style="color: #8b2252;">"&#24212;&#20184;"</span> <span style="color: #907373;">}</span>, sheet, 0<span style="color: #709870;">)</span>;
<span class="linenr"> 82: </span>
<span class="linenr"> 83: </span>            ExcelHelper.<span style="color: #0000ff;">InsertRow</span><span style="color: #709870;">(</span><span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> Bill.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, RATE.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, Tip.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, <span style="color: #6276ba;">(</span>Bill + Tip<span style="color: #6276ba;">)</span>.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span> <span style="color: #907373;">}</span>, sheet<span style="color: #709870;">)</span>;
<span class="linenr"> 84: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 85: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 86: </span>
<span class="linenr"> 87: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCalc</span> : <span style="color: #228b22;">Calculator</span>
<span class="linenr"> 88: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 89: </span>        <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">TaxCalc</span><span style="color: #909183;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">m</span><span style="color: #909183;">)</span> =&gt; Money = m;
<span class="linenr"> 90: </span>
<span class="linenr"> 91: </span>        <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">_money</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#29992;&#26469;&#25215;&#36733;&#21518;&#38754;&#30340;&#25968;&#25454;&#65292;&#31246;&#21069;&#25910;&#20837;</span>
<span class="linenr"> 92: </span>        <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">Rates</span> = <span style="color: #909183;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #909183;">}</span>;
<span class="linenr"> 93: </span>
<span class="linenr"> 94: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Money</span>
<span class="linenr"> 95: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 96: </span>            <span style="color: #a020f0;">get</span> =&gt; _money;
<span class="linenr"> 97: </span>            <span style="color: #a020f0;">set</span>
<span class="linenr"> 98: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 99: </span>                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span><span style="color: #008b8b;">value</span> &lt; 0<span style="color: #907373;">)</span>
<span class="linenr">100: </span>                    ConsoleHelper.<span style="color: #0000ff;">QuitWithReason</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#21442;&#25968;&#36755;&#20837;&#26684;&#24335;&#19981;&#27491;&#30830;&#65281;"</span><span style="color: #907373;">)</span>;
<span class="linenr">101: </span>                _money = <span style="color: #008b8b;">value</span>;
<span class="linenr">102: </span>                <span style="color: #0000ff;">CalculateTax</span><span style="color: #907373;">()</span>;
<span class="linenr">103: </span>            <span style="color: #709870;">}</span>
<span class="linenr">104: </span>        <span style="color: #909183;">}</span>
<span class="linenr">105: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Rate</span> <span style="color: #909183;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #909183;">}</span>
<span class="linenr">106: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Tax</span> <span style="color: #909183;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #909183;">}</span>
<span class="linenr">107: </span>
<span class="linenr">108: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CalculateTax</span><span style="color: #909183;">()</span>
<span class="linenr">109: </span>        <span style="color: #909183;">{</span>
<span class="linenr">110: </span>            <span style="color: #a020f0;">switch</span> <span style="color: #709870;">(</span>Money<span style="color: #709870;">)</span>
<span class="linenr">111: </span>            <span style="color: #709870;">{</span>
<span class="linenr">112: </span>                <span style="color: #a020f0;">case</span> &lt;= 5000:
<span class="linenr">113: </span>                    Rate = 0;
<span class="linenr">114: </span>                    Tax = 0;
<span class="linenr">115: </span>                    <span style="color: #a020f0;">break</span>;
<span class="linenr">116: </span>                <span style="color: #a020f0;">case</span> &lt; 10000:
<span class="linenr">117: </span>                    Rate = Rates<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
<span class="linenr">118: </span>                    Tax = <span style="color: #907373;">(</span>Money - 5000<span style="color: #907373;">)</span> * Rate;
<span class="linenr">119: </span>                    <span style="color: #a020f0;">break</span>;
<span class="linenr">120: </span>                <span style="color: #a020f0;">case</span> &lt; 20000:
<span class="linenr">121: </span>                    Rate = Rates<span style="color: #907373;">[</span>1<span style="color: #907373;">]</span>;
<span class="linenr">122: </span>                    Tax = <span style="color: #907373;">(</span>Money - 10000<span style="color: #907373;">)</span> * Rate + 5000 * Rates<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
<span class="linenr">123: </span>                    <span style="color: #a020f0;">break</span>;
<span class="linenr">124: </span>                <span style="color: #a020f0;">case</span> &lt; 100000:
<span class="linenr">125: </span>                    Rate = Rates<span style="color: #907373;">[</span>2<span style="color: #907373;">]</span>;
<span class="linenr">126: </span>                    Tax = <span style="color: #907373;">(</span>Money - 20000<span style="color: #907373;">)</span> * Rate + 10000 * Rates<span style="color: #907373;">[</span>1<span style="color: #907373;">]</span> + 5000 * Rates<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
<span class="linenr">127: </span>                    <span style="color: #a020f0;">break</span>;
<span class="linenr">128: </span>                <span style="color: #a020f0;">default</span>:
<span class="linenr">129: </span>                    Rate = Rates<span style="color: #907373;">[</span>3<span style="color: #907373;">]</span>;
<span class="linenr">130: </span>                    Tax = <span style="color: #907373;">(</span>Money - 100000<span style="color: #907373;">)</span> * Rate + 80000 * Rates<span style="color: #907373;">[</span>2<span style="color: #907373;">]</span> + 10000 * Rates<span style="color: #907373;">[</span>1<span style="color: #907373;">]</span> + 5000 * Rates<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
<span class="linenr">131: </span>                    <span style="color: #a020f0;">break</span>;
<span class="linenr">132: </span>            <span style="color: #709870;">}</span>
<span class="linenr">133: </span>        <span style="color: #909183;">}</span>
<span class="linenr">134: </span>
<span class="linenr">135: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>
<span class="linenr">136: </span>        <span style="color: #909183;">{</span>
<span class="linenr">137: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
<span class="linenr">138: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #709870;">)</span>;
<span class="linenr">139: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #709870;">)</span>;
<span class="linenr">140: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #907373;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
<span class="linenr">141: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #709870;">)</span>;
<span class="linenr">142: </span>        <span style="color: #909183;">}</span>
<span class="linenr">143: </span>
<span class="linenr">144: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToBody</span><span style="color: #909183;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span><span style="color: #909183;">)</span>
<span class="linenr">145: </span>        <span style="color: #909183;">{</span>
<span class="linenr">146: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>sheet.LastRowNum == 0<span style="color: #709870;">)</span>
<span class="linenr">147: </span>                ExcelHelper.<span style="color: #0000ff;">InsertRow</span><span style="color: #709870;">(</span><span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> <span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;"</span>, <span style="color: #8b2252;">"&#31246;&#29575;"</span>, <span style="color: #8b2252;">"&#31246;&#39069;"</span>, <span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;"</span> <span style="color: #907373;">}</span>, sheet, 0<span style="color: #709870;">)</span>;
<span class="linenr">148: </span>
<span class="linenr">149: </span>            ExcelHelper.<span style="color: #0000ff;">InsertRow</span><span style="color: #709870;">(</span><span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> Money.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, Rate.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, Tax.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, <span style="color: #6276ba;">(</span>Money + Tax<span style="color: #6276ba;">)</span>.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span> <span style="color: #907373;">}</span>, sheet<span style="color: #709870;">)</span>;
<span class="linenr">150: </span>        <span style="color: #909183;">}</span>
<span class="linenr">151: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">152: </span>
<span class="linenr">153: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ElectricBillCalc</span> : <span style="color: #228b22;">Calculator</span>
<span class="linenr">154: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">155: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22522;&#20934;&#25968;&#25454;</span>
<span class="linenr">156: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">SummerLevels</span> = <span style="color: #909183;">{</span> 260, 600 <span style="color: #909183;">}</span>;
<span class="linenr">157: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">WinterLevels</span> = <span style="color: #909183;">{</span> 200, 400 <span style="color: #909183;">}</span>;
<span class="linenr">158: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">Rates</span> = <span style="color: #909183;">{</span> 0.600, 0.650, 0.900 <span style="color: #909183;">}</span>;
<span class="linenr">159: </span>
<span class="linenr">160: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#30693;&#36947;&#30340;&#25968;&#25454;</span>
<span class="linenr">161: </span>        <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">_month</span>;
<span class="linenr">162: </span>        <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">_used</span>;
<span class="linenr">163: </span>
<span class="linenr">164: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#35745;&#31639;&#20986;&#26469;&#30340;&#25968;&#25454;</span>
<span class="linenr">165: </span>        <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">_lvUsed</span>;
<span class="linenr">166: </span>
<span class="linenr">167: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Lv1Cost</span> =&gt; _lvUsed<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span> * Rates<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span>;
<span class="linenr">168: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Lv2Cost</span> =&gt; _lvUsed<span style="color: #909183;">[</span>1<span style="color: #909183;">]</span> * Rates<span style="color: #909183;">[</span>1<span style="color: #909183;">]</span>;
<span class="linenr">169: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Lv3Cost</span> =&gt; _lvUsed<span style="color: #909183;">[</span>2<span style="color: #909183;">]</span> * Rates<span style="color: #909183;">[</span>2<span style="color: #909183;">]</span>;
<span class="linenr">170: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Bill</span> =&gt; Lv1Cost + Lv2Cost + Lv3Cost;
<span class="linenr">171: </span>
<span class="linenr">172: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SetMonthAndUsed</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">month</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">used</span><span style="color: #909183;">)</span>
<span class="linenr">173: </span>        <span style="color: #909183;">{</span>
<span class="linenr">174: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>month &lt; 1 || month &gt; 12 || used &lt; 0<span style="color: #709870;">)</span>
<span class="linenr">175: </span>                ConsoleHelper.<span style="color: #0000ff;">QuitWithReason</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#21442;&#25968;&#36755;&#20837;&#38169;&#35823;"</span><span style="color: #709870;">)</span>;
<span class="linenr">176: </span>            <span style="color: #709870;">(</span>_month, _used<span style="color: #709870;">)</span> = <span style="color: #709870;">(</span>month, used<span style="color: #709870;">)</span>;
<span class="linenr">177: </span>            <span style="color: #0000ff;">CalculateLvUsed</span><span style="color: #709870;">()</span>;
<span class="linenr">178: </span>        <span style="color: #909183;">}</span>
<span class="linenr">179: </span>
<span class="linenr">180: </span>        <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CalculateLvUsed</span><span style="color: #909183;">()</span>
<span class="linenr">181: </span>        <span style="color: #909183;">{</span>
<span class="linenr">182: </span>            <span style="color: #709870;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">p1</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">p2</span><span style="color: #709870;">)</span> = <span style="color: #0000ff;">IsSummer</span><span style="color: #709870;">()</span> ? <span style="color: #709870;">(</span><span style="color: #228b22;">SummerLevels</span><span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>, <span style="color: #228b22;">SummerLevels</span><span style="color: #907373;">[</span>1<span style="color: #907373;">]</span><span style="color: #709870;">)</span> : <span style="color: #709870;">(</span><span style="color: #228b22;">WinterLevels</span><span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>, <span style="color: #228b22;">WinterLevels</span><span style="color: #907373;">[</span>1<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
<span class="linenr">183: </span>
<span class="linenr">184: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>_used &lt;= p1<span style="color: #709870;">)</span>
<span class="linenr">185: </span>            <span style="color: #709870;">{</span>
<span class="linenr">186: </span>                _lvUsed = <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> _used, 0, 0 <span style="color: #907373;">}</span>;
<span class="linenr">187: </span>            <span style="color: #709870;">}</span>
<span class="linenr">188: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>_used &lt;= p2<span style="color: #709870;">)</span>
<span class="linenr">189: </span>            <span style="color: #709870;">{</span>
<span class="linenr">190: </span>                _lvUsed = <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> p1, _used - p1, 0 <span style="color: #907373;">}</span>;
<span class="linenr">191: </span>            <span style="color: #709870;">}</span>
<span class="linenr">192: </span>            <span style="color: #a020f0;">else</span>
<span class="linenr">193: </span>            <span style="color: #709870;">{</span>
<span class="linenr">194: </span>                _lvUsed = <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> p1, p2 - p1, _used - p2 <span style="color: #907373;">}</span>;
<span class="linenr">195: </span>            <span style="color: #709870;">}</span>
<span class="linenr">196: </span>        <span style="color: #909183;">}</span>
<span class="linenr">197: </span>
<span class="linenr">198: </span>        <span style="color: #228b22;">bool</span> <span style="color: #0000ff;">IsSummer</span><span style="color: #909183;">()</span> =&gt; _month &gt;= 5 &amp;&amp; _month &lt;= 10;
<span class="linenr">199: </span>
<span class="linenr">200: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintFantasy</span><span style="color: #909183;">()</span>
<span class="linenr">201: </span>        <span style="color: #909183;">{</span>
<span class="linenr">202: </span>            <span style="color: #0000ff;">PrintToConsole</span><span style="color: #709870;">()</span>;
<span class="linenr">203: </span>            <span style="color: #a020f0;">while</span> <span style="color: #709870;">(</span><span style="color: #008b8b;">true</span><span style="color: #709870;">)</span>
<span class="linenr">204: </span>            <span style="color: #709870;">{</span>
<span class="linenr">205: </span>                <span style="color: #228b22;">var</span> <span style="color: #a0522d;">key</span> = Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #907373;">()</span>;
<span class="linenr">206: </span>                Console.<span style="color: #0000ff;">Clear</span><span style="color: #907373;">()</span>;
<span class="linenr">207: </span>
<span class="linenr">208: </span>                <span style="color: #a020f0;">switch</span> <span style="color: #907373;">(</span>key.Key<span style="color: #907373;">)</span>
<span class="linenr">209: </span>                <span style="color: #907373;">{</span>
<span class="linenr">210: </span>                    <span style="color: #a020f0;">case</span> ConsoleKey.D1:
<span class="linenr">211: </span>                        <span style="color: #0000ff;">PrintToConsole</span><span style="color: #6276ba;">(</span>ConsoleColor.Red<span style="color: #6276ba;">)</span>;
<span class="linenr">212: </span>                        <span style="color: #a020f0;">break</span>;
<span class="linenr">213: </span>                    <span style="color: #a020f0;">case</span> ConsoleKey.D2:
<span class="linenr">214: </span>                        <span style="color: #0000ff;">PrintToConsole</span><span style="color: #6276ba;">(</span>ConsoleColor.Green<span style="color: #6276ba;">)</span>;
<span class="linenr">215: </span>                        <span style="color: #a020f0;">break</span>;
<span class="linenr">216: </span>                    <span style="color: #a020f0;">case</span> ConsoleKey.D3:
<span class="linenr">217: </span>                        <span style="color: #0000ff;">PrintToConsole</span><span style="color: #6276ba;">(</span>ConsoleColor.Yellow<span style="color: #6276ba;">)</span>;
<span class="linenr">218: </span>                        <span style="color: #a020f0;">break</span>;
<span class="linenr">219: </span>                    <span style="color: #a020f0;">case</span> ConsoleKey.Enter:
<span class="linenr">220: </span>                        <span style="color: #6276ba;">{</span>
<span class="linenr">221: </span>                            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">i</span> = 0;
<span class="linenr">222: </span>                            <span style="color: #a020f0;">while</span> <span style="color: #858580;">(</span><span style="color: #008b8b;">true</span><span style="color: #858580;">)</span>
<span class="linenr">223: </span>                            <span style="color: #858580;">{</span>
<span class="linenr">224: </span>                                <span style="color: #228b22;">ConsoleColor</span><span style="color: #80a880;">[]</span> <span style="color: #a0522d;">colors</span> = <span style="color: #a020f0;">new</span><span style="color: #80a880;">[]</span> <span style="color: #80a880;">{</span> ConsoleColor.Red, ConsoleColor.Green, ConsoleColor.Blue <span style="color: #80a880;">}</span>;
<span class="linenr">225: </span>                                i = <span style="color: #80a880;">(</span>i + 1<span style="color: #80a880;">)</span> % colors.Length;
<span class="linenr">226: </span>                                <span style="color: #a020f0;">if</span> <span style="color: #80a880;">(</span>i == 1<span style="color: #80a880;">)</span>
<span class="linenr">227: </span>                                    Console.<span style="color: #0000ff;">Beep</span><span style="color: #80a880;">(</span>90, 50<span style="color: #80a880;">)</span>;
<span class="linenr">228: </span>                                <span style="color: #a020f0;">else</span>
<span class="linenr">229: </span>                                    Console.<span style="color: #0000ff;">Beep</span><span style="color: #80a880;">(</span>40, 50<span style="color: #80a880;">)</span>;
<span class="linenr">230: </span>                                Console.<span style="color: #0000ff;">Clear</span><span style="color: #80a880;">()</span>;
<span class="linenr">231: </span>                                <span style="color: #0000ff;">PrintToConsole</span><span style="color: #80a880;">(</span>colors<span style="color: #887070;">[</span>i<span style="color: #887070;">]</span><span style="color: #80a880;">)</span>;
<span class="linenr">232: </span>                                Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #80a880;">(</span>300<span style="color: #80a880;">)</span>;
<span class="linenr">233: </span>                            <span style="color: #858580;">}</span>
<span class="linenr">234: </span>                        <span style="color: #6276ba;">}</span>
<span class="linenr">235: </span>                    <span style="color: #a020f0;">default</span>:
<span class="linenr">236: </span>                        <span style="color: #0000ff;">PrintToConsole</span><span style="color: #6276ba;">()</span>;
<span class="linenr">237: </span>                        <span style="color: #a020f0;">break</span>;
<span class="linenr">238: </span>                <span style="color: #907373;">}</span>
<span class="linenr">239: </span>            <span style="color: #709870;">}</span>
<span class="linenr">240: </span>        <span style="color: #909183;">}</span>
<span class="linenr">241: </span>
<span class="linenr">242: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">(</span><span style="color: #228b22;">ConsoleColor</span> <span style="color: #a0522d;">color</span><span style="color: #909183;">)</span>
<span class="linenr">243: </span>        <span style="color: #909183;">{</span>
<span class="linenr">244: </span>            Console.ForegroundColor = color;
<span class="linenr">245: </span>            <span style="color: #0000ff;">PrintToConsole</span><span style="color: #709870;">()</span>;
<span class="linenr">246: </span>            Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #709870;">()</span>;
<span class="linenr">247: </span>        <span style="color: #909183;">}</span>
<span class="linenr">248: </span>
<span class="linenr">249: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>
<span class="linenr">250: </span>        <span style="color: #909183;">{</span>
<span class="linenr">251: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
<span class="linenr">252: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{_month} &#26376;&#30340;&#29992;&#30005;&#37327;&#26159;: {_used} KWh"</span><span style="color: #709870;">)</span>;
<span class="linenr">253: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#31532;&#19968;&#26723;&#30005;&#36153;: {Lv1Cost,10:C}"</span><span style="color: #709870;">)</span>;
<span class="linenr">254: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#31532;&#20108;&#26723;&#30005;&#36153;: {Lv2Cost,10:C}"</span><span style="color: #709870;">)</span>;
<span class="linenr">255: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#31532;&#19977;&#26723;&#30005;&#36153;: {Lv3Cost,10:C}"</span><span style="color: #709870;">)</span>;
<span class="linenr">256: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #907373;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
<span class="linenr">257: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#24635;&#35745;: {Bill,10:C} "</span><span style="color: #709870;">)</span>;
<span class="linenr">258: </span>        <span style="color: #909183;">}</span>
<span class="linenr">259: </span>
<span class="linenr">260: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToBody</span><span style="color: #909183;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span><span style="color: #909183;">)</span>
<span class="linenr">261: </span>        <span style="color: #909183;">{</span>
<span class="linenr">262: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>sheet.LastRowNum == 0<span style="color: #709870;">)</span>
<span class="linenr">263: </span>                ExcelHelper.<span style="color: #0000ff;">InsertRow</span><span style="color: #709870;">(</span><span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> <span style="color: #8b2252;">"&#26376;"</span>, <span style="color: #8b2252;">"&#37327;"</span>, <span style="color: #8b2252;">"&#36153;&#29992;"</span> <span style="color: #907373;">}</span>, sheet, 0<span style="color: #709870;">)</span>;
<span class="linenr">264: </span>
<span class="linenr">265: </span>            ExcelHelper.<span style="color: #0000ff;">InsertRow</span><span style="color: #709870;">(</span><span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> _month.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, _used.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, Bill.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span> <span style="color: #907373;">}</span>, sheet<span style="color: #709870;">)</span>;
<span class="linenr">266: </span>        <span style="color: #909183;">}</span>
<span class="linenr">267: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">268: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1c6e753" class="outline-4">
<h4 id="org1c6e753"><span class="section-number-4">6.5.4.</span> Main</h4>
<div class="outline-text-4" id="text-6-5-4">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">Nfit161</span>;

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">double bill;</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">if (args.Length != 1 || !double.TryParse(args[0], out bill))</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">{</span>
        <span style="color: #b22222;">//    </span><span style="color: #b22222;">Console.WriteLine("&#24744;&#30340;&#36755;&#20837;&#26377;&#35823;&#65292;&#27491;&#30830;&#30340;&#35843;&#29992;&#26041;&#27861;&#26159;:\nTaxCalculator &#31246;&#21069;&#25910;&#20837;");</span>
        <span style="color: #b22222;">//    </span><span style="color: #b22222;">return;</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">}</span>

        <span style="color: #b22222;">//</span><span style="color: #b22222;">var ec = new Y.TipCalc(2000);</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">ec.ExportToExcel(@"e:\33333333333.xls");</span>

        <span style="color: #b22222;">//</span><span style="color: #b22222;">var ed = new Y.ElectricBillCalc();</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">ed.SetMonthAndUsed(3, 24000);</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">ed.ExportToExcel(@"e:\44444444444.xls");</span>

        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #909183;">)</span>;
        ConsoleHelper.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"cccccccccccccccooolor"</span>, ConsoleColor.<span style="color: #228b22;">DarkMagenta</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"world"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb1329e9" class="outline-3">
<h3 id="orgb1329e9"><span class="section-number-3">6.6.</span> 不仅有权利还有义务，强制的规则: 抽象方法</h3>
<div class="outline-text-3" id="text-6-6">
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">abstract</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Calculator</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">ExcelHelper</span> <span style="color: #a0522d;">ExcelHelper</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ExcelHelper</span><span style="color: #7388d6;">()</span>;
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToBody</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{}</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 8: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 9: </span>        <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = ExcelHelper.<span style="color: #0000ff;">OpenOrCreate</span><span style="color: #909183;">(</span><span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">10: </span>        <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">11: </span>        <span style="color: #0000ff;">ExportToBody</span><span style="color: #909183;">(</span><span style="color: #228b22;">sheet</span><span style="color: #909183;">)</span>;
<span class="linenr">12: </span>        ExcelHelper.<span style="color: #0000ff;">SaveAndClose</span><span style="color: #909183;">(</span><span style="color: #228b22;">workbook</span>, <span style="color: #228b22;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr">13: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">14: </span>
<span class="linenr">15: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23376;&#31867;&#24517;&#39035;&#35201;&#23454;&#29616;&#36825;&#20123;&#26041;&#27861;!</span>
<span class="linenr">16: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">abstract</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>;
<span class="linenr">17: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">abstract</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Help</span><span style="color: #7388d6;">()</span>;
<span class="linenr">18: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5de54a0" class="outline-3">
<h3 id="org5de54a0"><span class="section-number-3">6.7.</span> 有了接口，就有了 <del>工业</del> 标准，就有了分工和协作</h3>
<div class="outline-text-3" id="text-6-7">
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr">  1: </span><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;
<span class="linenr">  2: </span><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>.<span style="color: #a0522d;">Threading</span>;
<span class="linenr">  3: </span><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">NPOI</span>.<span style="color: #a0522d;">SS</span>.<span style="color: #a0522d;">UserModel</span>;
<span class="linenr">  4: </span>
<span class="linenr">  5: </span><span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">Nfit161</span>
<span class="linenr">  6: </span><span style="color: #707183;">{</span>
<span class="linenr">  7: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26550;&#26500;&#32423;&#21035;</span>
<span class="linenr">  8: </span>
<span class="linenr">  9: </span>    <span style="color: #a020f0;">interface</span> <span style="color: #228b22;">IHelpable</span>
<span class="linenr"> 10: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 11: </span>        <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Help</span><span style="color: #909183;">()</span>;
<span class="linenr"> 12: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 13: </span>
<span class="linenr"> 14: </span>    <span style="color: #a020f0;">interface</span> <span style="color: #228b22;">ICalculator</span> : <span style="color: #228b22;">IHelpable</span>
<span class="linenr"> 15: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 16: </span>        <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>;
<span class="linenr"> 17: </span>        <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>;
<span class="linenr"> 18: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 19: </span>
<span class="linenr"> 20: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22823;&#20332;&#32423;&#21035;</span>
<span class="linenr"> 21: </span>
<span class="linenr"> 22: </span>    <span style="color: #a020f0;">abstract</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">CalculatorBase</span> : <span style="color: #228b22;">ICalculator</span>
<span class="linenr"> 23: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 24: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">abstract</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Help</span><span style="color: #909183;">()</span>;
<span class="linenr"> 25: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">abstract</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>;
<span class="linenr"> 26: </span>
<span class="linenr"> 27: </span>        <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">ExcelHelper</span> <span style="color: #a0522d;">ExcelHelper</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ExcelHelper</span><span style="color: #909183;">()</span>;
<span class="linenr"> 28: </span>
<span class="linenr"> 29: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fileName</span><span style="color: #909183;">)</span>
<span class="linenr"> 30: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 31: </span>            <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span> = ExcelHelper.<span style="color: #0000ff;">OpenOrCreate</span><span style="color: #709870;">(</span>fileName<span style="color: #709870;">)</span>;
<span class="linenr"> 32: </span>            <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span> = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
<span class="linenr"> 33: </span>            <span style="color: #0000ff;">ExportToBody</span><span style="color: #709870;">(</span>sheet<span style="color: #709870;">)</span>;
<span class="linenr"> 34: </span>            ExcelHelper.<span style="color: #0000ff;">SaveAndClose</span><span style="color: #709870;">(</span>workbook, fileName<span style="color: #709870;">)</span>;
<span class="linenr"> 35: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 36: </span>
<span class="linenr"> 37: </span>        <span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToBody</span><span style="color: #909183;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span><span style="color: #909183;">)</span>
<span class="linenr"> 38: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 39: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#22312;&#36825;&#37324;&#27809;&#20570;&#20219;&#20309;&#20107;&#65292;&#23376;&#31867;&#21487;&#20197;&#36873;&#39033;&#24615;&#37325;&#20889;&#27492;&#26041;&#27861;"</span><span style="color: #709870;">)</span>;
<span class="linenr"> 40: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 41: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 42: </span>
<span class="linenr"> 43: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25644;&#30742;&#32423;&#21035;</span>
<span class="linenr"> 44: </span>
<span class="linenr"> 45: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCalculator</span> : <span style="color: #228b22;">CalculatorBase</span>
<span class="linenr"> 46: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 47: </span>        <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">TipCalculator</span><span style="color: #909183;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">bill</span><span style="color: #909183;">)</span> =&gt; Bill = bill;
<span class="linenr"> 48: </span>
<span class="linenr"> 49: </span>        <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">RATE</span> = 0.18;
<span class="linenr"> 50: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Bill</span> <span style="color: #909183;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #909183;">}</span>
<span class="linenr"> 51: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Tip</span> =&gt; Bill * RATE;
<span class="linenr"> 52: </span>
<span class="linenr"> 53: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Help</span><span style="color: #909183;">()</span>
<span class="linenr"> 54: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 55: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#36825;&#26159;&#19968;&#20010;&#28040;&#36153;&#35745;&#31639;&#22120;&#65292;&#20854;&#20351;&#29992;&#26041;&#24335;&#20026; ..."</span><span style="color: #709870;">)</span>;
<span class="linenr"> 56: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 57: </span>
<span class="linenr"> 58: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>
<span class="linenr"> 59: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 60: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
<span class="linenr"> 61: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#36134;&#21333;&#24635;&#39069;: {Bill,10:C}"</span><span style="color: #709870;">)</span>;
<span class="linenr"> 62: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#23567;&#36153;&#25968;&#39069;: {Tip,10:C} ({RATE:P1})"</span><span style="color: #709870;">)</span>;
<span class="linenr"> 63: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #907373;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
<span class="linenr"> 64: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#36134;&#21333;&#23454;&#20184;: {Bill + Tip,10:C}"</span><span style="color: #709870;">)</span>;
<span class="linenr"> 65: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 66: </span>
<span class="linenr"> 67: </span>        <span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToBody</span><span style="color: #909183;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span><span style="color: #909183;">)</span>
<span class="linenr"> 68: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 69: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>sheet.LastRowNum == 0<span style="color: #709870;">)</span>
<span class="linenr"> 70: </span>                ExcelHelper.<span style="color: #0000ff;">InsertRow</span><span style="color: #709870;">(</span><span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> <span style="color: #8b2252;">"&#36134;&#21333;"</span>, <span style="color: #8b2252;">"&#36153;&#29575;"</span>, <span style="color: #8b2252;">"&#23567;&#36153;"</span>, <span style="color: #8b2252;">"&#24212;&#20184;"</span> <span style="color: #907373;">}</span>, sheet, 0<span style="color: #709870;">)</span>;
<span class="linenr"> 71: </span>            ExcelHelper.<span style="color: #0000ff;">InsertRow</span><span style="color: #709870;">(</span><span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> Bill.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, RATE.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, Tip.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, <span style="color: #6276ba;">(</span>Bill + Tip<span style="color: #6276ba;">)</span>.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span> <span style="color: #907373;">}</span>, sheet<span style="color: #709870;">)</span>;
<span class="linenr"> 72: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 73: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 74: </span>
<span class="linenr"> 75: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCalculator</span> : <span style="color: #228b22;">CalculatorBase</span>
<span class="linenr"> 76: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 77: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Help</span><span style="color: #909183;">()</span>
<span class="linenr"> 78: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 79: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 80: </span>
<span class="linenr"> 81: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>
<span class="linenr"> 82: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 83: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 84: </span>
<span class="linenr"> 85: </span>        <span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToBody</span><span style="color: #909183;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span><span style="color: #909183;">)</span>
<span class="linenr"> 86: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 87: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 88: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 89: </span>
<span class="linenr"> 90: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ElectricBillCalculator</span> : <span style="color: #228b22;">CalculatorBase</span>
<span class="linenr"> 91: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 92: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Help</span><span style="color: #909183;">()</span>
<span class="linenr"> 93: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 94: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 95: </span>
<span class="linenr"> 96: </span>        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>
<span class="linenr"> 97: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 98: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 99: </span>
<span class="linenr">100: </span>        <span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToBody</span><span style="color: #909183;">(</span><span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span><span style="color: #909183;">)</span>
<span class="linenr">101: </span>        <span style="color: #909183;">{</span>
<span class="linenr">102: </span>        <span style="color: #909183;">}</span>
<span class="linenr">103: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">104: </span>
<span class="linenr">105: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27979;&#35797;&#32423;&#21035;</span>
<span class="linenr">106: </span>
<span class="linenr">107: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">CalculatorTest</span>
<span class="linenr">108: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">109: </span>        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Test1</span><span style="color: #909183;">()</span>
<span class="linenr">110: </span>        <span style="color: #909183;">{</span>
<span class="linenr">111: </span>            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">calcs</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ICalculator</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">TipCalculator</span><span style="color: #907373;">(</span>2222<span style="color: #907373;">)</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ElectricBillCalculator</span><span style="color: #907373;">()</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TaxCalculator</span><span style="color: #907373;">()</span><span style="color: #709870;">}</span>;
<span class="linenr">112: </span>
<span class="linenr">113: </span>            <span style="color: #a020f0;">foreach</span> <span style="color: #709870;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">c</span> <span style="color: #a020f0;">in</span> calcs<span style="color: #709870;">)</span>
<span class="linenr">114: </span>            <span style="color: #709870;">{</span>
<span class="linenr">115: </span>                c.<span style="color: #0000ff;">Help</span><span style="color: #907373;">()</span>;
<span class="linenr">116: </span>                c.<span style="color: #0000ff;">PrintToConsole</span><span style="color: #907373;">()</span>;
<span class="linenr">117: </span>                c.<span style="color: #0000ff;">ExportToExcel</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"xxx"</span><span style="color: #907373;">)</span>;
<span class="linenr">118: </span>            <span style="color: #709870;">}</span>
<span class="linenr">119: </span>        <span style="color: #909183;">}</span>
<span class="linenr">120: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">121: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org8b59fca" class="outline-2">
<h2 id="org8b59fca"><span class="section-number-2">7.</span> 阶梯电费计算</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-orgcdc956a" class="outline-3">
<h3 id="orgcdc956a"><span class="section-number-3">7.1.</span> 第一种解决方案</h3>
<div class="outline-text-3" id="text-7-1">
<p>
这种方式由第三小组提供:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr">  1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">&#30005;&#36153;&#35745;&#31639;</span>
<span class="linenr">  2: </span><span style="color: #707183;">{</span>
<span class="linenr">  3: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#30693;&#36947;&#30340;&#25968;&#25454;</span>
<span class="linenr">  4: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">_&#26376;&#20221;</span>;
<span class="linenr">  5: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">_&#30005;&#25968;</span>;
<span class="linenr">  6: </span>
<span class="linenr">  7: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#35745;&#31639;&#20986;&#26469;&#30340;&#25968;&#25454;</span>
<span class="linenr">  8: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#31532;&#19968;&#26723;&#30005;&#36153;</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">  9: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#31532;&#20108;&#26723;&#30005;&#36153;</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span class="linenr"> 10: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#31532;&#19977;&#26723;&#30005;&#36153;</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span class="linenr"> 11: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#24635;&#30005;&#36153;</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span class="linenr"> 12: </span>
<span class="linenr"> 13: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22522;&#20934;&#25968;&#25454;</span>
<span class="linenr"> 14: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">&#26723;&#36153;</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> 0.600, 0.650, 0.900 <span style="color: #7388d6;">}</span>;
<span class="linenr"> 15: </span>
<span class="linenr"> 16: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">&#26376;&#20221;</span>
<span class="linenr"> 17: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 18: </span>        <span style="color: #a020f0;">get</span> <span style="color: #909183;">{</span> <span style="color: #a020f0;">return</span> _&#26376;&#20221;; <span style="color: #909183;">}</span>
<span class="linenr"> 19: </span>        <span style="color: #a020f0;">set</span>
<span class="linenr"> 20: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 21: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span><span style="color: #008b8b;">value</span> &lt; 1 || <span style="color: #008b8b;">value</span> &gt; 12<span style="color: #709870;">)</span>
<span class="linenr"> 22: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 23: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#21442;&#25968;&#36755;&#20837;&#38169;&#35823;&#12290;"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 24: </span>                Environment.<span style="color: #0000ff;">Exit</span><span style="color: #907373;">(</span>0<span style="color: #907373;">)</span>;
<span class="linenr"> 25: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 26: </span>            _&#26376;&#20221; = <span style="color: #008b8b;">value</span>;
<span class="linenr"> 27: </span>            &#35745;&#31639;&#30005;&#36153;<span style="color: #709870;">()</span>;
<span class="linenr"> 28: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 29: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 30: </span>
<span class="linenr"> 31: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#30005;&#25968;</span>
<span class="linenr"> 32: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 33: </span>        <span style="color: #a020f0;">get</span> <span style="color: #909183;">{</span> <span style="color: #a020f0;">return</span> _&#30005;&#25968;; <span style="color: #909183;">}</span>
<span class="linenr"> 34: </span>        <span style="color: #a020f0;">set</span>
<span class="linenr"> 35: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 36: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span><span style="color: #008b8b;">value</span> &lt; 0<span style="color: #709870;">)</span>
<span class="linenr"> 37: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 38: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#21442;&#25968;&#36755;&#20837;&#38169;&#35823;&#12290;"</span><span style="color: #907373;">)</span>;
<span class="linenr"> 39: </span>                Environment.<span style="color: #0000ff;">Exit</span><span style="color: #907373;">(</span>0<span style="color: #907373;">)</span>;
<span class="linenr"> 40: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 41: </span>            _&#30005;&#25968; = <span style="color: #008b8b;">value</span>;
<span class="linenr"> 42: </span>            &#35745;&#31639;&#30005;&#36153;<span style="color: #709870;">()</span>;
<span class="linenr"> 43: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 44: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 45: </span>
<span class="linenr"> 46: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#35745;&#31639;&#30005;&#36153;</span><span style="color: #7388d6;">()</span>
<span class="linenr"> 47: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 48: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>_&#26376;&#20221; &gt;= 5 &amp;&amp; _&#26376;&#20221; &lt;= 10<span style="color: #909183;">)</span>
<span class="linenr"> 49: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 50: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>_&#30005;&#25968; &lt;= 260<span style="color: #709870;">)</span>
<span class="linenr"> 51: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 52: </span>                &#31532;&#19968;&#26723;&#30005;&#36153; = _&#30005;&#25968; * &#26723;&#36153;<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
<span class="linenr"> 53: </span>                &#31532;&#20108;&#26723;&#30005;&#36153; = 0;
<span class="linenr"> 54: </span>                &#31532;&#19977;&#26723;&#30005;&#36153; = 0;
<span class="linenr"> 55: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 56: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>_&#30005;&#25968; &lt;= 600<span style="color: #709870;">)</span>
<span class="linenr"> 57: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 58: </span>                &#31532;&#19968;&#26723;&#30005;&#36153; = 260 * &#26723;&#36153;<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
<span class="linenr"> 59: </span>                &#31532;&#20108;&#26723;&#30005;&#36153; = <span style="color: #907373;">(</span>_&#30005;&#25968; - 260<span style="color: #907373;">)</span> * <span style="color: #907373;">(</span><span style="color: #228b22;">&#26723;&#36153;</span><span style="color: #6276ba;">[</span>1<span style="color: #6276ba;">]</span><span style="color: #907373;">)</span>;
<span class="linenr"> 60: </span>                &#31532;&#19977;&#26723;&#30005;&#36153; = 0;
<span class="linenr"> 61: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 62: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>_&#30005;&#25968; &gt; 600<span style="color: #709870;">)</span>
<span class="linenr"> 63: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 64: </span>                &#31532;&#19968;&#26723;&#30005;&#36153; = 260 * &#26723;&#36153;<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
<span class="linenr"> 65: </span>                &#31532;&#20108;&#26723;&#30005;&#36153; = <span style="color: #907373;">(</span>600 - 260<span style="color: #907373;">)</span> * <span style="color: #907373;">(</span><span style="color: #228b22;">&#26723;&#36153;</span><span style="color: #6276ba;">[</span>1<span style="color: #6276ba;">]</span><span style="color: #907373;">)</span>;
<span class="linenr"> 66: </span>                &#31532;&#19977;&#26723;&#30005;&#36153; = <span style="color: #907373;">(</span>_&#30005;&#25968; - 600<span style="color: #907373;">)</span> * <span style="color: #907373;">(</span><span style="color: #228b22;">&#26723;&#36153;</span><span style="color: #6276ba;">[</span>2<span style="color: #6276ba;">]</span><span style="color: #907373;">)</span>;
<span class="linenr"> 67: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 68: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 69: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr"> 70: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 71: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>_&#30005;&#25968; &gt; 0 &amp;&amp; _&#30005;&#25968; &lt;= 200<span style="color: #709870;">)</span>
<span class="linenr"> 72: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 73: </span>                &#31532;&#19968;&#26723;&#30005;&#36153; = _&#30005;&#25968; * &#26723;&#36153;<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
<span class="linenr"> 74: </span>                &#31532;&#20108;&#26723;&#30005;&#36153; = 0;
<span class="linenr"> 75: </span>                &#31532;&#19977;&#26723;&#30005;&#36153; = 0;
<span class="linenr"> 76: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 77: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>_&#30005;&#25968; &gt; 200 &amp;&amp; _&#30005;&#25968; &lt;= 400<span style="color: #709870;">)</span>
<span class="linenr"> 78: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 79: </span>                &#31532;&#19968;&#26723;&#30005;&#36153; = 200 * &#26723;&#36153;<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
<span class="linenr"> 80: </span>                &#31532;&#20108;&#26723;&#30005;&#36153; = <span style="color: #907373;">(</span>_&#30005;&#25968; - 200<span style="color: #907373;">)</span> * <span style="color: #907373;">(</span><span style="color: #228b22;">&#26723;&#36153;</span><span style="color: #6276ba;">[</span>1<span style="color: #6276ba;">]</span><span style="color: #907373;">)</span>;
<span class="linenr"> 81: </span>                &#31532;&#19977;&#26723;&#30005;&#36153; = 0;
<span class="linenr"> 82: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 83: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>_&#30005;&#25968; &gt; 400<span style="color: #709870;">)</span>
<span class="linenr"> 84: </span>            <span style="color: #709870;">{</span>
<span class="linenr"> 85: </span>                &#31532;&#19968;&#26723;&#30005;&#36153; = 200 * &#26723;&#36153;<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
<span class="linenr"> 86: </span>                &#31532;&#20108;&#26723;&#30005;&#36153; = <span style="color: #907373;">(</span>400 - 200<span style="color: #907373;">)</span> * <span style="color: #907373;">(</span><span style="color: #228b22;">&#26723;&#36153;</span><span style="color: #6276ba;">[</span>1<span style="color: #6276ba;">]</span><span style="color: #907373;">)</span>;
<span class="linenr"> 87: </span>                &#31532;&#19977;&#26723;&#30005;&#36153; = <span style="color: #907373;">(</span>_&#30005;&#25968; - 400<span style="color: #907373;">)</span> * <span style="color: #907373;">(</span><span style="color: #228b22;">&#26723;&#36153;</span><span style="color: #6276ba;">[</span>2<span style="color: #6276ba;">]</span><span style="color: #907373;">)</span>;
<span class="linenr"> 88: </span>            <span style="color: #709870;">}</span>
<span class="linenr"> 89: </span>        <span style="color: #909183;">}</span>
<span class="linenr"> 90: </span>        &#24635;&#30005;&#36153; = &#31532;&#19968;&#26723;&#30005;&#36153; + &#31532;&#20108;&#26723;&#30005;&#36153; + &#31532;&#19977;&#26723;&#30005;&#36153;;
<span class="linenr"> 91: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 92: </span>
<span class="linenr"> 93: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
<span class="linenr"> 94: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 95: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr"> 96: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{_&#26376;&#20221;} &#26376;&#30340;&#29992;&#30005;&#37327;&#26159;: {_&#30005;&#25968;} KWh"</span><span style="color: #909183;">)</span>;
<span class="linenr"> 97: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#19968;&#26723;&#30005;&#36153;: { &#31532;&#19968;&#26723;&#30005;&#36153;,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr"> 98: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#20108;&#26723;&#30005;&#36153;: { &#31532;&#20108;&#26723;&#30005;&#36153;,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr"> 99: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#19977;&#26723;&#30005;&#36153;: { &#31532;&#19977;&#26723;&#30005;&#36153;,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">100: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
<span class="linenr">101: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24635;&#35745;: { &#24635;&#30005;&#36153;,10:C} "</span><span style="color: #909183;">)</span>;
<span class="linenr">102: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">103: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge0499e9" class="outline-3">
<h3 id="orge0499e9"><span class="section-number-3">7.2.</span> 第一种方案的优化版</h3>
<div class="outline-text-3" id="text-7-2">
<p>
经过集思广益，整个班级一起修改，在上述的版本上进行优化:
</p>
<ul class="org-ul">
<li>减少了代码的冗余，让代码更清晰</li>
<li>将档位等数据提取为字段，方便管理和维护</li>
</ul>

<p>
代码如下:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">&#30005;&#36153;&#35745;&#31639;</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#30693;&#36947;&#30340;&#25968;&#25454;</span>
<span class="linenr"> 4: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">_&#26376;&#20221;</span>;
<span class="linenr"> 5: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">_&#30005;&#25968;</span>;
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#35745;&#31639;&#20986;&#26469;&#30340;&#25968;&#25454;</span>
<span class="linenr"> 8: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#31532;&#19968;&#26723;&#30005;&#36153;</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span class="linenr"> 9: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#31532;&#20108;&#26723;&#30005;&#36153;</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">10: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#31532;&#19977;&#26723;&#30005;&#36153;</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">11: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#24635;&#30005;&#36153;</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span> =&gt; &#31532;&#19968;&#26723;&#30005;&#36153; + &#31532;&#20108;&#26723;&#30005;&#36153; + &#31532;&#19977;&#26723;&#30005;&#36153;; <span style="color: #7388d6;">}</span>
<span class="linenr">12: </span>
<span class="linenr">13: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22522;&#20934;&#25968;&#25454;</span>
<span class="linenr">14: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">int</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">&#22799;&#23395;&#26723;&#20301;</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> 260, 600 <span style="color: #7388d6;">}</span>;
<span class="linenr">15: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">int</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">&#20908;&#23395;&#26723;&#20301;</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> 200, 400 <span style="color: #7388d6;">}</span>;
<span class="linenr">16: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">&#26723;&#36153;</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> 0.600, 0.650, 0.900 <span style="color: #7388d6;">}</span>;
<span class="linenr">17: </span>
<span class="linenr">18: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#26376;&#21644;&#30005;</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">&#26376;</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#30005;</span><span style="color: #7388d6;">)</span>
<span class="linenr">19: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">20: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>&#26376; &lt; 1 || &#26376; &gt; 12 || &#30005; &lt; 0<span style="color: #909183;">)</span>
<span class="linenr">21: </span>        <span style="color: #909183;">{</span>
<span class="linenr">22: </span>            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#21442;&#25968;&#36755;&#20837;&#38169;&#35823;&#12290;"</span><span style="color: #709870;">)</span>;
<span class="linenr">23: </span>            Environment.<span style="color: #0000ff;">Exit</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
<span class="linenr">24: </span>        <span style="color: #909183;">}</span>
<span class="linenr">25: </span>        _&#26376;&#20221; = &#26376;;
<span class="linenr">26: </span>        _&#30005;&#25968; = &#30005;;
<span class="linenr">27: </span>        &#35745;&#31639;&#30005;&#36153;<span style="color: #909183;">()</span>;
<span class="linenr">28: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">29: </span>
<span class="linenr">30: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#35745;&#31639;&#30005;&#36153;</span><span style="color: #7388d6;">()</span>
<span class="linenr">31: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">32: </span>        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">p1</span> = &#26159;&#22799;&#23395;<span style="color: #909183;">()</span> ? &#22799;&#23395;&#26723;&#20301;<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span> : &#20908;&#23395;&#26723;&#20301;<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span>;
<span class="linenr">33: </span>        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">p2</span> = &#26159;&#22799;&#23395;<span style="color: #909183;">()</span> ? &#22799;&#23395;&#26723;&#20301;<span style="color: #909183;">[</span>1<span style="color: #909183;">]</span> : &#20908;&#23395;&#26723;&#20301;<span style="color: #909183;">[</span>1<span style="color: #909183;">]</span>;
<span class="linenr">34: </span>
<span class="linenr">35: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>_&#30005;&#25968; &lt; p1<span style="color: #909183;">)</span>
<span class="linenr">36: </span>        <span style="color: #909183;">{</span>
<span class="linenr">37: </span>            &#31532;&#19968;&#26723;&#30005;&#36153; = _&#30005;&#25968; * &#26723;&#36153;<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
<span class="linenr">38: </span>            &#31532;&#20108;&#26723;&#30005;&#36153; = 0;
<span class="linenr">39: </span>            &#31532;&#19977;&#26723;&#30005;&#36153; = 0;
<span class="linenr">40: </span>        <span style="color: #909183;">}</span>
<span class="linenr">41: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>_&#30005;&#25968; &lt; p2<span style="color: #909183;">)</span>
<span class="linenr">42: </span>        <span style="color: #909183;">{</span>
<span class="linenr">43: </span>            &#31532;&#19968;&#26723;&#30005;&#36153; = p1 * &#26723;&#36153;<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
<span class="linenr">44: </span>            &#31532;&#20108;&#26723;&#30005;&#36153; = <span style="color: #709870;">(</span>_&#30005;&#25968; - p1<span style="color: #709870;">)</span> * &#26723;&#36153;<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
<span class="linenr">45: </span>            &#31532;&#19977;&#26723;&#30005;&#36153; = 0;
<span class="linenr">46: </span>        <span style="color: #909183;">}</span>
<span class="linenr">47: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr">48: </span>        <span style="color: #909183;">{</span>
<span class="linenr">49: </span>            &#31532;&#19968;&#26723;&#30005;&#36153; = p1 * &#26723;&#36153;<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
<span class="linenr">50: </span>            &#31532;&#20108;&#26723;&#30005;&#36153; = <span style="color: #709870;">(</span>p2 - p1<span style="color: #709870;">)</span> * &#26723;&#36153;<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
<span class="linenr">51: </span>            &#31532;&#19977;&#26723;&#30005;&#36153; = <span style="color: #709870;">(</span>_&#30005;&#25968; - p2<span style="color: #709870;">)</span> * &#26723;&#36153;<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
<span class="linenr">52: </span>        <span style="color: #909183;">}</span>
<span class="linenr">53: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">54: </span>
<span class="linenr">55: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">bool</span> <span style="color: #0000ff;">&#26159;&#22799;&#23395;</span><span style="color: #7388d6;">()</span>
<span class="linenr">56: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">57: </span>        <span style="color: #a020f0;">return</span> _&#26376;&#20221; &gt;= 5 &amp;&amp; _&#26376;&#20221; &lt;= 10;
<span class="linenr">58: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">59: </span>
<span class="linenr">60: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
<span class="linenr">61: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">62: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr">63: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{_&#26376;&#20221;} &#26376;&#30340;&#29992;&#30005;&#37327;&#26159;: {_&#30005;&#25968;} KWh"</span><span style="color: #909183;">)</span>;
<span class="linenr">64: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#19968;&#26723;&#30005;&#36153;: { &#31532;&#19968;&#26723;&#30005;&#36153;,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">65: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#20108;&#26723;&#30005;&#36153;: { &#31532;&#20108;&#26723;&#30005;&#36153;,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">66: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#19977;&#26723;&#30005;&#36153;: { &#31532;&#19977;&#26723;&#30005;&#36153;,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">67: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
<span class="linenr">68: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24635;&#35745;: { &#24635;&#30005;&#36153;,10:C} "</span><span style="color: #909183;">)</span>;
<span class="linenr">69: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">70: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org87022c0" class="outline-3">
<h3 id="org87022c0"><span class="section-number-3">7.3.</span> 第二种方案</h3>
<div class="outline-text-3" id="text-7-3">
<p>
基于阶梯度数，应该更加合理:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">ElectricBillCal</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22522;&#20934;&#25968;&#25454;</span>
<span class="linenr"> 4: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">int</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">&#22799;&#23395;&#26723;&#20301;</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> 260, 600 <span style="color: #7388d6;">}</span>;
<span class="linenr"> 5: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">int</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">&#20908;&#23395;&#26723;&#20301;</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> 200, 400 <span style="color: #7388d6;">}</span>;
<span class="linenr"> 6: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">&#26723;&#36153;</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> 0.600, 0.650, 0.900 <span style="color: #7388d6;">}</span>;
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#30693;&#36947;&#30340;&#25968;&#25454;</span>
<span class="linenr"> 9: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">_&#26376;&#20221;</span>;
<span class="linenr">10: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">_&#30005;&#25968;</span>;
<span class="linenr">11: </span>
<span class="linenr">12: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#35745;&#31639;&#20986;&#26469;&#30340;&#25968;&#25454;</span>
<span class="linenr">13: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">_&#38454;&#26799;&#24230;&#25968;</span>;
<span class="linenr">14: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#31532;&#19968;&#26723;&#30005;&#36153;</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span> =&gt; _&#38454;&#26799;&#24230;&#25968;<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span> * &#26723;&#36153;<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">15: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#31532;&#20108;&#26723;&#30005;&#36153;</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span> =&gt; _&#38454;&#26799;&#24230;&#25968;<span style="color: #909183;">[</span>1<span style="color: #909183;">]</span> * &#26723;&#36153;<span style="color: #909183;">[</span>1<span style="color: #909183;">]</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">16: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#31532;&#19977;&#26723;&#30005;&#36153;</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span> =&gt; _&#38454;&#26799;&#24230;&#25968;<span style="color: #909183;">[</span>2<span style="color: #909183;">]</span> * &#26723;&#36153;<span style="color: #909183;">[</span>2<span style="color: #909183;">]</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">17: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#24635;&#30005;&#36153;</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span> =&gt; &#31532;&#19968;&#26723;&#30005;&#36153; + &#31532;&#20108;&#26723;&#30005;&#36153; + &#31532;&#19977;&#26723;&#30005;&#36153;; <span style="color: #7388d6;">}</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#35774;&#32622;&#26376;&#20221;&#21644;&#30005;&#25968;</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">&#26376;</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">&#25968;</span><span style="color: #7388d6;">)</span>
<span class="linenr">20: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">21: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>&#26376; &lt; 1 || &#26376; &gt; 12 || &#25968; &lt; 0<span style="color: #909183;">)</span> &#25265;&#24616;&#24182;&#36864;&#20986;<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#21442;&#25968;&#36755;&#20837;&#38169;&#35823;"</span><span style="color: #909183;">)</span>;
<span class="linenr">22: </span>        <span style="color: #909183;">(</span><span style="color: #228b22;">_&#26376;&#20221;</span>, <span style="color: #228b22;">_&#30005;&#25968;</span><span style="color: #909183;">)</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">&#26376;</span>, <span style="color: #228b22;">&#25968;</span><span style="color: #909183;">)</span>;
<span class="linenr">23: </span>        &#35745;&#31639;&#38454;&#26799;&#24230;&#25968;<span style="color: #909183;">()</span>;
<span class="linenr">24: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">25: </span>
<span class="linenr">26: </span>    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#35745;&#31639;&#38454;&#26799;&#24230;&#25968;</span><span style="color: #7388d6;">()</span>
<span class="linenr">27: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">28: </span>        <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">p1</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">p2</span><span style="color: #909183;">)</span> = &#22799;&#22825;&#21542;<span style="color: #909183;">()</span> ? <span style="color: #909183;">(</span><span style="color: #228b22;">&#22799;&#23395;&#26723;&#20301;</span><span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>, <span style="color: #228b22;">&#22799;&#23395;&#26723;&#20301;</span><span style="color: #709870;">[</span>1<span style="color: #709870;">]</span><span style="color: #909183;">)</span> : <span style="color: #909183;">(</span><span style="color: #228b22;">&#20908;&#23395;&#26723;&#20301;</span><span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>, <span style="color: #228b22;">&#20908;&#23395;&#26723;&#20301;</span><span style="color: #709870;">[</span>1<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;
<span class="linenr">29: </span>
<span class="linenr">30: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>_&#30005;&#25968; &lt;= p1<span style="color: #909183;">)</span>
<span class="linenr">31: </span>        <span style="color: #909183;">{</span>
<span class="linenr">32: </span>            _&#38454;&#26799;&#24230;&#25968; = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> _&#30005;&#25968;, 0, 0 <span style="color: #709870;">}</span>;
<span class="linenr">33: </span>        <span style="color: #909183;">}</span>
<span class="linenr">34: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>_&#30005;&#25968; &lt;= p2<span style="color: #909183;">)</span>
<span class="linenr">35: </span>        <span style="color: #909183;">{</span>
<span class="linenr">36: </span>            _&#38454;&#26799;&#24230;&#25968; = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> p1, _&#30005;&#25968; - p1, 0 <span style="color: #709870;">}</span>;
<span class="linenr">37: </span>        <span style="color: #909183;">}</span>
<span class="linenr">38: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr">39: </span>        <span style="color: #909183;">{</span>
<span class="linenr">40: </span>            _&#38454;&#26799;&#24230;&#25968; = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> p1, p2 - p1, _&#30005;&#25968; - p2 <span style="color: #709870;">}</span>;
<span class="linenr">41: </span>        <span style="color: #909183;">}</span>
<span class="linenr">42: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">43: </span>
<span class="linenr">44: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
<span class="linenr">45: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">46: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr">47: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{_&#26376;&#20221;} &#26376;&#30340;&#29992;&#30005;&#37327;&#26159;: {_&#30005;&#25968;} KWh"</span><span style="color: #909183;">)</span>;
<span class="linenr">48: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#19968;&#26723;&#30005;&#36153;: {&#31532;&#19968;&#26723;&#30005;&#36153;,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">49: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#20108;&#26723;&#30005;&#36153;: {&#31532;&#20108;&#26723;&#30005;&#36153;,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">50: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#19977;&#26723;&#30005;&#36153;: {&#31532;&#19977;&#26723;&#30005;&#36153;,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">51: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
<span class="linenr">52: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24635;&#35745;: {&#24635;&#30005;&#36153;,10:C} "</span><span style="color: #909183;">)</span>;
<span class="linenr">53: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">54: </span>
<span class="linenr">55: </span>    <span style="color: #228b22;">bool</span> <span style="color: #0000ff;">&#22799;&#22825;&#21542;</span><span style="color: #7388d6;">()</span> =&gt; _&#26376;&#20221; &gt;= 5 &amp;&amp; _&#26376;&#20221; &lt;= 10;
<span class="linenr">56: </span>
<span class="linenr">57: </span>    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#25265;&#24616;&#24182;&#36864;&#20986;</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">&#25265;&#24616;&#20869;&#23481;</span><span style="color: #7388d6;">)</span>
<span class="linenr">58: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">59: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">&#25265;&#24616;&#20869;&#23481;</span><span style="color: #909183;">)</span>;
<span class="linenr">60: </span>        Environment.<span style="color: #0000ff;">Exit</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">61: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">62: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6730ea1" class="outline-3">
<h3 id="org6730ea1"><span class="section-number-3">7.4.</span> 第二种方案的英文变量版本</h3>
<div class="outline-text-3" id="text-7-4">
<p>
用英文进行命名，还是比较主流和正规的。需要的只是简单的英文而已，写多了就熟了:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">ElectricBillCalc</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22522;&#20934;&#25968;&#25454;</span>
<span class="linenr"> 4: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">int</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">SummerLevels</span> = <span style="color: #7388d6;">{</span> 260, 600 <span style="color: #7388d6;">}</span>;
<span class="linenr"> 5: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">int</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">WinterLevels</span> = <span style="color: #7388d6;">{</span> 200, 400 <span style="color: #7388d6;">}</span>;
<span class="linenr"> 6: </span>    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">Rates</span> = <span style="color: #7388d6;">{</span> 0.600, 0.650, 0.900 <span style="color: #7388d6;">}</span>;
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#30693;&#36947;&#30340;&#25968;&#25454;</span>
<span class="linenr"> 9: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">_month</span>;
<span class="linenr">10: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">_used</span>;
<span class="linenr">11: </span>
<span class="linenr">12: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#35745;&#31639;&#20986;&#26469;&#30340;&#25968;&#25454;</span>
<span class="linenr">13: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">lvUsed</span>;
<span class="linenr">14: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Lv1Cost</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span> =&gt; lvUsed<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span> * Rates<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">15: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Lv2Cost</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span> =&gt; lvUsed<span style="color: #909183;">[</span>1<span style="color: #909183;">]</span> * Rates<span style="color: #909183;">[</span>1<span style="color: #909183;">]</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">16: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Lv3Cost</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span> =&gt; lvUsed<span style="color: #909183;">[</span>2<span style="color: #909183;">]</span> * Rates<span style="color: #909183;">[</span>2<span style="color: #909183;">]</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">17: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Bill</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span> =&gt; Lv1Cost + Lv2Cost + Lv3Cost; <span style="color: #7388d6;">}</span>
<span class="linenr">18: </span>
<span class="linenr">19: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SetMonthAndUsed</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">month</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">used</span><span style="color: #7388d6;">)</span>
<span class="linenr">20: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">21: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>month &lt; 1 || month &gt; 12 || used &lt; 0<span style="color: #909183;">)</span> <span style="color: #0000ff;">QuitWithReason</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#21442;&#25968;&#36755;&#20837;&#38169;&#35823;"</span><span style="color: #909183;">)</span>;
<span class="linenr">22: </span>        <span style="color: #909183;">(</span><span style="color: #228b22;">_month</span>, <span style="color: #228b22;">_used</span><span style="color: #909183;">)</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">month</span>, <span style="color: #228b22;">used</span><span style="color: #909183;">)</span>;
<span class="linenr">23: </span>        <span style="color: #0000ff;">CalculateLvUsed</span><span style="color: #909183;">()</span>;
<span class="linenr">24: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">25: </span>
<span class="linenr">26: </span>    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CalculateLvUsed</span><span style="color: #7388d6;">()</span>
<span class="linenr">27: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">28: </span>        <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">p1</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">p2</span><span style="color: #909183;">)</span> = <span style="color: #0000ff;">IsSummer</span><span style="color: #909183;">()</span> ? <span style="color: #909183;">(</span><span style="color: #228b22;">SummerLevels</span><span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>, <span style="color: #228b22;">SummerLevels</span><span style="color: #709870;">[</span>1<span style="color: #709870;">]</span><span style="color: #909183;">)</span> : <span style="color: #909183;">(</span><span style="color: #228b22;">WinterLevels</span><span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>, <span style="color: #228b22;">WinterLevels</span><span style="color: #709870;">[</span>1<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;
<span class="linenr">29: </span>
<span class="linenr">30: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>_used &lt;= p1<span style="color: #909183;">)</span>
<span class="linenr">31: </span>        <span style="color: #909183;">{</span>
<span class="linenr">32: </span>            lvUsed = <span style="color: #a020f0;">new</span> <span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> _used, 0, 0 <span style="color: #709870;">}</span>;
<span class="linenr">33: </span>        <span style="color: #909183;">}</span>
<span class="linenr">34: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>_used &lt;= p2<span style="color: #909183;">)</span>
<span class="linenr">35: </span>        <span style="color: #909183;">{</span>
<span class="linenr">36: </span>            lvUsed = <span style="color: #a020f0;">new</span> <span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> p1, _used - p1, 0 <span style="color: #709870;">}</span>;
<span class="linenr">37: </span>        <span style="color: #909183;">}</span>
<span class="linenr">38: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr">39: </span>        <span style="color: #909183;">{</span>
<span class="linenr">40: </span>            lvUsed = <span style="color: #a020f0;">new</span> <span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> p1, p2 - p1, _used - p2 <span style="color: #709870;">}</span>;
<span class="linenr">41: </span>        <span style="color: #909183;">}</span>
<span class="linenr">42: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">43: </span>
<span class="linenr">44: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
<span class="linenr">45: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">46: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr">47: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{_month} &#26376;&#30340;&#29992;&#30005;&#37327;&#26159;: {_used} KWh"</span><span style="color: #909183;">)</span>;
<span class="linenr">48: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#19968;&#26723;&#30005;&#36153;: {Lv1Cost,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">49: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#20108;&#26723;&#30005;&#36153;: {Lv2Cost,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">50: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31532;&#19977;&#26723;&#30005;&#36153;: {Lv3Cost,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">51: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
<span class="linenr">52: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24635;&#35745;: {Bill,10:C} "</span><span style="color: #909183;">)</span>;
<span class="linenr">53: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">54: </span>
<span class="linenr">55: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">()</span>
<span class="linenr">56: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">57: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">todo</span>
<span class="linenr">58: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">59: </span>
<span class="linenr">60: </span>    <span style="color: #228b22;">bool</span> <span style="color: #0000ff;">IsSummer</span><span style="color: #7388d6;">()</span> =&gt; _month &gt;= 5 &amp;&amp; _month &lt;= 10;
<span class="linenr">61: </span>
<span class="linenr">62: </span>    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">QuitWithReason</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">reason</span><span style="color: #7388d6;">)</span>
<span class="linenr">63: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">64: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">reason</span><span style="color: #909183;">)</span>;
<span class="linenr">65: </span>        Environment.<span style="color: #0000ff;">Exit</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">66: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">67: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3f5da9d" class="outline-3">
<h3 id="org3f5da9d"><span class="section-number-3">7.5.</span> 学习怎么使用别人的封装 (Console)</h3>
<div class="outline-text-3" id="text-7-5">
<blockquote>
<p>
完成 ElectricBillCalc 中杀马特版本的 Print:
</p>
<ul class="org-ul">
<li>1: 红色</li>
<li>2: 绿色</li>
<li>3: 黄色</li>
<li>q: 或 esc 退出</li>
<li>回车: 每秒变一种颜色，适当增加声音效果 (beep)</li>
<li>其他: 原来的颜色</li>
</ul>
</blockquote>

<ul class="org-ul">
<li>首先理清楚思路，明白自己要做什么，不要着急写代码</li>
<li>碰到不会不懂的，要及时求助别人或度姨</li>
<li>解决问题过程中，一定要总结与反思 (带脑子)</li>
<li>问题解决了，笔记也要整理好 (温故知新，多练习)</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr">210: </span><span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintFantasy</span><span style="color: #707183;">()</span>
<span class="linenr">211: </span><span style="color: #707183;">{</span>
<span class="linenr">212: </span>    <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>;
<span class="linenr">213: </span>    <span style="color: #a020f0;">while</span><span style="color: #7388d6;">(</span><span style="color: #008b8b;">true</span><span style="color: #7388d6;">)</span>
<span class="linenr">214: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">215: </span>        <span style="color: #228b22;">ConsoleKeyInfo</span> <span style="color: #a0522d;">key</span> = Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #909183;">()</span>;
<span class="linenr">216: </span>        Console.<span style="color: #0000ff;">Clear</span><span style="color: #909183;">()</span>;
<span class="linenr">217: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>key.Key == ConsoleKey.D1<span style="color: #909183;">)</span>
<span class="linenr">218: </span>        <span style="color: #909183;">{</span>
<span class="linenr">219: </span>            <span style="color: #0000ff;">PrintToConsole</span><span style="color: #709870;">(</span>ConsoleColor.Red<span style="color: #709870;">)</span>;
<span class="linenr">220: </span>        <span style="color: #909183;">}</span>
<span class="linenr">221: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>key.Key == ConsoleKey.D2<span style="color: #909183;">)</span>
<span class="linenr">222: </span>        <span style="color: #909183;">{</span>
<span class="linenr">223: </span>            <span style="color: #0000ff;">PrintToConsole</span><span style="color: #709870;">(</span>ConsoleColor.Green<span style="color: #709870;">)</span>;
<span class="linenr">224: </span>        <span style="color: #909183;">}</span>
<span class="linenr">225: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>key.Key == ConsoleKey.D3<span style="color: #909183;">)</span>
<span class="linenr">226: </span>        <span style="color: #909183;">{</span>
<span class="linenr">227: </span>            <span style="color: #0000ff;">PrintToConsole</span><span style="color: #709870;">(</span>ConsoleColor.Yellow<span style="color: #709870;">)</span>;
<span class="linenr">228: </span>        <span style="color: #909183;">}</span>
<span class="linenr">229: </span>        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span><span style="color: #909183;">(</span>key.Key == ConsoleKey.Enter<span style="color: #909183;">)</span>
<span class="linenr">230: </span>        <span style="color: #909183;">{</span>
<span class="linenr">231: </span>            <span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0;
<span class="linenr">232: </span>            <span style="color: #a020f0;">while</span> <span style="color: #709870;">(</span><span style="color: #008b8b;">true</span><span style="color: #709870;">)</span>
<span class="linenr">233: </span>            <span style="color: #709870;">{</span>
<span class="linenr">234: </span>                <span style="color: #228b22;">ConsoleColor</span><span style="color: #907373;">[]</span> <span style="color: #a0522d;">colors</span> = <span style="color: #a020f0;">new</span><span style="color: #907373;">[]</span> <span style="color: #907373;">{</span> ConsoleColor.Red, ConsoleColor.Green, ConsoleColor.Blue <span style="color: #907373;">}</span>;
<span class="linenr">235: </span>                Console.<span style="color: #0000ff;">Clear</span><span style="color: #907373;">()</span>;
<span class="linenr">236: </span>                i = <span style="color: #907373;">(</span>i + 1<span style="color: #907373;">)</span> % colors.Length;
<span class="linenr">237: </span>                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>i == 1<span style="color: #907373;">)</span>
<span class="linenr">238: </span>                <span style="color: #907373;">{</span>
<span class="linenr">239: </span>                    Console.<span style="color: #0000ff;">Beep</span><span style="color: #6276ba;">(</span>90, 50<span style="color: #6276ba;">)</span>;
<span class="linenr">240: </span>                <span style="color: #907373;">}</span>
<span class="linenr">241: </span>                <span style="color: #a020f0;">else</span>
<span class="linenr">242: </span>                <span style="color: #907373;">{</span>
<span class="linenr">243: </span>                    Console.<span style="color: #0000ff;">Beep</span><span style="color: #6276ba;">(</span>40, 50<span style="color: #6276ba;">)</span>;
<span class="linenr">244: </span>                <span style="color: #907373;">}</span>
<span class="linenr">245: </span>                <span style="color: #0000ff;">PrintToConsole</span><span style="color: #907373;">(</span>colors<span style="color: #6276ba;">[</span>i<span style="color: #6276ba;">]</span><span style="color: #907373;">)</span>;
<span class="linenr">246: </span>                Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #907373;">(</span>300<span style="color: #907373;">)</span>;
<span class="linenr">247: </span>            <span style="color: #709870;">}</span>
<span class="linenr">248: </span>        <span style="color: #909183;">}</span>
<span class="linenr">249: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr">250: </span>        <span style="color: #909183;">{</span>
<span class="linenr">251: </span>            <span style="color: #0000ff;">PrintToConsole</span><span style="color: #709870;">()</span>;
<span class="linenr">252: </span>        <span style="color: #909183;">}</span>
<span class="linenr">253: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">254: </span><span style="color: #707183;">}</span>
<span class="linenr">255: </span>
<span class="linenr">256: </span><span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #707183;">(</span><span style="color: #228b22;">ConsoleColor</span> <span style="color: #a0522d;">color</span><span style="color: #707183;">)</span>
<span class="linenr">257: </span><span style="color: #707183;">{</span>
<span class="linenr">258: </span>    Console.ForegroundColor = color;
<span class="linenr">259: </span>    <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>;
<span class="linenr">260: </span>    Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #7388d6;">()</span>;
<span class="linenr">261: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org12b0fdd" class="outline-3">
<h3 id="org12b0fdd"><span class="section-number-3">7.6.</span> 学习怎么使用别人的封装 (ExportToExcel)</h3>
<div class="outline-text-3" id="text-7-6">
<p>
C# 操纵 Excel 的方法:
</p>
<ul class="org-ul">
<li>内置的 Interop 包，需要安装 Office 后才可以使用</li>
<li>开源独立的 NPOI 包，需要在 NuGet 中下载并引入到项目</li>
</ul>

<p>
使用 NPOI 进行数据导出的示例:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #707183;">()</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">book</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #7388d6;">()</span>;    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24037;&#20316;&#31807;</span>
<span class="linenr"> 4: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">sheet1</span> = book.<span style="color: #0000ff;">CreateSheet</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#20449;&#24687;&#34920;"</span><span style="color: #7388d6;">)</span>;   <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24037;&#20316;&#34920;</span>
<span class="linenr"> 5: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">sheet2</span> = book.<span style="color: #0000ff;">CreateSheet</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#20449;&#24687;&#34920;2"</span><span style="color: #7388d6;">)</span>;  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24037;&#20316;&#34920;</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25968;&#25454;&#21644;&#26679;&#24335;</span>
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row1Values</span> = <span style="color: #a020f0;">new</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> <span style="color: #8b2252;">"&#26376;&#20221;"</span>, <span style="color: #8b2252;">"&#24230;&#25968;"</span>, <span style="color: #8b2252;">"&#19968;&#26723;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#20108;&#25377;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#19977;&#26723;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#24635;&#36153;&#29992;"</span> <span style="color: #7388d6;">}</span>;
<span class="linenr">10: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row2Values</span> = <span style="color: #a020f0;">new</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> _month, _used, Lv1Cost, Lv2Cost, Lv3Cost, Bill <span style="color: #7388d6;">}</span>;
<span class="linenr">11: </span>
<span class="linenr">12: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">style1</span> = book.<span style="color: #0000ff;">CreateCellStyle</span><span style="color: #7388d6;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23545;&#35937;&#65292;&#23553;&#35013;&#20102;&#26679;&#24335;&#26041;&#38754;&#30340;&#25968;&#25454;</span>
<span class="linenr">13: </span>    style1.BottomBorderColor = NPOI.HSSF.Util.HSSFColor.Red.Index;
<span class="linenr">14: </span>    style1.BorderBottom = BorderStyle.Double;
<span class="linenr">15: </span>    style1.FillForegroundColor = NPOI.HSSF.Util.HSSFColor.Yellow.Index;
<span class="linenr">16: </span>    style1.FillPattern = FillPattern.SolidForeground;
<span class="linenr">17: </span>    style1.Alignment = HorizontalAlignment.Center;
<span class="linenr">18: </span>    style1.VerticalAlignment = VerticalAlignment.Center;
<span class="linenr">19: </span>
<span class="linenr">20: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">style2</span> = book.<span style="color: #0000ff;">CreateCellStyle</span><span style="color: #7388d6;">()</span>;
<span class="linenr">21: </span>    style2.<span style="color: #0000ff;">CloneStyleFrom</span><span style="color: #7388d6;">(</span>style1<span style="color: #7388d6;">)</span>;
<span class="linenr">22: </span>    style2.FillPattern = FillPattern.NoFill;
<span class="linenr">23: </span>
<span class="linenr">24: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21019;&#24314;&#34892;</span>
<span class="linenr">25: </span>
<span class="linenr">26: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row1</span> = sheet1.<span style="color: #0000ff;">CreateRow</span><span style="color: #7388d6;">(</span>0<span style="color: #7388d6;">)</span>;
<span class="linenr">27: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row2</span> = sheet1.<span style="color: #0000ff;">CreateRow</span><span style="color: #7388d6;">(</span>1<span style="color: #7388d6;">)</span>;
<span class="linenr">28: </span>
<span class="linenr">29: </span>    row1.Height = 700;
<span class="linenr">30: </span>    row2.Height = 500;
<span class="linenr">31: </span>
<span class="linenr">32: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22836;&#37096;&#34892;</span>
<span class="linenr">33: </span>
<span class="linenr">34: </span>    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; row1Values.Length; i++<span style="color: #7388d6;">)</span>
<span class="linenr">35: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">36: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">cell1</span> = row1.<span style="color: #0000ff;">CreateCell</span><span style="color: #909183;">(</span>i<span style="color: #909183;">)</span>;
<span class="linenr">37: </span>        cell1.<span style="color: #0000ff;">SetCellValue</span><span style="color: #909183;">(</span>row1Values<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;
<span class="linenr">38: </span>        cell1.CellStyle = style1;
<span class="linenr">39: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">40: </span>
<span class="linenr">41: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25968;&#25454;&#34892;</span>
<span class="linenr">42: </span>
<span class="linenr">43: </span>    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; row2Values.Length; i++<span style="color: #7388d6;">)</span>
<span class="linenr">44: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">45: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">cell2</span> = row2.<span style="color: #0000ff;">CreateCell</span><span style="color: #909183;">(</span>i<span style="color: #909183;">)</span>;
<span class="linenr">46: </span>        cell2.<span style="color: #0000ff;">SetCellValue</span><span style="color: #909183;">(</span>row2Values<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;
<span class="linenr">47: </span>        cell2.CellStyle = style2;
<span class="linenr">48: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">49: </span>
<span class="linenr">50: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20445;&#23384;</span>
<span class="linenr">51: </span>
<span class="linenr">52: </span>    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#23548;&#20986;..."</span><span style="color: #7388d6;">)</span>;
<span class="linenr">53: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">fileName</span> = $<span style="color: #8b2252;">"D:\\test.xls"</span>;
<span class="linenr">54: </span>    <span style="color: #a020f0;">try</span>
<span class="linenr">55: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">56: </span>        <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> file = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">FileStream</span><span style="color: #909183;">(</span>fileName, FileMode.Create<span style="color: #909183;">)</span>;
<span class="linenr">57: </span>        book.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span>file<span style="color: #909183;">)</span>;
<span class="linenr">58: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">59: </span>    <span style="color: #a020f0;">catch</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #7388d6;">)</span>
<span class="linenr">60: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">61: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#25991;&#20214;&#20445;&#23384;&#22833;&#36133;&#65292;&#35831;&#37325;&#35797;&#12290;\n&#22833;&#36133;&#30340;&#21407;&#22240;: {e.Message}"</span><span style="color: #909183;">)</span>;
<span class="linenr">62: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">63: </span>    book.<span style="color: #0000ff;">Close</span><span style="color: #7388d6;">()</span>;
<span class="linenr">64: </span><span style="color: #707183;">}</span>
</pre>
</div>

<p>
注意:
</p>
<ul class="org-ul">
<li>资源类变量 (文件等)，用完之后，一定记得要释放 (Close)。为了确保释放成功，应该将释放语句放到 finally 块中</li>
<li>可以使用 <code>using</code> 语法糖简化释放</li>
<li>实现相关功能，需要先有思路，后有代码。不要着急写代码，先搞明白自己要做的事情是什么，要怎么去做</li>
<li>有了思路，却写不出来代码的根本原因是，写的少，对语法不熟悉。解决方案: 多练</li>
</ul>
</div>
</div>

<div id="outline-container-org886dfe1" class="outline-3">
<h3 id="org886dfe1"><span class="section-number-3">7.7.</span> 优化 ExportToExcel 为直接使用已存在的文件</h3>
<div class="outline-text-3" id="text-7-7">
<ul class="org-ul">
<li>如果 Excel 文件存在，直接使用</li>
<li>如果 Excel 不存在，先创建并初始化，再使用</li>
<li>点击查看思路 (<a href="img/exporttoexcel-1.png">图片</a>)</li>
</ul>

<p>
提示:
</p>
<ul class="org-ul">
<li>务必要确保资源被合理释放 (<code>using</code>) !!!</li>
<li><code>File.Exists</code> 用来判断文件存不存在</li>
<li><code>File.OpenRead/OpenWrite</code> 用来打开文件，分别用作读和写。是简化的写法</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel3</span><span style="color: #707183;">()</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">fileName</span> = @<span style="color: #8b2252;">"e:\xxxxx.xls"</span>;
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span>    <span style="color: #228b22;">IWorkbook</span> <span style="color: #a0522d;">workbook</span>;
<span class="linenr"> 6: </span>    <span style="color: #228b22;">ISheet</span> <span style="color: #a0522d;">sheet</span>;
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #909183;">(</span>fileName<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#25991;&#20214;&#23384;&#22312;&#65292;&#37027;&#20040;&#25171;&#24320;&#20351;&#29992;&#23427;</span>
<span class="linenr"> 9: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">10: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#25171;&#24320;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">11: </span>        <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sr = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #909183;">(</span>fileName<span style="color: #909183;">)</span>;
<span class="linenr">12: </span>        workbook = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #909183;">(</span>sr<span style="color: #909183;">)</span>;
<span class="linenr">13: </span>        sheet = workbook.<span style="color: #0000ff;">GetSheetAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">14: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">15: </span>    <span style="color: #a020f0;">else</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#25991;&#20214;&#19981;&#23384;&#22312;&#65292;&#21019;&#24314;&#24182;&#20351;&#29992;&#23427;</span>
<span class="linenr">16: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">17: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#21019;&#24314;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">18: </span>        workbook = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HSSFWorkbook</span><span style="color: #909183;">()</span>;
<span class="linenr">19: </span>        sheet = workbook.<span style="color: #0000ff;">CreateSheet</span><span style="color: #909183;">()</span>;
<span class="linenr">20: </span>
<span class="linenr">21: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#21021;&#22987;&#21270;&#22836;&#37096;..."</span><span style="color: #909183;">)</span>;
<span class="linenr">22: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">heads</span> = <span style="color: #a020f0;">new</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> <span style="color: #8b2252;">"&#26376;&#20221;"</span>, <span style="color: #8b2252;">"&#24230;&#25968;"</span>, <span style="color: #8b2252;">"&#19968;&#26723;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#20108;&#25377;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#19977;&#26723;&#36153;&#29992;"</span>, <span style="color: #8b2252;">"&#24635;&#36153;&#29992;"</span> <span style="color: #909183;">}</span>;
<span class="linenr">23: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">headRow</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
<span class="linenr">24: </span>        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; heads.Length; i++<span style="color: #909183;">)</span>
<span class="linenr">25: </span>        <span style="color: #909183;">{</span>
<span class="linenr">26: </span>            headRow.<span style="color: #0000ff;">CreateCell</span><span style="color: #709870;">(</span>i<span style="color: #709870;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #709870;">(</span>heads<span style="color: #907373;">[</span>i<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
<span class="linenr">27: </span>        <span style="color: #909183;">}</span>
<span class="linenr">28: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">29: </span>
<span class="linenr">30: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25554;&#20837;&#25968;&#25454;</span>
<span class="linenr">31: </span>    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#25554;&#20837;..."</span><span style="color: #7388d6;">)</span>;
<span class="linenr">32: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">values</span> = <span style="color: #a020f0;">new</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> _month, _used, Lv1Cost, Lv2Cost, Lv3Cost, Bill <span style="color: #7388d6;">}</span>;
<span class="linenr">33: </span>    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">row</span> = sheet.<span style="color: #0000ff;">CreateRow</span><span style="color: #7388d6;">(</span>sheet.LastRowNum + 1<span style="color: #7388d6;">)</span>;
<span class="linenr">34: </span>    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; values.Length; i++<span style="color: #7388d6;">)</span>
<span class="linenr">35: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">36: </span>        row.<span style="color: #0000ff;">CreateCell</span><span style="color: #909183;">(</span>i<span style="color: #909183;">)</span>.<span style="color: #0000ff;">SetCellValue</span><span style="color: #909183;">(</span>values<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;
<span class="linenr">37: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">38: </span>
<span class="linenr">39: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20445;&#23384; Excel</span>
<span class="linenr">40: </span>    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#24320;&#22987;&#20445;&#23384;..."</span><span style="color: #7388d6;">)</span>;
<span class="linenr">41: </span>    <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> sw = File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #7388d6;">(</span>fileName<span style="color: #7388d6;">)</span>;
<span class="linenr">42: </span>    workbook.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span>sw<span style="color: #7388d6;">)</span>;
<span class="linenr">43: </span>
<span class="linenr">44: </span>    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#23548;&#20986;&#25104;&#21151;!"</span><span style="color: #7388d6;">)</span>;
<span class="linenr">45: </span><span style="color: #707183;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">()</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #a020f0;">while</span> <span style="color: #7388d6;">(</span><span style="color: #008b8b;">true</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 4: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 5: </span>        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#35831;&#36755;&#20837;&#26376;&#20221;: "</span><span style="color: #909183;">)</span>;
<span class="linenr"> 6: </span>        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">yue</span> = <span style="color: #228b22;">int</span>.<span style="color: #0000ff;">Parse</span><span style="color: #909183;">(</span>Console.<span style="color: #0000ff;">ReadLine</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#35831;&#36755;&#20837;&#29992;&#30005;&#37327;: "</span><span style="color: #909183;">)</span>;
<span class="linenr"> 9: </span>        <span style="color: #228b22;">double</span> <span style="color: #a0522d;">liang</span> = <span style="color: #228b22;">double</span>.<span style="color: #0000ff;">Parse</span><span style="color: #909183;">(</span>Console.<span style="color: #0000ff;">ReadLine</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
<span class="linenr">10: </span>
<span class="linenr">11: </span>        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992;&#33258;&#24049;&#30340;&#23553;&#35013;</span>
<span class="linenr">12: </span>        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ec</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ElectricBillCalc</span><span style="color: #909183;">()</span>;
<span class="linenr">13: </span>        ec.<span style="color: #0000ff;">SetMonthAndUsed</span><span style="color: #909183;">(</span>yue, liang<span style="color: #909183;">)</span>;
<span class="linenr">14: </span>        ec.<span style="color: #0000ff;">ExportToExcel3</span><span style="color: #909183;">()</span>;
<span class="linenr">15: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">16: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org9c3454e" class="outline-2">
<h2 id="org9c3454e"><span class="section-number-2">8.</span> 个税计算器 (简化版) <a href="tasks.html#ID-6c800397-9525-4a5d-b857-4356fb81f85c">源</a></h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-orga8de1a8" class="outline-3">
<h3 id="orga8de1a8"><span class="section-number-3">8.1.</span> 原始版本，*顺序* 执行</h3>
<div class="outline-text-3" id="text-8-1">
<p>
这是第二小组提供的代码:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;
<span class="linenr"> 2: </span>
<span class="linenr"> 3: </span><span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">Tax</span>
<span class="linenr"> 4: </span><span style="color: #707183;">{</span>
<span class="linenr"> 5: </span>    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span class="linenr"> 6: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 7: </span>        <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #909183;">)</span>
<span class="linenr"> 8: </span>        <span style="color: #909183;">{</span>
<span class="linenr"> 9: </span>            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">a</span> = 0.03;
<span class="linenr">10: </span>            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">b</span> = 0.05;
<span class="linenr">11: </span>            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">c</span> = 0.2;
<span class="linenr">12: </span>            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">d</span> = 0.45;
<span class="linenr">13: </span>            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">n</span>;
<span class="linenr">14: </span>            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>args.Length != 1 || !<span style="color: #228b22;">double</span>.<span style="color: #0000ff;">TryParse</span><span style="color: #907373;">(</span><span style="color: #228b22;">args</span><span style="color: #6276ba;">[</span>0<span style="color: #6276ba;">]</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">n</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
<span class="linenr">15: </span>            <span style="color: #709870;">{</span>
<span class="linenr">16: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#21435;&#36755;&#20837;&#27491;&#30830;&#30340;&#26684;&#24335;&#65306;Tax &#31246;&#21069;&#25910;&#20837;"</span><span style="color: #907373;">)</span>;
<span class="linenr">17: </span>                <span style="color: #a020f0;">return</span>;
<span class="linenr">18: </span>            <span style="color: #709870;">}</span>
<span class="linenr">19: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>n &lt; 5000<span style="color: #709870;">)</span>
<span class="linenr">20: </span>            <span style="color: #709870;">{</span>
<span class="linenr">21: </span>                <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax1</span> = n;
<span class="linenr">22: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;&#65306;{n,10:c}"</span><span style="color: #907373;">)</span>;
<span class="linenr">23: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#20132;&#31246;/&#31246;&#29575;&#65306;{0,10:c}({0:p})"</span><span style="color: #907373;">)</span>;
<span class="linenr">24: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #6276ba;">(</span>30, <span style="color: #8b2252;">'-'</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>;
<span class="linenr">25: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#23454;&#21457;&#24037;&#36164;&#65306;{n:c}"</span><span style="color: #907373;">)</span>;
<span class="linenr">26: </span>            <span style="color: #709870;">}</span>
<span class="linenr">27: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>n &lt; 10000<span style="color: #709870;">)</span>
<span class="linenr">28: </span>            <span style="color: #709870;">{</span>
<span class="linenr">29: </span>                <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax2</span> = <span style="color: #907373;">(</span>n - 5000<span style="color: #907373;">)</span> * a;
<span class="linenr">30: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;&#65306;{n, 10:c}"</span><span style="color: #907373;">)</span>;
<span class="linenr">31: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#20132;&#31246;/&#31246;&#29575;&#65306;{tax2,10:c}({a:p})"</span><span style="color: #907373;">)</span>;
<span class="linenr">32: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #6276ba;">(</span>30, <span style="color: #8b2252;">'-'</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>;
<span class="linenr">33: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#23454;&#21457;&#24037;&#36164;&#65306;{n - tax2:c}"</span><span style="color: #907373;">)</span>;
<span class="linenr">34: </span>            <span style="color: #709870;">}</span>
<span class="linenr">35: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>n &lt; 20000<span style="color: #709870;">)</span>
<span class="linenr">36: </span>            <span style="color: #709870;">{</span>
<span class="linenr">37: </span>                <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax3</span> = <span style="color: #907373;">(</span>n - 10000<span style="color: #907373;">)</span> * b + 5000 * a;
<span class="linenr">38: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;&#65306;{n,10:c}"</span><span style="color: #907373;">)</span>;
<span class="linenr">39: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#20132;&#31246;/&#31246;&#29575;&#65306;{tax3,10:c}({b:p})"</span><span style="color: #907373;">)</span>;
<span class="linenr">40: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #6276ba;">(</span>30, <span style="color: #8b2252;">'-'</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>;
<span class="linenr">41: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#23454;&#21457;&#24037;&#36164;&#65306;{n - tax3:c}"</span><span style="color: #907373;">)</span>;
<span class="linenr">42: </span>            <span style="color: #709870;">}</span>
<span class="linenr">43: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>n &lt; 100000<span style="color: #709870;">)</span>
<span class="linenr">44: </span>            <span style="color: #709870;">{</span>
<span class="linenr">45: </span>                <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax4</span> = <span style="color: #907373;">(</span>n - 20000<span style="color: #907373;">)</span> * c + 10000 * b + 5000 * a;
<span class="linenr">46: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;&#65306;{n,10:c}"</span><span style="color: #907373;">)</span>;
<span class="linenr">47: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#20132;&#31246;/&#31246;&#29575;&#65306;{tax4,10:c}({c:p})"</span><span style="color: #907373;">)</span>;
<span class="linenr">48: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #6276ba;">(</span>30, <span style="color: #8b2252;">'-'</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>;
<span class="linenr">49: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#23454;&#21457;&#24037;&#36164;&#65306;{n - tax4:c}"</span><span style="color: #907373;">)</span>;
<span class="linenr">50: </span>            <span style="color: #709870;">}</span>
<span class="linenr">51: </span>
<span class="linenr">52: </span>            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>n &gt; 100000<span style="color: #709870;">)</span>
<span class="linenr">53: </span>            <span style="color: #709870;">{</span>
<span class="linenr">54: </span>                <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax6</span> = <span style="color: #907373;">(</span>n - 100000<span style="color: #907373;">)</span> * d + 80000 * c + 10000 * b + 5000 * a;
<span class="linenr">55: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;&#65306;{n,   10:c}"</span><span style="color: #907373;">)</span>;
<span class="linenr">56: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#20132;&#31246;/&#31246;&#29575;&#65306;{tax6,10:c}({d:p})"</span><span style="color: #907373;">)</span>;
<span class="linenr">57: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #6276ba;">(</span>30, <span style="color: #8b2252;">'-'</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>;
<span class="linenr">58: </span>                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#23454;&#21457;&#24037;&#36164;&#65306;{n - tax6:c}"</span><span style="color: #907373;">)</span>;
<span class="linenr">59: </span>            <span style="color: #709870;">}</span>
<span class="linenr">60: </span>        <span style="color: #909183;">}</span>
<span class="linenr">61: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">62: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd09fb09" class="outline-3">
<h3 id="orgd09fb09"><span class="section-number-3">8.2.</span> 原始版本的批注</h3>
<div class="outline-text-3" id="text-8-2">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">Tax</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21464;&#37327;&#30340;&#21629;&#21517;&#19981;&#35201;&#22826;&#38543;&#24847;!</span>
            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">a</span> = 0.03;
            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">b</span> = 0.05;
            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">c</span> = 0.2;
            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">d</span> = 0.45;

            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">n</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31246;&#21069;&#25910;&#20837;</span>

            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>args.Length != 1 || !<span style="color: #228b22;">double</span>.<span style="color: #0000ff;">TryParse</span><span style="color: #907373;">(</span><span style="color: #228b22;">args</span><span style="color: #6276ba;">[</span>0<span style="color: #6276ba;">]</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">n</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#21435;&#36755;&#20837;&#27491;&#30830;&#30340;&#26684;&#24335;&#65306;Tax &#24212;&#21457;&#24037;&#36164;"</span><span style="color: #907373;">)</span>;
                <span style="color: #a020f0;">return</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">else &#27809;&#26377;&#24517;&#35201;</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>n &lt; 5000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax1</span> = n; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27492;&#21464;&#37327;&#30340;&#24847;&#20041;? &#20195;&#30721;&#28151;&#28102;</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#21457;&#24037;&#36164;&#65306;{n,10:c}"</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#20132;&#31246;/&#31246;&#29575;&#65306;{0,10:c}({0:p})"</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #6276ba;">(</span>30, <span style="color: #8b2252;">'-'</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#23454;&#21457;&#24037;&#36164;&#65306;{n:c}"</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>n &lt; 10000<span style="color: #709870;">)</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38544;&#34255;&#24847;&#24605; 1w &gt; n &gt;= 5k</span>
            <span style="color: #709870;">{</span>
                <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax2</span> = <span style="color: #907373;">(</span>n - 5000<span style="color: #907373;">)</span> * a; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35835;&#21040;&#36825;&#37324;&#65292;&#25165;&#30693;&#26195; a &#34920;&#31034;&#31246;&#29575;</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#21457;&#24037;&#36164;&#65306;{n,10:c}"</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#20132;&#31246;/&#31246;&#29575;&#65306;{tax2,10:c}({a:p})"</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #6276ba;">(</span>30, <span style="color: #8b2252;">'-'</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#23454;&#21457;&#24037;&#36164;&#65306;{n - tax2:c}"</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>n &lt; 20000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">&#19968;&#23450;&#35201;&#21892;&#20110;&#27169;&#20223;&#12289;&#23665;&#23528;&#12289;&#25220;&#34989;&#65292;&#24635;&#20043; C-c/C-v</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27169;&#20223;&#24182;&#19981;&#21487;&#32827;&#65292;&#21487;&#32827;&#30340;&#26159;&#65292;&#38271;&#24180;&#32047;&#26376;&#65292;&#27809;&#26377;&#20219;&#20309;&#36827;&#27493;</span>
                <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax3</span> = <span style="color: #907373;">(</span>n - 10000<span style="color: #907373;">)</span> * b + 5000 * a;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#21457;&#24037;&#36164;&#65306;{n,10:c}"</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#20132;&#31246;/&#31246;&#29575;&#65306;{tax3,10:c}({b:p})"</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #6276ba;">(</span>30, <span style="color: #8b2252;">'-'</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#23454;&#21457;&#24037;&#36164;&#65306;{n - tax3:c}"</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>n &lt; 100000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax4</span> = <span style="color: #907373;">(</span>n - 20000<span style="color: #907373;">)</span> * c + 10000 * b + 5000 * a;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#21457;&#24037;&#36164;&#65306;{n,10:c}"</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#20132;&#31246;/&#31246;&#29575;&#65306;{tax4,10:c}({c:p})"</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #6276ba;">(</span>30, <span style="color: #8b2252;">'-'</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#23454;&#21457;&#24037;&#36164;&#65306;{n - tax4:c}"</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>n &gt; 100000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20887;&#20313;&#20195;&#30721;&#22826;&#22810;&#20102;&#65292;&#27809;&#24517;&#35201;&#30340;&#20887;&#20313;&#20250;&#23548;&#33268;:</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">- &#24320;&#21457;&#36215;&#26469;&#65292;&#33457;&#36153;&#26102;&#38388;&#22826;&#22810;</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">- &#38405;&#35835;&#36215;&#26469;&#65292;&#19981;&#26159;&#37027;&#20040;&#21451;&#22909;</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">- &#32500;&#25252;&#36215;&#26469;&#65292;&#36234;&#26469;&#36234;&#40635;&#28902; (shi&#23665;)</span>
                <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax6</span> = <span style="color: #907373;">(</span>n - 100000<span style="color: #907373;">)</span> * d + 80000 * c + 10000 * b + 5000 * a;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#21457;&#24037;&#36164;&#65306;{n,10:c}"</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#24212;&#20132;&#31246;/&#31246;&#29575;&#65306;{tax6,10:c}({d:p})"</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #6276ba;">(</span>30, <span style="color: #8b2252;">'-'</span><span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#23454;&#21457;&#24037;&#36164;&#65306;{n - tax6:c}"</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3e506ca" class="outline-3">
<h3 id="org3e506ca"><span class="section-number-3">8.3.</span> 第四组优化版</h3>
<div class="outline-text-3" id="text-8-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#21629;&#21517;&#35201;&#35268;&#33539; &#8800; &#21629;&#21517;&#24517;&#39035;&#20351;&#29992;&#33521;&#25991;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#27809;&#24517;&#35201;&#22240;&#20026;&#33521;&#25991;&#22833;&#21435;&#20102;&#32534;&#31243;&#30340;&#20449;&#24515;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#33021;&#21147;&#21487;&#20197;&#65292;&#20351;&#29992;&#33521;&#25991;&#26159;&#25512;&#33616;&#30340;&#65292;&#20294;&#26159;&#22914;&#26524;&#26377;&#20123;&#21507;&#21147;&#65292;&#25340;&#38899;&#20063;&#21487;&#20197;&#21834;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#24847;&#24605;&#26159;: &#22914;&#26524;&#33021;&#31359;&#21697;&#29260;&#20986;&#21435;&#33258;&#28982;&#22909;&#65292;&#20294;&#26159;&#27809;&#38065;&#30340;&#35805;&#65292;&#24178;&#24178;&#20928;&#20928;&#20063;&#19981;&#20002;&#20154;</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20889;&#20195;&#30721;&#65292;&#26368;&#37325;&#35201;&#30340;&#26159;&#26377;&#24605;&#36335;&#65292;&#20063;&#23601;&#26159;&#30693;&#36947;&#33258;&#24049;&#35201;&#20570;&#20160;&#20040;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#25105;&#20204;&#35201;&#20570;&#30340;&#20107;&#24773;&#26159;: &#35745;&#31639;&#31246;&#21518;&#25910;&#20837;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">- &#31532;&#19968;&#27493;&#65292;&#25509;&#25910;&#31246;&#21069;&#25910;&#20837;&#30340;&#37329;&#39069;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">- &#31532;&#20108;&#27493;&#65292;&#25353;&#29031; [ &#31246;&#25910; = &#31246;&#21069;&#25910;&#20837; * &#24688;&#24403;&#30340;&#31246;&#29575; ] &#30340;&#26041;&#24335;&#35745;&#31639;&#31246;&#29575;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">- &#31532;&#19977;&#27493;&#65292;&#36890;&#36807; [ &#31246;&#21518;&#25910;&#20837; = &#31246;&#21069;&#25910;&#20837; - &#31246;&#25910; ] &#30340;&#26041;&#24335;&#35745;&#31639;&#31246;&#21518;&#25910;&#20837;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">- &#26368;&#21518;&#65292;&#33457;&#26679;&#36755;&#20986;</span>

<span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">Tax</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">slv</span>;   <span style="color: #b22222;">//</span><span style="color: #b22222;">&#31246;&#29575;</span>
            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">ynsk</span>;  <span style="color: #b22222;">//</span><span style="color: #b22222;">&#24212;&#32435;&#31246;&#27454;</span>
            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">gongzi</span>; <span style="color: #b22222;">//</span><span style="color: #b22222;">&#24037;&#36164;</span>

            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>args.Length != 1 || !<span style="color: #228b22;">double</span>.<span style="color: #0000ff;">TryParse</span><span style="color: #907373;">(</span><span style="color: #228b22;">args</span><span style="color: #6276ba;">[</span>0<span style="color: #6276ba;">]</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">gongzi</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#21435;&#36755;&#20837;&#27491;&#30830;&#30340;&#26684;&#24335;&#65306;Tax &#31246;&#21069;&#25910;&#20837;"</span><span style="color: #907373;">)</span>;
                <span style="color: #a020f0;">return</span>;
            <span style="color: #709870;">}</span>

            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>gongzi &lt; 10000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                slv = 0.03;
                ynsk = <span style="color: #907373;">(</span>gongzi - 5000<span style="color: #907373;">)</span> * slv;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>gongzi &lt; 20000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                slv = 0.05;
                ynsk = <span style="color: #907373;">(</span>gongzi - 5000<span style="color: #907373;">)</span> * slv;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>gongzi &lt; 100000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                slv = 0.2;
                ynsk = <span style="color: #907373;">(</span>gongzi - 5000<span style="color: #907373;">)</span> * slv;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span>
            <span style="color: #709870;">{</span>
                slv = 0.45;
                ynsk = <span style="color: #907373;">(</span>gongzi - 5000<span style="color: #907373;">)</span> * slv;
            <span style="color: #709870;">}</span>

            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;&#65306;{gongzi,5:c}"</span><span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#24212;&#20132;&#31246;/&#31246;&#29575;&#65306;{ynsk,5:c}({slv:p})"</span><span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #907373;">(</span>30, <span style="color: #8b2252;">'-'</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#24037;&#36164;&#65306;{ gongzi - ynsk,5:c}"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

</pre>
</div>
</div>
</div>

<div id="outline-container-orgf0945da" class="outline-3">
<h3 id="orgf0945da"><span class="section-number-3">8.4.</span> <b>分离</b> 计算跟输出，优化代码结构</h3>
<div class="outline-text-3" id="text-8-4">

<figure id="orgb57bb98">
<img src="img/tax-cal.png" alt="tax-cal.png">

</figure>
</div>
</div>


<div id="outline-container-orgf2eded1" class="outline-3">
<h3 id="orgf2eded1"><span class="section-number-3">8.5.</span> 通过 <b>方法</b> 对逻辑进行提取</h3>
<div class="outline-text-3" id="text-8-5">
<p>
将某些代码块单独 <b>分离</b> 出来，并用一个名字代表，这就是所谓的方法。
在原先执行代码块的地方，使用这个名字代替，这就是方法调用。
通过这种方法调用方式，将程序变成了结构式的了，方便了重用和维护。
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;

<span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">Tax</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#25509;&#25910;&#21442;&#25968;</span>
            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span>;
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>args.Length != 1 || !<span style="color: #228b22;">double</span>.<span style="color: #0000ff;">TryParse</span><span style="color: #907373;">(</span><span style="color: #228b22;">args</span><span style="color: #6276ba;">[</span>0<span style="color: #6276ba;">]</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">money</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#36755;&#20837;&#26377;&#35823;&#65292;&#27491;&#30830;&#30340;&#35843;&#29992;&#26041;&#27861;&#26159;:\nTaxCalculator &#31246;&#21069;&#25910;&#20837;"</span><span style="color: #907373;">)</span>;
                <span style="color: #a020f0;">return</span>;
            <span style="color: #709870;">}</span>

            <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#25353;&#29031;&#25509;&#25910;&#30340;&#21442;&#25968;&#36827;&#34892;&#35745;&#31639;</span>
            <span style="color: #228b22;">double</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">result</span> = <span style="color: #0000ff;">CalculateTax</span><span style="color: #709870;">(</span><span style="color: #228b22;">money</span><span style="color: #709870;">)</span>;

            <span style="color: #b22222;">// </span><span style="color: #b22222;">3. &#23545;&#32467;&#26524;&#36827;&#34892;&#36755;&#20986;</span>
            <span style="color: #0000ff;">PrintToConsole</span><span style="color: #709870;">(</span><span style="color: #228b22;">money</span>, <span style="color: #228b22;">result</span><span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>, <span style="color: #228b22;">result</span><span style="color: #907373;">[</span>1<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;

        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">static</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #0000ff;">CalculateTax</span><span style="color: #909183;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #228b22;">double</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #709870;">}</span>;
            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">rate</span>, <span style="color: #a0522d;">tax</span>;
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>money &lt;= 5000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                rate = 0;
                tax = 0;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>money &lt; 10000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                rate = rates<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
                tax = <span style="color: #907373;">(</span>money - 5000<span style="color: #907373;">)</span> * rate;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>money &lt; 20000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                rate = rates<span style="color: #907373;">[</span>1<span style="color: #907373;">]</span>;
                tax = <span style="color: #907373;">(</span>money - 10000<span style="color: #907373;">)</span> * rate + 5000 * rates<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>money &lt; 100000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                rate = rates<span style="color: #907373;">[</span>2<span style="color: #907373;">]</span>;
                tax = <span style="color: #907373;">(</span>money - 20000<span style="color: #907373;">)</span> * rate + 10000 * rates<span style="color: #907373;">[</span>1<span style="color: #907373;">]</span> + 5000 * rates<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span>
            <span style="color: #709870;">{</span>
                rate = rates<span style="color: #907373;">[</span>3<span style="color: #907373;">]</span>;
                tax = <span style="color: #907373;">(</span>money - 100000<span style="color: #907373;">)</span> * rate + 80000 * rates<span style="color: #907373;">[</span>2<span style="color: #907373;">]</span> + 10000 * rates<span style="color: #907373;">[</span>1<span style="color: #907373;">]</span> + 5000 * rates<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> rate, tax <span style="color: #709870;">}</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">rate</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">()</span>;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {money,10:C}"</span><span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {tax,10:C} ({rate:P1})"</span><span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #907373;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {money - tax,10:C}"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org427d6c5" class="outline-3">
<h3 id="org427d6c5"><span class="section-number-3">8.6.</span> 通过 <b>类</b> 对代码逻辑进行进一步分离</h3>
<div class="outline-text-3" id="text-8-6">
<p>
方法越来越多，需要按照功能进行分门别类。这样就更具备组织性了。
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#25509;&#25910;&#21442;&#25968;</span>
        <span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args.Length != 1 || !<span style="color: #228b22;">double</span>.<span style="color: #0000ff;">TryParse</span><span style="color: #709870;">(</span><span style="color: #228b22;">args</span><span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">money</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#36755;&#20837;&#26377;&#35823;&#65292;&#27491;&#30830;&#30340;&#35843;&#29992;&#26041;&#27861;&#26159;:\nTaxCalculator &#31246;&#21069;&#25910;&#20837;"</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31246;&#25910;&#30340;&#35745;&#31639;</span>
        <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">result</span> = TaxCal.<span style="color: #0000ff;">CalculateTax</span><span style="color: #909183;">(</span><span style="color: #228b22;">money</span><span style="color: #909183;">)</span>;
        TaxCal.<span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">(</span><span style="color: #228b22;">money</span>, <span style="color: #228b22;">result</span><span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>, <span style="color: #228b22;">result</span><span style="color: #709870;">[</span>1<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;
        TaxCal.<span style="color: #0000ff;">ExportToExcel</span><span style="color: #909183;">(</span><span style="color: #228b22;">money</span>, <span style="color: #228b22;">result</span><span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>, <span style="color: #228b22;">result</span><span style="color: #709870;">[</span>1<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCal</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #0000ff;">CalculateTax</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #909183;">}</span>;
        <span style="color: #228b22;">double</span> <span style="color: #a0522d;">rate</span>, <span style="color: #a0522d;">tax</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>money &lt;= 5000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            rate = 0;
            tax = 0;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>money &lt; 10000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            rate = rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
            tax = <span style="color: #709870;">(</span>money - 5000<span style="color: #709870;">)</span> * rate;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>money &lt; 20000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            rate = rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
            tax = <span style="color: #709870;">(</span>money - 10000<span style="color: #709870;">)</span> * rate + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>money &lt; 100000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            rate = rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
            tax = <span style="color: #709870;">(</span>money - 20000<span style="color: #709870;">)</span> * rate + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            rate = rates<span style="color: #709870;">[</span>3<span style="color: #709870;">]</span>;
            tax = <span style="color: #709870;">(</span>money - 100000<span style="color: #709870;">)</span> * rate + 80000 * rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span> + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span>rate, tax<span style="color: #909183;">}</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">rate</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {tax,10:C} ({rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {money - tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">rate</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#31246;&#21069;&#25910;&#20837;: {money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#24212;&#20184;&#31246;&#25910;: {tax,10:C} ({rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#31246;&#21518;&#25910;&#20837;: {money - tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCalculator</span> <span style="color: #707183;">{</span> ... <span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PowerFeeCalculator</span> <span style="color: #707183;">{</span> ... <span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org64c0722" class="outline-3">
<h3 id="org64c0722"><span class="section-number-3">8.7.</span> 让类中的各个方法，能 <b>共享数据</b></h3>
<div class="outline-text-3" id="text-8-7">
<p>
在类中定义变量缓存每次方法调用的中间结果，下一个方法调用也可以直接使用这些缓存的结果。
这样，方法调用间就产生了关联，调用的时候不需要传递那么多参数。
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#25509;&#25910;&#21442;&#25968;</span>
        <span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args.Length != 1 || !<span style="color: #228b22;">double</span>.<span style="color: #0000ff;">TryParse</span><span style="color: #709870;">(</span><span style="color: #228b22;">args</span><span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">money</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#36755;&#20837;&#26377;&#35823;&#65292;&#27491;&#30830;&#30340;&#35843;&#29992;&#26041;&#27861;&#26159;:\nTaxCalculator &#31246;&#21069;&#25910;&#20837;"</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31246;&#25910;&#30340;&#35745;&#31639;</span>
        TaxCal.money = money;
        TaxCal.<span style="color: #0000ff;">CalculateTax</span><span style="color: #909183;">()</span>;
        TaxCal.<span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>;
        TaxCal.<span style="color: #0000ff;">ExportToExcel</span><span style="color: #909183;">()</span>;

        TaxCal.money = 23232;
        TaxCal.<span style="color: #0000ff;">CalculateTax</span><span style="color: #909183;">()</span>;
        TaxCal.<span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCal</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span>;
    <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">rate</span>;
    <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax</span>;

    <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CalculateTax</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #909183;">}</span>;
        <span style="color: #b22222;">//</span><span style="color: #b22222;">double rate, tax;</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>money &lt;= 5000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            rate = 0;
            tax = 0;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>money &lt; 10000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            rate = rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
            tax = <span style="color: #709870;">(</span>money - 5000<span style="color: #709870;">)</span> * rate;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>money &lt; 20000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            rate = rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
            tax = <span style="color: #709870;">(</span>money - 10000<span style="color: #709870;">)</span> * rate + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>money &lt; 100000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            rate = rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
            tax = <span style="color: #709870;">(</span>money - 20000<span style="color: #709870;">)</span> * rate + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            rate = rates<span style="color: #709870;">[</span>3<span style="color: #709870;">]</span>;
            tax = <span style="color: #709870;">(</span>money - 100000<span style="color: #709870;">)</span> * rate + 80000 * rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span> + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {tax,10:C} ({rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {money - tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#31246;&#21069;&#25910;&#20837;: {money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#24212;&#20184;&#31246;&#25910;: {tax,10:C} ({rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#31246;&#21518;&#25910;&#20837;: {money - tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0c46169" class="outline-3">
<h3 id="org0c46169"><span class="section-number-3">8.8.</span> 引入 <b>对象</b> 保证调用的数据安全</h3>
<div class="outline-text-3" id="text-8-8">
<p>
引入独立的存储空间，将方法共享的数据进行隔离:
</p>


<figure id="org1041a89">
<img src="img/tax-cal3.png" alt="tax-cal3.png" width="400">

</figure>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#25509;&#25910;&#21442;&#25968;</span>
        <span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args.Length != 1 || !<span style="color: #228b22;">double</span>.<span style="color: #0000ff;">TryParse</span><span style="color: #709870;">(</span><span style="color: #228b22;">args</span><span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">money</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#36755;&#20837;&#26377;&#35823;&#65292;&#27491;&#30830;&#30340;&#35843;&#29992;&#26041;&#27861;&#26159;:\nTaxCalculator &#31246;&#21069;&#25910;&#20837;"</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #228b22;">TaxCal</span> <span style="color: #a0522d;">tc1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TaxCal</span><span style="color: #909183;">()</span>;
        tc1.money = money;
        tc1.<span style="color: #0000ff;">CalculateTax</span><span style="color: #909183;">()</span>;
        tc1.<span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>;

        <span style="color: #228b22;">TaxCal</span> <span style="color: #a0522d;">tc2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TaxCal</span><span style="color: #909183;">()</span>;
        tc2.money = 33333;
        tc2.<span style="color: #0000ff;">CalculateTax</span><span style="color: #909183;">()</span>;
        tc2.<span style="color: #0000ff;">ExportToExcel</span><span style="color: #909183;">()</span>;

        tc1.<span style="color: #0000ff;">ExportToExcel</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCal</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">rate</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tax</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CalculateTax</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #909183;">}</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>money &lt;= 5000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            rate = 0;
            tax = 0;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>money &lt; 10000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            rate = rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
            tax = <span style="color: #709870;">(</span>money - 5000<span style="color: #709870;">)</span> * rate;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>money &lt; 20000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            rate = rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
            tax = <span style="color: #709870;">(</span>money - 10000<span style="color: #709870;">)</span> * rate + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>money &lt; 100000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            rate = rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
            tax = <span style="color: #709870;">(</span>money - 20000<span style="color: #709870;">)</span> * rate + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            rate = rates<span style="color: #709870;">[</span>3<span style="color: #709870;">]</span>;
            tax = <span style="color: #709870;">(</span>money - 100000<span style="color: #709870;">)</span> * rate + 80000 * rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span> + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {tax,10:C} ({rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {money - tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#31246;&#21069;&#25910;&#20837;: {money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#24212;&#20184;&#31246;&#25910;: {tax,10:C} ({rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#31246;&#21518;&#25910;&#20837;: {money - tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org99be013" class="outline-3">
<h3 id="org99be013"><span class="section-number-3">8.9.</span> 通过 [private Field + public Method] 的方式，*保护数据* 安全</h3>
<div class="outline-text-3" id="text-8-9">
<p>
面向对象的数据的封装 (数据的安全):
</p>
<ul class="org-ul">
<li>对象是按照类的模板创建的包含了若干数据的一段存储空间</li>
<li>后续的方法调用都是基于对象的这片存储空间的</li>
<li>因此，我们需要通过一定手段对对象里的数据进行相关的访问保护</li>
<li>通用手段是提供了 private/public/protected 访问权限修饰符
<ul class="org-ul">
<li>如果修饰为 private 的话，那么字段的数据从外部是禁止访问的 (不读、不写)</li>
<li>如果修饰为 public 的话，那么字段的数据从外部是可以无限制访问的 (读、写)</li>
<li>默认的修饰符为 private，也就是如果不添加任何修饰符的话，默认是不读、不写</li>
</ul></li>
<li>当然，有时候，我们需要对一些数据或方法有特殊的要求，比如只读或只写:
<ul class="org-ul">
<li>只读: 1) 将字段设置为 private 2) 创建一个 public 的方法，这个方法能够间接返回字段的值</li>
<li>只写: 1) 将字段设置为 private 2) 创建一个 public 的方法，在这个方法中可以为字段赋值</li>
<li>可控的读跟写: 1) 将字段设为 private 2) 创建两个方法，一个用来读 (Get)，一个用来写 (Set)</li>
</ul></li>
</ul>


<figure id="org82da9ad">
<img src="img/tax-cal2.png" alt="tax-cal2.png" width="400">

</figure>


<p>
于是，上述的这种模式，*private 字段 + public 方法*，成为了一种标准的编程实践:
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args.Length != 1 || !<span style="color: #228b22;">double</span>.<span style="color: #0000ff;">TryParse</span><span style="color: #709870;">(</span><span style="color: #228b22;">args</span><span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">money</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#36755;&#20837;&#26377;&#35823;&#65292;&#27491;&#30830;&#30340;&#35843;&#29992;&#26041;&#27861;&#26159;:\nTaxCalculator &#31246;&#21069;&#25910;&#20837;"</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #228b22;">TaxCal</span> <span style="color: #a0522d;">tc1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TaxCal</span><span style="color: #909183;">()</span>;
        tc1.<span style="color: #0000ff;">SetMoney</span><span style="color: #909183;">(</span>8000<span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>tc1.<span style="color: #0000ff;">GetMoney</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;

        tc1.<span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>;
        tc1.<span style="color: #0000ff;">ExportToExcel</span><span style="color: #909183;">()</span>;
        tc1.<span style="color: #0000ff;">SetMoney</span><span style="color: #909183;">(</span>333333333<span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&gt;&gt;&gt; {0}"</span>, tc1.<span style="color: #0000ff;">GetRate</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCal</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Money</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Rate</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Tax</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetMoney</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> Money;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SetMoney</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">duoshao</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>duoshao &lt; 0<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"\n&#21442;&#25968;&#36755;&#20837;&#26684;&#24335;&#19981;&#27491;&#30830;&#65281;"</span><span style="color: #709870;">)</span>;
            Environment.<span style="color: #0000ff;">Exit</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        Money = duoshao;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetTax</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #0000ff;">CalculateTax</span><span style="color: #909183;">()</span>;
        <span style="color: #a020f0;">return</span> Tax;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetRate</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #0000ff;">CalculateTax</span><span style="color: #909183;">()</span>;
        <span style="color: #a020f0;">return</span> Rate;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CalculateTax</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #909183;">}</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt;= 5000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = 0;
            Tax = 0;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 10000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 5000<span style="color: #709870;">)</span> * Rate;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 20000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 10000<span style="color: #709870;">)</span> * Rate + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 100000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 20000<span style="color: #709870;">)</span> * Rate + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>3<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 100000<span style="color: #709870;">)</span> * Rate + 80000 * rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span> + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #0000ff;">CalculateTax</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #0000ff;">CalculateTax</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcab3e20" class="outline-3">
<h3 id="orgcab3e20"><span class="section-number-3">8.10.</span> 减少代码冗余，*Lazy* and <b>Eager</b></h3>
<div class="outline-text-3" id="text-8-10">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args.Length != 1 || !<span style="color: #228b22;">double</span>.<span style="color: #0000ff;">TryParse</span><span style="color: #709870;">(</span><span style="color: #228b22;">args</span><span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">money</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#36755;&#20837;&#26377;&#35823;&#65292;&#27491;&#30830;&#30340;&#35843;&#29992;&#26041;&#27861;&#26159;:\nTaxCalculator &#31246;&#21069;&#25910;&#20837;"</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #228b22;">TaxCal</span> <span style="color: #a0522d;">tc1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TaxCal</span><span style="color: #909183;">()</span>;
        tc1.<span style="color: #0000ff;">SetMoney</span><span style="color: #909183;">(</span><span style="color: #228b22;">money</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>tc1.<span style="color: #0000ff;">GetTax</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
        tc1.<span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCal</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Money</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Rate</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Tax</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetMoney</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> Money;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SetMoney</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">duoshao</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>duoshao &lt; 0<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"\n&#21442;&#25968;&#36755;&#20837;&#26684;&#24335;&#19981;&#27491;&#30830;&#65281;"</span><span style="color: #709870;">)</span>;
            Environment.<span style="color: #0000ff;">Exit</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        Money = duoshao;
        <span style="color: #0000ff;">CalculateTax</span><span style="color: #909183;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26356;&#26032;&#23545;&#35937;&#20013;&#30340; Tax &#21644; Rate</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetRate</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> Rate;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetTax</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> Tax;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CalculateTax</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #909183;">}</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt;= 5000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = 0;
            Tax = 0;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 10000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 5000<span style="color: #709870;">)</span> * Rate;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 20000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 10000<span style="color: #709870;">)</span> * Rate + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 100000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 20000<span style="color: #709870;">)</span> * Rate + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>3<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 100000<span style="color: #709870;">)</span> * Rate + 80000 * rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span> + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCalLazy</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Money</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetMoney</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> Money;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SetMoney</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">duoshao</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>duoshao &lt; 0<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"\n&#21442;&#25968;&#36755;&#20837;&#26684;&#24335;&#19981;&#27491;&#30830;&#65281;"</span><span style="color: #709870;">)</span>;
            Environment.<span style="color: #0000ff;">Exit</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        Money = duoshao;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetTax</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #909183;">}</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt;= 5000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> 0;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 10000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> <span style="color: #709870;">(</span>Money - 5000<span style="color: #709870;">)</span> * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 20000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> <span style="color: #709870;">(</span>Money - 10000<span style="color: #709870;">)</span> * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 100000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> <span style="color: #709870;">(</span>Money - 20000<span style="color: #709870;">)</span> * rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span> + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> <span style="color: #709870;">(</span>Money - 100000<span style="color: #709870;">)</span> * rates<span style="color: #709870;">[</span>3<span style="color: #709870;">]</span> + 80000 * rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span> + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetRate</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #909183;">}</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt;= 5000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> 0;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 10000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 20000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 100000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> rates<span style="color: #709870;">[</span>3<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {GetTax(),10:C} ({GetRate():P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - GetTax(),10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#24212;&#20184;&#31246;&#25910;: {GetTax(),10:C} ({GetRate():P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excel&#36755;&#20986;&#31246;&#21518;&#25910;&#20837;: {Money - GetTax(),10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1c6173a" class="outline-3">
<h3 id="org1c6173a"><span class="section-number-3">8.11.</span> 来自语法糖的力量: 通过 <b>Property</b> 简化代码</h3>
<div class="outline-text-3" id="text-8-11">
</div>
<div id="outline-container-org814f8da" class="outline-4">
<h4 id="org814f8da"><span class="section-number-4">8.11.1.</span> Eager Version</h4>
<div class="outline-text-4" id="text-8-11-1">

<div  class='mc11'>
<div>
<p>

</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCal</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Money</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Rate</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Tax</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetMoney</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> Money;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SetMoney</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">duoshao</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>duoshao &lt; 0<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"\n&#21442;&#25968;&#36755;&#20837;&#26684;&#24335;&#19981;&#27491;&#30830;&#65281;"</span><span style="color: #709870;">)</span>;
            Environment.<span style="color: #0000ff;">Exit</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        Money = duoshao;
        <span style="color: #0000ff;">CalculateTax</span><span style="color: #909183;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26356;&#26032;&#23545;&#35937;&#20013;&#30340; Tax &#21644; Rate</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetRate</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> Rate;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetTax</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> Tax;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CalculateTax</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]{</span>0.03, 0.05, 0.2, 0.45<span style="color: #909183;">}</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt;= 5000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = 0;
            Tax = 0;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 10000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 5000<span style="color: #709870;">)</span> * Rate;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 20000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 10000<span style="color: #709870;">)</span> * Rate ...;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 100000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 20000<span style="color: #709870;">)</span> * Rate ...;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>3<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 100000<span style="color: #709870;">)</span> * Rate ...;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>

</div>
<div>

</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCal</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">_money</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#29992;&#26469;&#25215;&#36733;&#21518;&#38754;&#30340;&#25968;&#25454;&#65292;&#31246;&#21069;&#25910;&#20837;</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Money</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">get</span> <span style="color: #909183;">{</span> <span style="color: #a020f0;">return</span> _money; <span style="color: #909183;">}</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">xxxx.Money</span>
        <span style="color: #a020f0;">set</span>                    <span style="color: #b22222;">// </span><span style="color: #b22222;">xxxx.Money = 3333;</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span><span style="color: #008b8b;">value</span> &lt; 0<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"\n&#21442;&#25968;&#36755;&#20837;&#26684;&#24335;&#19981;&#27491;&#30830;&#65281;"</span><span style="color: #907373;">)</span>;
                Environment.<span style="color: #0000ff;">Exit</span><span style="color: #907373;">(</span>0<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
            _money = <span style="color: #008b8b;">value</span>;
            <span style="color: #0000ff;">CalculateTax</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Rate</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Tax</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CalculateTax</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #909183;">}</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt;= 5000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = 0;
            Tax = 0;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 10000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 5000<span style="color: #709870;">)</span> * Rate;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 20000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 10000<span style="color: #709870;">)</span> * Rate + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 100000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 20000<span style="color: #709870;">)</span> * Rate + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>3<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 100000<span style="color: #709870;">)</span> * Rate + 80000 * rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span> + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

</div>

</div>
</div>
</div>

<div id="outline-container-org9f3915f" class="outline-4">
<h4 id="org9f3915f"><span class="section-number-4">8.11.2.</span> Lazy Version</h4>
<div class="outline-text-4" id="text-8-11-2">

<div  class='mc11'>
<div>
<p>

</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCalLazy</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Money</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetMoney</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> Money;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">SetMoney</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">duoshao</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>duoshao &lt; 0<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"\n&#21442;&#25968;&#36755;&#20837;&#26684;&#24335;&#19981;&#27491;&#30830;&#65281;"</span><span style="color: #709870;">)</span>;
            Environment.<span style="color: #0000ff;">Exit</span><span style="color: #709870;">(</span>0<span style="color: #709870;">)</span>;

        <span style="color: #909183;">}</span>
        Money = duoshao;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetTax</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]{</span>0.03, 0.05, 0.2, 0.45<span style="color: #909183;">}</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt;= 5000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> 0;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 10000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> <span style="color: #709870;">(</span>Money - 5000<span style="color: #709870;">)</span> * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 20000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> <span style="color: #709870;">(</span>Money - 10000<span style="color: #709870;">)</span> * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + ...;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 100000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> <span style="color: #709870;">(</span>Money - 20000<span style="color: #709870;">)</span> * rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span> + ...;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> <span style="color: #709870;">(</span>Money - 100000<span style="color: #709870;">)</span> * rates<span style="color: #709870;">[</span>3<span style="color: #709870;">]</span> + ...;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetRate</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #909183;">}</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt;= 5000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> 0;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 10000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 20000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 100000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> rates<span style="color: #709870;">[</span>3<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {GetTax(),10:C} ({GetRate():P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - GetTax(),10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {GetTax(),10:C} ({GetRate():P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - GetTax(),10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

</pre>
</div>

<p>

</div>
<div>

</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCalLazy</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">_money</span>;
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Money</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">get</span> <span style="color: #909183;">{</span> <span style="color: #a020f0;">return</span> _money; <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">set</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span><span style="color: #008b8b;">value</span> &lt; 0<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"\n&#21442;&#25968;&#36755;&#20837;&#26684;&#24335;&#19981;&#27491;&#30830;&#65281;"</span><span style="color: #907373;">)</span>;
                Environment.<span style="color: #0000ff;">Exit</span><span style="color: #907373;">(</span>0<span style="color: #907373;">)</span>;

            <span style="color: #709870;">}</span>
            _money = <span style="color: #008b8b;">value</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Tax</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">get</span>
        <span style="color: #909183;">{</span>
            <span style="color: #228b22;">double</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #709870;">}</span>;
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>Money &lt;= 5000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">return</span> 0;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>Money &lt; 10000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">return</span> <span style="color: #907373;">(</span>Money - 5000<span style="color: #907373;">)</span> * rates<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>Money &lt; 20000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">return</span> <span style="color: #907373;">(</span>Money - 10000<span style="color: #907373;">)</span> * rates<span style="color: #907373;">[</span>1<span style="color: #907373;">]</span> + 5000 * rates<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>Money &lt; 100000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">return</span> <span style="color: #907373;">(</span>Money - 20000<span style="color: #907373;">)</span> * rates<span style="color: #907373;">[</span>2<span style="color: #907373;">]</span> + 10000 * rates<span style="color: #907373;">[</span>1<span style="color: #907373;">]</span> + 5000 * rates<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">return</span> <span style="color: #907373;">(</span>Money - 100000<span style="color: #907373;">)</span> * rates<span style="color: #907373;">[</span>3<span style="color: #907373;">]</span> + 80000 * rates<span style="color: #907373;">[</span>2<span style="color: #907373;">]</span> + 10000 * rates<span style="color: #907373;">[</span>1<span style="color: #907373;">]</span> + 5000 * rates<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Rate</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">get</span>
        <span style="color: #909183;">{</span>
            <span style="color: #228b22;">double</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #709870;">}</span>;
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>Money &lt;= 5000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">return</span> 0;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>Money &lt; 10000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">return</span> rates<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>Money &lt; 20000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">return</span> rates<span style="color: #907373;">[</span>1<span style="color: #907373;">]</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>Money &lt; 100000<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">return</span> rates<span style="color: #907373;">[</span>2<span style="color: #907373;">]</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">else</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">return</span> rates<span style="color: #907373;">[</span>3<span style="color: #907373;">]</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

</div>

</div>
</div>
</div>
</div>

<div id="outline-container-orge446b07" class="outline-3">
<h3 id="orge446b07"><span class="section-number-3">8.12.</span> 使用 <b>Constructor</b> 进行对象的个性化构建</h3>
<div class="outline-text-3" id="text-8-12">
<p>
使用构造方法，让对象在创建的时候，进行必要的初始化工作。
</p>

<p>
每个类都需要有构造方法，构造方法就是一种特殊的方法:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCal</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">TaxCal</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Money = money;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">_money</span>;
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Money</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">get</span> <span style="color: #909183;">{</span> <span style="color: #a020f0;">return</span> _money; <span style="color: #909183;">}</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">xxxx.Money</span>
        <span style="color: #a020f0;">set</span>                    <span style="color: #b22222;">// </span><span style="color: #b22222;">xxxx.Money = 3333;</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span><span style="color: #008b8b;">value</span> &lt; 0<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"\n&#21442;&#25968;&#36755;&#20837;&#26684;&#24335;&#19981;&#27491;&#30830;&#65281;"</span><span style="color: #907373;">)</span>;
                Environment.<span style="color: #0000ff;">Exit</span><span style="color: #907373;">(</span>0<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
            _money = <span style="color: #008b8b;">value</span>;
            <span style="color: #0000ff;">CalculateTax</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Rate</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Tax</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CalculateTax</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #909183;">}</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt;= 5000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = 0;
            Tax = 0;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 10000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 5000<span style="color: #709870;">)</span> * Rate;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 20000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 10000<span style="color: #709870;">)</span> * Rate + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 100000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 20000<span style="color: #709870;">)</span> * Rate + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>3<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 100000<span style="color: #709870;">)</span> * Rate + 80000 * rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span> + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">t</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TaxCal</span><span style="color: #909183;">(</span>20000<span style="color: #909183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24517;&#39035;&#20351;&#29992;&#24102;&#21442;&#25968;&#30340;&#26500;&#36896;&#22120;&#36827;&#34892;&#21021;&#22987;&#21270;</span>
        t.<span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge51b682" class="outline-3">
<h3 id="orge51b682"><span class="section-number-3">8.13.</span> 使用 <b>static</b> 将某些数据归属于类，达到数据共享的目的</h3>
<div class="outline-text-3" id="text-8-13">
<p>
世界大势，合久必分，分久必合。使用对象将数据进行有效分离，使用 static 将某些数据归属于类，从而在实例间进行共享。
</p>

<p>
共享了就有被误操作的风险，所以，可以通过 const/readonly 保证字段不会被随意修改。
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span> <span style="color: #a0522d;">money</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args.Length != 1 || !<span style="color: #228b22;">double</span>.<span style="color: #0000ff;">TryParse</span><span style="color: #709870;">(</span><span style="color: #228b22;">args</span><span style="color: #907373;">[</span>0<span style="color: #907373;">]</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">money</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#36755;&#20837;&#26377;&#35823;&#65292;&#27491;&#30830;&#30340;&#35843;&#29992;&#26041;&#27861;&#26159;:\nTaxCalculator &#31246;&#21069;&#25910;&#20837;"</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #228b22;">TaxCal</span> <span style="color: #a0522d;">t</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TaxCal</span><span style="color: #909183;">(</span>22323<span style="color: #909183;">)</span>;
        t.<span style="color: #0000ff;">PrintToConsole</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">TaxCal</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">TaxCal</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">m</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Money = m;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">_money</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#29992;&#26469;&#25215;&#36733;&#21518;&#38754;&#30340;&#25968;&#25454;&#65292;&#31246;&#21069;&#25910;&#20837;</span>
    <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">rates</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span> 0.03, 0.05, 0.2, 0.45 <span style="color: #7388d6;">}</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Money</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">get</span> =&gt; _money; <span style="color: #b22222;">// </span><span style="color: #b22222;">xxxx.Money</span>
        <span style="color: #a020f0;">set</span>                    <span style="color: #b22222;">// </span><span style="color: #b22222;">xxxx.Money = 3333;</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span><span style="color: #008b8b;">value</span> &lt; 0<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"\n&#21442;&#25968;&#36755;&#20837;&#26684;&#24335;&#19981;&#27491;&#30830;&#65281;"</span><span style="color: #907373;">)</span>;
                Environment.<span style="color: #0000ff;">Exit</span><span style="color: #907373;">(</span>0<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
            _money = <span style="color: #008b8b;">value</span>;
            <span style="color: #0000ff;">CalculateTax</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Rate</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Tax</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">CalculateTax</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt;= 5000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = 0;
            Tax = 0;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 10000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 5000<span style="color: #709870;">)</span> * Rate;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 20000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 10000<span style="color: #709870;">)</span> * Rate + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>Money &lt; 100000<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 20000<span style="color: #709870;">)</span> * Rate + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            Rate = rates<span style="color: #709870;">[</span>3<span style="color: #709870;">]</span>;
            Tax = <span style="color: #709870;">(</span>Money - 100000<span style="color: #709870;">)</span> * Rate + 80000 * rates<span style="color: #709870;">[</span>2<span style="color: #709870;">]</span> + 10000 * rates<span style="color: #709870;">[</span>1<span style="color: #709870;">]</span> + 5000 * rates<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintToConsole</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ExportToExcel</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excle&#36755;&#20986;&#31246;&#21069;&#25910;&#20837;: {Money,10:C}"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excle&#36755;&#20986;&#24212;&#20184;&#31246;&#25910;: {Tax,10:C} ({Rate:P1})"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"Excle&#36755;&#20986;&#31246;&#21518;&#25910;&#20837;: {Money - Tax,10:C}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ShowRates</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">r</span> <span style="color: #a020f0;">in</span> rates<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"- {r}"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>



<div id="outline-container-org7bd9dc5" class="outline-3">
<h3 id="org7bd9dc5"><span class="section-number-3">8.14.</span> 小结</h3>
</div>
</section>

<section id="outline-container-org51b2636" class="outline-2">
<h2 id="org51b2636"><span class="section-number-2">9.</span> 小费计算器</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-org9914205" class="outline-3">
<h3 id="org9914205"><span class="section-number-3">9.1.</span> 核心代码</h3>
<div class="outline-text-3" id="text-9-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">Main &#26041;&#27861;&#26159;&#31243;&#24207;&#30340;&#20837;&#21475;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">args &#34920;&#31034;&#20174;&#25511;&#21046;&#21488;&#20256;&#26469;&#30340;&#21442;&#25968;&#25968;&#25454;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#27604;&#22914;&#65292;&#22312; CMD &#31383;&#21475;&#36755;&#20837; TipCalculator 222 333 444&#65292;&#37027;&#20040;:</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">- args[0] &#23601;&#26159;&#23383;&#31526;&#20018; 222</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">- args[1] &#23601;&#26159;&#23383;&#31526;&#20018; 333</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">- args[2] &#23601;&#26159;&#23383;&#31526;&#20018; 444</span>
<span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23383;&#31526;&#20018;&#26159;&#29992;&#26469;&#25551;&#36848;&#19990;&#30028;&#30340;&#26041;&#24335;&#65292;&#23427;&#19981;&#33021;&#21442;&#19982;&#25968;&#23398;&#35745;&#31639;&#12290;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22240;&#27492;&#35201;&#35745;&#31639;&#65292;&#38656;&#35201;&#20808;&#36716;&#25442;&#25104;&#21512;&#36866;&#30340;&#26684;&#24335;&#65292;&#27604;&#22914; double &#31867;&#22411;</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36134;&#21333;</span>
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">bill</span> = <span style="color: #228b22;">double</span>.<span style="color: #0000ff;">Parse</span><span style="color: #7388d6;">(</span>args<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span><span style="color: #7388d6;">)</span>;
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23567;&#36153;&#35745;&#31639;</span>
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">rate</span> = 0.18;
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tip</span> = bill * rate;
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23454;&#38469;&#36134;&#21333;&#35745;&#31639;</span>
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">realBill</span> = bill + tip;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36755;&#20986;</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"{0}"</span>, realBill<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb539204" class="outline-3">
<h3 id="orgb539204"><span class="section-number-3">9.2.</span> 在核心代码上进行优化</h3>
<div class="outline-text-3" id="text-9-2">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#30446;&#26631;:</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#35753;&#31243;&#24207;&#26356;&#20581;&#22766;&#65292;&#36991;&#20813;&#19981;&#24517;&#35201;&#30340;&#24322;&#24120;&#25243;&#20986;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#35753;&#36755;&#20986;&#26356;&#21152;&#32654;&#35266;&#65292;&#29992;&#25143;&#20307;&#39564;&#26356;&#21451;&#22909;</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22768;&#26126;&#19968;&#20010;&#21464;&#37327;&#65292;&#29992;&#26469;&#20445;&#23384;&#36716;&#25442;&#21518;&#30340;&#36134;&#21333;&#25968;&#30446;</span>
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">bill</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26816;&#26597;&#29992;&#25143;&#36755;&#20837;&#65292;&#22914;&#26524;&#36755;&#20837;&#19981;&#21512;&#29702;&#65292;&#32473;&#20104;&#25552;&#37266;&#24182;&#36864;&#20986;&#31243;&#24207;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">double.Parse &#21644; double.TryParse &#37117;&#26159;&#29992;&#26469;&#23558; string &#31867;&#22411;&#30340;&#25968;&#25454;&#36716;&#25442;&#20026; double &#31867;&#22411;:</span>
    <span style="color: #b22222;">//  </span><span style="color: #b22222;">- Parse &#20250;&#22312;&#36716;&#25442;&#22833;&#36133;&#30340;&#26102;&#20505;&#25243;&#20986;&#24322;&#24120;&#65292;&#25152;&#20197;&#22914;&#26524;&#24819;&#35753;&#31243;&#24207;&#36816;&#34892;&#33391;&#22909;&#65292;&#38656;&#35201;&#32467;&#21512; try..catch &#36827;&#34892;&#38169;&#35823;&#22788;&#29702;</span>
    <span style="color: #b22222;">//  </span><span style="color: #b22222;">- TryParse &#21487;&#36890;&#36807;&#36820;&#22238; true/false &#30340;&#26041;&#24335;&#21028;&#26029;&#36716;&#25442;&#25104;&#21151;&#19982;&#21542;&#65292;&#38656;&#35201;&#32467;&#21512; out &#21442;&#25968;&#23384;&#20648;&#36716;&#25442;&#21518;&#30340;&#20540;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">if &#26159;&#19968;&#31181;&#22522;&#26412;&#30340;&#31243;&#24207;&#27969;&#31243;&#65292;&#34920;&#31034;&#21482;&#26377;&#28385;&#36275;&#26465;&#20214;&#30340;&#26102;&#20505;&#65292;&#20854;&#20195;&#30721;&#22359;&#25165;&#20250;&#34987;&#25191;&#34892;&#12290;&#23427;&#26159;&#23545;&#39034;&#24207;&#32467;&#26500;&#30340;&#34917;&#20805;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">return &#34920;&#31034;&#36864;&#20986;&#24403;&#21069;&#26041;&#27861;&#30340;&#36816;&#34892;&#12290;&#22914;&#26524;&#22312; Main &#26041;&#27861;&#20013;&#65292;&#21017;&#34920;&#31034;&#36864;&#20986;&#31243;&#24207;&#30340;&#36816;&#34892;</span>
    <span style="color: #b22222;">//</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#19979;&#38754;&#19968;&#21477;&#30340;&#24847;&#24605;&#26159;: &#22914;&#26524;&#36755;&#20837;&#30340;&#21442;&#25968;&#19981;&#26159; 1 &#20010;&#65292;&#25110;&#32773;&#36755;&#20837;&#30340;&#21442;&#25968;&#19981;&#33021;&#36716;&#25442;&#20026; double&#65292;&#37027;&#20040;&#25552;&#37266;&#29992;&#25143;&#24182;&#36864;&#20986;</span>
    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>args.Length != 1 || !<span style="color: #228b22;">double</span>.<span style="color: #0000ff;">TryParse</span><span style="color: #909183;">(</span>args<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">bill</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#36755;&#20837;&#26377;&#35823;&#65292;&#27491;&#30830;&#30340;&#35843;&#29992;&#26041;&#27861;&#26159;:\nTipCalculator &#36134;&#21333;&#25968;&#39069;"</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23567;&#36153;&#20197;&#21450;&#23454;&#38469;&#36134;&#21333;&#30340;&#35745;&#31639;</span>
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">rate</span> = 0.18;
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">tip</span> = bill * rate;
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">realBill</span> = bill + tip;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36827;&#34892;&#26684;&#24335;&#21270;&#36755;&#20986;&#65292;&#21363;&#23558;&#26576;&#20010;&#31867;&#22411;&#30340;&#25968;&#20540;&#65292;&#36716;&#25442;&#25104;&#39044;&#26399;&#26684;&#24335;&#30340;&#23383;&#31526;&#20018;:</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">- &#20351;&#29992; $ &#31526;&#21495;&#65292;&#21487;&#20197;&#23545;&#21464;&#37327;&#36827;&#34892;&#20869;&#25554;&#25805;&#20316;; &#20351;&#29992; @ &#21487;&#20197;&#24573;&#30053;&#36716;&#20041;&#24182;&#36816;&#34892;&#22810;&#34892;&#23383;&#31526;&#20018;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">- &#36890;&#36807; {a:X} &#21487;&#20197;&#20351;&#29992; C# &#39044;&#35774;&#30340;&#26576;&#20123;&#36716;&#25442;&#35268;&#21017;&#36827;&#34892;&#36716;&#25442;&#12290;&#27604;&#22914; C &#34920;&#31034;&#36135;&#24065;&#65292;P &#34920;&#31034;&#30334;&#20998;&#27604;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">- &#20351;&#29992; {a,N} &#30340;&#26041;&#24335;&#65292;&#35753;&#36716;&#25442;&#21518;&#30340;&#23383;&#31526;&#20018;&#28385;&#36275; N &#30340;&#38271;&#24230;&#12290;&#22914;&#26524;&#19981;&#28385;&#36275;&#65292;&#20351;&#29992;&#31354;&#26684;&#34917;&#40784;&#12290;-N &#34920;&#31034;&#24038;&#23545;&#40784;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">- &#21487;&#20197;&#32467;&#21512;&#20351;&#29992;&#65292;&#35821;&#27861;&#20026; {a,N:X...}&#65292;&#27604;&#22914; {rate,10:P1} &#34920;&#31034;&#25353;&#29031;&#30334;&#20998;&#27604;&#26174;&#31034;&#12289;&#23567;&#25968;&#20445;&#30041;&#19968;&#20301;&#12289;&#34917;&#40784;&#20026; 10 &#30340;&#38271;&#24230;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">string.PadRight &#26159;&#20869;&#32622;&#30340;&#19968;&#20010;&#23383;&#31526;&#20018;&#25805;&#20316;&#30340; API&#65292;&#34920;&#31034;&#23558;&#23383;&#31526;&#20018;&#20351;&#29992;&#26576;&#20010;&#23383;&#31526;&#34917;&#40784;&#20026;&#22810;&#23569;&#38271;&#24230;</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">()</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"&#36134;&#21333;&#24635;&#39069;: {bill,10:C}"</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"&#23567;&#36153;&#25968;&#39069;: {tip,10:C} ({rate:P1})"</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #909183;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"&#36134;&#21333;&#23454;&#20184;: {realBill,10:C}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org93ab691" class="outline-3">
<h3 id="org93ab691"><span class="section-number-3">9.3.</span> 结构化重构</h3>
<div class="outline-text-3" id="text-9-3">
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCal</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">TipCal</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">bill</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 4: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 5: </span>        Bill = bill;
<span class="linenr"> 6: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>    <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">RATE</span> = 0.18;
<span class="linenr"> 9: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Bill</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span class="linenr">10: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Tip</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span> <span style="color: #909183;">{</span> <span style="color: #a020f0;">return</span> Bill * RATE; <span style="color: #909183;">}</span> <span style="color: #7388d6;">}</span>
<span class="linenr">11: </span>
<span class="linenr">12: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Print</span><span style="color: #7388d6;">()</span>
<span class="linenr">13: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">14: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
<span class="linenr">15: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#36134;&#21333;&#24635;&#39069;: {Bill,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">16: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#23567;&#36153;&#25968;&#39069;: {Tip,10:C} ({RATE:P1})"</span><span style="color: #909183;">)</span>;
<span class="linenr">17: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">""</span>.<span style="color: #0000ff;">PadRight</span><span style="color: #709870;">(</span>30, <span style="color: #8b2252;">'&#9480;'</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
<span class="linenr">18: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#36134;&#21333;&#23454;&#20184;: {Bill + Tip,10:C}"</span><span style="color: #909183;">)</span>;
<span class="linenr">19: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">20: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 悟饭</p>
<p class="date">Created: 2021-12-27</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
