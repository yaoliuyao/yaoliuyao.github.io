<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2022-04-07 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>C♯</title>
<meta name="generator" content="Org mode">
<meta name="author" content="悟饭">
<link rel='stylesheet' href='/html/asset/common.css?3344' />
<link rel='stylesheet' href='/yaoliuyao/html/asset/common.css?3344' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/html/asset/common.js'></script>
<script src='/yaoliuyao/html/asset/common.js'></script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">C♯</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org6e8c65d">1. 历史</a></li>
<li><a href="#org215ec81">2. [语言与类型]</a>
<ul>
<li><a href="#org2c530ae">2.1. Main</a></li>
<li><a href="#org74d778d">2.2. 命名空间</a>
<ul>
<li><a href="#org4a747a5">2.2.1. 使用</a></li>
<li><a href="#org35cdcbe">2.2.2. 定义</a></li>
<li><a href="#org2075c98">2.2.3. BCL/System</a></li>
</ul>
</li>
<li><a href="#org303539c">2.3. 模板 vs 实例</a></li>
<li><a href="#org82a47e3">2.4. 值类型 vs 引用类型</a></li>
</ul>
</li>
<li><a href="#org0559329">3. 预定义数值类型</a>
<ul>
<li><a href="#org63d2929">3.1. 整数</a></li>
<li><a href="#orgd900280">3.2. 浮点数</a></li>
<li><a href="#org176c74c">3.3. Literate (字面量表达)</a></li>
</ul>
</li>
<li><a href="#org119130a">4. 预定义/非数值·值类型</a>
<ul>
<li><a href="#org0f543da">4.1. 字符类型 (char)</a></li>
<li><a href="#org6d49662">4.2. 布尔类型 (bool)</a>
<ul>
<li><a href="#org6292f00">4.2.1. [条件分支] 在某种条件之下，做某件事</a></li>
<li><a href="#orgd14fa0c">4.2.2. [循环迭代] 重复做某件事</a></li>
<li><a href="#org6252d1e">4.2.3. 语句 (Statement) vs 表达式 (Expression)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2a0ed18">5. 预定义/非数值·引用类型</a>
<ul>
<li><a href="#orge4dda6d">5.1. string</a>
<ul>
<li><a href="#orgea1a0e9">5.1.1. 字符串的初始化</a></li>
<li><a href="#orga509b0c">5.1.2. 字符串的不可变性 (Immutable)</a>
<ul>
<li><a href="#org2e66dd9">5.1.2.1. what &amp; why</a></li>
<li><a href="#org3d244a1">5.1.2.2. System.Text.StringBuilder</a></li>
<li><a href="#orga3eea77">5.1.2.3. String Intern Pool (字符串池)</a></li>
</ul>
</li>
<li><a href="#org8bd5cd4">5.1.3. [API] 基本操作</a></li>
<li><a href="#org902e17f">5.1.4. [API] 拼接 + 格式化</a></li>
<li><a href="#org330335b">5.1.5. [API] 子字符串</a></li>
<li><a href="#orgebb94db">5.1.6. [API] 字符串的修改</a></li>
<li><a href="#orgb13cd6e">5.1.7. [API] String 跟 Array 的转换</a></li>
</ul>
</li>
<li><a href="#orgf40a769">5.2. object</a></li>
<li><a href="#orgebd8ec8">5.3. dynamic</a></li>
</ul>
</li>
<li><a href="#org710620e">6. 用户自定义类型</a>
<ul>
<li><a href="#orgecf4b54">6.1. class</a></li>
<li><a href="#orgdf476f3">6.2. interface</a></li>
<li><a href="#org29671bb">6.3. delegate</a></li>
<li><a href="#org7a80d08">6.4. array</a></li>
<li><a href="#org434b62c">6.5. struct</a></li>
<li><a href="#org5842d62">6.6. enum</a></li>
</ul>
</li>
<li><a href="#org6672eb9">7. 类型转换</a>
<ul>
<li><a href="#orgb9ed1b3">7.1. 隐式转换/强制转换</a></li>
<li><a href="#orgb6d106f">7.2. 引用类型的隐式和强制转换</a></li>
<li><a href="#org247f02f">7.3. 装箱/拆箱 (auto-boxing)</a></li>
<li><a href="#org273cc98">7.4. 自定义转换规则</a></li>
<li><a href="#org23dcc37">7.5. 基于 <b>字符串</b> 之间的互相转换</a>
<ul>
<li><a href="#org8d4e926">7.5.1. string.Format</a></li>
<li><a href="#org7852148">7.5.2. type.ToString</a></li>
<li><a href="#orgaa7a4ab">7.5.3. type.Parse/TryParse</a></li>
<li><a href="#org89bbc31">7.5.4. Convert</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orge7ae5fd">8. 类 (Class)</a>
<ul>
<li><a href="#org99f48fc">8.1. 字段 (Field)</a></li>
<li><a href="#orga8cd62d">8.2. 方法 (Method)</a>
<ul>
<li><a href="#orgfe90159">8.2.1. Basic</a></li>
<li><a href="#org3f39897">8.2.2. 方法的重载 (overload)</a></li>
<li><a href="#orgca9382d">8.2.3. 参数 (值参数/ref/out)</a></li>
<li><a href="#orgb0c8cd6">8.2.4. out 参数: 用来模拟方法返回多个值的场景</a></li>
<li><a href="#org1225826">8.2.5. 数组参数 (params)</a></li>
<li><a href="#org5d0fcf2">8.2.6. 可选参数/命名参数</a></li>
</ul>
</li>
<li><a href="#orgf1b7e70">8.3. 属性 (Property)</a></li>
<li><a href="#org715084d">8.4. 索引器 (Indexer)</a></li>
<li><a href="#org2457fb6">8.5. 构造方法/构造器 (Constructor)</a>
<ul>
<li><a href="#org89b9afd">8.5.1. 对象的实例化</a></li>
<li><a href="#orgd5f0cbd">8.5.2. 构造器</a></li>
<li><a href="#org8ad35bd">8.5.3. 构造器链</a></li>
<li><a href="#org3b33b66">8.5.4. 静态构造器</a></li>
</ul>
</li>
<li><a href="#org6b51ef3">8.6. 析构方法/析构器 (Deconstructor)</a></li>
<li><a href="#orge4475c6">8.7. 静态方法 (Static)</a></li>
<li><a href="#orgd48aa0d">8.8. 将数据设置为不变的 (const/readonly)</a></li>
<li><a href="#orgbdf81f1">8.9. 继承 (Inheritance)</a>
<ul>
<li><a href="#orga51b557">8.9.1. 虚方法 (virtual/override)</a></li>
<li><a href="#orga8b46e7">8.9.2. 抽象方法 (abstract)</a></li>
</ul>
</li>
<li><a href="#org8464328">8.10. 多态 (Polymorphism)</a></li>
<li><a href="#org2391071">8.11. 静态类/static</a></li>
<li><a href="#org6276832">8.12. 密封类/sealed</a></li>
<li><a href="#org6b1ee8d">8.13. 分部类/partial</a></li>
<li><a href="#org3b7afe6">8.14. 基类 Object</a>
<ul>
<li><a href="#org3cf1bab">8.14.1. ToString</a></li>
</ul>
</li>
<li><a href="#org95a7a34">8.15. 类的扩展机制</a></li>
</ul>
</li>
<li><a href="#org8ec73e0">9. 接口 (Interface)</a>
<ul>
<li><a href="#org1db3e56">9.1. IComparable 接口使用示例</a></li>
</ul>
</li>
<li><a href="#org2b3f26b">10. 结构体 (Struct)</a></li>
<li><a href="#orgf7e4865">11. 枚举 (Enum)</a>
<ul>
<li><a href="#orgbf8709d">11.1. 基本使用</a></li>
<li><a href="#orge30e795">11.2. Flags (TODO)</a></li>
<li><a href="#orgf66ddd0">11.3. 基本 API</a></li>
</ul>
</li>
<li><a href="#org51cb116">12. 委托 (Delegate)</a>
<ul>
<li><a href="#org284b10d">12.1. 写一个方法 MyAdd ，求取 <b>若干数</b> 的和</a>
<ul>
<li><a href="#org8aeda41">12.1.1. 原始写法</a></li>
<li><a href="#org1a2ec01">12.1.2. 通过一个 Flag 来通知 MyAdd 要去调用什么逻辑</a></li>
<li><a href="#orgc3394e6">12.1.3. 没有中间商赚差价，借助类和接口的方式，传递不同的方法</a></li>
<li><a href="#org8135472">12.1.4. 模板代码实在不爽，委托类型出现来救场</a></li>
</ul>
</li>
<li><a href="#orgc96b5c7">12.2. 基本语法</a></li>
<li><a href="#orgcd3c6c8">12.3. 匿名委托</a></li>
<li><a href="#org3ba3802">12.4. 表达式语法</a></li>
<li><a href="#orga61407f">12.5. 内建的委托类型 Action/Func</a></li>
<li><a href="#org9960498">12.6. 多播委托</a></li>
<li><a href="#org352852b">12.7. [练习] 如何简化图片绘制的代码</a></li>
<li><a href="#orga83e7b7">12.8. [练习] 如何简化输出程序执行时间的逻辑</a></li>
</ul>
</li>
<li><a href="#org83674a3">13. 数组 (Array)</a>
<ul>
<li><a href="#org6ff1fe0">13.1. 一维数组</a></li>
<li><a href="#org45c249e">13.2. 多维数组 (Dimensional Array)</a></li>
<li><a href="#org54c0416">13.3. 交错数组 (Jagged Array)</a></li>
</ul>
</li>
<li><a href="#orgd1a814f">14. 元组 (Tuple/ValueTuple)</a></li>
<li><a href="#org0ddd227">15. 集合 (Collections)</a>
<ul>
<li><a href="#org148b25e">15.1. System.Collections</a>
<ul>
<li><a href="#org23e8eaf">15.1.1. ArrayList</a></li>
<li><a href="#org07d682c">15.1.2. Hashtable</a></li>
<li><a href="#org71f747c">15.1.3. Queue</a></li>
<li><a href="#org4da5fc8">15.1.4. Stack</a></li>
<li><a href="#orgb6581b8">15.1.5. SortedList/BitArray</a></li>
</ul>
</li>
<li><a href="#orgfd4e718">15.2. System.Collections.Generic</a>
<ul>
<li><a href="#org6e02371">15.2.1. List&lt;T&gt;</a></li>
<li><a href="#orgaac5501">15.2.2. Dictionary&lt;TKey, TValue&gt;</a></li>
<li><a href="#org5ae3ed1">15.2.3. Queue&lt;T&gt;</a></li>
<li><a href="#org71a1d2e">15.2.4. Stack&lt;T&gt;</a></li>
<li><a href="#org85be6fd">15.2.5. LinkedList&lt;T&gt;</a></li>
<li><a href="#org4f819f4">15.2.6. HashSet&lt;T&gt;</a></li>
<li><a href="#orgfde6f3a">15.2.7. SortedList/Set/Dictionary&lt;&gt;</a></li>
</ul>
</li>
<li><a href="#org5849224">15.3. System.Collections.Immutable</a></li>
</ul>
</li>
<li><a href="#org6d182ea">16. IEnumerable/Linq</a>
<ul>
<li><a href="#orge14a4af">16.1. IEnumerable/IEnumerator/foreach</a></li>
<li><a href="#orgecb87b8">16.2. Iterator</a></li>
<li><a href="#orga09ac9a">16.3. Linq</a>
<ul>
<li><a href="#org7a8df59">16.3.1. Method Syntax</a></li>
<li><a href="#org04f3d4b">16.3.2. Query Syntax/Expression</a></li>
</ul>
</li>
<li><a href="#org0334bbb">16.4. Linq to XML</a></li>
</ul>
</li>
<li><a href="#org82eaf28">17. 泛型 (Generic)</a>
<ul>
<li><a href="#org38a7ec1">17.1. 方法泛型</a></li>
</ul>
</li>
<li><a href="#org5501efc">18. 事件 (Event)</a>
<ul>
<li><a href="#orga0b7177">18.1. 如果使用一般的写法</a></li>
<li><a href="#org2338b03">18.2. 上述的写法虽然没有错误，但是存在一些问题</a></li>
<li><a href="#org6b57f0d">18.3. 上述代码虽然简洁了，但是条件和最后要执行的逻辑写在一起，耦合度太大</a></li>
<li><a href="#org714a70d">18.4. 接下来，可以将第一段代码单独抽出来，作为单独的 Publisher，从而实现更好的分离</a></li>
<li><a href="#orgbec16d7">18.5. 通过上述实现，我们可以看到事件是通过委托实现的，但还是有些缺点</a></li>
<li><a href="#org8b4d25c">18.6. 接下来，要考虑的是，能不能在事件触发的时候，传递一些参数</a></li>
</ul>
</li>
<li><a href="#org952b77e">19. 异常 (Exception)</a>
<ul>
<li><a href="#org8acbb25">19.1. 传统方式</a></li>
<li><a href="#orgf237683">19.2. 通过 Exception 提供 <b>解耦合</b> 的处理方式</a></li>
<li><a href="#orgd8f87c4">19.3. 异常的嵌套，以及 finally</a></li>
</ul>
</li>
<li><a href="#org035e25c">20. 反射和特性 (Reflection/Attribute)</a>
<ul>
<li><a href="#org255be30">20.1. 反射 (Reflection)</a></li>
<li><a href="#org430a056">20.2. [例子] ToModelList</a></li>
<li><a href="#org35c2611">20.3. 特性 (Attribute)</a>
<ul>
<li><a href="#org297b46c">20.3.1. 特性就是一个普通的类</a></li>
<li><a href="#org6455304">20.3.2. 通过反射得到它的实例，然后就可以使用了</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org176af74">21. 依赖注入 (DI/IoC)</a>
<ul>
<li><a href="#org52ee22f">21.1. 正常手段</a></li>
<li><a href="#org6b77f67">21.2. DI/IoC</a></li>
<li><a href="#org10164ab">21.3. 基本使用</a></li>
<li><a href="#orgd43b4c0">21.4. 三种生命周期</a></li>
<li><a href="#org241ceb1">21.5. 高内聚低耦合</a></li>
</ul>
</li>
<li><a href="#org4c40ce0">22. 异步编程</a>
<ul>
<li><a href="#org44a15e9">22.1. Process</a></li>
<li><a href="#orgdbe9107">22.2. Thread</a></li>
<li><a href="#org0aef5ab">22.3. ThreadPool</a></li>
<li><a href="#org4fffd68">22.4. TPL (Task-Parallel Libary)</a>
<ul>
<li><a href="#org42065bf">22.4.1. Task.Run</a></li>
<li><a href="#orgee0881f">22.4.2. 其他创建任务的方式</a></li>
<li><a href="#org9776dc9">22.4.3. 任务协作</a></li>
</ul>
</li>
<li><a href="#org7449fd7">22.5. TAL (Task-based Asyncronize Pattern)</a></li>
<li><a href="#org4f504a1">22.6. Parallel</a></li>
<li><a href="#org05ddd87">22.7. 任务的同步和协作</a>
<ul>
<li><a href="#org17ea04d">22.7.1. Monitor.Enter/Exit</a></li>
<li><a href="#org734cdbb">22.7.2. lock</a></li>
<li><a href="#org4af87e0">22.7.3. ManualResetEventSlim</a></li>
<li><a href="#orgb8daa02">22.7.4. Interlock</a></li>
<li><a href="#org56e5dfd">22.7.5. Semaphore</a></li>
<li><a href="#org91c5610">22.7.6. CountdownEvent</a></li>
</ul>
</li>
<li><a href="#orgd739c45">22.8. 其他几种异步模式</a>
<ul>
<li><a href="#org8d264a7">22.8.1. BackgroundWorker</a></li>
<li><a href="#org8e134ef">22.8.2. System.Threading.Timer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0adc5fa">23. IO/Stream</a>
<ul>
<li><a href="#org9d7cfe4">23.1. Path</a></li>
<li><a href="#org6828845">23.2. Driver</a></li>
<li><a href="#org942a5e5">23.3. Directory</a></li>
<li><a href="#orgecb1704">23.4. File</a></li>
<li><a href="#org0bb555b">23.5. Stream</a>
<ul>
<li><a href="#orgc15377d">23.5.1. FileSteam</a></li>
<li><a href="#org58f5eb3">23.5.2. MemoryStream</a></li>
<li><a href="#orgf9b860a">23.5.3. NetworkStream</a></li>
</ul>
</li>
<li><a href="#org575a40d">23.6. Reader/Writer</a>
<ul>
<li><a href="#org165428b">23.6.1. StreamReader/StreamWriter</a></li>
<li><a href="#org2de8f2b">23.6.2. StringReader/StringWriter</a></li>
<li><a href="#org7eb0fb0">23.6.3. BinaryReader/BinaryWriter</a></li>
<li><a href="#org265e218">23.6.4. XmlReader/XmlWriter</a></li>
</ul>
</li>
<li><a href="#org5138b5a">23.7. FileSystemWatching</a></li>
</ul>
</li>
<li><a href="#org36de137">24. Socket</a>
<ul>
<li><a href="#org198d03f">24.1. OSI 模型</a></li>
<li><a href="#orgf520b62">24.2. TCP/IP 协议栈</a></li>
<li><a href="#orgad2a3f5">24.3. Uri/UriBuilder</a></li>
<li><a href="#org009fd5e">24.4. IpAddress/Dns</a></li>
<li><a href="#orgd8059e2">24.5. Socket</a>
<ul>
<li><a href="#orgc6a387b">24.5.1. TCP vs UDP</a></li>
<li><a href="#orgad22831">24.5.2. Socket/TCP</a>
<ul>
<li><a href="#org0a6b38a">24.5.2.1. 基本语法</a></li>
<li><a href="#orge8a1a0e">24.5.2.2. 简单的 HTTP 服务器</a></li>
<li><a href="#orga38c28b">24.5.2.3. 简单的客户端实现</a></li>
</ul>
</li>
<li><a href="#org3889b60">24.5.3. Socket/UDP</a></li>
<li><a href="#org0ca0d53">24.5.4. 通过 NetworkStream 简化对 Socket 读写的操作</a></li>
<li><a href="#org4c1e0e3">24.5.5. 飞鸽/FeiQ</a></li>
</ul>
</li>
<li><a href="#org1fc4ef7">24.6. TcpClient/TcpListener</a></li>
<li><a href="#org5066e75">24.7. UdpClient</a></li>
<li><a href="#orgb33f00f">24.8. HttpClient/HttpListener</a>
<ul>
<li><a href="#orgdf687fe">24.8.1. HttpListener</a></li>
<li><a href="#orga03b142">24.8.2. HttpWebRequest/WebClient/HttpClient</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc60f97b">25. Database</a>
<ul>
<li><a href="#orgb67f9d8">25.1. ADO.NET</a>
<ul>
<li><a href="#orgbc4ea68">25.1.1. SqlConnection / SqlCommand / SqlDataReader</a></li>
<li><a href="#orge4b38fe">25.1.2. ExecuteScalar / SQL Injection / Parameters</a></li>
<li><a href="#orgf83cfa0">25.1.3. SqlDataReader vs SqlDataAdapter/DataTable</a></li>
</ul>
</li>
<li><a href="#org1b59814">25.2. Entity Framework</a>
<ul>
<li><a href="#org91cd06d">25.2.1. 历史</a></li>
<li><a href="#orgf816245">25.2.2. EF6</a>
<ul>
<li><a href="#org8558171">25.2.2.1. 模型生成 (基于 edmx)</a></li>
<li><a href="#org00357a0">25.2.2.2. 模型生成 (Code First)</a></li>
</ul>
</li>
<li><a href="#orgd42a80e">25.2.3. EFCore</a></li>
<li><a href="#org2501b18">25.2.4. 上下文 (DbContext/DbSet)</a></li>
<li><a href="#orge332288">25.2.5. 模型的三个层次</a></li>
<li><a href="#org731eef2">25.2.6. 模型之间的关系</a></li>
<li><a href="#org272d158">25.2.7. 数据查询</a></li>
<li><a href="#org20ced09">25.2.8. 数据修改</a></li>
<li><a href="#org8a170b5">25.2.9. 日志</a>
<ul>
<li><a href="#org449e710">25.2.9.1. 使用 options.LogTo 方法</a></li>
</ul>
</li>
<li><a href="#orgda84140">25.2.10. 集成容器</a></li>
<li><a href="#org1bdad3d">25.2.11. 三层架构</a></li>
<li><a href="#orgebd8559">25.2.12. 随堂代码</a>
<ul>
<li><a href="#orgeb840c2">25.2.12.1. 2021年11月10日 (基本使用)</a></li>
<li><a href="#orgb8ed44a">25.2.12.2. 2021年11月11日 (模型创建)</a></li>
</ul>
</li>
<li><a href="#org232efd1">25.2.13. 生成/Reverse</a></li>
<li><a href="#org5744275">25.2.14. 总结</a></li>
</ul>
</li>
<li><a href="#org095a64e">25.3. Dapper/SqlSugar/FreeSQL/NHibernate</a>
<ul>
<li><a href="#orga7baae3">25.3.1. Dapper</a></li>
<li><a href="#orgccce5c8">25.3.2. SqlSugar</a></li>
<li><a href="#org25d8e03">25.3.3. FreeSQL</a></li>
<li><a href="#org9a88460">25.3.4. NHibernate</a></li>
<li><a href="#org0cb1fbf">25.3.5. MyBatis.NET</a></li>
</ul>
</li>
<li><a href="#orgc7102f7">25.4. 事务 (Transaction)</a></li>
<li><a href="#orgcdaf6f1">25.5. 示例数据库</a></li>
</ul>
</li>
<li><a href="#org5ebd25d">26. BCL (Base-Class Library) 基础类库</a>
<ul>
<li><a href="#org8b5c979">26.1. Console/控制台</a></li>
<li><a href="#orgf370806">26.2. Random/Thread</a></li>
<li><a href="#org078427d">26.3. IDisposable/资源</a></li>
<li><a href="#orgb5a2b13">26.4. Stopwatch/秒表</a></li>
<li><a href="#orgd0a8d63">26.5. ConfigurationManager/配置管理器</a></li>
<li><a href="#orgf35d672">26.6. RegularExpression/正则表达式</a></li>
</ul>
</li>
<li><a href="#org7682cdc">27. Winform</a>
<ul>
<li><a href="#org24de99a">27.1. 布局相关</a>
<ul>
<li><a href="#org5685a3a">27.1.1. 基本属性</a></li>
<li><a href="#org3bdbf58">27.1.2. Layout</a></li>
</ul>
</li>
<li><a href="#orge7f2856">27.2. 数据容器</a></li>
</ul>
</li>
<li><a href="#org156e49a">28. 技巧和示例</a>
<ul>
<li><a href="#org0ca31ac">28.1. 求余</a></li>
</ul>
</li>
<li><a href="#orgc4fc2ee">29. 模拟题</a>
<ul>
<li><a href="#orgc0f6ff4">29.1. 继承相关</a></li>
<li><a href="#org939dab5">29.2. 重载 (overload) 和 重写 (override) 有啥区别 (15 分)</a></li>
</ul>
</li>
<li><a href="#orgeb3a958">30. 问题 (仅作参考)</a>
<ul>
<li><a href="#orgb7e73e7">30.1. string 和 StringBuilder 有什么区别</a></li>
<li><a href="#org1ea4148">30.2. 什么是抽象类，抽象类有什么用处</a></li>
<li><a href="#org137e9b5">30.3. 什么是接口，什么是面向接口编程，面向接口编程有什么好处</a></li>
<li><a href="#org4fd837a">30.4. 什么是静态类，什么是密封类，什么是分部类</a></li>
<li><a href="#org836a79f">30.5. 什么是类，什么是对象，对象的实例化过程是怎么样的</a></li>
<li><a href="#org5e43cb0">30.6. 什么是面向对象编程，面向对象有什么特点，有什么好处</a></li>
<li><a href="#org6dfeb49">30.7. 什么是字段，什么是方法，什么是属性。属性有什么好处</a></li>
<li><a href="#orgc976762">30.8. 什么是封装，什么是继承，什么是多态</a></li>
<li><a href="#orge5fd970">30.9. 什么是虚方法，它有什么用处</a></li>
<li><a href="#org97c53af">30.10. 什么是组合，它跟继承有什么区别，分别用在什么场景</a></li>
<li><a href="#org6a9a3d4">30.11. 什么是 DRY，代码复用的手段有哪些</a></li>
<li><a href="#org4ff3fe5">30.12. Parse/TryParse 有啥区别</a></li>
<li><a href="#org2df8eb1">30.13. 什么是装箱拆箱</a></li>
<li><a href="#org5b399e5">30.14. 什么是值类型/引用类型</a></li>
<li><a href="#org38b212d">30.15. is/as 分别是干啥的</a></li>
</ul>
</li>
<li><a href="#org2b28ec2">31. 代码生成器</a></li>
<li><a href="#org161d77e">32. Miscellaneous</a>
<ul>
<li><a href="#orgfa5d65f">32.1. 模拟 Path 寻找的方式</a></li>
<li><a href="#org31978ab">32.2. 基本思想</a></li>
<li><a href="#org2d4b2ec">32.3. Relation-Database/SQL</a></li>
</ul>
</li>
</ul>
</div>
</nav>


<section id="outline-container-org6e8c65d" class="outline-2">
<h2 id="org6e8c65d"><span class="section-number-2">1.</span> 历史</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>Visual J++ 被放弃，<a href="https://baike.baidu.com/item/%E5%AE%89%E5%BE%B7%E6%96%AF%C2%B7%E6%B5%B7%E5%B0%94%E6%96%AF%E4%BC%AF%E6%A0%BC">安德斯·海尔斯伯格</a>带领团队从 2000 年左右开始开发了 C#，到 2002 年的的时候，开始提交给 ECMA 成为了标准</li>
<li>因为安德斯他的个人经历，所以 C# 深受 Pascal/C++/Java 的影响</li>
<li>到现在，C# 已经成为了一种多范式的语言。首先它是一门纯粹的面向对象的语言 (封装、继承、多态)，提供了面向组件编程的一些改进 (属性、委托、事件)</li>
</ul>

<p>
C# 版本演化:
</p>
<ul class="org-ul">
<li>1.0 纯粹的面向对象 (2002)</li>
<li>2.0 增加了泛型的概念 (2005)</li>
<li>3.0 增加了 LINQ 功能 (2008)</li>
<li>4.0 增加了命名参数和可选参数的功能，并添加了动态编程的支持 (2010)</li>
<li>5.0 增加了 async/await 的异步编程范式 (2012)</li>
<li>6.0 推进了跟 .NET Core 的语言共享 (2015)</li>
<li>7.0 添加了函数式编程的一些特性，如果模式匹配、元组等等，包括其他一些优化 (2017)</li>
<li>8.0 开始支持默认接口方法，可空引用类型，switch 表达式等 (2019)</li>
<li>9.0 增加了 Record 类型，继续对 switch 表达式等进行简化跟优化 (2021)</li>
</ul>
</div>
</section>

<section id="outline-container-org215ec81" class="outline-2">
<h2 id="org215ec81"><span class="section-number-2">2.</span> [语言与类型]</h2>
<div class="outline-text-2" id="text-2">
<p>
在 C# 等面向对象的语言中，*类型 (Type)* 是第一位的
</p>
<ul class="org-ul">
<li>在 C# 中，不外乎做两件事，第一件是引入别人的类型，第二件是声明自己的类型</li>
<li>也就是说，整个 C# 项目，是由不同的 <b>类型声明</b> 组成的</li>
<li>在整个 C# 项目中，需要 <b>有且只有一个</b> 特殊的方法，就是 Main 方法。它是程序执行的起点</li>
<li>通过引入 <b>命名空间 (namespace)</b> 的概念，用来组织各种类型，从而避免命名冲突</li>
</ul>


<figure id="org7575b9f">
<img src="img/types.png" alt="types.png" width="400px">

</figure>


<figure id="org342d42e">
<img src="img/types-2.png" alt="types-2.png" width="400px">

</figure>
</div>

<div id="outline-container-org2c530ae" class="outline-3">
<h3 id="org2c530ae"><span class="section-number-3">2.1.</span> Main</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">Main</span> <span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">return</span> &#22914;&#26524;&#27491;&#24120;&#36820;&#22238;&#21017;&#26159; 0&#65292;&#21542;&#21017;&#26159;&#19968;&#20010;&#25972;&#25968;&#20195;&#34920;&#38169;&#35823;&#32534;&#21495;;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span> <span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#30495;&#30340;&#19981;&#20851;&#24515;&#36820;&#22238;&#30340;&#38169;&#35823;&#32534;&#21495;&#30340;&#35805;&#65292;&#21487;&#20197;&#23558;&#36820;&#22238;&#20540;&#35774;&#32622;&#20026; void</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21487;&#20197;&#20351;&#29992; args &#26469;&#25429;&#33719;&#20174;&#25511;&#21046;&#21488;&#36755;&#20837;&#30340;&#21442;&#25968; (&#29992;&#31354;&#26684;&#20998;&#38548;&#30340;&#20803;&#32032;)</span>
    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>args.Length &gt; 0 &amp;&amp; args<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span> == <span style="color: #8b2252;">"--help"</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#20351;&#29992;&#26041;&#24335;: ./Program"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span> <span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#20320;&#30495;&#30340;&#19981;&#22312;&#20046;&#20256;&#20837;&#21442;&#25968;&#30340;&#35805;&#65292;&#37027;&#20040;&#23558; args &#30465;&#30053;&#25481;&#20063;&#21487;&#20197;</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #a020f0;">async</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">await</span> <span style="color: #0000ff;">CCCAync</span><span style="color: #7388d6;">()</span>;
    <span style="color: #a020f0;">await</span> <span style="color: #0000ff;">AAA</span><span style="color: #7388d6;">()</span>;
    <span style="color: #a020f0;">await</span> <span style="color: #0000ff;">BBB</span><span style="color: #7388d6;">()</span>;
    <span style="color: #0000ff;">DDD</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
args 使用的另一个示例:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>args.Length == 1<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>args<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span> == <span style="color: #8b2252;">"--help"</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>

            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#20351;&#29992;&#26041;&#27861;: dotnet run 2223"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">bill</span> = <span style="color: #228b22;">double</span>.<span style="color: #0000ff;">Parse</span><span style="color: #709870;">(</span>args<span style="color: #907373;">[</span>0<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">calc</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TipCalculator</span><span style="color: #709870;">(</span>bill<span style="color: #709870;">)</span>;
            calc.<span style="color: #0000ff;">PrintToConsole</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">else</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#21442;&#25968;&#38169;&#35823;."</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org74d778d" class="outline-3">
<h3 id="org74d778d"><span class="section-number-3">2.2.</span> 命名空间</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>用来解决类型名字的冲突</li>
<li>用来合理组织类型</li>
</ul>
</div>

<div id="outline-container-org4a747a5" class="outline-4">
<h4 id="org4a747a5"><span class="section-number-4">2.2.1.</span> 使用</h4>
<div class="outline-text-4" id="text-2-2-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#31867;&#22411;&#30340;&#20351;&#29992;&#65292;&#21487;&#20197;&#36890;&#36807; namespace.&#31867;&#22411; &#26469;&#35775;&#38382;&#21040; / full name</span>
System.<span style="color: #228b22;">String</span> <span style="color: #a0522d;">aaa</span> = System.IO.File.<span style="color: #0000ff;">ReadAllText</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"e:\\aaa.txt"</span><span style="color: #707183;">)</span>;
System.Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>aaa<span style="color: #707183;">)</span>;
System.Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#21487;&#20197;&#20511;&#21161; using &#21629;&#21517;&#31354;&#38388;&#30340;&#26041;&#24335;&#65292;&#31616;&#21270;&#31867;&#22411;&#30340;&#20351;&#29992;</span>
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>.<span style="color: #a0522d;">IO</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">aaa</span> = File.<span style="color: #0000ff;">ReadAllText</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"e:\\aaa.txt"</span><span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>aaa<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#21487;&#20197;&#20351;&#29992; using static &#30340;&#35821;&#27861;&#32487;&#32493;&#36827;&#34892;&#31616;&#21270;</span>
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">static</span> S<span style="color: #a0522d;">ystem</span>.<span style="color: #a0522d;">Console</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">static</span> S<span style="color: #a0522d;">ystem</span>.<span style="color: #a0522d;">IO</span>.<span style="color: #a0522d;">File</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">aaa</span> = <span style="color: #0000ff;">ReadAllText</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"e:\\aaa.txt"</span><span style="color: #707183;">)</span>;
<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>aaa<span style="color: #707183;">)</span>;
<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#21487;&#20197;&#20351;&#29992; using = &#30340;&#26041;&#24335;&#65292;&#20026;&#21629;&#21517;&#31354;&#38388;&#36215;&#19968;&#20010;&#21035;&#21517;&#12290;&#36825;&#31181;&#26041;&#24335;&#19968;&#33324;&#29992;&#26469;&#35299;&#20915;&#20914;&#31361;</span>
<span style="color: #a020f0;">using</span> <span style="color: #228b22;">SI</span> = <span style="color: #a0522d;">System</span>.<span style="color: #a0522d;">IO</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">HisSystem</span>;
SI.File.<span style="color: #0000ff;">xxx</span><span style="color: #707183;">()</span>;  <span style="color: #b22222;">// </span><span style="color: #b22222;">System.IO.File.xxx();</span>
File.<span style="color: #0000ff;">xxx</span><span style="color: #707183;">()</span>;     <span style="color: #b22222;">// </span><span style="color: #b22222;">HisSystem.FIle.xxx();</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org35cdcbe" class="outline-4">
<h4 id="org35cdcbe"><span class="section-number-4">2.2.2.</span> 定义</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
支持嵌套，支持使用 . 的形式进行简写:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">using</span> <span style="color: #228b22;">SI</span> = <span style="color: #a0522d;">System</span>.<span style="color: #a0522d;">IO</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">File</span>

<span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">TaxCalculator</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">Hi</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">Ih</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">TaxCalculator.Hi.Ih.Boy</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Boy</span>
            <span style="color: #709870;">{</span>
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Girl</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">TaxCalculator.Hi.Girl</span>
        <span style="color: #909183;">{</span>
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">A</span>.<span style="color: #a0522d;">B</span>.<span style="color: #a0522d;">C</span>.<span style="color: #a0522d;">D</span>.<span style="color: #a0522d;">E</span>.<span style="color: #a0522d;">F</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">G</span>.<span style="color: #a0522d;">H</span>.<span style="color: #a0522d;">X</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">using</span> <span style="color: #a020f0;">static</span> System.Console;
            <span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">Y</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Hello</span>
                <span style="color: #907373;">{</span>
                    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Say</span><span style="color: #6276ba;">()</span>
                    <span style="color: #6276ba;">{</span>
                        <span style="color: #0000ff;">WriteLine</span><span style="color: #858580;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #858580;">)</span>;
                    <span style="color: #6276ba;">}</span>
                <span style="color: #907373;">}</span>
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">B</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">using</span> <span style="color: #008b8b;">System</span>;
        <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">TaxCalculator.Program</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #709870;">()</span>
            <span style="color: #709870;">{</span>
                <span style="color: #228b22;">string</span> <span style="color: #a0522d;">aaa</span> = SI.File.<span style="color: #0000ff;">ReadAllText</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"e:\\aaa.txt"</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #228b22;">aaa</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2075c98" class="outline-4">
<h4 id="org2075c98"><span class="section-number-4">2.2.3.</span> BCL/System</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
System 命名空间:
</p>
<ul class="org-ul">
<li>System.IO (Input/Output), 文件的处理</li>
<li>System.Drawing, 绘制图片</li>
<li>System.Collections，集合类型</li>
<li>System.Net，网络访问</li>
<li>System.Text，跟文本相关的内容，比如正则表达式</li>
<li>System.Threading，多线程</li>
<li>System.Threading.Tasks，异步编程</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org303539c" class="outline-3">
<h3 id="org303539c"><span class="section-number-3">2.3.</span> 模板 vs 实例</h3>
<div class="outline-text-3" id="text-2-3">
<p>
类型就是用来创建数据结构的一种 *模板*：
</p>
<ul class="org-ul">
<li>类型本身并不是真正的数据，它只是描述了数据应该怎么被构造出来</li>
<li>类型它需要有名字，占用的空间，包括一系列的属性和行为</li>
</ul>

<p>
通过某个类型模板创建实际的对象，称作 <b>实例化</b> 该类型:
</p>
<ul class="org-ul">
<li>它就是真正的数据。类型的实例，类型的对象。所有的数据都是要根据类型创建出来的</li>
<li>类型的话，要么是平台预定义的，要么是 BCL/FCL 中定义的，要么是你自己声明的</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">1 &#22768;&#26126;</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">xxx</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span>;
    <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>;
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">yyy</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span>;
    <span style="color: #228b22;">xxx</span> <span style="color: #a0522d;">xxx</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">2 &#20351;&#29992;</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">new</span> <span style="color: #228b22;">yyy</span><span style="color: #707183;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">2 &#20351;&#29992;</span>

<span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span> = 333; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#19981;&#38656;&#35201;&#22768;&#26126;&#65292;&#30452;&#25509;&#23454;&#20363;&#21270;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org82a47e3" class="outline-3">
<h3 id="org82a47e3"><span class="section-number-3">2.4.</span> 值类型 vs 引用类型</h3>
<div class="outline-text-3" id="text-2-4">
<p>
内存分为两部分:
</p>
<ul class="org-ul">
<li>栈 (Stack)，速度快</li>
<li>堆 (Heap)，容积大</li>
</ul>


<figure id="org9414d10">
<img src="img/value-type-ref-type.png" alt="value-type-ref-type.png" width="500px">

</figure>
</div>
</div>
</section>

<section id="outline-container-org0559329" class="outline-2">
<h2 id="org0559329"><span class="section-number-2">3.</span> 预定义数值类型</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org63d2929" class="outline-3">
<h3 id="org63d2929"><span class="section-number-3">3.1.</span> 整数</h3>
<div class="outline-text-3" id="text-3-1">
<p>
为了表示显示世界中的计算，人们发明了数字的记法:
</p>
<ul class="org-ul">
<li>通用的计算方式是 <b>十进制</b> (因为人自古来来，都有十根手指头)</li>
<li>计算机内部使用的是 <b>二进制</b> (因为使用电子元件状态表达 0/1 是最简单的)</li>
<li>人们一般使用 <b>十六进制</b> 来描述计算机中的二进制 (其表达能力更强，且能跟字节为单位的二进制形成对应关系)</li>
</ul>

<p>
为了能在计算机中有效存储整数，C# 中预定义了如下类型:
</p>
<ul class="org-ul">
<li>byte (字节，使用 8bit 表示，它的表现能力最差，只有 0 ~ 255)</li>
<li>short (短整数，使用 2Byte 表示，能表示到 3 万大小)</li>
<li>int (整数，4B 长度，能表达到 20 多亿)</li>
<li>long (长整数，16B 长度，能表达到亿亿的单位)</li>
</ul>

<p>
另外，考虑是否设置符号位 (Sign/Unsign)，上面的类型又有对应的类型:
</p>
<ul class="org-ul">
<li>sbyte</li>
<li>ushort</li>
<li>uint</li>
<li>ulong</li>
</ul>

<p>
上述的类型都是用来创建整数数据的模板，它们的区别在于占用空间和表达里。
选择类型的根据是:
</p>
<ul class="org-ul">
<li>占用小的，表达能力差；占用大的，表达能力强</li>
<li>在业务的允许范围内，尽量选择占用空间小的类型</li>
<li>如果不好决定使用声明类型，优先使用 int</li>
</ul>

<p>
整数:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">byte</span> <span style="color: #a0522d;">aa</span> = 0;
<span style="color: #228b22;">byte</span> <span style="color: #a0522d;">az</span> = 255;
<span style="color: #228b22;">sbyte</span> <span style="color: #a0522d;">ba</span> = -128;
<span style="color: #228b22;">sbyte</span> <span style="color: #a0522d;">bz</span> = 127;

<span style="color: #228b22;">short</span> <span style="color: #a0522d;">s1</span> = -32768;
<span style="color: #228b22;">short</span> <span style="color: #a0522d;">s2</span> = 32767;
<span style="color: #228b22;">ushort</span> <span style="color: #a0522d;">s3</span> = 0;
<span style="color: #228b22;">ushort</span> <span style="color: #a0522d;">s4</span> = 65535;

<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i1</span> = -2147483648;
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i2</span> = 21_4748_3647;
<span style="color: #228b22;">uint</span> <span style="color: #a0522d;">i3</span> = 42_9496_7295;

<span style="color: #228b22;">long</span> <span style="color: #a0522d;">l1</span> = 3232323232335555355;
<span style="color: #228b22;">ulong</span> <span style="color: #a0522d;">l2</span> = 23333333333333333;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>0.1 + 0.2<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>100 * 0.28<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>100 * 0.27<span style="color: #707183;">)</span>;

<span style="color: #228b22;">byte</span> <span style="color: #a0522d;">a</span> = 1;
<span style="color: #228b22;">short</span> <span style="color: #a0522d;">b</span> = 1;
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">c</span> = 1;
<span style="color: #228b22;">long</span> <span style="color: #a0522d;">d</span> = 1;

<span style="color: #b22222;">// </span><span style="color: #b22222;">C# &#29616;&#22312;&#20801;&#35768;&#20351;&#29992;&#20998;&#38548;&#31526;&#25551;&#36848;&#25968;&#23383;&#65292;&#36825;&#26679;&#20855;&#22791;&#26356;&#22909;&#30340;&#21487;&#35835;&#24615;</span>
<span style="color: #228b22;">long</span> <span style="color: #a0522d;">xxx</span> = 11_1161_1311_4441_2323;
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">yyy</span> = 2323;
</pre>
</div>

<p>
可以直接使用二进制/十六进制的方式描述数字:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">byte</span> <span style="color: #a0522d;">zzz</span> = 0b11111111;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>zzz<span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">16 &#36827;&#21046; 10 2 </span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">0,1,10,11,100,101,110,111</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">1,2,..9,10,11,12..19</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">1, 2,...9, a, b, c, d, e, f / 15, 1111</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">10, 11, 12 .. 1e, 1f     0001_1111</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">20,...............2f</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">30................3f</span>
<span style="color: #b22222;">//                   </span><span style="color: #b22222;">9f</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">a0................af</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">b0................bf</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">c0................cf</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">d0................df</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">e0................ef</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">f0..............fe.ff 256 1111_1111</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">100 .. 101. .....</span>

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>0b11111111_11111110_11111111<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>0x1e<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>0xff_fe_ab_12<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>2222323<span style="color: #707183;">)</span>;
</pre>
</div>


<figure id="orge913c3e">
<img src="img/integers.png" alt="integers.png" width="400px">

</figure>
</div>
</div>

<div id="outline-container-orgd900280" class="outline-3">
<h3 id="orgd900280"><span class="section-number-3">3.2.</span> 浮点数</h3>
<div class="outline-text-3" id="text-3-2">
<ul class="org-ul">
<li>根据存储形式，分为单精度 (float) 和双精度 (double)</li>
<li><b>float</b> 使用 32bit 来存储 (1 个符号位 8 个指数位 23 个尾数)</li>
<li><b>double</b> 使用 64bit 来存储 (1 个符号位 11 个指数位 52 个尾数)</li>
<li>一个小数，转换为计算机存储的形式，难免会有精度的损失。因此
<ul class="org-ul">
<li>0.1 + 0.2 ≠ 0.3</li>
<li>0.6 + 0.7 = 1.2999999999999998</li>
<li>0.28 * 100 = 28.000000000000004</li>
</ul></li>
<li>可以使用 <b>decimal</b> 类型，来表示更加精确的数值计算
<ul class="org-ul">
<li>它的优点是，可以进行精确的计算</li>
<li>它的缺点是，它需要占用更大的存储空间 (128bit)</li>
</ul></li>
</ul>


<figure id="orge22cbda">
<img src="img/float-type.png" alt="float-type.png" width="500px">

</figure>
</div>
</div>

<div id="outline-container-org176c74c" class="outline-3">
<h3 id="org176c74c"><span class="section-number-3">3.3.</span> Literate (字面量表达)</h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#23383;&#38754;&#37327;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">1112 int</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">1112L long</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">1112UL Unsigned Long</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">1112F float</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">1112.0 double</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">1112M decimal</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>0.1M + 0.2M<span style="color: #707183;">)</span>;

<span style="color: #228b22;">double</span> <span style="color: #a0522d;">a</span> = 2222;
<span style="color: #228b22;">float</span> <span style="color: #a0522d;">b1</span> = 33332332323233;
<span style="color: #228b22;">float</span> <span style="color: #a0522d;">b2</span> = 2323F;
<span style="color: #228b22;">decimal</span> <span style="color: #a0522d;">c</span> = 3.222M;

<span style="color: #228b22;">int</span> <span style="color: #a0522d;">x</span> = 333;
<span style="color: #228b22;">long</span> <span style="color: #a0522d;">y1</span> = 54444;
<span style="color: #228b22;">long</span> <span style="color: #a0522d;">y2</span> = 54444L;
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org119130a" class="outline-2">
<h2 id="org119130a"><span class="section-number-2">4.</span> 预定义/非数值·值类型</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org0f543da" class="outline-3">
<h3 id="org0f543da"><span class="section-number-3">4.1.</span> 字符类型 (char)</h3>
<div class="outline-text-3" id="text-4-1">
<p>
字符集/编码格式:
</p>
<ul class="org-ul">
<li>最原始的英文中的 <b>ASCII</b> 编码</li>
<li>后来出现的，各个国家的，比如 <b>GBK/Big5</b></li>
<li>为了消除字符集冲突，出现的 <b>Unicode</b> 组织跟字符集。并根据字符集出现了 <b>UTF-16/UTF-8</b> 等编码格式</li>
</ul>

<p>
Q &amp; A:
</p>
<ul class="org-ul">
<li>ucs-2 vs UTF-16 ????</li>
<li>UTF8 怎么的格式 ????</li>
</ul>


<figure id="org21f4112">
<img src="img/unicode.png" alt="unicode.png" width="500px">

</figure>

<p>
因此，在 C# 中内部，字符是使用 UTF-16 格式存储的。
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">char</span> <span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'x'</span>;

<span style="color: #228b22;">char</span> <span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'x'</span>;
<span style="color: #228b22;">char</span> <span style="color: #a0522d;">b</span> = <span style="color: #8b2252;">'&#20013;'</span>;
<span style="color: #228b22;">char</span> <span style="color: #a0522d;">c</span> = <span style="color: #8b2252;">'&#9786;'</span>;
<span style="color: #228b22;">char</span> <span style="color: #a0522d;">d</span> = <span style="color: #8b2252;">'&#8286;'</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6d49662" class="outline-3">
<h3 id="org6d49662"><span class="section-number-3">4.2.</span> 布尔类型 (bool)</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">bool</span> <span style="color: #a0522d;">a</span> = <span style="color: #008b8b;">true</span>;
<span style="color: #228b22;">bool</span> <span style="color: #a0522d;">b</span> = <span style="color: #008b8b;">false</span>;

<span style="color: #228b22;">bool</span> <span style="color: #a0522d;">c</span> = 1 &gt; 2; <span style="color: #b22222;">// </span><span style="color: #b22222;">&gt; &lt; == &gt;= &lt;=</span>
<span style="color: #228b22;">bool</span> <span style="color: #a0522d;">d</span> = 1 == 2;

a = !!!!!a; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21453;</span>
a || b;     <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25110;</span>
a &amp;&amp; b;     <span style="color: #b22222;">// </span><span style="color: #b22222;">&#19982;</span>

a = <span style="color: #008b8b;">true</span>; b = <span style="color: #008b8b;">false</span>; d = <span style="color: #008b8b;">true</span>; e = <span style="color: #008b8b;">false</span>;
f = <span style="color: #008b8b;">true</span>; g = <span style="color: #008b8b;">true</span>; h = <span style="color: #008b8b;">false</span>;

<span style="color: #707183;">(</span><span style="color: #7388d6;">(</span>a || b<span style="color: #7388d6;">)</span> &amp;&amp; <span style="color: #7388d6;">(</span>c &amp;&amp; d<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span> || e &amp;&amp; <span style="color: #707183;">(</span>f || g<span style="color: #707183;">)</span> || h;
</pre>
</div>
</div>

<div id="outline-container-org6292f00" class="outline-4">
<h4 id="org6292f00"><span class="section-number-4">4.2.1.</span> [条件分支] 在某种条件之下，做某件事</h4>
<div class="outline-text-4" id="text-4-2-1">
<ul class="org-ul">
<li>if/else if/else</li>
<li>switch (statement/expression)</li>
</ul>

<p>
if:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #b22222;">// </span><span style="color: #b22222;">1</span>
<span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span>aaa<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#28385;&#36275;&#21017;&#25191;&#34892;&#65292;&#21542;&#21017;&#36339;&#36807;"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#24744;&#35828;&#25105;&#20160;&#20040;&#26465;&#20214;&#20250;&#34987;&#25191;&#34892;?"</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">2</span>
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">score</span> = 59; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20998;&#25968;</span>
<span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span>score &gt; 70<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"&#29616;&#22312;&#20320;&#30340;&#25104;&#32489;&#26159;: {score}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">else</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#25104;&#32489;&#36824;&#21487;&#20197;&#21862;&#65292;&#35831;&#19979;&#19968;&#27425;&#26356;&#21152;&#20248;&#31168;&#21734;."</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">3</span>
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">score</span> = 59;
<span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span>score &gt; 70<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"&#29616;&#22312;&#20320;&#30340;&#25104;&#32489;&#26159;: {score}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">else</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>score &lt; 30<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24744;&#22826;&#26834;&#20102;&#65292;&#25226;&#24744;&#29240;&#29240;&#22920;&#22920;&#35831;&#36807;&#26469;&#19968;&#36215;&#20998;&#20139;&#36825;&#20221;&#33635;&#32768;&#21543;."</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">else</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>score &gt; 60<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#25104;&#32489;&#36824;&#21487;&#20197;&#21862;&#65292;&#35831;&#19979;&#19968;&#27425;&#26356;&#21152;&#20248;&#31168;&#21734;."</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#25104;&#32489;&#36824;&#21487;&#20197;&#21862;..."</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">4</span>
<span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span>score &gt; 70<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"&#29616;&#22312;&#20320;&#30340;&#25104;&#32489;&#26159;: {score}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span>score &gt; 60<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#25104;&#32489;&#36824;&#21487;&#20197;&#21862;&#65292;&#35831;&#19979;&#19968;&#27425;&#26356;&#21152;&#20248;&#31168;&#21734;."</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span>score &gt; 30<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#24744;&#30340;&#25104;&#32489;&#36824;&#21487;&#20197;&#21862;..."</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">else</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#24744;&#22826;&#26834;&#20102;&#65292;&#25226;&#24744;&#29240;&#29240;&#22920;&#22920;&#35831;&#36807;&#26469;&#19968;&#36215;&#20998;&#20139;&#36825;&#20221;&#33635;&#32768;&#21543;."</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
switch (是 else if 语法的一种精简版):
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">switch</span> <span style="color: #707183;">(</span>c<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">case</span> <span style="color: #8b2252;">'A'</span>:
    <span style="color: #a020f0;">case</span> <span style="color: #8b2252;">'B'</span>:
        color = ConsoleColor.Yellow;
        <span style="color: #a020f0;">break</span>;
    <span style="color: #a020f0;">case</span> <span style="color: #8b2252;">'C'</span>:
        color = ConsoleColor.Green;
        <span style="color: #a020f0;">break</span>;
    <span style="color: #a020f0;">case</span> <span style="color: #8b2252;">'D'</span>:
        color = ConsoleColor.Blue;
        <span style="color: #a020f0;">break</span>;
    <span style="color: #a020f0;">default</span>:
        color = ConsoleColor.Black;
        <span style="color: #a020f0;">break</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
switch statement (语句) 和 expression (表达式):
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#35821;&#21477;&#65292;&#27599;&#20010;&#20998;&#25903;&#21435;&#20570;&#28857;&#21861;&#20107;</span>
<span style="color: #228b22;">ConsoleColor</span> <span style="color: #a0522d;">color</span>;
<span style="color: #a020f0;">switch</span> <span style="color: #707183;">(</span>c<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">case</span> <span style="color: #8b2252;">'A'</span>:
        color = ConsoleColor.Red;
        <span style="color: #a020f0;">break</span>;
    <span style="color: #a020f0;">case</span> <span style="color: #8b2252;">'B'</span>:
        color = ConsoleColor.Yellow;
        <span style="color: #a020f0;">break</span>;
    <span style="color: #a020f0;">case</span> <span style="color: #8b2252;">'C'</span>:
        color = ConsoleColor.Green;
        <span style="color: #a020f0;">break</span>;
    <span style="color: #a020f0;">case</span> <span style="color: #8b2252;">'D'</span>:
        color = ConsoleColor.Blue;
        <span style="color: #a020f0;">break</span>;
    <span style="color: #a020f0;">default</span>:
        color = ConsoleColor.Black;
        <span style="color: #a020f0;">break</span>;
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#34920;&#36798;&#24335;&#65292;&#36820;&#22238;&#20540;</span>
<span style="color: #228b22;">ConsoleColor</span> <span style="color: #a0522d;">c1</span> = c <span style="color: #a020f0;">switch</span>
<span style="color: #707183;">{</span>
    <span style="color: #8b2252;">'A'</span> =&gt; ConsoleColor.Red,
    <span style="color: #8b2252;">'B'</span> =&gt; ConsoleColor.Yellow,
    <span style="color: #8b2252;">'C'</span> =&gt; ConsoleColor.Green,
    <span style="color: #8b2252;">'D'</span> =&gt; ConsoleColor.Blue,
    _   =&gt; ConsoleColor.Black
<span style="color: #707183;">}</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd14fa0c" class="outline-4">
<h4 id="orgd14fa0c"><span class="section-number-4">4.2.2.</span> [循环迭代] 重复做某件事</h4>
<div class="outline-text-4" id="text-4-2-2">
<ul class="org-ul">
<li>for</li>
<li>while</li>
<li>do while</li>
<li>foreach</li>
</ul>

<p>
遍历字符串:
</p>
<div class="org-src-container">
<pre class="src src-csx"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">s</span> = <span style="color: #8b2252;">"hello world"</span>;

<span style="color: #a020f0;">foreach</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">c</span> <span style="color: #a020f0;">in</span> s<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>c<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; s.Length; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>s<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0;
<span style="color: #a020f0;">while</span> <span style="color: #707183;">(</span>i &lt; s.Length<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>s<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span><span style="color: #7388d6;">)</span>;
    i++;
<span style="color: #707183;">}</span>

<span style="color: #228b22;">int</span> <span style="color: #a0522d;">j</span> = 0;
<span style="color: #a020f0;">do</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>s<span style="color: #909183;">[</span>j<span style="color: #909183;">]</span><span style="color: #7388d6;">)</span>;
    j++;
<span style="color: #707183;">}</span> <span style="color: #a020f0;">while</span> <span style="color: #707183;">(</span>j &lt; s.Length<span style="color: #707183;">)</span>;
</pre>
</div>


<p>
使用不同的方式，实现从 1 加到 10000 的和:
</p>
<div class="org-src-container">
<pre class="src src-csx"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#21629;&#21517;&#19981;&#35268;&#33539;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">- &#26041;&#27861;&#21517;&#65292;&#38656;&#35201;&#36981;&#24490; Pascal &#35821;&#27861; !!!</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">- &#21464;&#37327;&#30340;&#21629;&#21517;&#65292;&#35201;&#35753;&#20195;&#30721;&#20855;&#22791;&#33258;&#35299;&#37322;&#24615; (&#26395;&#25991;&#29983;&#20041;)</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">- &#21464;&#37327;&#30340;&#21517;&#23383;/&#21442;&#25968;&#30340;&#21464;&#37327;&#65292;&#38656;&#35201;&#26159;&#39548;&#23792;&#20889;&#27861;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20174; 1 &#21040; 10000 &lt;&#19981;&#31561;&#20110;&gt; &#20174; 0 &#21040; 10000&#12290;&#24490;&#29615;&#30340;&#36807;&#31243;&#19968;&#23450;&#35201;&#27880;&#24847;&#36793;&#30028;&#26465;&#20214;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#21512;&#29702;&#35774;&#35745;&#26041;&#27861; (&#36820;&#22238;&#20540;)</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20805;&#20998;&#32771;&#34385;&#21040;&#21487;&#21464;&#24615;&#65292;&#23558;&#19968;&#20123;&#20540;&#25277;&#21462;&#20026;&#21442;&#25968;</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 10000;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #0000ff;">SumWithFor</span><span style="color: #909183;">(</span>i<span style="color: #909183;">)</span> / 2<span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #0000ff;">SumWithWhile</span><span style="color: #909183;">(</span>i<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #0000ff;">SumWithDoWhile</span><span style="color: #909183;">(</span>i<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">SumWithFor</span><span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">top</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span> = 0;
    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 1; i &lt;= top; i++<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        sum += i;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">return</span> sum;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">SumWithWhile</span><span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">top</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span> = 0;

    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 1;
    <span style="color: #a020f0;">while</span> <span style="color: #7388d6;">(</span>i &lt;= top<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        sum += i;
        i++;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">return</span> sum;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">SumWithDoWhile</span><span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">top</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span> = 0;

    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 1;
    <span style="color: #a020f0;">do</span>
    <span style="color: #7388d6;">{</span>
        sum += i;
        i++;
    <span style="color: #7388d6;">}</span> <span style="color: #a020f0;">while</span> <span style="color: #7388d6;">(</span>i &lt;= top<span style="color: #7388d6;">)</span>;

    <span style="color: #a020f0;">return</span> sum;
<span style="color: #707183;">}</span>
</pre>
</div>


<p>
通过循环的方式，处理下面字符串:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558;&#23383;&#31526;&#20018;&#36827;&#34892;&#21453;&#36716;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558;&#25152;&#26377;&#30340;&#22823;&#20889;&#23383;&#27597;&#37117;&#25552;&#21040;&#21069;&#38754;</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">"hekjsdkfSldAfjKksjsjkKFfjHkl"</span>;

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">Fanzhuan</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">str</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">string</span> <span style="color: #a0522d;">result</span> = <span style="color: #8b2252;">""</span>;
    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = str.Length-1; i&gt;=0 ; i--<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        result += str<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">return</span> result;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">DaxieTiDaoQianMianWithFor</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">str</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">StringBuilder</span> <span style="color: #a0522d;">xiaoxie</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #7388d6;">()</span>;
    <span style="color: #228b22;">StringBuilder</span> <span style="color: #a0522d;">daxie</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #7388d6;">()</span>;
    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; str.Length; i++<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>str<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span> &gt;= <span style="color: #8b2252;">'a'</span> &amp;&amp; str<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span> &lt;= <span style="color: #8b2252;">'z'</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            xiaoxie.<span style="color: #0000ff;">Append</span><span style="color: #709870;">(</span>str<span style="color: #907373;">[</span>i<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            daxie.<span style="color: #0000ff;">Append</span><span style="color: #709870;">(</span>str<span style="color: #907373;">[</span>i<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    daxie.<span style="color: #0000ff;">Append</span><span style="color: #7388d6;">(</span>xiaoxie<span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">return</span> daxie.<span style="color: #0000ff;">ToString</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6252d1e" class="outline-4">
<h4 id="org6252d1e"><span class="section-number-4">4.2.3.</span> 语句 (Statement) vs 表达式 (Expression)</h4>
<div class="outline-text-4" id="text-4-2-3">
<p>
提问:  <span style="color: red">表达式和语句有社么区别?</span>
</p>

<p>
语句 (Statement):
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">int</span> <span style="color: #a0522d;">r</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Random</span><span style="color: #707183;">()</span>.<span style="color: #0000ff;">Next</span><span style="color: #707183;">(</span>0, 100<span style="color: #707183;">)</span>;

<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span>;
<span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span>r &gt; 50<span style="color: #707183;">)</span>
    i = 111;
<span style="color: #a020f0;">else</span>
    i = 222;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>i<span style="color: #707183;">)</span>;
</pre>
</div>

<p>
表达式 (Expression):
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">int</span> <span style="color: #a0522d;">r</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Random</span><span style="color: #707183;">()</span>.<span style="color: #0000ff;">Next</span><span style="color: #707183;">(</span>0, 100<span style="color: #707183;">)</span>;

<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = <span style="color: #707183;">(</span>
    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>r &gt; 50<span style="color: #7388d6;">)</span>
        111;
    <span style="color: #a020f0;">else</span>
        222;
<span style="color: #707183;">)</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>i<span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">if &#19981;&#33021;&#20316;&#20026;&#34920;&#36798;&#24335;&#20351;&#29992;</span>
</pre>
</div>
</div>
</div>
</div>
</section>

<section id="outline-container-org2a0ed18" class="outline-2">
<h2 id="org2a0ed18"><span class="section-number-2">5.</span> 预定义/非数值·引用类型</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orge4dda6d" class="outline-3">
<h3 id="orge4dda6d"><span class="section-number-3">5.1.</span> string</h3>
<div class="outline-text-3" id="text-5-1">
<p>
字符串，是由字符序列组成的一种数据结构。
</p>
</div>

<div id="outline-container-orgea1a0e9" class="outline-4">
<h4 id="orgea1a0e9"><span class="section-number-4">5.1.1.</span> 字符串的初始化</h4>
<div class="outline-text-4" id="text-5-1-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">g1</span> = <span style="color: #8b2252;">"Hello World!"</span>;
System.<span style="color: #228b22;">String</span> <span style="color: #a0522d;">g2</span> = <span style="color: #8b2252;">"Hello World!"</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">g3</span> = <span style="color: #8b2252;">"Hello World!"</span>;

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">message1</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">message2</span> = <span style="color: #008b8b;">null</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">message3</span> = String.Empty; <span style="color: #b22222;">// </span><span style="color: #b22222;">string message3 = "";</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">oldPath</span> = <span style="color: #8b2252;">"Path:\nc:\\Program Files\\Microsoft Visual Studio 8.0"</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">newPath</span> = @<span style="color: #8b2252;">"Path:</span>
<span style="color: #8b2252;">c:\Program Files\Microsoft Visual Studio 9.0"</span>;

<span style="color: #228b22;">char</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">letters</span> = <span style="color: #707183;">{</span> <span style="color: #8b2252;">'A'</span>, <span style="color: #8b2252;">'B'</span>, <span style="color: #8b2252;">'C'</span> <span style="color: #707183;">}</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">alphabet</span> = <span style="color: #a020f0;">new</span> <span style="color: #0000ff;">string</span><span style="color: #707183;">(</span>letters<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga509b0c" class="outline-4">
<h4 id="orga509b0c"><span class="section-number-4">5.1.2.</span> 字符串的不可变性 (Immutable)</h4>
<div class="outline-text-4" id="text-5-1-2">
</div>
<div id="outline-container-org2e66dd9" class="outline-5">
<h5 id="org2e66dd9"><span class="section-number-5">5.1.2.1.</span> what &amp; why</h5>
<div class="outline-text-5" id="text-5-1-2-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">b</span>;


<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 1; <span style="color: #b22222;">// </span><span style="color: #b22222;">int i; i = 1;</span>
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">j</span> = 23;
i += j; <span style="color: #b22222;">// </span><span style="color: #b22222;">i = i + j; i = 24;</span>

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s</span> = <span style="color: #8b2252;">"h"</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">t</span> = <span style="color: #8b2252;">"w"</span>;
s += t; <span style="color: #b22222;">// </span><span style="color: #b22222;">s = s + t;</span>
</pre>
</div>


<figure id="org06e448f">
<img src="img/string-immute.png" alt="string-immute.png" width="400px">

</figure>


<p>
字符串是不可更改的:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">s</span> = <span style="color: #8b2252;">"hello"</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s<span style="color: #7388d6;">[</span>1<span style="color: #7388d6;">]</span><span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21487;&#20197;&#36890;&#36807;&#36825;&#31181;&#26041;&#24335;&#35835;&#21462;&#23383;&#31526;&#20018;&#30340;&#26576;&#20010;&#20301;&#32622;</span>
s<span style="color: #707183;">[</span>1<span style="color: #707183;">]</span> = <span style="color: #8b2252;">'x'</span>;              <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36825;&#19968;&#21477;&#26159;&#38169;&#35823;&#30340;</span>
</pre>
</div>

<p>
思考:
</p>
<ul class="org-ul">
<li>为什么要搞成不可变的 ?</li>
<li>不可变能带来什么好处 ?</li>
</ul>
</div>
</div>

<div id="outline-container-org3d244a1" class="outline-5">
<h5 id="org3d244a1"><span class="section-number-5">5.1.2.2.</span> System.Text.StringBuilder</h5>
<div class="outline-text-5" id="text-5-1-2-2">
<p>
这是 BCL 中提供的一个类，专门使用在 <b>字符串拼接</b> 的场景下。
</p>

<p>
因为，在预定义的字符串实现中，字符串拼接 (+=) 是非常低效的一种行为 (要去理解为什么)。
</p>


<figure id="orgf99a972">
<img src="img/string-vs-stringbuilder.png" alt="string-vs-stringbuilder.png" width="500px">

</figure>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>.<span style="color: #a0522d;">Text</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#35299;&#26512;&#19968;&#19979;&#65292;&#20026;&#20160;&#20040;&#36825;&#27573;&#20195;&#30721;&#20250;&#20026;&#20869;&#23384;&#24102;&#26469;&#22823;&#37327;&#30340;&#22403;&#22334;</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s</span> = <span style="color: #8b2252;">"hello"</span>;
<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 1000; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    s += <span style="color: #8b2252;">"."</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>s<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#35201;&#29702;&#35299;&#65292;&#20026;&#20160;&#20040; StringBuilder &#20250;&#21344;&#29992;&#26356;&#23569;&#30340;&#31354;&#38388;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#20309;&#29702;&#24615;&#30475;&#24453; String vs StringBuilder &#20004;&#31181;&#31867;&#22411;</span>
<span style="color: #228b22;">StringBuilder</span> <span style="color: #a0522d;">sb</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 1000; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    sb.<span style="color: #0000ff;">Append</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"."</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>sb<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span>s == sb.<span style="color: #0000ff;">ToString</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#21704;&#21704;&#65292;&#19968;&#26679;&#21834;"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3eea77" class="outline-5">
<h5 id="orga3eea77"><span class="section-number-5">5.1.2.3.</span> String Intern Pool (字符串池)</h5>
<div class="outline-text-5" id="text-5-1-2-3">
<p>
因为字符串是不可变的，所以在字符串的操作中，会产生很多临时字符串 (垃圾)。
</p>

<p>
在实际使用中，有很多字符串我们会反复去使用的，所以为了避免重复进行字符串的创建，
会对字符串操作过程中产生的字符串进行缓存管理，即创建一个字符串池管理它们。
</p>

<p>
后续进行字符串的声明时，会优先到池中寻找，如果已经存在，那么直接使用它。
</p>

<p>
字符串池的根本原因是，字符串是不可变的。
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">"hello"</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">b</span> = <span style="color: #8b2252;">"hel"</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">c</span> = <span style="color: #8b2252;">"lo"</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">d</span> = b + c;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">e</span> = <span style="color: #8b2252;">"hello"</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992; == &#21028;&#26029;&#65292;&#20004;&#20010;&#23383;&#31526;&#20018;&#30340;&#20540;&#26159;&#19981;&#26159;&#19968;&#26679;&#30340;</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>a == d<span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">True</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>a == e<span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">True</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992; object.ReferenceEquals &#21028;&#23450;&#26159;&#21542;&#21344;&#29992;&#20102;&#30456;&#21516;&#30340;&#20869;&#23384;&#31354;&#38388;</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #228b22;">object</span>.<span style="color: #0000ff;">ReferenceEquals</span><span style="color: #7388d6;">(</span>a, d<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">False</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #228b22;">object</span>.<span style="color: #0000ff;">ReferenceEquals</span><span style="color: #7388d6;">(</span>a, e<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">True</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#27880;&#24847;&#65292;&#31867;&#27604; Java:</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">a == b &#21028;&#26029;&#30340;&#26159; a &#36319; b &#26159;&#21542;&#26159;&#21516;&#19968;&#20010;&#24341;&#29992;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">a.equals(b) &#29992;&#26469;&#21028;&#26029; a &#36319; b &#30340;&#20540;&#26159;&#19981;&#26159;&#19968;&#26679;&#30340;</span>
<span style="color: #b22222;">//</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">string a = null;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">string b = "hello";</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">a.equals(b) -&gt; b.equals(a);</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">"hello".equal(a); (1)</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">if (a != null) a.equal("hello"); (2)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8bd5cd4" class="outline-4">
<h4 id="org8bd5cd4"><span class="section-number-4">5.1.3.</span> [API] 基本操作</h4>
<div class="outline-text-4" id="text-5-1-3">
<p>
API (Application Programming Interface) 应用程序编程接口。
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">s1</span> = <span style="color: #8b2252;">"aaa"</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s2</span> = <span style="color: #8b2252;">"&#24744;&#22909;aaa"</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s3</span> = <span style="color: #8b2252;">"&#131603;&#22909;aaa"</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s1.Length<span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#30001;&#22810;&#23569;&#20010;&#23383;&#31526;&#32452;&#25104;</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s2.Length<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s3.Length<span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36825;&#20010;&#20026;&#20160;&#20040;&#26159; 6 ?</span>

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s4</span> = <span style="color: #8b2252;">"&#20013;&#22269;&#131603;&#24744;&#22909;&#131603;blahblaah&#20013;&#21326;&#131603;&#20320;&#20204;&#37117;&#26159;&#21861;kdjfkdjkdfdkjlah&#20013;&#21326;&#131603;&#20320;&#20204;&#37117;&#26159;&#21861;kdjfkdjkdfdkjlah&#20013;&#21326;&#131603;&#20320;&#20204;&#37117;&#26159;&#21861;kdjfkdjkdfdkjlah&#20013;&#21326;&#131603;&#20320;&#20204;&#37117;&#26159;&#21861;kdjfkdjkdfdkjlah&#20013;&#21326;&#131603;&#20320;&#20204;&#37117;&#26159;&#21861;kdjfkdjkdfdkjlah&#20013;&#21326;&#131603;&#20320;&#20204;&#37117;&#26159;&#21861;kdjfkdjkdfdkjlah&#20013;&#21326;&#131603;&#20320;&#20204;&#37117;&#26159;&#21861;kdjfkdjkdfdkjlah&#20013;&#21326;&#131603;&#20320;&#20204;&#37117;&#26159;&#21861;kdjfkdjkdfdkjlah&#20013;&#21326;&#131603;&#20320;&#20204;&#37117;&#26159;&#21861;kdjfkdjkdfdkjf"</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s4.Length<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringInfo</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">s4</span><span style="color: #7388d6;">)</span>.LengthInTextElements<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org902e17f" class="outline-4">
<h4 id="org902e17f"><span class="section-number-4">5.1.4.</span> [API] 拼接 + 格式化</h4>
<div class="outline-text-4" id="text-5-1-4">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"tom"</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">friend</span> = <span style="color: #8b2252;">"jerry"</span>;
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span> = 30;
<span style="color: #228b22;">decimal</span> <span style="color: #a0522d;">sal</span> = 200.12345M;

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">r1</span> = name + <span style="color: #8b2252;">"&#30340;&#26379;&#21451;&#26159;"</span>
                 + friend + <span style="color: #8b2252;">"&#65292;&#23427;&#34429;&#28982;&#21482;&#26377;"</span>
                 + age + <span style="color: #8b2252;">"&#23681;&#65292;&#20294;&#26159;&#23427;&#30340;&#25910;&#20837;&#33021;&#21040;&#36798;&#21040;"</span>
                 + sal + <span style="color: #8b2252;">"&#20992;"</span>;

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">r2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #707183;">()</span>
    .<span style="color: #0000ff;">Append</span><span style="color: #707183;">(</span>name<span style="color: #707183;">)</span>
    .<span style="color: #0000ff;">Append</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#30340;&#26379;&#21451;&#26159;"</span><span style="color: #707183;">)</span>
    .<span style="color: #0000ff;">Append</span><span style="color: #707183;">(</span>friend<span style="color: #707183;">)</span>
    .<span style="color: #0000ff;">Append</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#65292;&#23427;&#34429;&#28982;&#21482;&#26377;"</span><span style="color: #707183;">)</span>
    .<span style="color: #0000ff;">Append</span><span style="color: #707183;">(</span>age<span style="color: #707183;">)</span>
    .<span style="color: #0000ff;">Append</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#23681;&#65292;&#20294;&#26159;&#23427;&#30340;&#25910;&#20837;&#33021;&#21040;&#36798;&#21040;"</span><span style="color: #707183;">)</span>
    .<span style="color: #0000ff;">Append</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span>
    .<span style="color: #0000ff;">Append</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#20992;"</span><span style="color: #707183;">)</span>
    .<span style="color: #0000ff;">ToString</span><span style="color: #707183;">()</span>;

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">r3</span> = <span style="color: #228b22;">string</span>.<span style="color: #0000ff;">Format</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"{0}&#30340;&#26379;&#21451;&#26159;{1}&#65292;&#23427;&#34429;&#28982;&#21482;&#26377;{2}&#23681;&#65292;&#20294;&#26159;&#23427;&#30340;&#25910;&#20837;&#36798;&#21040;{3:C}"</span>, name, friend, age, sal<span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">{&#21464;&#37327;,&#23545;&#40784;&#22810;&#23569;&#38271;&#24230;:&#26684;&#24335;}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">[&#23545;&#40784;] &#27491;&#25968;&#34920;&#31034;&#21491;&#23545;&#40784;&#65292;&#36127;&#25968;&#34920;&#31034;&#24038;&#23545;&#40784;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">[&#26684;&#24335;] P &#30334;&#20998;&#27604; C &#36135;&#24065; E &#31185;&#23398;&#35745;&#25968;&#27861; D &#34917;&#40784;&#38271;&#24230; F/N &#23567;&#25968;&#28857;&#22810;&#23569;&#20301; X &#21313;&#20845;&#36827;&#21046;</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">r4</span> = $<span style="color: #8b2252;">"{name}&#30340;&#26379;&#21451;&#26159;{friend}&#65292;&#23427;&#34429;&#28982;&#21482;&#26377;{age:d5}&#23681;&#65292;&#20294;&#26159;&#23427;&#30340;&#25910;&#20837;&#36798;&#21040;{sal:C}!"</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#35821;&#35328;-&#22269;&#23478;&#25110;&#21306;&#22495;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">zh-CN</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">en-US</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">en-EN</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">ss</span> = sal.<span style="color: #0000ff;">ToString</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"C"</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">CultureInfo</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"en-US"</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">r5</span> = $<span style="color: #8b2252;">"{name}&#30340;&#26379;&#21451;&#26159;{friend}&#65292;&#23427;&#34429;&#28982;&#21482;&#26377;{age:d5}&#23681;&#65292;&#20294;&#26159;&#23427;&#30340;&#25910;&#20837;&#36798;&#21040;{ss}!"</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>r5<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org330335b" class="outline-4">
<h4 id="org330335b"><span class="section-number-4">5.1.5.</span> [API] 子字符串</h4>
<div class="outline-text-4" id="text-5-1-5">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">s1</span> = <span style="color: #8b2252;">"000o&#12290;OOOoOO0O0Ooo000o"</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#21462;</span>
<span style="color: #228b22;">char</span> <span style="color: #a0522d;">c</span> = s1<span style="color: #707183;">[</span>1<span style="color: #707183;">]</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21462;&#23383;&#31526;</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s2</span> = s1.<span style="color: #0000ff;">Substring</span><span style="color: #707183;">(</span>1, 2<span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20301;&#32622;&#65292;&#38271;&#24230; : el</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s3</span> = s1.<span style="color: #0000ff;">Substring</span><span style="color: #707183;">(</span>2<span style="color: #707183;">)</span>;    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20174;&#26576;&#20010;&#20301;&#32622;&#21040;&#26368;&#21518;</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s4</span> = s1.<span style="color: #0000ff;">Substring</span><span style="color: #707183;">(</span>2, 0<span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">String.Empty ""</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#21028;</span>
<span style="color: #228b22;">bool</span> <span style="color: #a0522d;">b1</span> = s1.<span style="color: #0000ff;">Contains</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"o0"</span><span style="color: #707183;">)</span>;    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26159;&#21542;&#21253;&#21547;&#19968;&#20010;&#23376;&#23383;&#31526;&#20018;</span>
<span style="color: #228b22;">bool</span> <span style="color: #a0522d;">b2</span> = s1.<span style="color: #0000ff;">StartsWith</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"o"</span><span style="color: #707183;">)</span>;   <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26159;&#19981;&#26159;&#20197; x &#24320;&#22987;</span>
<span style="color: #228b22;">bool</span> <span style="color: #a0522d;">b3</span> = s1.<span style="color: #0000ff;">EndsWith</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"o"</span><span style="color: #707183;">)</span>;     <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26159;&#19981;&#26159;&#20197; x &#32467;&#26463;&#30340;</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#24207;</span>
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i1</span> = s1.<span style="color: #0000ff;">IndexOf</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"O"</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i2</span> = s1.<span style="color: #0000ff;">LastIndexOf</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"O"</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i3</span> = s1.<span style="color: #0000ff;">IndexOfAny</span><span style="color: #707183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #7388d6;">[]{</span><span style="color: #8b2252;">'o'</span>, <span style="color: #8b2252;">'O'</span><span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#32467;&#21512;</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">path</span> = <span style="color: #8b2252;">"C:/aaa/work.x/hello.txt"</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">drive</span> = path.<span style="color: #0000ff;">Substring</span><span style="color: #707183;">(</span>0, path.<span style="color: #0000ff;">IndexOf</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">":"</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">dir</span> = path.<span style="color: #0000ff;">Substring</span><span style="color: #707183;">(</span>0, path.<span style="color: #0000ff;">LastIndexOf</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/"</span><span style="color: #7388d6;">)</span> + 1<span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">file</span> = path.<span style="color: #0000ff;">Substring</span><span style="color: #707183;">(</span>path.<span style="color: #0000ff;">LastIndexOf</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/"</span><span style="color: #7388d6;">)</span> + 1<span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">ext</span> = path.<span style="color: #0000ff;">Substring</span><span style="color: #707183;">(</span>path.<span style="color: #0000ff;">LastIndexOf</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"."</span><span style="color: #7388d6;">)</span> + 1<span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#33258;&#23450;&#20041;&#29256;&#26412;&#30340; LastIndexOf</span>
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">p</span> = 0;
<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = path.Length - 1; i &gt;= 0; i--<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>path<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span> == <span style="color: #8b2252;">'/'</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        p = i;
        <span style="color: #a020f0;">break</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">dir2</span> = path.<span style="color: #0000ff;">Substring</span><span style="color: #707183;">(</span>0, p<span style="color: #707183;">)</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>dir2<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgebb94db" class="outline-4">
<h4 id="orgebb94db"><span class="section-number-4">5.1.6.</span> [API] 字符串的修改</h4>
<div class="outline-text-4" id="text-5-1-6">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#35880;&#35760;:</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20462;&#25913;&#19981;&#20250;&#20316;&#29992;&#22312;&#21407;&#20808;&#30340;&#23383;&#31526;&#20018;&#19978;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#25152;&#26377;&#30340;&#20462;&#25913;&#65292;&#37117;&#26159;&#36820;&#22238;&#20102;&#19968;&#20010;&#23436;&#20840;&#23853;&#26032;&#30340;&#23383;&#31526;&#20018;</span>

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s1</span> = <span style="color: #8b2252;">"  000o&#12290;OOOoOO0O&#65292;0Ooo000o--"</span>;

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s2</span> = s1.<span style="color: #0000ff;">Insert</span><span style="color: #707183;">(</span>3, <span style="color: #8b2252;">"&gt;&gt;&gt;"</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s3</span> = s1.<span style="color: #0000ff;">Remove</span><span style="color: #707183;">(</span>2, 1<span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s4</span> = s1.<span style="color: #0000ff;">Replace</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#12290;"</span>, <span style="color: #8b2252;">"."</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s5</span> = s1.<span style="color: #0000ff;">Replace</span><span style="color: #707183;">(</span><span style="color: #8b2252;">'&#65292;'</span>, <span style="color: #8b2252;">'_'</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s6</span> = s1.<span style="color: #0000ff;">Replace</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"OoO"</span>, <span style="color: #8b2252;">"111"</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s7</span> = s1.<span style="color: #0000ff;">Replace</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"OoO"</span>, <span style="color: #8b2252;">"222"</span>, <span style="color: #008b8b;">true</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">CultureInfo</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"zh-CN"</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s8</span> = s1.<span style="color: #0000ff;">PadLeft</span><span style="color: #707183;">(</span>100<span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s9</span> = s1.<span style="color: #0000ff;">PadLeft</span><span style="color: #707183;">(</span>100, <span style="color: #8b2252;">'-'</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">sa</span> = s1.<span style="color: #0000ff;">PadRight</span><span style="color: #707183;">(</span>100, <span style="color: #8b2252;">'-'</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">sb</span> = s1.<span style="color: #0000ff;">Trim</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">sc</span> = s1.<span style="color: #0000ff;">Trim</span><span style="color: #707183;">(</span><span style="color: #8b2252;">'-'</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">sd</span> = s1.<span style="color: #0000ff;">TrimStart</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">de</span> = s1.<span style="color: #0000ff;">TrimStart</span><span style="color: #707183;">()</span>.<span style="color: #0000ff;">TrimEnd</span><span style="color: #707183;">(</span><span style="color: #8b2252;">'-'</span><span style="color: #707183;">)</span>.<span style="color: #0000ff;">PadLeft</span><span style="color: #707183;">(</span>50, <span style="color: #8b2252;">':'</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">df</span> = s1.<span style="color: #0000ff;">ToLower</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">dg</span> = s1.<span style="color: #0000ff;">ToUpper</span><span style="color: #707183;">()</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>de<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb13cd6e" class="outline-4">
<h4 id="orgb13cd6e"><span class="section-number-4">5.1.7.</span> [API] String 跟 Array 的转换</h4>
<div class="outline-text-4" id="text-5-1-7">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">s1</span> = <span style="color: #8b2252;">"  000o&#12290;OOOoOO0O&#65292;0Ooo000o--"</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#23383;&#31526;&#20018;&#21040; [&#25968;&#32452;] &#30340;&#36716;&#25442;</span>
<span style="color: #228b22;">char</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">a1</span> = s1.<span style="color: #0000ff;">ToCharArray</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">char</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">a2</span> = s1.<span style="color: #0000ff;">ToCharArray</span><span style="color: #707183;">(</span>2, 10<span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">[&#25968;&#32452;] &#21040;&#23383;&#31526;&#20018;&#30340;&#36716;&#25442;</span>
<span style="color: #228b22;">char</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">a3</span> = <span style="color: #a020f0;">new</span><span style="color: #707183;">[]</span> <span style="color: #707183;">{</span><span style="color: #8b2252;">'a'</span>, <span style="color: #8b2252;">'o'</span>, <span style="color: #8b2252;">'e'</span><span style="color: #707183;">}</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s2</span> = <span style="color: #a020f0;">new</span> <span style="color: #0000ff;">string</span><span style="color: #707183;">(</span>a3<span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">StringBuild vs String</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s3</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #707183;">()</span>.<span style="color: #0000ff;">Append</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #707183;">)</span>.<span style="color: #0000ff;">ToString</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">StringBuilder</span> <span style="color: #a0522d;">sb</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #707183;">(</span>s1<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf40a769" class="outline-3">
<h3 id="orgf40a769"><span class="section-number-3">5.2.</span> object</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<pre class="src src-csx"><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 20;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s</span> = <span style="color: #8b2252;">"hello"</span>;

<span style="color: #228b22;">object</span> <span style="color: #a0522d;">i1</span> = 20;
<span style="color: #228b22;">object</span> <span style="color: #a0522d;">s1</span> = <span style="color: #8b2252;">"hello"</span>;

<span style="color: #228b22;">object</span> <span style="color: #a0522d;">i2</span>;
<span style="color: #228b22;">object</span> <span style="color: #a0522d;">s2</span>;

i2 = 20;
s2 = <span style="color: #8b2252;">"hello"</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgebd8ec8" class="outline-3">
<h3 id="orgebd8ec8"><span class="section-number-3">5.3.</span> dynamic</h3>
<div class="outline-text-3" id="text-5-3">
<ul class="org-ul">
<li>静态语言</li>
<li>动态语言 (动态一时爽，重构hzc)</li>
</ul>

<div class="org-src-container">
<pre class="src src-csx"><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 20;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s</span> = <span style="color: #8b2252;">"hello"</span>;

<span style="color: #228b22;">object</span> <span style="color: #a0522d;">i1</span> = 20;
<span style="color: #228b22;">object</span> <span style="color: #a0522d;">s1</span> = <span style="color: #8b2252;">"hello"</span>;

<span style="color: #228b22;">object</span> <span style="color: #a0522d;">i2</span>;
<span style="color: #228b22;">object</span> <span style="color: #a0522d;">s2</span>;

i2 = 20;
s2 = <span style="color: #8b2252;">"hello"</span>;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-cs"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#21160;&#24577;&#35821;&#35328;&#30340;&#25630;&#27861;&#65292;s &#26159;&#21861;&#19981;&#30830;&#23450;&#65292;&#36816;&#34892;&#21040;&#21738;&#37324;&#21487;&#20197;&#33021;&#23601;&#21464;&#20102;</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s</span>;
s = 2323;     <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25972;&#25968;</span>
s = <span style="color: #8b2252;">"kdjkfd"</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23383;&#31526;&#20018;</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s.Length<span style="color: #707183;">)</span>;
s = <span style="color: #707183;">[</span>2, 3<span style="color: #707183;">]</span>;   <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25968;&#32452;</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#38745;&#24577;&#31867;&#22411;&#65292;s &#26159;&#21861;&#65292;&#20986;&#29983;&#23450;&#32456;&#36523;</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s</span> = <span style="color: #8b2252;">"hello"</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">C# &#23545;&#21160;&#24577;&#31867;&#22411;&#30340;&#25903;&#25345;</span>
<span style="color: #228b22;">dynamic</span> <span style="color: #a0522d;">a</span> = 1111;
a = <span style="color: #8b2252;">"hello"</span>;
a = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">FileInfo</span><span style="color: #707183;">(</span><span style="color: #8b2252;">""</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org710620e" class="outline-2">
<h2 id="org710620e"><span class="section-number-2">6.</span> 用户自定义类型</h2>
<div class="outline-text-2" id="text-6">
<ol class="org-ol">
<li>声明类型</li>
<li>实例化</li>
<li>使用</li>
</ol>
</div>

<div id="outline-container-orgecf4b54" class="outline-3">
<h3 id="orgecf4b54"><span class="section-number-3">6.1.</span> class</h3>
<div class="outline-text-3" id="text-6-1">
<p>
类
</p>
</div>
</div>

<div id="outline-container-orgdf476f3" class="outline-3">
<h3 id="orgdf476f3"><span class="section-number-3">6.2.</span> interface</h3>
<div class="outline-text-3" id="text-6-2">
<p>
接口
</p>
</div>
</div>

<div id="outline-container-org29671bb" class="outline-3">
<h3 id="org29671bb"><span class="section-number-3">6.3.</span> delegate</h3>
<div class="outline-text-3" id="text-6-3">
<p>
委托
</p>
</div>
</div>

<div id="outline-container-org7a80d08" class="outline-3">
<h3 id="org7a80d08"><span class="section-number-3">6.4.</span> array</h3>
<div class="outline-text-3" id="text-6-4">
<p>
数组
</p>
</div>
</div>

<div id="outline-container-org434b62c" class="outline-3">
<h3 id="org434b62c"><span class="section-number-3">6.5.</span> struct</h3>
<div class="outline-text-3" id="text-6-5">
<p>
结构体
</p>
</div>
</div>

<div id="outline-container-org5842d62" class="outline-3">
<h3 id="org5842d62"><span class="section-number-3">6.6.</span> enum</h3>
<div class="outline-text-3" id="text-6-6">
<p>
枚举
</p>
</div>
</div>
</section>

<section id="outline-container-org6672eb9" class="outline-2">
<h2 id="org6672eb9"><span class="section-number-2">7.</span> 类型转换</h2>
<div class="outline-text-2" id="text-7">
<p>
基本类型的转换:
</p>
<ul class="org-ul">
<li><p>
如果涉及到转换之后不会存在任何的精度损失的话，会进行隐式转换 (implicit)
</p>
<pre class="example">
int a; byte b; a = b;
</pre></li>
<li><p>
如果可能存在精度损失的话，这个时候，必须进行强制转换 (explicit)
</p>
<pre class="example">
int a; byte b; b = (int)a;
</pre></li>
<li>如果强制转换过程中，出现精度损失的话，默认情况下会按照某种规则截断。注意，不会报错</li>
<li><p>
我们可以使用 <code>checked</code> 关键词将转换的语句包围住，然后在转换中出现精度损失的话，会抛出异常
</p>
<pre class="example">
int a; byte b; b = check((int)a);
</pre></li>
</ul>

<p>
引用类型的转换:
</p>
<ul class="org-ul">
<li><p>
引用类型同样存在 implicit/explicit 抓换
</p>
<pre class="example">
Person p = new Student();
Student s = (Student) p;
</pre></li>
<li>引用类型的转换，如果转换失败，默认会抛出异常</li>
<li><p>
使用 <code>is</code> 语句，判断是否属于某种类型。经常会跟显式转换配合使用:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">Student</span> <span style="color: #a0522d;">s</span>;
<span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span>p <span style="color: #a020f0;">is</span> Student<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    s = <span style="color: #7388d6;">(</span><span style="color: #228b22;">Student</span><span style="color: #7388d6;">)</span> p;
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">else</span>
<span style="color: #707183;">{</span>
    s = <span style="color: #008b8b;">null</span>;
<span style="color: #707183;">}</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s<span style="color: #707183;">)</span>;
</pre>
</div></li>
<li><p>
可以使用 <code>as</code> 语句，简化上述的判断跟转换。这是一种很甜的糖:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">Student</span> <span style="color: #a0522d;">s</span> = p <span style="color: #a020f0;">as</span> Student;
<span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span>s == <span style="color: #008b8b;">null</span><span style="color: #707183;">)</span> ...
</pre>
</div></li>
</ul>

<p>
装箱/拆箱 (boxing/unboxing):
</p>
<ul class="org-ul">
<li><b>装箱</b> 是将值类型转换为 object 类型或由此值类型实现的任何接口类型的过程</li>
<li>在 C# 中，基本类型也是 object 的实例。
但是为了效率，基本类型都被直接存储在栈上，存储的形式不是对象的形式。
因此，如果想将基本类型当作对象，来进行方法调用的时候，需要将其转换为对象存储形式
为了简化上述过程，在对基本类型进行方法调用的时候，CLR 会自动进行上述转换。
这种隐式转换的机制，叫做自动装箱 (auto-boxing)</li>
<li>反向的过程叫拆箱</li>
</ul>
</div>

<div id="outline-container-orgb9ed1b3" class="outline-3">
<h3 id="orgb9ed1b3"><span class="section-number-3">7.1.</span> 隐式转换/强制转换</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">char</span> <span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'A'</span>;
<span style="color: #228b22;">byte</span> <span style="color: #a0522d;">ab</span> = <span style="color: #707183;">(</span><span style="color: #228b22;">byte</span><span style="color: #707183;">)</span>a;

<span style="color: #228b22;">int</span> <span style="color: #a0522d;">s1</span> = ab + 13; <span style="color: #b22222;">// </span><span style="color: #b22222;">byte + int</span>
ab = <span style="color: #707183;">(</span><span style="color: #228b22;">byte</span><span style="color: #707183;">)</span> <span style="color: #707183;">(</span><span style="color: #7388d6;">(</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span><span style="color: #909183;">)</span> ab<span style="color: #7388d6;">)</span> + 13<span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">int + int = int</span>
ab = <span style="color: #707183;">(</span><span style="color: #228b22;">byte</span><span style="color: #707183;">)</span> <span style="color: #707183;">(</span>ab + 13<span style="color: #707183;">)</span>;

<span style="color: #8b2252;">/////</span>
<span style="color: #228b22;">char</span> <span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">'A'</span>;
<span style="color: #228b22;">byte</span> <span style="color: #a0522d;">a1</span> = <span style="color: #707183;">(</span><span style="color: #228b22;">byte</span><span style="color: #707183;">)</span> a;
<span style="color: #228b22;">char</span> <span style="color: #a0522d;">a2</span> = <span style="color: #707183;">(</span><span style="color: #228b22;">char</span><span style="color: #707183;">)</span> <span style="color: #707183;">(</span>a1 + 13<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"{a} -&gt; {a1} -&gt; {a2}"</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
使用 checked 来释放危险:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span> = 1;
<span style="color: #228b22;">byte</span> <span style="color: #a0522d;">b</span> = 0;
<span style="color: #228b22;">byte</span> <span style="color: #a0522d;">c</span> = 0;
<span style="color: #228b22;">byte</span> <span style="color: #a0522d;">d</span> = 0;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#28508;&#22312;&#30340;&#21361;&#38505;</span>
b = <span style="color: #707183;">(</span><span style="color: #228b22;">byte</span><span style="color: #707183;">)</span> a;
c = <span style="color: #707183;">(</span><span style="color: #228b22;">byte</span><span style="color: #707183;">)</span> a;
d = <span style="color: #707183;">(</span><span style="color: #228b22;">byte</span><span style="color: #707183;">)</span> a;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20027;&#21160;&#37322;&#25918;&#21361;&#38505;</span>
b = <span style="color: #a020f0;">checked</span><span style="color: #707183;">(</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">byte</span><span style="color: #7388d6;">)</span> a<span style="color: #707183;">)</span>;
c = <span style="color: #a020f0;">checked</span><span style="color: #707183;">(</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">byte</span><span style="color: #7388d6;">)</span> a<span style="color: #707183;">)</span>;
d = <span style="color: #a020f0;">checked</span><span style="color: #707183;">(</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">byte</span><span style="color: #7388d6;">)</span> a<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>b<span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#25351;&#23450;&#21361;&#38505;&#21306;&#22495;</span>
<span style="color: #a020f0;">checked</span>
<span style="color: #707183;">{</span>
    b = <span style="color: #7388d6;">(</span><span style="color: #228b22;">byte</span><span style="color: #7388d6;">)</span>a;
    c = <span style="color: #7388d6;">(</span><span style="color: #228b22;">byte</span><span style="color: #7388d6;">)</span>a;
    d = <span style="color: #7388d6;">(</span><span style="color: #228b22;">byte</span><span style="color: #7388d6;">)</span>a;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>b<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb6d106f" class="outline-3">
<h3 id="orgb6d106f"><span class="section-number-3">7.2.</span> 引用类型的隐式和强制转换</h3>
<div class="outline-text-3" id="text-7-2">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span> <span style="color: #707183;">{}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Student</span> : <span style="color: #228b22;">Person</span> <span style="color: #707183;">{}</span>

<span style="color: #228b22;">Person</span> <span style="color: #a0522d;">p</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">Student</span> <span style="color: #a0522d;">s</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #707183;">()</span>;

<span style="color: #228b22;">Person</span> <span style="color: #a0522d;">p1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #707183;">()</span>;

<span style="color: #228b22;">object</span> <span style="color: #a0522d;">a</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #707183;">()</span>;
a = 2122;
<span style="color: #b22222;">// </span><span style="color: #b22222;">a: object</span>
<span style="color: #228b22;">Student</span> <span style="color: #a0522d;">s2</span> = <span style="color: #707183;">(</span><span style="color: #228b22;">Student</span><span style="color: #707183;">)</span>a;
</pre>
</div>
</div>
</div>

<div id="outline-container-org247f02f" class="outline-3">
<h3 id="org247f02f"><span class="section-number-3">7.3.</span> 装箱/拆箱 (auto-boxing)</h3>
<div class="outline-text-3" id="text-7-3">
<div class="org-src-container">
<pre class="src src-csx"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#33258;&#21160;&#35013;&#31665;</span>
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 1;
<span style="color: #228b22;">object</span> <span style="color: #a0522d;">o</span> = <span style="color: #008b8b;">null</span>;
o = i;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"i: {i}, o: {o}"</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#35013;&#31665;&#20351;&#29992;&#30340;&#26159;&#25968;&#25454;&#30340;&#21103;&#26412;</span>
i = 5;
o = 6;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"i: {i}, o: {o}"</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#25286;&#31665;</span>
i = <span style="color: #707183;">(</span><span style="color: #228b22;">int</span><span style="color: #707183;">)</span>o;
</pre>
</div>
</div>
</div>

<div id="outline-container-org273cc98" class="outline-3">
<h3 id="org273cc98"><span class="section-number-3">7.4.</span> 自定义转换规则</h3>
<div class="outline-text-3" id="text-7-4">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>

        <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">p</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">Student</span> <span style="color: #a0522d;">s</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #909183;">()</span>;

        <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">p1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #909183;">()</span>;

        <span style="color: #228b22;">object</span> <span style="color: #a0522d;">a</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">Student</span> <span style="color: #a0522d;">s2</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">Student</span><span style="color: #909183;">)</span>a;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312; C# &#20013;&#65292;&#31867;&#22411;&#36716;&#25442;&#30340;&#35268;&#21017;&#65292;&#26159;&#21487;&#20197;&#33258;&#23450;&#20041;&#30340;</span>
        <span style="color: #228b22;">Student</span> <span style="color: #a0522d;">ss</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #909183;">()</span>;
        ss.id = 222;
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = ss;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">i</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">Student</span> <span style="color: #a0522d;">st</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">Student</span><span style="color: #909183;">)</span>333;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">st</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span> <span style="color: #7388d6;">{</span> <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Student</span> : <span style="color: #228b22;">Person</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span>;

        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">implicit</span> <span style="color: #a020f0;">operator</span> <span style="color: #228b22;">int</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Student</span> <span style="color: #a0522d;">s</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> s.id;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">explicit</span> <span style="color: #a020f0;">operator</span> <span style="color: #0000ff;">Student</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">si</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">s</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #709870;">()</span>;
            s.id = si;
            <span style="color: #a020f0;">return</span> s;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
学号 - 学生，转换的示例:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#26222;&#36890;&#20351;&#29992;</span>
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span> = 2323232323;
s = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #707183;">()</span>;
s.id = id;
s.xxx = ksdfj;
s.yyy = kjskdfj;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#25277;&#20986;&#20026;&#26041;&#27861;</span>
<span style="color: #228b22;">Student</span> <span style="color: #0000ff;">MakeStudent</span><span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    s = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #7388d6;">()</span>;
    s.id = i;
    s.xxx = ksdfj;
    s.yyy = kjskdfj;
<span style="color: #707183;">}</span>
S = <span style="color: #0000ff;">MakeStudent</span><span style="color: #707183;">(</span>id<span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#25277;&#20986;&#20026;&#31867;&#22411;&#36716;&#25442;</span>
<span style="color: #228b22;">Student</span> <span style="color: #a0522d;">s</span> = <span style="color: #707183;">(</span><span style="color: #228b22;">Student</span><span style="color: #707183;">)</span> id;
</pre>
</div>
</div>
</div>

<div id="outline-container-org23dcc37" class="outline-3">
<h3 id="org23dcc37"><span class="section-number-3">7.5.</span> 基于 <b>字符串</b> 之间的互相转换</h3>
<div class="outline-text-3" id="text-7-5">
<ul class="org-ul">
<li>核心两种方法: <code>string.Format</code> 用来转换为字符串，~type.Parse~ 用来从字符串转化</li>
<li>可以使用 <code>ToString/TryParse</code> 对上面的两个方法进行补充</li>
</ul>

<p>
简而言之:
</p>
<ul class="org-ul">
<li>将其他类型转换为字符串: <code>string.Format/ToString</code></li>
<li>将字符串转换为其他类型: <code>xxx.Parse/TryParse</code></li>
<li>BCL 中提供了一个叫 <code>Convert</code> 的类，可以实现更多更复杂的转换</li>
</ul>
</div>

<div id="outline-container-org8d4e926" class="outline-4">
<h4 id="org8d4e926"><span class="section-number-4">7.5.1.</span> string.Format</h4>
<div class="outline-text-4" id="text-7-5-1">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">r3</span> = <span style="color: #228b22;">string</span>.<span style="color: #0000ff;">Format</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"{0}&#30340;&#26379;&#21451;&#26159;{1}&#65292;&#23427;&#34429;&#28982;&#21482;&#26377;{2}&#23681;&#65292;&#20294;&#26159;&#23427;&#30340;&#25910;&#20837;&#36798;&#21040;{3:C}"</span>, name, friend, age, sal<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org7852148" class="outline-4">
<h4 id="org7852148"><span class="section-number-4">7.5.2.</span> type.ToString</h4>
<div class="outline-text-4" id="text-7-5-2">
<p>
因为，string 类型是如此重要，所以在 <b>所有类的基类，即 object 中</b>,
包含了一个默认的 ToString 方法。
</p>

<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sal</span> = 1000000;

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Hahaha</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"hdskfjksjfksjdfkke"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #228b22;">Person</span> <span style="color: #a0522d;">p</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #707183;">()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>p.<span style="color: #0000ff;">ToString</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">Program+Person</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sal</span> = 1000000;

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Hahaha</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"hdskfjksjfksjdfkke"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">ToString</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&#25105;&#23601;&#26159;&#25105;&#65292;&#19981;&#19968;&#26679;&#30340;&#28895;&#28779;.&#25105;&#30340;&#24037;&#36164;: "</span> + <span style="color: #a020f0;">this</span>.sal;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #228b22;">Person</span> <span style="color: #a0522d;">p</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #707183;">()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>p<span style="color: #707183;">)</span>;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-cs"><span style="color: #b22222;">// </span><span style="color: #b22222;">int</span>
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 112323;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s1</span> = i.<span style="color: #0000ff;">ToString</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"X"</span><span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s1<span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">datetime</span>
<span style="color: #228b22;">DateTime</span> <span style="color: #a0522d;">now</span> = DateTime.Now;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s2</span> = now.<span style="color: #0000ff;">ToString</span><span style="color: #707183;">()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s2<span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s3</span> = now.<span style="color: #0000ff;">ToString</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#29616;&#22312;&#26102;&#38388;: yyyy&#24180;MM&#26376;dd&#26085;&#65292;&#19981;&#21578;&#35785;&#20320;&#20960;&#28857;"</span><span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s3<span style="color: #707183;">)</span>;
<span style="color: #228b22;">CultureInfo</span> <span style="color: #a0522d;">ci</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">CultureInfo</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"zh-CN"</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s4</span> = now.<span style="color: #0000ff;">ToString</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#29616;&#22312;&#26102;&#38388;: yyyy&#24180;MMM ddd&#65292;&#19981;&#21578;&#35785;&#20320;&#20960;&#28857;"</span>, ci<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s4<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaa7a4ab" class="outline-4">
<h4 id="orgaa7a4ab"><span class="section-number-4">7.5.3.</span> type.Parse/TryParse</h4>
<div class="outline-text-4" id="text-7-5-3">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #b22222;">// </span><span style="color: #b22222;">int</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s1</span> = <span style="color: #8b2252;">"1234343"</span>;
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = <span style="color: #228b22;">int</span>.<span style="color: #0000ff;">Parse</span><span style="color: #707183;">(</span>s1<span style="color: #707183;">)</span> + 1;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>i<span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">double</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s2</span> = <span style="color: #8b2252;">"2322222"</span>;
<span style="color: #228b22;">double</span> <span style="color: #a0522d;">d</span> = <span style="color: #228b22;">double</span>.<span style="color: #0000ff;">Parse</span><span style="color: #707183;">(</span>s2<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>d<span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">DateTime</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s3</span> = <span style="color: #8b2252;">"1999-02-13"</span>;
<span style="color: #228b22;">DateTime</span> <span style="color: #a0522d;">dt</span> = DateTime.<span style="color: #0000ff;">Parse</span><span style="color: #707183;">(</span>s3<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>dt.Year<span style="color: #707183;">)</span>;
</pre>
</div>

<p>
转换失败，会抛异常:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">s4</span> = <span style="color: #8b2252;">"hello"</span>;
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i2</span> = <span style="color: #228b22;">int</span>.<span style="color: #0000ff;">Parse</span><span style="color: #707183;">(</span>s4<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">try</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s4</span> = <span style="color: #8b2252;">"hello"</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">i2</span> = <span style="color: #228b22;">int</span>.<span style="color: #0000ff;">Parse</span><span style="color: #7388d6;">(</span>s4<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">catch</span> <span style="color: #707183;">(</span>e<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36716;&#25442;&#19981;&#20102;&#24590;&#20040;&#21150;</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
可以使用 TryParse 进行转化，如果转换失败，会返回 False:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">s4</span> = <span style="color: #8b2252;">"hello"</span>;

<span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span>.<span style="color: #0000ff;">TryParse</span><span style="color: #7388d6;">(</span>s4, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">result</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>result<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #228b22;">bool</span> <span style="color: #0000ff;">TryMyParse</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">s</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">result</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">try</span>
    <span style="color: #7388d6;">{</span>
        result = <span style="color: #228b22;">int</span>.<span style="color: #0000ff;">Parse</span><span style="color: #909183;">(</span>s4<span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">true</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">catch</span>
    <span style="color: #7388d6;">{</span>
        result = 0;
        <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">false</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org89bbc31" class="outline-4">
<h4 id="org89bbc31"><span class="section-number-4">7.5.4.</span> Convert</h4>
<div class="outline-text-4" id="text-7-5-4">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">s1</span> = Convert.<span style="color: #0000ff;">ToString</span><span style="color: #707183;">(</span>82738283782, 2<span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s2</span> = Convert.<span style="color: #0000ff;">ToString</span><span style="color: #707183;">(</span>82738283782, 8<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s2<span style="color: #707183;">)</span>;

Convert.<span style="color: #0000ff;">TryFromBase64String</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>
</div>
</section>

<section id="outline-container-orge7ae5fd" class="outline-2">
<h2 id="orge7ae5fd"><span class="section-number-2">8.</span> 类 (Class)</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-org99f48fc" class="outline-3">
<h3 id="org99f48fc"><span class="section-number-3">8.1.</span> 字段 (Field)</h3>
<div class="outline-text-3" id="text-8-1">
<ul class="org-ul">
<li>作为一个字段，最重要的是 (类型) (名字) = (值)</li>
<li>可以 <b>选择性</b> 使用其他修饰符，为字段增加 <b>额外</b> 的功能或限制:
<ul class="org-ul">
<li>访问修饰符: private/public/protected/internal 等，用来给予外部的访问限制</li>
<li>只读/常量修饰符: const/readonly，用来防止数据被误修改</li>
<li>静态修饰符: static 的作用是，将这个字段的归属权给予类</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orga8cd62d" class="outline-3">
<h3 id="orga8cd62d"><span class="section-number-3">8.2.</span> 方法 (Method)</h3>
<div class="outline-text-3" id="text-8-2">
</div>
<div id="outline-container-orgfe90159" class="outline-4">
<h4 id="orgfe90159"><span class="section-number-4">8.2.1.</span> Basic</h4>
<div class="outline-text-4" id="text-8-2-1">
<p>
方法是一个具备名字的代码块:
</p>
<ul class="org-ul">
<li>通过 <code>方法名()</code> 的方式实现方法调用，
也就是在调用的地方将方法名代表的代码块里的代码进行运行</li>
<li>方法的三要素:
<ol class="org-ol">
<li>一个名字 (方法名)</li>
<li>传入的数据 (传入参数) 入参写在方法名后面的括号里。如果没有入参，括号保持为空即可</li>
<li>传出的数据 (返回值) 方法内部，使用 return 表示返回的数据。在方法名前面，添加返回的类型。
如果方法内部没有任何 return 表示方法没有返回值，需要在方法前面添加 void 表示这种情况</li>
</ol></li>
</ul>
</div>
</div>

<div id="outline-container-org3f39897" class="outline-4">
<h4 id="org3f39897"><span class="section-number-4">8.2.2.</span> 方法的重载 (overload)</h4>
<div class="outline-text-4" id="text-8-2-2">
<ul class="org-ul">
<li>一个类中，可以有同名的方法。需要有不同的参数 (这样才能区分调用)</li>
<li>请叙述一下 overload 和 override 有什么区别</li>
</ul>

<p>
方法的示例:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26041;&#27861;&#30340;&#22768;&#26126;&#12289;&#23450;&#20041;</span>
    <span style="color: #228b22;">int</span> <span style="color: #0000ff;">&#22686;&#21152;</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span><span style="color: #7388d6;">)</span>  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26041;&#27861;&#21517;&#20026; [&#22686;&#21152;]&#65292;&#20837;&#21442;&#20026; [a]</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> a + 1;  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238;&#20540;&#20026; [a + 1]</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #228b22;">double</span> <span style="color: #0000ff;">&#21152;&#27861;</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">a</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">b</span><span style="color: #7388d6;">)</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21487;&#20197;&#26377;&#22810;&#20010;&#20837;&#21442;</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> a + b;
    <span style="color: #7388d6;">}</span>
    <span style="color: #228b22;">double</span> <span style="color: #0000ff;">&#27809;&#26377;&#20837;&#21442;</span> <span style="color: #7388d6;">()</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21487;&#20197;&#27809;&#26377;&#20837;&#21442;</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> 111.111; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238; double &#31867;&#22411;&#30340;&#25968;&#25454;</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#27809;&#26377;&#36820;&#22238;&#25968;&#25454;</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span><span style="color: #7388d6;">)</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27809;&#26377;&#36820;&#22238;&#25968;&#25454;&#20351;&#29992; void &#34920;&#31034;</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">name</span><span style="color: #909183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26041;&#27861;&#20307;&#20869;&#65292;&#27809;&#26377;&#20219;&#20309; return &#35821;&#21477;&#65292;&#25152;&#20197;&#26041;&#27861;&#27809;&#26377;&#36820;&#22238;&#20219;&#20309;&#25968;&#25454;</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#27809;&#26377;&#36820;&#22238;&#20540;&#20063;&#27809;&#26377;&#20837;&#21442;</span> <span style="color: #7388d6;">()</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36825;&#20010;&#26041;&#27861;&#65292;&#23601;&#26159;&#27809;&#26377;&#36820;&#22238;&#20540;&#20063;&#27809;&#26377;&#20837;&#21442;</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"hello, world"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26041;&#27861;&#30340;&#35843;&#29992;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992;&#26041;&#27861;&#30340;&#21517;&#23383;&#35843;&#29992;&#26041;&#27861;:</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">- &#20837;&#21442;&#30340;&#20010;&#25968;&#21644;&#39034;&#24207;&#35201;&#36319;&#19978;&#36848;&#23450;&#20041;&#30340;&#19968;&#33268;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">- &#36820;&#22238;&#20540;&#30340;&#31867;&#22411;&#35201;&#36319;&#19978;&#36848;&#23450;&#20041;&#30340;&#19968;&#33268;&#65292;&#22914;&#26524; void &#31867;&#22411;&#30340;&#20989;&#25968;&#26159;&#19981;&#33021;&#25509;&#21463;&#20854;&#36820;&#22238;&#20540;&#30340;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#19978;&#36848;&#26041;&#27861;&#23450;&#20041;&#20013;&#30340;&#21442;&#25968;&#65292;&#21448;&#21483;&#24418;&#24335;&#21442;&#25968; (&#24418;&#21442;)</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36825;&#37324;&#35843;&#29992;&#26102;&#20256;&#20837;&#30340;&#21442;&#25968;&#65292;&#21448;&#21483;&#23454;&#38469;&#21442;&#25968; (&#23454;&#21442;)</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20063;&#23601;&#26159;&#65292;&#23454;&#21442;&#35201;&#36319;&#24418;&#21442;&#30456;&#23545;&#24212;!</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span> = &#22686;&#21152;<span style="color: #7388d6;">(</span>11<span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">b</span> = &#21152;&#27861;<span style="color: #7388d6;">(</span>11, 33<span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">c</span> = &#27809;&#26377;&#20837;&#21442;<span style="color: #7388d6;">()</span>;
    &#27809;&#26377;&#36820;&#22238;&#25968;&#25454;<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"H&amp;M"</span><span style="color: #7388d6;">)</span>;
    &#27809;&#26377;&#36820;&#22238;&#20540;&#20063;&#27809;&#26377;&#20837;&#21442;<span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca9382d" class="outline-4">
<h4 id="orgca9382d"><span class="section-number-4">8.2.3.</span> 参数 (值参数/ref/out)</h4>
<div class="outline-text-4" id="text-8-2-3">
<p>
值参数 (默认的):
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 5;
    <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">p</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #7388d6;">()</span>;

    <span style="color: #0000ff;">TestZhi</span><span style="color: #7388d6;">(</span>i, p<span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"out: i: {i}, age: ${p.Age}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">TestZhi</span><span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">ii</span>, <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">pp</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    ii = ii + 1;
    pp.Age = pp.Age + 18;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"in:  i: {ii}, age: ${pp.Age}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">Age</span> = 18;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
ref:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 5;
    <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">p</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #7388d6;">()</span>;

    <span style="color: #0000ff;">TestZhi</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">ref</span> <span style="color: #228b22;">i</span>, p<span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"out: i: {i}, age: ${p.Age}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">TestZhi</span><span style="color: #707183;">(</span><span style="color: #a020f0;">ref</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">ii</span>, <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">pp</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    ii = ii + 1;
    pp.Age = pp.Age + 18;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"in:  i: {ii}, age: ${pp.Age}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">Age</span> = 18;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
out:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span>;
    <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">p</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #7388d6;">()</span>;

    <span style="color: #0000ff;">TestZhi</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">out</span> <span style="color: #228b22;">i</span>, p<span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"out: i: {i}, age: ${p.Age}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">TestZhi</span><span style="color: #707183;">(</span><span style="color: #a020f0;">out</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">ii</span>, <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">pp</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    ii = 999;
    pp.Age = pp.Age + 18;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"in:  i: {ii}, age: ${pp.Age}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">Age</span> = 18;
<span style="color: #707183;">}</span>
</pre>
</div>


<figure id="org1c77dca">
<img src="img/method-parameter.png" alt="method-parameter.png" width="400px">

</figure>
</div>
</div>


<div id="outline-container-orgb0c8cd6" class="outline-4">
<h4 id="orgb0c8cd6"><span class="section-number-4">8.2.4.</span> out 参数: 用来模拟方法返回多个值的场景</h4>
<div class="outline-text-4" id="text-8-2-4">
<p>
如果不用 out，可以使用 Class 的方式返回多个值，这种方式比较重:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span>;
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">sal</span>;

    <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">p</span> = <span style="color: #0000ff;">GetYourInformation</span><span style="color: #7388d6;">()</span>;
    name = p.Name;
    age = p.Age;
    sal = p.Sal;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">Person</span> <span style="color: #0000ff;">GetYourInformation</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a0522d;">Name</span> = <span style="color: #8b2252;">"Kitty"</span>,
        <span style="color: #a0522d;">Age</span> = 19,
        <span style="color: #a0522d;">Sal</span> = 2323323
    <span style="color: #7388d6;">}</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Name</span>;
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">Age</span>;
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Sal</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
而 out 的方法比较轻量级:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span>;
    <span style="color: #228b22;">double</span> <span style="color: #a0522d;">sal</span>;

    name = <span style="color: #0000ff;">GetYourInformation</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">out</span> <span style="color: #228b22;">age</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">sal</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"{name} &#30340;&#24180;&#40836;&#20026; {age} &#25910;&#20837;&#20026; {sal}&#65292;&#24744;&#21487;&#28385;&#24847;?"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">GetYourInformation</span><span style="color: #707183;">(</span><span style="color: #a020f0;">out</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">sal</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    age = 19;
    sal = 23232;
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"Kitty"</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
甚至可以更简化:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span> = <span style="color: #0000ff;">GetYourInformation</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">out</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">sal</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"{name} &#30340;&#24180;&#40836;&#20026; {age} &#25910;&#20837;&#20026; {sal}&#65292;&#24744;&#21487;&#28385;&#24847;?"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">GetYourInformation</span><span style="color: #707183;">(</span><span style="color: #a020f0;">out</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">sal</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    age = 19;
    sal = 23232;
    <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"Kitty"</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1225826" class="outline-4">
<h4 id="org1225826"><span class="section-number-4">8.2.5.</span> 数组参数 (params)</h4>
<div class="outline-text-4" id="text-8-2-5">
<p>
实现累加:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21152;&#27861;</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r1</span> = <span style="color: #0000ff;">MyAdd2</span><span style="color: #7388d6;">(</span>2, 3<span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r2</span> = <span style="color: #0000ff;">MyAdd3</span><span style="color: #7388d6;">(</span>2, 3, 4<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyAdd2</span><span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">b</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">return</span> a + b;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyAdd3</span><span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">b</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">c</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">return</span> a + b + c;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
使用数组改良的结果:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r1</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span>2, 3<span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r2</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span>2, 3, 4, 5, 6, 7<span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyAdd</span><span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">nums</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r</span> = 0;
    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; nums.Length; i++<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        r += nums<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">return</span> r;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
可以使用 params 修饰数组，达到进一步简化调用语法的目的:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r1</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #7388d6;">(</span>2, 3<span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r2</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #7388d6;">(</span>2, 3, 4, 5, 6, 7<span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"{r1} / {r2}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyAdd</span><span style="color: #707183;">(</span><span style="color: #a020f0;">params</span> <span style="color: #228b22;">int</span> <span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">nums</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r</span> = 0;
    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; nums.Length; i++<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        r += nums<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">return</span> r;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
数组参数需要放到后面:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #0000ff;">MyAdd</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#26368;&#21518;&#27714;&#21462;&#30340;&#21644;&#26159;: 0x{0:X}"</span>, 232, 3, 10<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">MyAdd</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fmt</span>, <span style="color: #a020f0;">params</span> <span style="color: #228b22;">int</span> <span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">nums</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r</span> = 0;
    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; nums.Length; i++<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        r += nums<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span>;
    <span style="color: #7388d6;">}</span>

    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>fmt, r<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d0fcf2" class="outline-4">
<h4 id="org5d0fcf2"><span class="section-number-4">8.2.6.</span> 可选参数/命名参数</h4>
<div class="outline-text-4" id="text-8-2-6">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #0000ff;">Hello</span><span style="color: #7388d6;">()</span>;
    <span style="color: #0000ff;">Hello</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"Hiii!"</span><span style="color: #7388d6;">)</span>;
    <span style="color: #0000ff;">Hello</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"Hi"</span>, <span style="color: #8b2252;">"Xiaoming"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Hello</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">action</span> = <span style="color: #8b2252;">"Hello"</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">who</span> = <span style="color: #8b2252;">"World"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"{action} {who}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
可以使用命名参数，简化多个可选参数存在的情况下的赋值:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #0000ff;">Hello</span><span style="color: #7388d6;">(</span>who: <span style="color: #8b2252;">"XM"</span><span style="color: #7388d6;">)</span>;
    <span style="color: #0000ff;">Hello</span><span style="color: #7388d6;">(</span>who: <span style="color: #8b2252;">"Xiaoming"</span>, action: <span style="color: #8b2252;">"out..."</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Hello</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">action</span> = <span style="color: #8b2252;">"Hello"</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">who</span> = <span style="color: #8b2252;">"World"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"{action} {who}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf1b7e70" class="outline-3">
<h3 id="orgf1b7e70"><span class="section-number-3">8.3.</span> 属性 (Property)</h3>
<div class="outline-text-3" id="text-8-3">
<p>
属性本身就是 [private Field + public Method] 一种语法糖:
</p>
<ul class="org-ul">
<li>它能减少太多冗余的模板代码；它能简化对实例中数据的可控性的访问，让代码更简洁</li>
<li>但是不要忘了，它跟 getter/setter 方法的本质是一样的。最后编译器还是将我们写的属性代码转换成了 getter/setter 方法的形式</li>
<li>也就是说 <code>r.Width = 333</code> 这样的属性赋值，本质就是方法调用</li>
</ul>

<p>
示例:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Rect</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Width</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Height</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Area</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">get</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> Width * Height;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">private double Height;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">public double GetHeight ()</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">{</span>
    <span style="color: #b22222;">//     </span><span style="color: #b22222;">return Height;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">}</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">public void SetHeight (double h);</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">{</span>
    <span style="color: #b22222;">//     </span><span style="color: #b22222;">Height = h;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">Rect</span> <span style="color: #a0522d;">r</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Rect</span><span style="color: #909183;">()</span>;
        r.Width = 2000;
        r.Height = 333;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#38754;&#31215;&#26159;: {0}"</span>, r.<span style="color: #228b22;">Area</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org715084d" class="outline-3">
<h3 id="org715084d"><span class="section-number-3">8.4.</span> 索引器 (Indexer)</h3>
<div class="outline-text-3" id="text-8-4">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">string</span> <span style="color: #a0522d;">a</span> = <span style="color: #8b2252;">"hello"</span>;
    <span style="color: #228b22;">char</span> <span style="color: #a0522d;">x1</span> = a<span style="color: #7388d6;">[</span>1<span style="color: #7388d6;">]</span>;

    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">b</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span>1, 2, 3, 4<span style="color: #7388d6;">}</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">x2</span> = b<span style="color: #7388d6;">[</span>1<span style="color: #7388d6;">]</span>;

    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">c</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">int</span><span style="color: #7388d6;">&gt;</span> <span style="color: #7388d6;">{</span>1, 2, 3, 4<span style="color: #7388d6;">}</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">x3</span> = c<span style="color: #7388d6;">[</span>1<span style="color: #7388d6;">]</span>;

    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">d</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Dictionary</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">string</span>, <span style="color: #228b22;">int</span><span style="color: #7388d6;">&gt;</span> <span style="color: #7388d6;">{</span><span style="color: #909183;">{</span><span style="color: #8b2252;">"xm"</span>, 22<span style="color: #909183;">}</span>, <span style="color: #909183;">{</span><span style="color: #8b2252;">"xh"</span>, 24<span style="color: #909183;">}</span><span style="color: #7388d6;">}</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">x4</span> = d<span style="color: #7388d6;">[</span><span style="color: #8b2252;">"xm"</span><span style="color: #7388d6;">]</span>;

    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">p</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #7388d6;">()</span>;
    p<span style="color: #7388d6;">[</span>1<span style="color: #7388d6;">]</span> = <span style="color: #8b2252;">"&#24744;&#22909;"</span>;
    p<span style="color: #7388d6;">[</span>5<span style="color: #7388d6;">]</span> = <span style="color: #8b2252;">"&#20320;&#22909;"</span>;
    p<span style="color: #7388d6;">[</span>3<span style="color: #7388d6;">]</span> = <span style="color: #8b2252;">"&#20843;&#22030;"</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>p<span style="color: #909183;">[</span>1<span style="color: #909183;">]</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>p<span style="color: #909183;">[</span>2<span style="color: #909183;">]</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>p<span style="color: #909183;">[</span>3<span style="color: #909183;">]</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>p<span style="color: #909183;">[</span>4<span style="color: #909183;">]</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>p<span style="color: #909183;">[</span>5<span style="color: #909183;">]</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">Dictionary</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">hiStyles</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Dictionary</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span><span style="color: #7388d6;">&gt;()</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a020f0;">this</span><span style="color: #7388d6;">[</span><span style="color: #228b22;">int</span> i<span style="color: #7388d6;">]</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">get</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>!hiStyles.<span style="color: #0000ff;">TryGetValue</span><span style="color: #907373;">(</span><span style="color: #228b22;">i</span>, <span style="color: #a020f0;">out</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">hiStyle</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                hiStyle = <span style="color: #8b2252;">"Hello"</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">return</span> $<span style="color: #8b2252;">"{hiStyle} {i}"</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">set</span>
        <span style="color: #909183;">{</span>
            hiStyles<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span> = <span style="color: #008b8b;">value</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2457fb6" class="outline-3">
<h3 id="org2457fb6"><span class="section-number-3">8.5.</span> 构造方法/构造器 (Constructor)</h3>
<div class="outline-text-3" id="text-8-5">
</div>
<div id="outline-container-org89b9afd" class="outline-4">
<h4 id="org89b9afd"><span class="section-number-4">8.5.1.</span> 对象的实例化</h4>
<div class="outline-text-4" id="text-8-5-1">
<p>
对象的实例化，分为下面几个步骤:
</p>
<ol class="org-ol">
<li>在内存中，分配相应的空间</li>
<li>按照类型进行相关字段的初始化工作</li>
<li>调用相应的 *构造方法*，进行相关初始化工作</li>
</ol>
</div>
</div>

<div id="outline-container-orgd5f0cbd" class="outline-4">
<h4 id="orgd5f0cbd"><span class="section-number-4">8.5.2.</span> 构造器</h4>
<div class="outline-text-4" id="text-8-5-2">
<p>
所谓的构造方法，就是类中定义的一个特殊方法。它用来对实例空间进行若干初始化工作:
</p>
<ul class="org-ul">
<li>构造方法可以写多个，即可以重载 (overload)</li>
<li>我们也可以不写任何构造方法，那么编译器在编译的时候，会自动帮我们插入一个 *无参的空的*。
但是，如果你在类中，定义了任何的构造方法，那么编译器就不会帮你再生成了</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">X</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">X</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">X</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">b</span><span style="color: #7388d6;">)</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">2</span>
    <span style="color: #7388d6;">{</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">X</span><span style="color: #909183;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;&#21442;&#25968;&#65292;&#37027;&#20040;&#20250;&#35843;&#29992;&#26080;&#21442;&#26500;&#36896;&#22120; 1</span>
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">X</span><span style="color: #909183;">(</span>1, 2<span style="color: #909183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22238;&#21435;&#35843;&#29992;&#30456;&#24212;&#30340;&#20855;&#22791;&#20004;&#20010;&#21442;&#25968;&#65292;&#24182;&#19988;&#31867;&#22411;&#27491;&#30830;&#30340;&#26500;&#36896;&#22120; 2</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8ad35bd" class="outline-4">
<h4 id="org8ad35bd"><span class="section-number-4">8.5.3.</span> 构造器链</h4>
<div class="outline-text-4" id="text-8-5-3">
<ul class="org-ul">
<li>如果不显式继承某个类，那么继承的将是 object。即可以忽略掉 <code>: Object</code></li>
<li>如果不显式添加构造器，那么编译器会自动插入一个无参的。即可以省略掉 <code>public Son() {}</code></li>
<li>如果不显式指定构造器顺序，那么任意构造器都会首先执行父类的无参构造器。即可以省略掉 <code>: base()</code></li>
<li>显式指定构造器顺序，需要手动添加 <code>: base(xxx)</code> 或者 <code>: this(xxx)</code></li>
<li>基本的规则是: 从下往上寻找，然后从上往下执行。这样就构成了 <b>构造器链</b></li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">GP</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">GP</span><span style="color: #7388d6;">()</span> : <span style="color: #a020f0;">base</span><span style="color: #7388d6;">()</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">4</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25105;&#26159;&#20320;&#29239;&#29239;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">GP</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">address</span><span style="color: #7388d6;">)</span> : <span style="color: #a020f0;">base</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#29239;&#29239;&#25105;&#30340;&#22320;&#22336;&#26159; {0}"</span>, <span style="color: #228b22;">address</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">GP</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">address</span><span style="color: #7388d6;">)</span> : <span style="color: #a020f0;">base</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#29239;&#29239; {0} &#30340;&#22320;&#22336;&#26159; {0}"</span>, <span style="color: #228b22;">name</span>, <span style="color: #228b22;">address</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PP</span> : <span style="color: #228b22;">GP</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">PP</span><span style="color: #7388d6;">()</span> : <span style="color: #a020f0;">base</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25105;&#26159;&#29240;&#29240;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">PP</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">address</span><span style="color: #7388d6;">)</span> : <span style="color: #a020f0;">base</span><span style="color: #7388d6;">()</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">3</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#29240;&#29240;&#25105;&#30340;&#22320;&#22336;&#26159; {0}"</span>, address<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">PP</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">address</span><span style="color: #7388d6;">)</span> : <span style="color: #a020f0;">base</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#29240;&#29240; {0} &#30340;&#22320;&#22336;&#26159; {0}"</span>, name, address<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

<span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">You</span> : <span style="color: #228b22;">PP</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">You</span><span style="color: #7388d6;">()</span> : <span style="color: #a020f0;">base</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25105;&#30340;&#20799;&#23376;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">You</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span><span style="color: #7388d6;">)</span> : <span style="color: #a020f0;">this</span><span style="color: #7388d6;">(</span>name, <span style="color: #8b2252;">"&#24191;&#35199;"</span><span style="color: #7388d6;">)</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">1</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>name<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">You</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">addr</span><span style="color: #7388d6;">)</span> : <span style="color: #a020f0;">base</span><span style="color: #7388d6;">(</span>addr<span style="color: #7388d6;">)</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">2</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"{0} &#30340; {1}"</span>, addr, name<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

<span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Son</span> : <span style="color: #228b22;">You</span>
<span style="color: #707183;">{</span>
<span style="color: #707183;">}</span>

<span style="color: #228b22;">You</span> <span style="color: #a0522d;">u</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">You</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#24352;&#19977;"</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org3b33b66" class="outline-4">
<h4 id="org3b33b66"><span class="section-number-4">8.5.4.</span> 静态构造器</h4>
<div class="outline-text-4" id="text-8-5-4">
<ul class="org-ul">
<li>构造器是用来初始化 <b>对象</b> 的</li>
<li>静态构造器是用来初始化 <b>类</b> 的</li>
<li>对象的初始化工作，是在代码中通过 new Class 的方式触发的</li>
<li>类的初始化工作，是由 CLR 自动执行的，一般来说，你第一次使用到某个类的时候，这个类就会 <b>被</b> 自动加载</li>
<li>静态的构造器，只能有一个，而且不能带任何参数</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCalculator</span> : <span style="color: #228b22;">CalculatorBase</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #0000ff;">TipCalculator</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25105;&#26159;&#19968;&#20010;&#24102; static &#30340;&#26500;&#36896;&#22120;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6b51ef3" class="outline-3">
<h3 id="org6b51ef3"><span class="section-number-3">8.6.</span> 析构方法/析构器 (Deconstructor)</h3>
<div class="outline-text-3" id="text-8-6">
<div class="org-src-container">
<pre class="src src-csharp">~<span style="color: #0000ff;">TipCalculator</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#25105;&#27515;&#30340;&#22909;&#24808;&#21834;"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

~&#25991;&#20214;<span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">this</span>.<span style="color: #0000ff;">Close</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge4475c6" class="outline-3">
<h3 id="orge4475c6"><span class="section-number-3">8.7.</span> 静态方法 (Static)</h3>
<div class="outline-text-3" id="text-8-7">
<p>
将归属权，交给类。调用的时候，使用 <code>类名.xxx</code> 方式。
</p>
</div>
</div>

<div id="outline-container-orgd48aa0d" class="outline-3">
<h3 id="orgd48aa0d"><span class="section-number-3">8.8.</span> 将数据设置为不变的 (const/readonly)</h3>
<div class="outline-text-3" id="text-8-8">
<pre class="example">
通过 private 等操作符可以保护数据的外部访问安全
通过 const/readonly 可以防止内鬼
</pre>


<p>
const:
</p>
<ul class="org-ul">
<li>即常量</li>
<li>基于编译期的替换，运行期是没有任何这个变量的信息的</li>
<li>相对来说，它不需要占用存储，而且不需要运行时检查，所以效率高</li>
<li>它的使用限制较多，比如，只能将一些简单的值赋予它</li>
<li>不能添加 static 修饰，但可以使用 <code>类名.PI</code> 来访问</li>
</ul>

<p>
readonly:
</p>
<ul class="org-ul">
<li>限定变量只能读，不能修改</li>
<li>可以修饰任何的字段，不管是不是静态的</li>
<li>相对来说，需要占用空间、需要运行时检查，效率会低一些</li>
<li>*注意*，使用 readonly 修饰数组等变量，虽然可以防止数组被重新赋值，但不能避免里面的元素被修改</li>
</ul>

<p>
有内鬼，停止交易:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Congming</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">const</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">PI</span> = 3.1415926;
    <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">readonly</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">pppi</span> = 3.14;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">QiuMianJi</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">r</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        pppi = 333;  <span style="color: #b22222;">// </span><span style="color: #b22222;">x</span>
        PI = 333;    <span style="color: #b22222;">// </span><span style="color: #b22222;">x</span>
        <span style="color: #a020f0;">return</span> pppi * r * r;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbdf81f1" class="outline-3">
<h3 id="orgbdf81f1"><span class="section-number-3">8.9.</span> 继承 (Inheritance)</h3>
<div class="outline-text-3" id="text-8-9">
<ul class="org-ul">
<li>继承表示，我的是我的，你的也是我的。使用 <code>:</code> 语法表示继承关系</li>
<li>继承主要用来消除冗余，让逻辑得以 *复用*。逻辑上来说，跟自然界的分门别类是对应一致的</li>
<li>new 对象的时候，会 *开辟空间、初始化字段、调用构造器*。如果存在继承关系的话，创建的实例是分为多部分的</li>
<li>调用实例上的某个方法 A，如果 A 调用了另一个方法 B，这时候，优先会使用 A 自身部分上面定义的 B。
如果想让 A 调用的 B 是派生类 <b>最下面</b> 的 B 的话，使用 <code>virutal/override</code> 将 B 设置为 <b>虚函数</b> 即可。
子类中存在的相同方法，如果不是 override 的，那么将会是 new 的。new 可以不写</li>
<li>在 C# 中，只允许有一个父类，即 <b>单继承</b></li>
<li>所有类的根基类是 *object*。object 中定义了 ToString/GetType/Equal 等方法。因此，所有的对象都拥有这几个方法</li>
<li>在方法中，使用 <b>this</b> 表示当前的对象，使用 <b>base</b> 表示父类部分。base.Xxx 表示调用父类部分的 Xxx</li>
<li>使用 private 修饰的数据不能被继承使用，这时候应该使用 <b>protected</b></li>
</ul>

<p>
基本语法:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span> : <span style="color: #228b22;">object</span> <span style="color: #707183;">{</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Say</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #909183;">)</span>;<span style="color: #7388d6;">}</span> <span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span> : <span style="color: #228b22;">A</span> <span style="color: #707183;">{}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">C</span> : <span style="color: #228b22;">B</span> <span style="color: #707183;">{</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Say</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"world"</span><span style="color: #909183;">)</span>;<span style="color: #7388d6;">}</span> <span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">D</span> : <span style="color: #228b22;">C</span> <span style="color: #707183;">{}</span>
<span style="color: #228b22;">D</span> <span style="color: #a0522d;">d</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">D</span><span style="color: #707183;">()</span>;
d.<span style="color: #0000ff;">Say</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>

<div id="outline-container-orga51b557" class="outline-4">
<h4 id="orga51b557"><span class="section-number-4">8.9.1.</span> 虚方法 (virtual/override)</h4>
<div class="outline-text-4" id="text-8-9-1">
<p>
虚函数:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">Name</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"hello"</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Say</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #a020f0;">this</span>.<span style="color: #0000ff;">Name</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span> : <span style="color: #228b22;">A</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">Name</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"world"</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">void</span> <span style="color: #228b22;">Say</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"heihei"</span> + <span style="color: #0000ff;">Name</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>; <span style="color: #a020f0;">base</span>.<span style="color: #0000ff;">Say</span><span style="color: #909183;">()</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">C</span> : <span style="color: #228b22;">B</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">Name</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"who"</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Say</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"hahaha"</span> + <span style="color: #0000ff;">Name</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">D</span> : <span style="color: #228b22;">C</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">Name</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"ryou"</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">d</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">D</span><span style="color: #707183;">()</span>;
d.<span style="color: #0000ff;">Say</span><span style="color: #707183;">()</span>;
</pre>
</div>

<p>
虚不虚?
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">Name</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"hello"</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Say</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #a020f0;">this</span>.<span style="color: #0000ff;">Name</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span> : <span style="color: #228b22;">A</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">new</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">string</span> <span style="color: #228b22;">Name</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"world"</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Say</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"heihei"</span> + <span style="color: #0000ff;">Name</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>; <span style="color: #a020f0;">base</span>.<span style="color: #0000ff;">Say</span><span style="color: #909183;">()</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">C</span> : <span style="color: #228b22;">B</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">Name</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"who"</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Say</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"hahaha"</span> + <span style="color: #0000ff;">Name</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">D</span> : <span style="color: #228b22;">C</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">Name</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"ryou"</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #228b22;">A</span> <span style="color: #a0522d;">a</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">D</span><span style="color: #707183;">()</span>;
a.<span style="color: #0000ff;">Say</span><span style="color: #707183;">()</span>;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">GrandPP</span>
<span style="color: #707183;">{</span>

<span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PP</span> : <span style="color: #228b22;">GrandPP</span>
<span style="color: #707183;">{</span>

<span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">You</span> : <span style="color: #228b22;">PP</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">You</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"."</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">You</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>name<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">You</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">addr</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>name + <span style="color: #8b2252;">":"</span> + addr<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

<span style="color: #707183;">}</span>
<span style="color: #a020f0;">new</span> <span style="color: #228b22;">You</span><span style="color: #707183;">()</span>;
<span style="color: #a020f0;">new</span> <span style="color: #228b22;">You</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#24352;&#19977;"</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">new</span> <span style="color: #228b22;">You</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#24352;&#19977;"</span>, <span style="color: #8b2252;">"&#28246;&#21335;"</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga8b46e7" class="outline-4">
<h4 id="orga8b46e7"><span class="section-number-4">8.9.2.</span> 抽象方法 (abstract)</h4>
<div class="outline-text-4" id="text-8-9-2">
<ul class="org-ul">
<li>继承下来的，不一定是权利，也有可能是义务。俗语有云 <b>父债子偿</b></li>
<li>通过在父类中，将某个方法用 <code>abstract</code> 修饰，表示它是债务&#x2026;</li>
<li>抽象方法可以 (1) 约束子类的行为 (2) 将父类中无法实现的功能，交给子类去实现</li>
<li>抽象类是不能被实例化的</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">abstract</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Baba</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Money</span> = 0.1;

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">virtual</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Sanjuhua</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#28418;&#20142;&#30340;&#22899;&#23401;&#23376;&#37117;&#27604;&#36739;&#21361;&#38505;"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25105;&#26377;&#24456;&#22810;&#38065;&#65292;&#34255;&#22312;&#26576;&#20010;&#22320;&#26041;"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#20294;&#25105;&#19981;&#21578;&#35785;&#20320;&#22312;&#21738;&#37324;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">abstract</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#33457;&#20809;&#36825;&#20123;&#38065;</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">You</span> : <span style="color: #228b22;">Baba</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Sanjuhua</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#28418;&#20142;&#30340;&#22899;&#23401;&#23376;&#26159;&#20540;&#24471;&#25105;&#20204;&#33457;&#19968;&#29983;&#21435;&#36861;&#27714;&#30340;"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25105;&#26377;&#24456;&#22810;&#38065;&#65292;&#23601;&#25918;&#22312;&#20013;&#22269;&#38134;&#34892;&#30340;&#38065;&#24211;&#37324;"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#20294;&#19981;&#35201;&#25226;&#38065;&#25918;&#30524;&#37324;&#65292;&#20316;&#20026;&#30495;&#30007;&#20154;&#65292;&#35201;&#25954;&#20110; 996&#65292;&#22857;&#29486;&#20154;&#29983;&#20215;&#20540;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#33457;&#20809;&#36825;&#20123;&#38065;</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#31532;&#19968;&#22825;&#65292;&#33457;&#20102; 3 &#20159;"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#31532;&#20108;&#22825;&#65292;&#33457;&#20102; 33 &#20159;"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#31532;&#19977;&#22825;&#65292;&#33457;&#20102; 333 &#20159;"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#31532;&#22235;&#22825;&#65292;&#26790;&#37266;&#20102;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8464328" class="outline-3">
<h3 id="org8464328"><span class="section-number-3">8.10.</span> 多态 (Polymorphism)</h3>
<div class="outline-text-3" id="text-8-10">
<p>
多态是一个来自生物学上的概念，<a href="https://baike.baidu.com/item/%E5%A4%9A%E6%80%81%E7%8E%B0%E8%B1%A1">参见百度百科</a>:
</p>
<ul class="org-ul">
<li>在语言中，多态指调用同一个类型的相同方法/属性，会产生不同结果的现象。
产生不同结果的原因是方法实质调用了不同派生类中的不同实现。</li>
<li>虚方法是实现多态性的主要手段，接口和抽象类是多态的充分体现</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#25209;&#37327;&#22788;&#29702; (&#20851;&#24515;&#30340;&#26159;&#20849;&#24615;)</span>

<span style="color: #228b22;">Animal</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">animals</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Animal</span><span style="color: #707183;">[</span>3<span style="color: #707183;">]</span>;
animals<span style="color: #707183;">[</span>0<span style="color: #707183;">]</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Animal</span><span style="color: #707183;">()</span>;
animals<span style="color: #707183;">[</span>1<span style="color: #707183;">]</span> = <span style="color: #a020f0;">new</span> &#32654;&#22899;<span style="color: #707183;">()</span>;
animals<span style="color: #707183;">[</span>2<span style="color: #707183;">]</span> = <span style="color: #a020f0;">new</span> &#37326;&#20861;<span style="color: #707183;">()</span>;

<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; animals.Length; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">Animal</span> <span style="color: #a0522d;">a</span> = animals<span style="color: #7388d6;">[</span>i<span style="color: #7388d6;">]</span>;
    a.<span style="color: #0000ff;">Eat</span><span style="color: #7388d6;">()</span>;
    a.<span style="color: #0000ff;">Sleep</span><span style="color: #7388d6;">()</span>;
    a.<span style="color: #0000ff;">WakeUp</span><span style="color: #7388d6;">()</span>;
    a.<span style="color: #0000ff;">Drink</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#36866;&#37197;&#30340;&#21442;&#25968;&#31867;&#22411;</span>
<span style="color: #a020f0;">interface</span> <span style="color: #228b22;">&#33021;&#24178;&#27963;&#30340;&#19996;&#35199;</span> <span style="color: #707183;">{</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#24178;&#27963;</span><span style="color: #7388d6;">()</span>; <span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">&#20154;</span> : <span style="color: #228b22;">&#33021;&#24178;&#27963;&#30340;&#19996;&#35199;</span> <span style="color: #707183;">{</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#24178;&#27963;</span> <span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> ... <span style="color: #7388d6;">}</span>; <span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">&#29482;</span> : <span style="color: #228b22;">&#33021;&#24178;&#27963;&#30340;&#19996;&#35199;</span> <span style="color: #707183;">{</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#24178;&#27963;</span> <span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> ... <span style="color: #7388d6;">}</span>; <span style="color: #707183;">}</span>

<span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#25307;&#32856;</span> <span style="color: #707183;">(</span><span style="color: #228b22;">&#33021;&#24178;&#27963;&#30340;&#19996;&#35199;</span> <span style="color: #a0522d;">x</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    x.&#24178;&#27963;<span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
&#25307;&#32856;<span style="color: #707183;">(</span>&#20154;<span style="color: #707183;">)</span>;
&#25307;&#32856;<span style="color: #707183;">(</span>&#29482;<span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#36866;&#37197;&#30340;&#36820;&#22238;&#20540; (&#32422;&#23450;&#36319;&#23454;&#29616;&#30340;&#21644;&#35856;)</span>

<span style="color: #228b22;">Dog</span> <span style="color: #0000ff;">GiveADog</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> &#20108;&#21704;<span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
<span style="color: #228b22;">Animal</span> <span style="color: #a0522d;">aaa</span> = <span style="color: #0000ff;">GiveADog</span><span style="color: #707183;">()</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#25509;&#21475;&#19982;&#22810;&#24577;</span>

<span style="color: #228b22;">IHelpable</span> <span style="color: #a0522d;">xxx</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TipCalculator</span><span style="color: #707183;">(</span>222<span style="color: #707183;">)</span>;
xxx.<span style="color: #0000ff;">Help</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org2391071" class="outline-3">
<h3 id="org2391071"><span class="section-number-3">8.11.</span> 静态类/static</h3>
<div class="outline-text-3" id="text-8-11">
<p>
限制里面所有的方法，必须是静态的。典型的代表是 Math 类。
</p>
</div>
</div>

<div id="outline-container-org6276832" class="outline-3">
<h3 id="org6276832"><span class="section-number-3">8.12.</span> 密封类/sealed</h3>
<div class="outline-text-3" id="text-8-12">
<p>
这就从语法上，避免了某个类被继承的可能。
</p>
</div>
</div>

<div id="outline-container-org6b1ee8d" class="outline-3">
<h3 id="org6b1ee8d"><span class="section-number-3">8.13.</span> 分部类/partial</h3>
<div class="outline-text-3" id="text-8-13">
<p>
让类可以写成多部分。在编译的环节，编译器将会帮助我们自动合并之后再编译。
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">partial</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyLove</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#20320;&#24819;&#25105;&#21527;</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">partial</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyLove</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#25105;&#24819;&#20320;</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3b7afe6" class="outline-3">
<h3 id="org3b7afe6"><span class="section-number-3">8.14.</span> 基类 Object</h3>
<div class="outline-text-3" id="text-8-14">
</div>
<div id="outline-container-org3cf1bab" class="outline-4">
<h4 id="org3cf1bab"><span class="section-number-4">8.14.1.</span> ToString</h4>
<div class="outline-text-4" id="text-8-14-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">TipCalculator</span> : <span style="color: #228b22;">CalculatorBase</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">ToString</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> $<span style="color: #8b2252;">"&#25105;&#26159;&#19968;&#20010;&#36134;&#21333;&#31867;&#65292;&#20256;&#20837;&#30340;&#21442;&#25968;&#26159; {Bill}"</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"{0}"</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TipCalculator</span><span style="color: #7388d6;">(</span>200<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org95a7a34" class="outline-3">
<h3 id="org95a7a34"><span class="section-number-3">8.15.</span> 类的扩展机制</h3>
<div class="outline-text-3" id="text-8-15">
<p>
为某个类扩展功能的基本方式:
</p>
<ol class="org-ol">
<li>直接修改源码，添加想要的方法</li>
<li>通过继承的方式，你的是我的我的还是我的</li>
</ol>

<p>
如果无法修改源码、而且不能继承时，就需要下面这种扩展手段，具备特点:
</p>
<ul class="org-ul">
<li>很灵活很方便</li>
<li>但需要慎用</li>
</ul>

<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>90.<span style="color: #0000ff;">Repeat</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"-"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>30.<span style="color: #0000ff;">Repeat</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"+  "</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>30.<span style="color: #0000ff;">Repeat</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"|  "</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>30.<span style="color: #0000ff;">Repeat</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"|  "</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        100.<span style="color: #0000ff;">Times</span><span style="color: #909183;">(</span><span style="color: #709870;">()</span> =&gt; Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"IOU "</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>; Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>30.<span style="color: #0000ff;">Repeat</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"|  "</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>30.<span style="color: #0000ff;">Repeat</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"|  "</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>30.<span style="color: #0000ff;">Repeat</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"+  "</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>90.<span style="color: #0000ff;">Repeat</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"-"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">SuibianQigemingzi</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Cl0ne</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">this</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"hello {s}!"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ClOne</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">this</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"hello {s}!"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">C1one</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">this</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"hello {s}!"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Hello</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">this</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"hello {s}!"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Hi</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">this</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">s</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">n</span> = 1<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{s} &#21152;&#19978; {n} &#20026; {s + n}!"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">Rot13</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">this</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">str</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">StringBuilder</span> <span style="color: #a0522d;">sb</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #909183;">()</span>;
        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">char</span> <span style="color: #a0522d;">c</span> <span style="color: #a020f0;">in</span> str<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            sb.<span style="color: #0000ff;">Append</span><span style="color: #709870;">(</span><span style="color: #0000ff;">RotChar</span><span style="color: #907373;">(</span><span style="color: #228b22;">c</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">return</span> sb.<span style="color: #0000ff;">ToString</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">char</span> <span style="color: #0000ff;">RotChar</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">char</span> <span style="color: #a0522d;">c</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">byte</span> <span style="color: #a0522d;">code</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">byte</span><span style="color: #909183;">)</span>c;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>c &gt;= <span style="color: #8b2252;">'a'</span> &amp;&amp; c &lt;= <span style="color: #8b2252;">'z'</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> <span style="color: #709870;">(</span><span style="color: #228b22;">char</span><span style="color: #709870;">)(</span>code + 13 &gt; 122 ? code - 13 : code + 13<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>c &gt;= <span style="color: #8b2252;">'A'</span> &amp;&amp; c &lt;= <span style="color: #8b2252;">'Z'</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">return</span> <span style="color: #709870;">(</span><span style="color: #228b22;">char</span><span style="color: #709870;">)(</span>code + 13 &gt; 90 ? code - 13 : code + 13<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">return</span> c;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">Repeat</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">this</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">count</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">source</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">sb</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #909183;">()</span>;
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; count; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            sb.<span style="color: #0000ff;">Append</span><span style="color: #709870;">(</span><span style="color: #228b22;">source</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">return</span> sb.<span style="color: #0000ff;">ToString</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Times</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">this</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">count</span>, <span style="color: #228b22;">Action</span> <span style="color: #a0522d;">action</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; count; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #0000ff;">action</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org8ec73e0" class="outline-2">
<h2 id="org8ec73e0"><span class="section-number-2">9.</span> 接口 (Interface)</h2>
<div class="outline-text-2" id="text-9">
<ul class="org-ul">
<li>接口本质就是一个可以进行 <b>多继承</b> 的纯的抽象类。它是单继承的一种例外</li>
<li>使用 interface 关键词声明接口，接口里面只能包含方法。按照习惯，一般使用 IXxx 的方式命名接口</li>
<li>不需要使用 public 修饰符，因为接口里所有方法默认都是公开的。方法不需要有方法体</li>
<li>接口实际上就是一种 <b>合同*，它起到的作用是制定统一的 *规则</b></li>
<li>接口有很多好处: blahblahblah&#x2026; 面向接口编程是一种好的编程实践</li>
</ul>
</div>

<div id="outline-container-org1db3e56" class="outline-3">
<h3 id="org1db3e56"><span class="section-number-3">9.1.</span> IComparable 接口使用示例</h3>
<div class="outline-text-3" id="text-9-1">
<p>
IComparable 用来为两个对象进行比较提供比较的规则:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span> : <span style="color: #228b22;">IComparable</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Name</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Salary</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">Age</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">Person</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">sal</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Name = name;
        Salary = sal;
        Age = age;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">CompareTo</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">object</span>? <span style="color: #a0522d;">obj</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">wo</span> = <span style="color: #a020f0;">this</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ni</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">Person</span><span style="color: #909183;">)</span> obj;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">if (wo.Salary &gt; ni.Salary) return -1;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">if (wo.Salary &lt; ni.Salary) return 1;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">return 0;</span>
        <span style="color: #a020f0;">return</span> wo.Salary - ni.Salary;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">p1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"a-&#23567;&#26126;"</span>, 20000, 50<span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">p2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"c-&#23567;&#24352;"</span>, 7000, 25<span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">p3</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"b-&#23567;&#29579;"</span>, 15000, 35<span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">p4</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"d-&#23567;&#32418;"</span>, 7500, 19<span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">p5</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"e-&#23567;&#24378;"</span>, 5000, 22<span style="color: #7388d6;">)</span>;

    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">persons</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #7388d6;">[]</span> <span style="color: #7388d6;">{</span>p1, p2, p3, p4, p5<span style="color: #7388d6;">}</span>;

    Array.<span style="color: #0000ff;">Sort</span><span style="color: #7388d6;">(</span>persons<span style="color: #7388d6;">)</span>;

    <span style="color: #a020f0;">foreach</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">p</span> <span style="color: #a020f0;">in</span> persons<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{p.Name}: {p.Age} &#23681;, &#25910;&#20837;&#20026; {p.Salary}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org2b3f26b" class="outline-2">
<h2 id="org2b3f26b"><span class="section-number-2">10.</span> 结构体 (Struct)</h2>
<div class="outline-text-2" id="text-10">
<ul class="org-ul">
<li>它跟 class 非常像，但它是值类型</li>
<li>由于是值类型，所以效率高:
<ul class="org-ul">
<li>栈上，用完退栈，不需要垃圾回收</li>
<li>对象内部</li>
</ul></li>
<li>实际上，我们的常见预定义类型，都是实现为 struct (int/float)</li>
<li>结构体，默认是密封的，因此，它不能继承</li>
<li>它支持 partial 的用法</li>
<li>它支持使用构造器:
<ul class="org-ul">
<li>在构造器中，需要确保为每个成员赋值</li>
<li>包含一个默认构造器，里面会对所有成员进行初始化，我们不能将其覆盖掉</li>
</ul></li>
<li>它不需要，也不能有析构方法</li>
</ul>

<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #0000ff;">TestStuct</span><span style="color: #7388d6;">()</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#32467;&#26463;&#20102;"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">TestStuct</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">YellowMan</span> <span style="color: #a0522d;">a</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">YellowMan</span><span style="color: #7388d6;">()</span>;
    a.Name = <span style="color: #8b2252;">"&#23567;&#40644;&#20154;&#30002;"</span>;
    a.Score = 333.4;

    <span style="color: #228b22;">YellowMan</span> <span style="color: #a0522d;">b</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">YellowMan</span><span style="color: #7388d6;">()</span>;
    b.Name = <span style="color: #8b2252;">"&#23567;&#40644;&#20154;&#20057;"</span>;
    b.Score = 133.4;

    b.<span style="color: #0000ff;">ZiWoJieShao</span><span style="color: #7388d6;">()</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>b<span style="color: #7388d6;">)</span>;

    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">d</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">YellowMan</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"kkk"</span>, 222<span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>d.Name<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">struct</span> <span style="color: #228b22;">YellowMan</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Name</span>;
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Score</span>;
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">Age</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">YellowMan</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">n</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">s</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Name = n;
        Score = s;
        Age = 23;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ZiWoJieShao</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#25105;&#26159; {Name},&#25105;&#30340;&#21487;&#29233;&#31243;&#24230;&#20026; {Score}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">ToString</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"hello, &#23567;&#40644;&#20154;"</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">YellowMan</span> <span style="color: #a0522d;">c</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">YellowMan</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</section>

<section id="outline-container-orgf7e4865" class="outline-2">
<h2 id="orgf7e4865"><span class="section-number-2">11.</span> 枚举 (Enum)</h2>
<div class="outline-text-2" id="text-11">
<p>
int/1 2 3 .. ..  3
double &#x2026;..
bool: true/false
</p>

<p>
Gender (男/女/未知)
</p>
</div>

<div id="outline-container-orgbf8709d" class="outline-3">
<h3 id="orgbf8709d"><span class="section-number-3">11.1.</span> 基本使用</h3>
<div class="outline-text-3" id="text-11-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">checked</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #709870;">(</span><span style="color: #228b22;">int</span><span style="color: #709870;">)</span>Gender3.&#22899;<span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #709870;">(</span><span style="color: #228b22;">int</span><span style="color: #709870;">)</span>Gender3.&#30007;<span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #709870;">(</span><span style="color: #228b22;">int</span><span style="color: #709870;">)</span>Gender3.&#25105;&#20063;&#19981;&#30693;&#36947;&#26159;&#30007;&#26159;&#22899;&#23427;&#21040;&#24213;&#26159;&#30007;&#26159;&#22899;&#21602;&#35841;&#30693;&#36947;&#21602;&#19981;&#31649;&#20182;&#20102;<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>Gender4.&#25105;&#20063;&#19981;&#30693;&#36947;&#26159;&#30007;&#26159;&#22899;&#23427;&#21040;&#24213;&#26159;&#30007;&#26159;&#22899;&#21602;&#35841;&#30693;&#36947;&#21602;&#19981;&#31649;&#20182;&#20102; == Gender4.&#30007;<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"Yes."</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">enum</span> <span style="color: #228b22;">MyBool</span>
<span style="color: #707183;">{</span>
    <span style="color: #a0522d;">True</span>,
    <span style="color: #a0522d;">False</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">enum</span> <span style="color: #228b22;">Gender</span>
<span style="color: #707183;">{</span>
    <span style="color: #a0522d;">&#30007;</span>,
    <span style="color: #a0522d;">&#22899;</span>,
    <span style="color: #a0522d;">&#25105;&#20063;&#19981;&#30693;&#36947;&#26159;&#30007;&#26159;&#22899;&#23427;&#21040;&#24213;&#26159;&#30007;&#26159;&#22899;&#21602;&#35841;&#30693;&#36947;&#21602;&#19981;&#31649;&#20182;&#20102;</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">enum</span> <span style="color: #228b22;">Gender2</span>
<span style="color: #707183;">{</span>
    <span style="color: #a0522d;">&#30007;</span> = 0,
    <span style="color: #a0522d;">&#22899;</span> = 1,
    <span style="color: #a0522d;">&#25105;&#20063;&#19981;&#30693;&#36947;&#26159;&#30007;&#26159;&#22899;&#23427;&#21040;&#24213;&#26159;&#30007;&#26159;&#22899;&#21602;&#35841;&#30693;&#36947;&#21602;&#19981;&#31649;&#20182;&#20102;</span> = 2
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">enum</span> <span style="color: #228b22;">Gender3</span>
<span style="color: #707183;">{</span>
    <span style="color: #a0522d;">&#30007;</span> = 110,
    <span style="color: #a0522d;">&#22899;</span>,
    <span style="color: #a0522d;">&#25105;&#20063;&#19981;&#30693;&#36947;&#26159;&#30007;&#26159;&#22899;&#23427;&#21040;&#24213;&#26159;&#30007;&#26159;&#22899;&#21602;&#35841;&#30693;&#36947;&#21602;&#19981;&#31649;&#20182;&#20102;</span> = 120
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">enum</span> <span style="color: #228b22;">Gender4</span>
<span style="color: #707183;">{</span>
    <span style="color: #a0522d;">&#30007;</span> = 110,
    <span style="color: #a0522d;">&#22899;</span>,
    <span style="color: #a0522d;">&#25105;&#20063;&#19981;&#30693;&#36947;&#26159;&#30007;&#26159;&#22899;&#23427;&#21040;&#24213;&#26159;&#30007;&#26159;&#22899;&#21602;&#35841;&#30693;&#36947;&#21602;&#19981;&#31649;&#20182;&#20102;</span> = &#30007;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">enum</span> <span style="color: #228b22;">Gender5</span> : <span style="color: #228b22;">short</span>
<span style="color: #707183;">{</span>
    <span style="color: #a0522d;">&#30007;</span> = 110,
    <span style="color: #a0522d;">&#22899;</span>,
    <span style="color: #a0522d;">&#25105;&#20063;&#19981;&#30693;&#36947;&#26159;&#30007;&#26159;&#22899;&#23427;&#21040;&#24213;&#26159;&#30007;&#26159;&#22899;&#21602;&#35841;&#30693;&#36947;&#21602;&#19981;&#31649;&#20182;&#20102;</span> = &#30007;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyGender</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">&#30007;</span> = 0;
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">&#22899;</span> = 1;
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">const</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">&#25105;&#20063;&#19981;&#30693;&#36947;&#26159;&#30007;&#26159;&#22899;&#23427;&#21040;&#24213;&#26159;&#30007;&#26159;&#22899;&#21602;&#35841;&#30693;&#36947;&#21602;&#19981;&#31649;&#20182;&#20102;</span> = 2;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge30e795" class="outline-3">
<h3 id="orge30e795"><span class="section-number-3">11.2.</span> Flags (TODO)</h3>
<div class="outline-text-3" id="text-11-2">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #707183;">[</span><span style="color: #a0522d;">Flags</span><span style="color: #707183;">]</span>
<span style="color: #a020f0;">enum</span> FeichangJincouDeLeixing
<span style="color: #707183;">{</span>
    <span style="color: #a0522d;">A</span> = 0x12,
    <span style="color: #a0522d;">B</span> = 0x13
<span style="color: #707183;">}</span>

111111
101001
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf66ddd0" class="outline-3">
<h3 id="orgf66ddd0"><span class="section-number-3">11.3.</span> 基本 API</h3>
<div class="outline-text-3" id="text-11-3">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">foreach</span> <span style="color: #707183;">(</span><span style="color: #228b22;">string</span> <span style="color: #0000ff;">name</span> <span style="color: #a020f0;">in</span> Enum.<span style="color: #0000ff;">GetNames</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">typeof</span><span style="color: #909183;">(</span>Gender<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>name<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">foreach</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #0000ff;">v</span> <span style="color: #a020f0;">in</span> Enum.<span style="color: #0000ff;">GetValues</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">typeof</span><span style="color: #909183;">(</span>Gender<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span><span style="color: #909183;">)</span>v<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org51cb116" class="outline-2">
<h2 id="org51cb116"><span class="section-number-2">12.</span> 委托 (Delegate)</h2>
<div class="outline-text-2" id="text-12">
<ul class="org-ul">
<li>背景:
<ul class="org-ul">
<li>我们需要通过参数的形式去传递一些逻辑</li>
<li>逻辑的基本单元是方法</li>
<li>很遗憾的是，方法在 C# 中并不是某种类型，也不具备相应的实例。因此，它不能作为参数被传递</li>
<li>所以，我们需要通过一定方式，达到能够传递方法 (以及其中的逻辑) 的目的</li>
<li>一种传统的方式，是将方法包含在某个类中，然后实例化并传递。但是这种方式特别麻烦</li>
<li>因此，在 C# 中为了解决这个问题，就推出了一种类型，叫做委托 (Delegate)</li>
</ul></li>
<li>总而言之，通过委托机制，达到 <b>像传递对象实例一样，传递方法</b> 的目的</li>
</ul>
</div>

<div id="outline-container-org284b10d" class="outline-3">
<h3 id="org284b10d"><span class="section-number-3">12.1.</span> 写一个方法 MyAdd ，求取 <b>若干数</b> 的和</h3>
<div class="outline-text-3" id="text-12-1">
</div>
<div id="outline-container-org8aeda41" class="outline-4">
<h4 id="org8aeda41"><span class="section-number-4">12.1.1.</span> 原始写法</h4>
<div class="outline-text-4" id="text-12-1-1">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Console.ForegroundColor = ConsoleColor.Red;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Console.WriteLine(sum);</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Console.ResetColor();</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558;&#19978;&#38754;&#19977;&#23616;&#65292;&#25918;&#21040;&#19968;&#20010;&#23545;&#35937;&#37324;&#65292;&#28982;&#21518;</span>
    <span style="color: #228b22;">object</span> <span style="color: #a0522d;">o1</span> = <span style="color: #008b8b;">null</span>;

    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r1</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #7388d6;">(</span>o1, 12, 32, 1112232, 43, 1112212, 3232323, 123<span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r2</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #7388d6;">(</span>o2, 222, 333, 444<span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r3</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #7388d6;">(</span>o3, 11, 2323, 4344<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyAdd</span><span style="color: #707183;">(</span><span style="color: #228b22;">object</span> <span style="color: #a0522d;">gaosuwogaigansm</span>, <span style="color: #a020f0;">params</span> <span style="color: #228b22;">int</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">nums</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span> = 0;
    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; nums.Length; i++<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        sum += nums<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Console.ForegroundColor = ConsoleColor.Red;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Console.WriteLine(sum);</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Console.ResetColor();</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">Console.BackgroundColor = ConsoleColor.Red;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Console.WriteLine("&#21644;&#20026;&#65306;"+sum);</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Console.ResetColor();</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">File.AppendAllText(@"E:\jiafa.txt", sum + "\r\n");</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">SpeechSynthesizer synth = new SpeechSynthesizer();</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">synth.Speak(sum.ToString());</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">synth.Dispose();</span>

    <span style="color: #228b22;">Bitmap</span> <span style="color: #a0522d;">image</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Bitmap</span><span style="color: #7388d6;">(</span>256, 256<span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">using</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">Graphics</span> <span style="color: #a0522d;">g</span> = Graphics.<span style="color: #0000ff;">FromImage</span><span style="color: #909183;">(</span>image<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        g.<span style="color: #0000ff;">FillRectangle</span><span style="color: #909183;">(</span>Brushes.Yellow, 0, 0, 256, 256<span style="color: #909183;">)</span>;
        g.<span style="color: #0000ff;">DrawString</span><span style="color: #909183;">(</span>sum.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Font</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"Monospace"</span>, 26<span style="color: #709870;">)</span>, Brushes.DarkGreen, 10, 10<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    image.<span style="color: #0000ff;">Save</span><span style="color: #7388d6;">(</span>@<span style="color: #8b2252;">"e:\hello.jpg"</span><span style="color: #7388d6;">)</span>;

    <span style="color: #a020f0;">return</span> sum;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
点评:
</p>
<ul class="org-ul">
<li>不能实现不同调用的时候，具备不同逻辑</li>
</ul>
</div>
</div>

<div id="outline-container-org1a2ec01" class="outline-4">
<h4 id="org1a2ec01"><span class="section-number-4">12.1.2.</span> 通过一个 Flag 来通知 MyAdd 要去调用什么逻辑</h4>
<div class="outline-text-4" id="text-12-1-2">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r1</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #909183;">(</span>1,    12, 32, 1112232, 43, 1112212, 3232323, 123<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r2</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #909183;">(</span>2,    222, 333, 444<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r3</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #909183;">(</span>4,    11, 2323, 4344<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyAdd</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">flag</span>, <span style="color: #a020f0;">params</span> <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">nums</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span> = 0;
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; nums.Length; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            sum += nums<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">switch</span> <span style="color: #909183;">(</span>flag<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">case</span> 1:
                <span style="color: #0000ff;">Print1</span><span style="color: #709870;">(</span><span style="color: #228b22;">sum</span><span style="color: #709870;">)</span>;
                <span style="color: #a020f0;">break</span>;
            <span style="color: #a020f0;">case</span> 2:
                <span style="color: #0000ff;">Print2</span><span style="color: #709870;">(</span><span style="color: #228b22;">sum</span><span style="color: #709870;">)</span>;
                <span style="color: #a020f0;">break</span>;
            <span style="color: #a020f0;">case</span> 3:
                <span style="color: #0000ff;">ToFile</span><span style="color: #709870;">(</span><span style="color: #228b22;">sum</span><span style="color: #709870;">)</span>;
                <span style="color: #a020f0;">break</span>;
            <span style="color: #a020f0;">case</span> 4:
                <span style="color: #0000ff;">Speech</span><span style="color: #709870;">(</span><span style="color: #228b22;">sum</span><span style="color: #709870;">)</span>;
                <span style="color: #a020f0;">break</span>;
            <span style="color: #a020f0;">default</span>:
                <span style="color: #0000ff;">Draw</span><span style="color: #709870;">(</span><span style="color: #228b22;">sum</span><span style="color: #709870;">)</span>;
                <span style="color: #a020f0;">break</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">return</span> sum;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Print1</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.ForegroundColor = ConsoleColor.Red;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">sum</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Print2</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.BackgroundColor = ConsoleColor.Red;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#21644;&#20026;&#65306;"</span> + sum<span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ToFile</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        File.<span style="color: #0000ff;">AppendAllText</span><span style="color: #909183;">(</span>@<span style="color: #8b2252;">"E:\jiafa.txt"</span>, sum + <span style="color: #8b2252;">"\r\n"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Speech</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">SpeechSynthesizer</span> <span style="color: #a0522d;">synth</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SpeechSynthesizer</span><span style="color: #909183;">()</span>;
        synth.<span style="color: #0000ff;">Speak</span><span style="color: #909183;">(</span>sum.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
        synth.<span style="color: #0000ff;">Dispose</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Draw</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">Bitmap</span> <span style="color: #a0522d;">image</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Bitmap</span><span style="color: #909183;">(</span>256, 256<span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">using</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Graphics</span> <span style="color: #a0522d;">g</span> = Graphics.<span style="color: #0000ff;">FromImage</span><span style="color: #709870;">(</span><span style="color: #228b22;">image</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            g.<span style="color: #0000ff;">FillRectangle</span><span style="color: #709870;">(</span>Brushes.<span style="color: #228b22;">Yellow</span>, 0, 0, 20, 20<span style="color: #709870;">)</span>;
            g.<span style="color: #0000ff;">DrawString</span><span style="color: #709870;">(</span>sum.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Font</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"Monospace"</span>, 26<span style="color: #907373;">)</span>, Brushes.<span style="color: #228b22;">DarkGreen</span>, 10, 10<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        image.<span style="color: #0000ff;">Save</span><span style="color: #909183;">(</span>@<span style="color: #8b2252;">"e:\hello.jpg"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
点评:
</p>
<ul class="org-ul">
<li>很直观，很简洁，很清晰</li>
<li>使用 flag 很难通过数字判断出来相对应的逻辑 (可以通过 enum 的改造，改善这个问题)</li>
<li>灵活性严重不足，扩张起来麻烦死了。</li>
</ul>
</div>
</div>

<div id="outline-container-orgc3394e6" class="outline-4">
<h4 id="orgc3394e6"><span class="section-number-4">12.1.3.</span> 没有中间商赚差价，借助类和接口的方式，传递不同的方法</h4>
<div class="outline-text-4" id="text-12-1-3">

<figure id="orgfeb82b1">
<img src="img/guaziershouche.png" alt="guaziershouche.png">

</figure>


<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r1</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Print1</span><span style="color: #709870;">()</span>, 12, 32, 1112232, 43, 1112212, 3232323, 123<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r2</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">PrintAndWuwuwu</span><span style="color: #709870;">()</span>, 222, 333, 444<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyAdd</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">IMyAdd</span> <span style="color: #a0522d;">o</span>, <span style="color: #a020f0;">params</span> <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">nums</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span> = 0;
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; nums.Length; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            sum += nums<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>

        o.<span style="color: #0000ff;">A</span><span style="color: #909183;">(</span><span style="color: #228b22;">sum</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">return</span> sum;
    <span style="color: #7388d6;">}</span>

    <span style="color: #8b2252;">////////////////////</span>

    <span style="color: #a020f0;">internal</span> <span style="color: #a020f0;">interface</span> <span style="color: #228b22;">IMyAdd</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">void</span> <span style="color: #0000ff;">A</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Print1</span> : <span style="color: #228b22;">IMyAdd</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">A</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.ForegroundColor = ConsoleColor.Red;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #228b22;">sum</span><span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Print2</span> : <span style="color: #228b22;">IMyAdd</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">A</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.BackgroundColor = ConsoleColor.Red;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#21644;&#20026;&#65306;"</span> + sum<span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ToFile</span> : <span style="color: #228b22;">IMyAdd</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">A</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            File.<span style="color: #0000ff;">AppendAllText</span><span style="color: #709870;">(</span>@<span style="color: #8b2252;">"E:\jiafa.txt"</span>, sum + <span style="color: #8b2252;">"\r\n"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">PrintAndWuwuwu</span> : <span style="color: #228b22;">IMyAdd</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">A</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.BackgroundColor = ConsoleColor.Green;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#21704;&#21704;&#21704;&#65292;&#21596;&#21596;&#21596;&#65306;"</span> + sum<span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #709870;">()</span>;
            <span style="color: #228b22;">SpeechSynthesizer</span> <span style="color: #a0522d;">synth</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SpeechSynthesizer</span><span style="color: #709870;">()</span>;
            synth.<span style="color: #0000ff;">Speak</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#21596;&#21596;&#21596;&#21596;&#21596;&#21596;&#21596;&#65292;&#21704;&#21704;&#21704;!"</span><span style="color: #709870;">)</span>;
            synth.<span style="color: #0000ff;">Dispose</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Speech</span> : <span style="color: #228b22;">IMyAdd</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">A</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #228b22;">SpeechSynthesizer</span> <span style="color: #a0522d;">synth</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SpeechSynthesizer</span><span style="color: #709870;">()</span>;
            synth.<span style="color: #0000ff;">Speak</span><span style="color: #709870;">(</span>sum.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            synth.<span style="color: #0000ff;">Dispose</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Draw</span> : <span style="color: #228b22;">IMyAdd</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">A</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #228b22;">Bitmap</span> <span style="color: #a0522d;">image</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Bitmap</span><span style="color: #709870;">(</span>256, 256<span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">using</span> <span style="color: #709870;">(</span><span style="color: #228b22;">Graphics</span> <span style="color: #a0522d;">g</span> = Graphics.<span style="color: #0000ff;">FromImage</span><span style="color: #907373;">(</span><span style="color: #228b22;">image</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                g.<span style="color: #0000ff;">FillRectangle</span><span style="color: #907373;">(</span>Brushes.<span style="color: #228b22;">Yellow</span>, 0, 0, 20, 20<span style="color: #907373;">)</span>;
                g.<span style="color: #0000ff;">DrawString</span><span style="color: #907373;">(</span>sum.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Font</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"Monospace"</span>, 26<span style="color: #6276ba;">)</span>, Brushes.<span style="color: #228b22;">DarkGreen</span>, 10, 10<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
            image.<span style="color: #0000ff;">Save</span><span style="color: #709870;">(</span>@<span style="color: #8b2252;">"e:\hello.jpg"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8135472" class="outline-4">
<h4 id="org8135472"><span class="section-number-4">12.1.4.</span> 模板代码实在不爽，委托类型出现来救场</h4>
<div class="outline-text-4" id="text-12-1-4">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#22768;&#26126;&#19968;&#31181;&#25968;&#25454;&#31867;&#22411;&#65292;&#21483; MyWeiTuo&#65292;&#26159;&#22996;&#25176;&#31867;&#22411;</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">delegate</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">MyWeiTuo</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #7388d6;">)</span>;

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#36890;&#36807; new &#25805;&#20316;&#31526;&#65292;&#20026;&#36825;&#31181;&#31867;&#22411;&#21019;&#24314;&#19968;&#20010;&#23454;&#20363;</span>
        <span style="color: #228b22;">MyWeiTuo</span> <span style="color: #a0522d;">v1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyWeiTuo</span><span style="color: #909183;">(</span><span style="color: #228b22;">PrintAndWuwuwu</span><span style="color: #909183;">)</span>;
        <span style="color: #b22222;">// </span><span style="color: #b22222;">3. &#20351;&#29992;&#36825;&#20010;&#23454;&#20363;&#12290;&#36825;&#37324;&#20027;&#35201;&#29992;&#20316;&#26041;&#27861;&#30340;&#21442;&#25968;&#20256;&#36882;</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r1</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #909183;">(</span><span style="color: #228b22;">v1</span>, 12, 32, 1112232, 43, 1112212, 3232323, 123<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r2</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyWeiTuo</span><span style="color: #709870;">(</span><span style="color: #228b22;">Print2</span><span style="color: #709870;">)</span>, 222, 333, 444<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r3</span> = <span style="color: #0000ff;">MyAdd</span><span style="color: #909183;">(</span><span style="color: #228b22;">MyLove</span>, 222, 333<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyAdd</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">MyWeiTuo</span> <span style="color: #a0522d;">o</span>, <span style="color: #a020f0;">params</span> <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">nums</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span> = 0;
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; nums.Length; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            sum += nums<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #0000ff;">o</span><span style="color: #909183;">(</span><span style="color: #228b22;">sum</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">return</span> sum;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Print1</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.ForegroundColor = ConsoleColor.Red;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">sum</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Print2</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.BackgroundColor = ConsoleColor.Red;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#21644;&#20026;&#65306;"</span> + sum<span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">ToFile</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        File.<span style="color: #0000ff;">AppendAllText</span><span style="color: #909183;">(</span>@<span style="color: #8b2252;">"E:\jiafa.txt"</span>, sum + <span style="color: #8b2252;">"\r\n"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintAndWuwuwu</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.BackgroundColor = ConsoleColor.Green;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#21704;&#21704;&#21704;&#65292;&#21596;&#21596;&#21596;&#65306;"</span> + sum<span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">SpeechSynthesizer</span> <span style="color: #a0522d;">synth</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SpeechSynthesizer</span><span style="color: #909183;">()</span>;
        synth.<span style="color: #0000ff;">Speak</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#21596;&#21596;&#21596;&#21596;&#21596;&#21596;&#21596;&#65292;&#21704;&#21704;&#21704;!"</span><span style="color: #909183;">)</span>;
        synth.<span style="color: #0000ff;">Dispose</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Speech</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">SpeechSynthesizer</span> <span style="color: #a0522d;">synth</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SpeechSynthesizer</span><span style="color: #909183;">()</span>;
        synth.<span style="color: #0000ff;">Speak</span><span style="color: #909183;">(</span>sum.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
        synth.<span style="color: #0000ff;">Dispose</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Draw</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">Bitmap</span> <span style="color: #a0522d;">image</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Bitmap</span><span style="color: #909183;">(</span>256, 256<span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">using</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Graphics</span> <span style="color: #a0522d;">g</span> = Graphics.<span style="color: #0000ff;">FromImage</span><span style="color: #709870;">(</span><span style="color: #228b22;">image</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            g.<span style="color: #0000ff;">FillRectangle</span><span style="color: #709870;">(</span>Brushes.<span style="color: #228b22;">Yellow</span>, 0, 0, 20, 20<span style="color: #709870;">)</span>;
            g.<span style="color: #0000ff;">DrawString</span><span style="color: #709870;">(</span>sum.<span style="color: #0000ff;">ToString</span><span style="color: #907373;">()</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Font</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"Monospace"</span>, 26<span style="color: #907373;">)</span>, Brushes.<span style="color: #228b22;">DarkGreen</span>, 10, 10<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        image.<span style="color: #0000ff;">Save</span><span style="color: #909183;">(</span>@<span style="color: #8b2252;">"e:\hello.jpg"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">MyLove</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25105;&#23601;&#26159;&#21916;&#27426;&#40644;&#33394;&#65292;&#21017;&#20040;&#20102;."</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc96b5c7" class="outline-3">
<h3 id="orgc96b5c7"><span class="section-number-3">12.2.</span> 基本语法</h3>
<div class="outline-text-3" id="text-12-2">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#22768;&#26126; (&#22996;&#25176;&#31867;&#22411;)</span>
<span style="color: #a020f0;">delegate</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">MyMethod1</span><span style="color: #707183;">()</span>;
<span style="color: #a020f0;">delegate</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyMethod2</span><span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">b</span><span style="color: #707183;">)</span>;

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#23454;&#20363;&#21270;</span>
        <span style="color: #228b22;">MyMethod1</span> <span style="color: #a0522d;">m1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyMethod1</span><span style="color: #909183;">(</span><span style="color: #228b22;">Hahaha</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">MyMethod2</span> <span style="color: #a0522d;">m2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyMethod2</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Program</span><span style="color: #709870;">()</span>.Heiheihei<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">MyMethod1</span> <span style="color: #a0522d;">m3</span> = Hahaha;
        <span style="color: #228b22;">MyMethod2</span> <span style="color: #a0522d;">m4</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Program</span><span style="color: #909183;">()</span>.Heiheihei;
        <span style="color: #228b22;">MyMethod2</span> <span style="color: #a0522d;">m5</span> = Hehehe;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">3. &#20351;&#29992;</span>
        <span style="color: #0000ff;">m1</span><span style="color: #909183;">()</span>;
        <span style="color: #0000ff;">m2</span><span style="color: #909183;">(</span>1, 2<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Hahaha</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"hahaha, henkuaile."</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">int</span> <span style="color: #0000ff;">Heiheihei</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">b</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> a * b;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">Hehehe</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">b</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> a + b * a - b;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd3c6c8" class="outline-3">
<h3 id="orgcd3c6c8"><span class="section-number-3">12.3.</span> 匿名委托</h3>
<div class="outline-text-3" id="text-12-3">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#22768;&#26126;</span>
<span style="color: #a020f0;">delegate</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">MyAddWT</span><span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #707183;">)</span>;

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#23454;&#20363;&#21270;</span>
        <span style="color: #228b22;">MyAddWT</span> <span style="color: #a0522d;">maw</span> = <span style="color: #a020f0;">delegate</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"hahaha, henkuaile."</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>;
        <span style="color: #b22222;">// </span><span style="color: #b22222;">3. &#20351;&#29992;</span>
        <span style="color: #0000ff;">MyAdd</span><span style="color: #909183;">(</span>1, 3, <span style="color: #228b22;">maw</span><span style="color: #909183;">)</span>;

        <span style="color: #0000ff;">MyAdd</span><span style="color: #909183;">(</span>111, 333, <span style="color: #a020f0;">delegate</span><span style="color: #709870;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#25105;&#30340;&#32467;&#26524;&#26159; {0}"</span>, <span style="color: #228b22;">sum</span><span style="color: #907373;">)</span>;
        <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;

        <span style="color: #0000ff;">MyAdd</span><span style="color: #909183;">(</span>121, 232, <span style="color: #a020f0;">delegate</span><span style="color: #709870;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#25105;&#19981;&#21578;&#35785;&#20320;&#32467;&#26524;"</span><span style="color: #907373;">)</span>;
        <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyAdd</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">b</span>, <span style="color: #228b22;">MyAddWT</span> <span style="color: #a0522d;">maw</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r</span> = a + b;
        <span style="color: #0000ff;">maw</span><span style="color: #909183;">(</span><span style="color: #228b22;">r</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> r;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ba3802" class="outline-3">
<h3 id="org3ba3802"><span class="section-number-3">12.4.</span> 表达式语法</h3>
<div class="outline-text-3" id="text-12-4">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#22768;&#26126;</span>
<span style="color: #a020f0;">delegate</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">MyAddWT</span><span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">delegate</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">MyAddWT</span><span style="color: #707183;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">sum</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">delegate</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">MyAddWT</span><span style="color: #707183;">(</span><span style="color: #228b22;">double</span> <span style="color: #a0522d;">sum</span><span style="color: #707183;">)</span>;

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">MyAddWT maw1 = new MyAddWT(MyAddShixian);</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">MyAddWT maw2 = MyAddShixian;</span>

        <span style="color: #228b22;">MyAddWT</span> <span style="color: #a0522d;">maw3</span> = <span style="color: #a020f0;">delegate</span><span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #909183;">)</span>
            <span style="color: #909183;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"aaa"</span><span style="color: #709870;">)</span>;
            <span style="color: #909183;">}</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#23454;&#20363;&#21270;</span>
        <span style="color: #228b22;">MyAddWT</span> <span style="color: #a0522d;">maw4</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">sum</span><span style="color: #909183;">)</span> =&gt;
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"aaa"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>;

        <span style="color: #228b22;">MyAddWT</span> <span style="color: #a0522d;">maw5</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">sum</span><span style="color: #909183;">)</span> =&gt;
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"aaa"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>;

        <span style="color: #228b22;">MyAddWT</span> <span style="color: #a0522d;">maw6</span> = sum =&gt;
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"aaa"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>;

        <span style="color: #228b22;">MyAddWT</span> <span style="color: #a0522d;">maw7</span> = sum =&gt; Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"aaa"</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">3. &#20351;&#29992;</span>
        <span style="color: #0000ff;">MyAdd</span><span style="color: #909183;">(</span>111, 222, <span style="color: #228b22;">maw7</span><span style="color: #909183;">)</span>;
        <span style="color: #0000ff;">MyAdd</span><span style="color: #909183;">(</span>222, 333, s =&gt; Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"result: {s}"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyAdd</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">b</span>, <span style="color: #228b22;">MyAddWT</span> <span style="color: #a0522d;">maw</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r</span> = a + b;
        <span style="color: #0000ff;">maw</span><span style="color: #909183;">(</span><span style="color: #228b22;">r</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> r;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga61407f" class="outline-3">
<h3 id="orga61407f"><span class="section-number-3">12.5.</span> 内建的委托类型 Action/Func</h3>
<div class="outline-text-3" id="text-12-5">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">MyAdd2(222, 333, (a, b, r) =&gt; Console.WriteLine($"{a} &#21152;&#19978; {b} &#31561;&#20110; {r}"));</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">MyAdd2(222, 333, (a, b, r) =&gt; Console.WriteLine($"{a} add {b} equals {r}"));</span>
        <span style="color: #0000ff;">MyAdd2</span><span style="color: #909183;">(</span>222, 333, <span style="color: #709870;">(</span><span style="color: #228b22;">a</span>, <span style="color: #228b22;">b</span>, <span style="color: #228b22;">r</span>, <span style="color: #228b22;">s1</span>, <span style="color: #228b22;">s2</span><span style="color: #709870;">)</span> =&gt; Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{a} {s1} {b} {s2} {r}"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyAdd1</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">b</span>, <span style="color: #228b22;">Action</span> <span style="color: #a0522d;">act</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r</span> = a + b;
        <span style="color: #0000ff;">act</span><span style="color: #909183;">()</span>;
        <span style="color: #a020f0;">return</span> r;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyAdd2</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">b</span>, <span style="color: #228b22;">Action</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">int</span>, <span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">act</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r</span> = a + b;
        <span style="color: #0000ff;">act</span><span style="color: #909183;">(</span><span style="color: #228b22;">a</span>, <span style="color: #228b22;">b</span>, <span style="color: #228b22;">r</span>, <span style="color: #8b2252;">"jiashang"</span>, <span style="color: #8b2252;">"dengyu"</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> r;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9960498" class="outline-3">
<h3 id="org9960498"><span class="section-number-3">12.6.</span> 多播委托</h3>
<div class="outline-text-3" id="text-12-6">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">MyWT</span> <span style="color: #a0522d;">a</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyWT</span><span style="color: #909183;">(</span><span style="color: #228b22;">MyAdd</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">MyWT</span> <span style="color: #a0522d;">b</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyWT</span><span style="color: #909183;">(</span><span style="color: #228b22;">MyMul</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">MyWT</span> <span style="color: #a0522d;">c</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyWT</span><span style="color: #909183;">(</span><span style="color: #228b22;">MyFuza</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">MyWT</span> <span style="color: #a0522d;">d</span> = a + b + c + a + a + a + a;
        <span style="color: #228b22;">MyWT</span> <span style="color: #a0522d;">e</span> = d + b;
        e += a;
        e -= a;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #0000ff;">e</span><span style="color: #709870;">(</span>4, 5<span style="color: #709870;">)</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">var d = a + b + c;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">Console.WriteLine(d(4,5));</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">Console.WriteLine((a + b + c)(4, 5));</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyAdd</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">b</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r</span> = a + b;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"Add: {0}"</span>, <span style="color: #228b22;">r</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> r;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyMul</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">b</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r</span> = a * b;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"Mul: {0}"</span>, <span style="color: #228b22;">r</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> r;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">MyFuza</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">a</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">b</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">int</span><span style="color: #909183;">)(</span>a * a + Math.<span style="color: #0000ff;">Pow</span><span style="color: #709870;">(</span><span style="color: #228b22;">b</span>, 4<span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"Fuza: {0}"</span>, <span style="color: #228b22;">r</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> r;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org352852b" class="outline-3">
<h3 id="org352852b"><span class="section-number-3">12.7.</span> [练习] 如何简化图片绘制的代码</h3>
<div class="outline-text-3" id="text-12-7">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>

    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">DrawHello</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">Bitmap</span> <span style="color: #a0522d;">image</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Bitmap</span><span style="color: #909183;">(</span>256, 256<span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">using</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Graphics</span> <span style="color: #a0522d;">g</span> = Graphics.<span style="color: #0000ff;">FromImage</span><span style="color: #709870;">(</span><span style="color: #228b22;">image</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            g.<span style="color: #0000ff;">DrawString</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"Hello"</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Font</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"Monospace"</span>, 26<span style="color: #907373;">)</span>, Brushes.<span style="color: #228b22;">DarkGreen</span>, 10, 10<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        image.<span style="color: #0000ff;">Save</span><span style="color: #909183;">(</span>@<span style="color: #8b2252;">"e:\hello.jpg"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">DrawWorld</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">Bitmap</span> <span style="color: #a0522d;">image</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Bitmap</span><span style="color: #909183;">(</span>256, 256<span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">using</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Graphics</span> <span style="color: #a0522d;">g</span> = Graphics.<span style="color: #0000ff;">FromImage</span><span style="color: #709870;">(</span><span style="color: #228b22;">image</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            g.<span style="color: #0000ff;">FillRectangle</span><span style="color: #709870;">(</span>Brushes.<span style="color: #228b22;">Yellow</span>, 0, 0, 20, 20<span style="color: #709870;">)</span>;
            g.<span style="color: #0000ff;">DrawString</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"World"</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Font</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"Monospace"</span>, 26<span style="color: #907373;">)</span>, Brushes.<span style="color: #228b22;">DarkOrange</span>, 10, 10<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        image.<span style="color: #0000ff;">Save</span><span style="color: #909183;">(</span>@<span style="color: #8b2252;">"e:\hello.jpg"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
示例:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #0000ff;">WithGraphics</span><span style="color: #909183;">(</span>@<span style="color: #8b2252;">"e:\hello333.jpg"</span>, g =&gt;
        <span style="color: #709870;">{</span>
            g.<span style="color: #0000ff;">DrawString</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"wqwww"</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Font</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"Aria"</span>, 46<span style="color: #6276ba;">)</span>, Brushes.<span style="color: #228b22;">Aqua</span>, 0, 300<span style="color: #907373;">)</span>;
            g.<span style="color: #0000ff;">DrawString</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"Hello"</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Font</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"Monospace"</span>, 26<span style="color: #6276ba;">)</span>, Brushes.<span style="color: #228b22;">DarkGreen</span>, 10, 10<span style="color: #907373;">)</span>;
        <span style="color: #709870;">}</span>, 500, 500<span style="color: #909183;">)</span>;

        <span style="color: #0000ff;">WithGraphics</span><span style="color: #909183;">(</span>@<span style="color: #8b2252;">"e:\hello4444.jpg"</span>, pen =&gt;
        <span style="color: #709870;">{</span>
            pen.<span style="color: #0000ff;">FillRectangle</span><span style="color: #907373;">(</span>Brushes.<span style="color: #228b22;">Yellow</span>, 0, 0, 20, 20<span style="color: #907373;">)</span>;
            pen.<span style="color: #0000ff;">DrawString</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"World"</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Font</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"Monospace"</span>, 26<span style="color: #6276ba;">)</span>, Brushes.<span style="color: #228b22;">DarkOrange</span>, 10, 10<span style="color: #907373;">)</span>;
        <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">WithGraphics</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">file</span>, <span style="color: #228b22;">Action</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Graphics</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">act</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">width</span> = 256, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">height</span> = 256<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #709870;">(</span><span style="color: #228b22;">file</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#24050;&#32463;&#23384;&#22312;...."</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>width &lt;= 0 || height &lt;= 0<span style="color: #909183;">)</span>
            <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Exception</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#23610;&#23544;&#19981;&#33021;&#20026;&#36127;"</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">Bitmap image2 = new Bitmap(file);</span>
        <span style="color: #228b22;">Bitmap</span> <span style="color: #a0522d;">image</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Bitmap</span><span style="color: #909183;">(</span><span style="color: #228b22;">width</span>, <span style="color: #228b22;">height</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">using</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Graphics</span> <span style="color: #a0522d;">g</span> = Graphics.<span style="color: #0000ff;">FromImage</span><span style="color: #709870;">(</span><span style="color: #228b22;">image</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #0000ff;">act</span><span style="color: #709870;">(</span><span style="color: #228b22;">g</span><span style="color: #709870;">)</span>;
            g.<span style="color: #0000ff;">DrawString</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"161"</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Font</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#24494;&#36719;&#38597;&#40657;"</span>, 24<span style="color: #907373;">)</span>, Brushes.<span style="color: #228b22;">Red</span>, width - 50, height - 30<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        image.<span style="color: #0000ff;">Save</span><span style="color: #909183;">(</span><span style="color: #228b22;">file</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga83e7b7" class="outline-3">
<h3 id="orga83e7b7"><span class="section-number-3">12.8.</span> [练习] 如何简化输出程序执行时间的逻辑</h3>
<div class="outline-text-3" id="text-12-8">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #0000ff;">WithElapsedTime</span><span style="color: #909183;">(</span><span style="color: #709870;">()</span> =&gt;
        <span style="color: #709870;">{</span>
            <span style="color: #0000ff;">WithGraphics</span><span style="color: #907373;">(</span>@<span style="color: #8b2252;">"e:\hello333.jpg"</span>, g =&gt;
            <span style="color: #6276ba;">{</span>
                g.<span style="color: #0000ff;">DrawString</span><span style="color: #858580;">(</span><span style="color: #8b2252;">"wqwww"</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Font</span><span style="color: #80a880;">(</span><span style="color: #8b2252;">"Aria"</span>, 46<span style="color: #80a880;">)</span>, Brushes.<span style="color: #228b22;">Aqua</span>, 0, 300<span style="color: #858580;">)</span>;
                g.<span style="color: #0000ff;">DrawString</span><span style="color: #858580;">(</span><span style="color: #8b2252;">"Hello"</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Font</span><span style="color: #80a880;">(</span><span style="color: #8b2252;">"Monospace"</span>, 26<span style="color: #80a880;">)</span>, Brushes.<span style="color: #228b22;">DarkGreen</span>, 10, 10<span style="color: #858580;">)</span>;
            <span style="color: #6276ba;">}</span>, 500, 500<span style="color: #907373;">)</span>;
        <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;


        <span style="color: #0000ff;">WithElapsedTime</span><span style="color: #909183;">(</span><span style="color: #709870;">()</span> =&gt;
            <span style="color: #0000ff;">WithGraphics</span><span style="color: #709870;">(</span>@<span style="color: #8b2252;">"e:\hello4444.jpg"</span>, pen =&gt;
            <span style="color: #907373;">{</span>
                pen.<span style="color: #0000ff;">FillRectangle</span><span style="color: #6276ba;">(</span>Brushes.<span style="color: #228b22;">Yellow</span>, 0, 0, 20, 20<span style="color: #6276ba;">)</span>;
                pen.<span style="color: #0000ff;">DrawString</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"World"</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Font</span><span style="color: #858580;">(</span><span style="color: #8b2252;">"Monospace"</span>, 26<span style="color: #858580;">)</span>, Brushes.<span style="color: #228b22;">DarkOrange</span>, 10, 10<span style="color: #6276ba;">)</span>;
            <span style="color: #907373;">}</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">WithElapsedTime</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Action</span> <span style="color: #a0522d;">code</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">sw</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Stopwatch</span><span style="color: #909183;">()</span>;
        sw.<span style="color: #0000ff;">Start</span><span style="color: #909183;">()</span>;
        <span style="color: #0000ff;">code</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#31243;&#24207;&#25191;&#34892;&#28040;&#32791;&#30340;&#26102;&#38388;&#20026;: {0}"</span>, sw.<span style="color: #228b22;">ElapsedMilliseconds</span><span style="color: #909183;">)</span>;
        sw.<span style="color: #0000ff;">Stop</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">WithGraphics</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">file</span>, <span style="color: #228b22;">Action</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Graphics</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">act</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">width</span> = 256, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">height</span> = 256<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #709870;">(</span><span style="color: #228b22;">file</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25991;&#20214;&#24050;&#32463;&#23384;&#22312;...."</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>width &lt;= 0 || height &lt;= 0<span style="color: #909183;">)</span>
            <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Exception</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#23610;&#23544;&#19981;&#33021;&#20026;&#36127;"</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">Bitmap image2 = new Bitmap(file);</span>
        <span style="color: #228b22;">Bitmap</span> <span style="color: #a0522d;">image</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Bitmap</span><span style="color: #909183;">(</span><span style="color: #228b22;">width</span>, <span style="color: #228b22;">height</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">using</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Graphics</span> <span style="color: #a0522d;">g</span> = Graphics.<span style="color: #0000ff;">FromImage</span><span style="color: #709870;">(</span><span style="color: #228b22;">image</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #0000ff;">act</span><span style="color: #709870;">(</span><span style="color: #228b22;">g</span><span style="color: #709870;">)</span>;
            g.<span style="color: #0000ff;">DrawString</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"161"</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Font</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#24494;&#36719;&#38597;&#40657;"</span>, 24<span style="color: #907373;">)</span>, Brushes.<span style="color: #228b22;">Red</span>, width - 50, height - 30<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        image.<span style="color: #0000ff;">Save</span><span style="color: #909183;">(</span><span style="color: #228b22;">file</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org83674a3" class="outline-2">
<h2 id="org83674a3"><span class="section-number-2">13.</span> 数组 (Array)</h2>
<div class="outline-text-2" id="text-13">
</div>
<div id="outline-container-org6ff1fe0" class="outline-3">
<h3 id="org6ff1fe0"><span class="section-number-3">13.1.</span> 一维数组</h3>
<div class="outline-text-3" id="text-13-1">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#22768;&#26126;</span>
<span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">arr1</span>;
<span style="color: #228b22;">string</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">arr2</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#23454;&#20363;&#21270;</span>
arr1 = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #707183;">[</span>4<span style="color: #707183;">]</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">3. &#21021;&#22987;&#20540;</span>
arr1<span style="color: #707183;">[</span>0<span style="color: #707183;">]</span> = 22;
arr1<span style="color: #707183;">[</span>1<span style="color: #707183;">]</span> = 5;
arr1<span style="color: #707183;">[</span>2<span style="color: #707183;">]</span> = 45;
arr1<span style="color: #707183;">[</span>3<span style="color: #707183;">]</span> = 555;
<span style="color: #b22222;">// </span><span style="color: #b22222;">arr1[4] = 777; // System.IndexOutOfRangeException</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">4. &#22522;&#26412;&#35775;&#38382;</span>
<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">i</span> = 0; i &lt; arr1.Length; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>arr1<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">string</span>
<span style="color: #228b22;">string</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">arr2</span>;
arr2 = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">string</span><span style="color: #707183;">[</span>5<span style="color: #707183;">]</span>;
arr2<span style="color: #707183;">[</span>3<span style="color: #707183;">]</span> = <span style="color: #8b2252;">"hello"</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>arr2<span style="color: #7388d6;">[</span>0<span style="color: #7388d6;">]</span> == <span style="color: #008b8b;">null</span><span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">true</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">Student</span>
<span style="color: #228b22;">Student</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">arr3</span>;
arr3 = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #707183;">[</span>8<span style="color: #707183;">]</span>;
arr3<span style="color: #707183;">[</span>3<span style="color: #707183;">]</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #707183;">()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>arr3<span style="color: #7388d6;">[</span>0<span style="color: #7388d6;">]</span> == <span style="color: #008b8b;">null</span><span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">true</span>
</pre>
</div>


<p>
数组表示法:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">arr0</span>;
arr0 = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #707183;">[</span>4<span style="color: #707183;">]</span>;
arr0<span style="color: #707183;">[</span>0<span style="color: #707183;">]</span> = 22;
arr0<span style="color: #707183;">[</span>1<span style="color: #707183;">]</span> = 5;
arr0<span style="color: #707183;">[</span>2<span style="color: #707183;">]</span> = 45;
arr0<span style="color: #707183;">[</span>3<span style="color: #707183;">]</span> = 555;

<span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">arr1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #707183;">[</span>4<span style="color: #707183;">]</span>;
arr1<span style="color: #707183;">[</span>0<span style="color: #707183;">]</span> = 22;
arr1<span style="color: #707183;">[</span>1<span style="color: #707183;">]</span> = 5;
arr1<span style="color: #707183;">[</span>2<span style="color: #707183;">]</span> = 45;
arr1<span style="color: #707183;">[</span>3<span style="color: #707183;">]</span> = 555;

<span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">arr2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #707183;">[</span>4<span style="color: #707183;">]</span> <span style="color: #707183;">{</span> 22, 5, 45, 555 <span style="color: #707183;">}</span>;

<span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">arr3</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #707183;">{</span> 22, 5, 45, 555 <span style="color: #707183;">}</span>;

<span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">arr4</span> = <span style="color: #707183;">{</span> 22, 5, 45, 555 <span style="color: #707183;">}</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">arr5</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #707183;">[]{</span> 22, 5, 45, 555 <span style="color: #707183;">}</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">arr6</span> = <span style="color: #a020f0;">new</span> <span style="color: #707183;">[]</span> <span style="color: #707183;">{</span> 22, 5, 45, 555 <span style="color: #707183;">}</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#23567;&#32467;:</span>
<span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">arr</span> = <span style="color: #707183;">{</span> 22, 5, 45, 555 <span style="color: #707183;">}</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">arr</span> = <span style="color: #a020f0;">new</span> <span style="color: #707183;">[]{</span> 22, 5, 45, 555 <span style="color: #707183;">}</span>;
</pre>
</div>

<p>
数组的扩张:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">arr</span> = <span style="color: #707183;">{</span> 22, 5, 45, 555 <span style="color: #707183;">}</span>;
arr<span style="color: #707183;">[</span>4<span style="color: #707183;">]</span> = 666;
arr<span style="color: #707183;">[</span>5<span style="color: #707183;">]</span> = 777;
</pre>
</div>
</div>
</div>

<div id="outline-container-org45c249e" class="outline-3">
<h3 id="org45c249e"><span class="section-number-3">13.2.</span> 多维数组 (Dimensional Array)</h3>
<div class="outline-text-3" id="text-13-2">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">int</span><span style="color: #707183;">[</span>,,<span style="color: #707183;">]</span> arr =
<span style="color: #707183;">{</span>
    <span style="color: #7388d6;">{</span><span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span>, <span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span>, <span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span>,<span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span><span style="color: #7388d6;">}</span>,
    <span style="color: #7388d6;">{</span><span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span>, <span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span>, <span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span>,<span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span><span style="color: #7388d6;">}</span>,
    <span style="color: #7388d6;">{</span><span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span>, <span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span>, <span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span>,<span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span><span style="color: #7388d6;">}</span>,
    <span style="color: #7388d6;">{</span><span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span>, <span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span>, <span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span>,<span style="color: #909183;">{</span>2, 3, 4, 1<span style="color: #909183;">}</span><span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>arr.Rank<span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31209;</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>arr.Length<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>arr.<span style="color: #0000ff;">GetLength</span><span style="color: #7388d6;">(</span>0<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org54c0416" class="outline-3">
<h3 id="org54c0416"><span class="section-number-3">13.3.</span> 交错数组 (Jagged Array)</h3>
<div class="outline-text-3" id="text-13-3">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">int</span><span style="color: #707183;">[][]</span> <span style="color: #a0522d;">arr</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #707183;">[</span>3<span style="color: #707183;">][]</span>;
arr<span style="color: #707183;">[</span>0<span style="color: #707183;">]</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #707183;">{</span>1, 2, 3, 4, 5<span style="color: #707183;">}</span>;
arr<span style="color: #707183;">[</span>1<span style="color: #707183;">]</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #707183;">{</span>3, 4<span style="color: #707183;">}</span>;
arr<span style="color: #707183;">[</span>2<span style="color: #707183;">]</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #707183;">{</span>1<span style="color: #707183;">}</span>;

<span style="color: #228b22;">int</span><span style="color: #707183;">[][</span>,<span style="color: #707183;">]</span> arr2 = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #707183;">[</span>3<span style="color: #707183;">][</span>,<span style="color: #707183;">]</span>;
arr2<span style="color: #707183;">[</span>2<span style="color: #707183;">]</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #707183;">[</span>,<span style="color: #707183;">]</span> <span style="color: #707183;">{</span> <span style="color: #7388d6;">{</span>2<span style="color: #7388d6;">}</span>, <span style="color: #7388d6;">{</span>3<span style="color: #7388d6;">}</span> <span style="color: #707183;">}</span>;
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-orgd1a814f" class="outline-2">
<h2 id="orgd1a814f"><span class="section-number-2">14.</span> 元组 (Tuple/ValueTuple)</h2>
<div class="outline-text-2" id="text-14">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Student</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">Id</span>;
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Name</span>;
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> <span style="color: #a0522d;">Score</span>;
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Tel</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992;&#25968;&#32452;&#30340;&#26041;&#24335;&#65292;&#21487;&#20197;&#23384;&#20648;&#22788;&#29702;&#30456;&#21516;&#31867;&#22411;&#30340;&#25968;&#25454;</span>
        <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">ids</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> 1, 2, 3, 4 <span style="color: #909183;">}</span>;
        <span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">names</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> <span style="color: #8b2252;">"&#23567;&#26126;"</span>, <span style="color: #8b2252;">"&#23567;&#32418;"</span>, <span style="color: #8b2252;">"&#22823;&#40644;"</span>, <span style="color: #8b2252;">"&#24352;&#19977;"</span> <span style="color: #909183;">}</span>;
        <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">scores</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">double</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span> 67.5, 60, 59.9, 90 <span style="color: #909183;">}</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992;&#31867;&#21644;&#23545;&#35937;&#30340;&#26041;&#24335;&#65292;&#21487;&#20197;&#22788;&#29702;&#19981;&#21516;&#25968;&#25454;&#30340;&#23384;&#20648; (&#24378;&#22823;&#65292;&#20294;&#40635;&#28902;)</span>
        <span style="color: #228b22;">Student</span> <span style="color: #a0522d;">s1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #909183;">()</span>;
        s1.Id = 2;
        s1.Name = <span style="color: #8b2252;">"&#23567;&#32418;"</span>;
        s1.Score = 60;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">s3</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span> <span style="color: #909183;">{</span> <span style="color: #a0522d;">Id</span> = 1, <span style="color: #a0522d;">Name</span> = <span style="color: #8b2252;">"&#23567;&#26126;"</span>, <span style="color: #a0522d;">Score</span> = 67.5 <span style="color: #909183;">}</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">s4</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span> <span style="color: #909183;">{</span> <span style="color: #a0522d;">Id</span> = 3, <span style="color: #a0522d;">Name</span> = <span style="color: #8b2252;">"&#22823;&#40644;"</span>, <span style="color: #a0522d;">Score</span> = 59, <span style="color: #a0522d;">Tel</span> = <span style="color: #8b2252;">"+86110"</span> <span style="color: #909183;">}</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21311;&#21517;&#31867;&#22411;&#65292;&#19981;&#38656;&#35201;&#20107;&#20808;&#22768;&#26126;&#19968;&#20010;&#31867;&#65292;&#23601;&#21487;&#20197;&#23454;&#20363;&#21270;&#20986;&#19968;&#20010;&#23545;&#35937;&#26469;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">s5</span> = <span style="color: #a020f0;">new</span> <span style="color: #909183;">{</span> <span style="color: #a0522d;">Xuehao</span> = 3, <span style="color: #a0522d;">Xingming</span> = <span style="color: #8b2252;">"&#22823;&#40644;"</span>, <span style="color: #a0522d;">Fenshu</span> = 59, <span style="color: #a0522d;">Dianhua</span> = <span style="color: #8b2252;">"+86110"</span>, <span style="color: #a0522d;">Dizhi</span> = <span style="color: #8b2252;">"&#22320;&#29699;&#26449;"</span> <span style="color: #909183;">}</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>s5.<span style="color: #228b22;">Fenshu</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>s5.<span style="color: #0000ff;">GetType</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20803;&#32452; (Tuple)</span>
        <span style="color: #228b22;">Tuple</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">int</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">s6</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Tuple</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">int</span><span style="color: #909183;">&gt;(</span>111, 2222<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">Tuple</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span>, <span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">s61</span> = Tuple.<span style="color: #0000ff;">Create</span><span style="color: #909183;">(</span>111, <span style="color: #8b2252;">"&#23567;&#26126;"</span>, 67, <span style="color: #8b2252;">"110"</span><span style="color: #909183;">)</span>;
        <span style="color: #0000ff;">xxx</span><span style="color: #909183;">(</span><span style="color: #228b22;">s61</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>s61.<span style="color: #228b22;">Item1</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992; out &#30340;&#26041;&#24335;&#65292;&#22788;&#29702;&#26041;&#27861;&#30340;&#22810;&#20010;&#36820;&#22238;&#20540;</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>;
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span> = <span style="color: #0000ff;">yyy</span><span style="color: #909183;">(</span><span style="color: #a020f0;">out</span> <span style="color: #228b22;">name</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992; Tuple &#30340;&#26041;&#24335;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r</span> = <span style="color: #0000ff;">zzz</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>r.<span style="color: #228b22;">Item1</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>r.<span style="color: #228b22;">Item2</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">ValueTuple</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">xxx</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Tuple</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span>, <span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">sss</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{sss.Item2} &#30340;&#25104;&#32489;&#20026; {sss.Item3}!"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">yyy</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">out</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        name = <span style="color: #8b2252;">"zhangsan"</span>;
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">age</span> = 16;
        <span style="color: #a020f0;">return</span> age;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">Tuple</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span><span style="color: #7388d6;">&gt;</span> <span style="color: #0000ff;">zzz</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> Tuple.<span style="color: #0000ff;">Create</span><span style="color: #909183;">(</span>16, <span style="color: #8b2252;">"xiaohua"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
ValueTuple:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20803;&#32452; (Tuple&#65292;&#24456;&#19985;&#24456;&#28201;&#26580;)</span>
        <span style="color: #228b22;">Tuple</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">int</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">s6</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Tuple</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">int</span><span style="color: #909183;">&gt;(</span>111, 2222<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">Tuple</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span>, <span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">s61</span> = Tuple.<span style="color: #0000ff;">Create</span><span style="color: #909183;">(</span>111, <span style="color: #8b2252;">"&#23567;&#26126;"</span>, 67, <span style="color: #8b2252;">"110"</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">ValueTuple</span>
        <span style="color: #228b22;">ValueTuple</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">int</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">s7</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ValueTuple</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">int</span><span style="color: #909183;">&gt;(</span>111, 2222<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">ValueTuple</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span>, <span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">s71</span> = ValueTuple.<span style="color: #0000ff;">Create</span><span style="color: #909183;">(</span>111, <span style="color: #8b2252;">"&#23567;&#26126;"</span>, 67, <span style="color: #8b2252;">"110"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">s72</span> = ValueTuple.<span style="color: #0000ff;">Create</span><span style="color: #909183;">(</span>111, <span style="color: #8b2252;">"&#23567;&#26126;"</span>, 67, <span style="color: #8b2252;">"110"</span><span style="color: #909183;">)</span>;
        s72.Item3 = 77;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>s72.<span style="color: #228b22;">Item3</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31616;&#21270;&#65292;&#35821;&#27861;&#31958;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">s73</span> = <span style="color: #909183;">(</span>111, <span style="color: #8b2252;">"&#23567;&#26126;"</span>, 67, <span style="color: #8b2252;">"110"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>s73.<span style="color: #228b22;">Item2</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">s74</span> = <span style="color: #909183;">(</span>111, name: <span style="color: #8b2252;">"&#23567;&#26126;"</span>, 67, <span style="color: #8b2252;">"110"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>s74.<span style="color: #228b22;">name</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">s75</span> = <span style="color: #909183;">(</span>id: 111, name: <span style="color: #8b2252;">"&#23567;&#26126;"</span>, score: 67, tel: <span style="color: #8b2252;">"110"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{s75.name} &#30340;&#20998;&#25968;&#26159; {s75.score}&#65292;&#24555;&#21578;&#35785;ta&#29240;&#29240;&#65292;&#21495;&#30721;&#26159; {s75.tel}"</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">//</span><span style="color: #b22222;">var s76 = (111, "&#23567;&#26126;", 67, "110");</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">var id = s76.Item1;</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">var name = s76.Item2;</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">var score = s76.Item3;</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">var tel = s76.Item4;</span>
        <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span>, <span style="color: #228b22;">double</span> <span style="color: #a0522d;">score</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">tel</span><span style="color: #909183;">)</span> = <span style="color: #909183;">(</span>111, <span style="color: #8b2252;">"&#23567;&#26126;"</span>, 67, <span style="color: #8b2252;">"110"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #909183;">(</span><span style="color: #228b22;">id2</span>, <span style="color: #228b22;">name2</span>, <span style="color: #228b22;">score2</span>, <span style="color: #228b22;">tel2</span><span style="color: #909183;">)</span> = <span style="color: #909183;">(</span>111, <span style="color: #8b2252;">"&#23567;&#26126;"</span>, 67, <span style="color: #8b2252;">"110"</span><span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{name2} &#30340;&#20998;&#25968;&#26159; {score2}&#65292;&#24555;&#21578;&#35785;ta&#29240;&#29240;&#65292;&#21495;&#30721;&#26159; {tel2}"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #909183;">(</span><span style="color: #228b22;">_</span>, <span style="color: #228b22;">_</span>, <span style="color: #228b22;">_</span>, <span style="color: #228b22;">tel3</span><span style="color: #909183;">)</span> = <span style="color: #909183;">(</span>111, <span style="color: #8b2252;">"&#23567;&#26126;"</span>, 67, <span style="color: #8b2252;">"110"</span><span style="color: #909183;">)</span>;


        <span style="color: #b22222;">// </span><span style="color: #b22222;">xxx1 &#30340;&#35843;&#29992;</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">n1</span>;
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">a1</span> = <span style="color: #0000ff;">xxx1</span><span style="color: #909183;">(</span><span style="color: #a020f0;">out</span> <span style="color: #228b22;">n1</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">xxx2 &#30340;&#35843;&#29992;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">t1</span> = <span style="color: #0000ff;">xxx2</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>t1.<span style="color: #228b22;">Item2</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">xxx3 &#30340;&#35843;&#29992;</span>
        <span style="color: #228b22;">var</span> <span style="color: #909183;">(</span><span style="color: #228b22;">age2</span>, <span style="color: #228b22;">name8</span><span style="color: #909183;">)</span> = <span style="color: #0000ff;">xxx3</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">age2</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">xxx4 &#30340;&#35843;&#29992;</span>
        <span style="color: #228b22;">var</span> <span style="color: #909183;">(</span><span style="color: #228b22;">aa4</span>, <span style="color: #228b22;">nn4</span><span style="color: #909183;">)</span> = <span style="color: #0000ff;">xxx3</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#21517;&#23383;&#26159; {nn4}, &#24180;&#40836;&#26159; {aa4}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">xxx1</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">out</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        name = <span style="color: #8b2252;">"xm"</span>;
        <span style="color: #a020f0;">return</span> 16;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">Tuple</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span><span style="color: #7388d6;">&gt;</span> <span style="color: #0000ff;">xxx2</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> Tuple.<span style="color: #0000ff;">Create</span><span style="color: #909183;">(</span>16, <span style="color: #8b2252;">"xm"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">ValueTuple</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span><span style="color: #7388d6;">&gt;</span> <span style="color: #0000ff;">xxx3</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> ValueTuple.<span style="color: #0000ff;">Create</span><span style="color: #909183;">(</span>16, <span style="color: #8b2252;">"xm"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span><span style="color: #7388d6;">)</span> <span style="color: #0000ff;">xxx4</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> <span style="color: #909183;">(</span>16, <span style="color: #8b2252;">"xm"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</section>

<section id="outline-container-org0ddd227" class="outline-2">
<h2 id="org0ddd227"><span class="section-number-2">15.</span> 集合 (Collections)</h2>
<div class="outline-text-2" id="text-15">
</div>
<div id="outline-container-org148b25e" class="outline-3">
<h3 id="org148b25e"><span class="section-number-3">15.1.</span> System.Collections</h3>
<div class="outline-text-3" id="text-15-1">
</div>
<div id="outline-container-org23e8eaf" class="outline-4">
<h4 id="org23e8eaf"><span class="section-number-4">15.1.1.</span> ArrayList</h4>
<div class="outline-text-4" id="text-15-1-1">
<ul class="org-ul">
<li>以数字为下标</li>
<li>有序的，自动编号</li>
<li>集合 (数据容器)</li>
</ul>

<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25968;&#32452;&#65292;&#26412;&#36523;&#38271;&#24230;&#26159;&#19981;&#33021;&#21464;&#21270;&#30340;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22240;&#27492;&#65292;&#35201;&#24448;&#25968;&#32452;&#37324;&#28155;&#21152;&#20803;&#32032;&#65292;&#21482;&#33021;&#21019;&#24314;&#19968;&#20010;&#26356;&#38271;&#30340;&#25968;&#32452;&#21462;&#20195;&#23427;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">a1</span> = <span style="color: #a020f0;">new</span><span style="color: #909183;">[]</span> <span style="color: #909183;">{</span>1, 2, 3<span style="color: #909183;">}</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">a2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #909183;">[</span>a1.Length + 1<span style="color: #909183;">]</span>;
        a2<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span> = a1<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span>;
        a2<span style="color: #909183;">[</span>1<span style="color: #909183;">]</span> = a1<span style="color: #909183;">[</span>1<span style="color: #909183;">]</span>;
        a2<span style="color: #909183;">[</span>2<span style="color: #909183;">]</span> = 4;
        a2<span style="color: #909183;">[</span>3<span style="color: #909183;">]</span> = a1<span style="color: #909183;">[</span>2<span style="color: #909183;">]</span>;
        a1 = a2;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;&#33258;&#23450;&#20041;&#19968;&#20010;&#31867;&#30340;&#26041;&#24335;&#65292;&#23558;&#19978;&#36848;&#30340;&#25805;&#20316;&#23553;&#35013;&#36215;&#26469;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">na1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">NideArray</span><span style="color: #909183;">()</span>;
        na1.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span>1<span style="color: #909183;">)</span>;
        na1.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span>2<span style="color: #909183;">)</span>;
        na1.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">o</span> <span style="color: #a020f0;">in</span> na1.innerArray<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #228b22;">o</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#30452;&#25509;&#20351;&#29992; BCL &#20013;&#30340;&#38598;&#21512;&#31867;&#65292;&#19981;&#38656;&#35201;&#36896;&#36718;&#23376;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">al</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ArrayList</span><span style="color: #909183;">()</span>;
        al.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span>1<span style="color: #909183;">)</span>;
        al.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span>21111<span style="color: #909183;">)</span>;
        al.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>;

        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#38271;&#24230; {0}"</span>, al.<span style="color: #228b22;">Count</span><span style="color: #909183;">)</span>;
        al.<span style="color: #0000ff;">Remove</span><span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>;
        al.<span style="color: #0000ff;">RemoveAt</span><span style="color: #909183;">(</span>0<span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#38271;&#24230; {0}"</span>, al.<span style="color: #228b22;">Count</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">o</span> <span style="color: #a020f0;">in</span> al<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #228b22;">o</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">NideArray</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">object</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">innerArray</span> = <span style="color: #7388d6;">{</span> 1, 2, 3 <span style="color: #7388d6;">}</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Add</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">object</span> <span style="color: #a0522d;">o</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">arr</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">object</span><span style="color: #909183;">[</span>innerArray.Length + 1<span style="color: #909183;">]</span>;
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">i</span> = 0; i &lt; innerArray.Length; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            arr<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span> = innerArray<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>

        arr<span style="color: #909183;">[</span>arr.Length - 1<span style="color: #909183;">]</span> = o;
        innerArray = arr;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Remove</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">object</span> <span style="color: #a0522d;">o</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>

    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org07d682c" class="outline-4">
<h4 id="org07d682c"><span class="section-number-4">15.1.2.</span> Hashtable</h4>
<div class="outline-text-4" id="text-15-1-2">
<ul class="org-ul">
<li>以对象为下标</li>
<li>k-v pair / 键值对</li>
<li>对于 key 最重要的是: 唯一性</li>
</ul>

<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24207;&#21495; vs &#21517;&#23383;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">t1</span> = <span style="color: #909183;">(</span>123, <span style="color: #8b2252;">"&#23567;&#26126;"</span>, 78.5, <span style="color: #8b2252;">"110"</span><span style="color: #909183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">t1.Item1, t1.Item2 ...</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">t2</span> = <span style="color: #909183;">(</span>id: 123, name: <span style="color: #8b2252;">"&#23567;&#26126;"</span>, score: 78.5<span style="color: #909183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">t2.name, t2.score</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24207;&#21495;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">n1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ArrayList</span><span style="color: #909183;">()</span>;
        n1.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#23567;&#26126;"</span><span style="color: #909183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">0</span>
        n1.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#23567;&#32418;"</span><span style="color: #909183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">1</span>
        n1.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#23567;&#34013;"</span><span style="color: #909183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">2</span>

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">s1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ArrayList</span><span style="color: #909183;">()</span>;
        s1.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span>59.5<span style="color: #909183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">0</span>
        s1.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span>97.5<span style="color: #909183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">1</span>
        s1.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span>67.5<span style="color: #909183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">2</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#21462;&#26576;&#20010;&#20540;: {0}"</span>, <span style="color: #228b22;">s1</span><span style="color: #709870;">[</span>0<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 3; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span> = n1<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span>.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span>;
            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">score</span> = <span style="color: #709870;">(</span><span style="color: #228b22;">double</span><span style="color: #709870;">)</span>s1<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span>;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{name} &#30340;&#25104;&#32489;&#20026; {score}"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26174;&#24335;&#25351;&#23450;&#21517;&#23383; (k-v)</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">s2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Hashtable</span><span style="color: #909183;">()</span>;
        s2.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#23567;&#26126;"</span>, 59.5<span style="color: #909183;">)</span>;
        s2.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#23567;&#32418;"</span>, 97.5<span style="color: #909183;">)</span>;
        s2.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#23567;&#34013;"</span>, 67.5<span style="color: #909183;">)</span>;
        s2.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#23567;&#24378;"</span>, 167.5<span style="color: #909183;">)</span>;
        s2.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#23567;&#24369;"</span>, 667.5<span style="color: #909183;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#21462;&#26576;&#20010;&#20540;: {0}"</span>, <span style="color: #228b22;">s2</span><span style="color: #709870;">[</span><span style="color: #8b2252;">"&#23567;&#26126;"</span><span style="color: #709870;">]</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">DictionaryEntry</span> <span style="color: #a0522d;">o</span> <span style="color: #a020f0;">in</span> s2<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"- {o.Key}: {o.Value}"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">k</span> <span style="color: #a020f0;">in</span> s2.Keys<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #228b22;">k</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
可以以自定义对象为下标，但是 <b>需要重写 GetHashCode/Equals 方法</b>:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20197;&#23545;&#35937;&#20026; Key</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">s3</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Hashtable</span><span style="color: #909183;">()</span>;
        s3.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#23567;&#26126;"</span><span style="color: #709870;">)</span>, 59.5<span style="color: #909183;">)</span>;
        s3.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#23567;&#32418;"</span><span style="color: #709870;">)</span>, 97.5<span style="color: #909183;">)</span>;
        s3.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#23567;&#34013;"</span><span style="color: #709870;">)</span>, 67.5<span style="color: #909183;">)</span>;
        s3.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#23567;&#24378;"</span><span style="color: #709870;">)</span>, 167.5<span style="color: #909183;">)</span>;
        s3.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#23567;&#24369;"</span><span style="color: #709870;">)</span>, 667.5<span style="color: #909183;">)</span>;

        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"+ {0}"</span>, <span style="color: #228b22;">s3</span><span style="color: #709870;">[</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#23567;&#24369;"</span><span style="color: #907373;">)</span><span style="color: #709870;">]</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Student</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Name</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Tel</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">Student</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">Student</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span><span style="color: #7388d6;">)</span> =&gt; Name = name;

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">GetHashCode</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> Name.<span style="color: #0000ff;">GetHashCode</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">bool</span> <span style="color: #0000ff;">Equals</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">object</span>? <span style="color: #a0522d;">obj</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">Student</span> <span style="color: #a0522d;">s</span> = obj <span style="color: #a020f0;">as</span> Student;
        <span style="color: #a020f0;">return</span> s != <span style="color: #008b8b;">null</span> &amp;&amp; Name == s.Name;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org71f747c" class="outline-4">
<h4 id="org71f747c"><span class="section-number-4">15.1.3.</span> Queue</h4>
<div class="outline-text-4" id="text-15-1-3">
<p>
FIFO (First In First Out，先进先出):
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">q1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Queue</span><span style="color: #707183;">()</span>;
q1.<span style="color: #0000ff;">Enqueue</span><span style="color: #707183;">(</span>111<span style="color: #707183;">)</span>;
q1.<span style="color: #0000ff;">Enqueue</span><span style="color: #707183;">(</span>222<span style="color: #707183;">)</span>;
q1.<span style="color: #0000ff;">Enqueue</span><span style="color: #707183;">(</span>333<span style="color: #707183;">)</span>;

<span style="color: #228b22;">object</span> <span style="color: #a0522d;">who</span> = q1.<span style="color: #0000ff;">Dequeue</span><span style="color: #707183;">()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>who<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>q1.<span style="color: #0000ff;">Peek</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21482;&#30475;&#19981;&#31227;&#38500;</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>q1.<span style="color: #0000ff;">Dequeue</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>q1.Count<span style="color: #707183;">)</span>;

<span style="color: #228b22;">object</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">arr</span> = q1.<span style="color: #0000ff;">ToArray</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org4da5fc8" class="outline-4">
<h4 id="org4da5fc8"><span class="section-number-4">15.1.4.</span> Stack</h4>
<div class="outline-text-4" id="text-15-1-4">
<p>
LIFO (Last In First Out，后进先出):
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">s1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Stack</span><span style="color: #707183;">()</span>;
s1.<span style="color: #0000ff;">Push</span><span style="color: #707183;">(</span>111<span style="color: #707183;">)</span>;
s1.<span style="color: #0000ff;">Push</span><span style="color: #707183;">(</span>222<span style="color: #707183;">)</span>;
s1.<span style="color: #0000ff;">Push</span><span style="color: #707183;">(</span>333<span style="color: #707183;">)</span>;

<span style="color: #228b22;">object</span> <span style="color: #a0522d;">who</span> = s1.<span style="color: #0000ff;">Pop</span><span style="color: #707183;">()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>who<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s1.<span style="color: #0000ff;">Peek</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s1.<span style="color: #0000ff;">Pop</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s1.Count<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s1.<span style="color: #0000ff;">Peek</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>;

s1.<span style="color: #0000ff;">Clear</span><span style="color: #707183;">()</span>;
</pre>
</div>

<p>
实现自己的栈:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span class="linenr"> 1: </span><span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyStack</span>
<span class="linenr"> 2: </span><span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">stackTop</span> = 0; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26632;&#39030;</span>
<span class="linenr"> 4: </span>    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">object</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">_items</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">object</span><span style="color: #7388d6;">[</span>200<span style="color: #7388d6;">]</span>;
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Push</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">object</span> <span style="color: #a0522d;">w</span><span style="color: #7388d6;">)</span>
<span class="linenr"> 7: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr"> 8: </span>        _items<span style="color: #909183;">[</span>stackTop<span style="color: #909183;">]</span> = w;
<span class="linenr"> 9: </span>        stackTop = stackTop + 1;
<span class="linenr">10: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">11: </span>
<span class="linenr">12: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">object</span> <span style="color: #0000ff;">Pop</span><span style="color: #7388d6;">()</span>
<span class="linenr">13: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">14: </span>        stackTop = stackTop - 1;
<span class="linenr">15: </span>        <span style="color: #a020f0;">return</span> _items<span style="color: #909183;">[</span>stackTop<span style="color: #909183;">]</span>;
<span class="linenr">16: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">17: </span>
<span class="linenr">18: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">object</span> <span style="color: #0000ff;">Peek</span><span style="color: #7388d6;">()</span>
<span class="linenr">19: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">20: </span>        <span style="color: #a020f0;">return</span> _items<span style="color: #909183;">[</span>stackTop - 1<span style="color: #909183;">]</span>;
<span class="linenr">21: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">22: </span>
<span class="linenr">23: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">Count</span>
<span class="linenr">24: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">25: </span>        <span style="color: #a020f0;">get</span> =&gt; stackTop;
<span class="linenr">26: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">27: </span>
<span class="linenr">28: </span>    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Clear</span><span style="color: #7388d6;">()</span>
<span class="linenr">29: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">30: </span>        stackTop = 0;
<span class="linenr">31: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">32: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb6581b8" class="outline-4">
<h4 id="orgb6581b8"><span class="section-number-4">15.1.5.</span> SortedList/BitArray</h4>
</div>
</div>


<div id="outline-container-orgfd4e718" class="outline-3">
<h3 id="orgfd4e718"><span class="section-number-3">15.2.</span> System.Collections.Generic</h3>
<div class="outline-text-3" id="text-15-2">
</div>
<div id="outline-container-org6e02371" class="outline-4">
<h4 id="org6e02371"><span class="section-number-4">15.2.1.</span> List&lt;T&gt;</h4>
<div class="outline-text-4" id="text-15-2-1">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">List</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;</span> <span style="color: #a0522d;">l1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;()</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">l2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;()</span>;
l2.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"aaaa"</span><span style="color: #707183;">)</span>;
l2.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"bbbb"</span><span style="color: #707183;">)</span>;
l2.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"1"</span><span style="color: #707183;">)</span>;
l2.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"2"</span><span style="color: #707183;">)</span>;
l2.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"3"</span><span style="color: #707183;">)</span>;
l2.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"4"</span><span style="color: #707183;">)</span>;
l2.<span style="color: #0000ff;">Insert</span><span style="color: #707183;">(</span>1, <span style="color: #8b2252;">"ccc"</span><span style="color: #707183;">)</span>;
l2.<span style="color: #0000ff;">RemoveAll</span><span style="color: #707183;">(</span>s =&gt; s.Length &lt; 4<span style="color: #707183;">)</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">l3</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;</span> <span style="color: #707183;">{</span><span style="color: #8b2252;">"aaaa"</span>, <span style="color: #8b2252;">"bbbb"</span>, <span style="color: #8b2252;">"1"</span>, <span style="color: #8b2252;">"2"</span>, <span style="color: #8b2252;">"3"</span>, <span style="color: #8b2252;">"4"</span><span style="color: #707183;">}</span>;
l3.<span style="color: #0000ff;">Insert</span><span style="color: #707183;">(</span>1, <span style="color: #8b2252;">"ccc"</span><span style="color: #707183;">)</span>;
l3.<span style="color: #0000ff;">RemoveAll</span><span style="color: #707183;">(</span>s =&gt; s.Length &lt; 4<span style="color: #707183;">)</span>;

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s1</span> = l2<span style="color: #707183;">[</span>0<span style="color: #707183;">]</span>;
<span style="color: #a020f0;">foreach</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">e</span> <span style="color: #a020f0;">in</span> l2<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>e<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaac5501" class="outline-4">
<h4 id="orgaac5501"><span class="section-number-4">15.2.2.</span> Dictionary&lt;TKey, TValue&gt;</h4>
<div class="outline-text-4" id="text-15-2-2">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">d1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Dictionary</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span>, <span style="color: #228b22;">double</span><span style="color: #707183;">&gt;()</span>;
d1.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"xm"</span>, 67.5<span style="color: #707183;">)</span>;
d1.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"xh"</span>, 97.5<span style="color: #707183;">)</span>;
d1.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"xl"</span>, 75<span style="color: #707183;">)</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">d2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Dictionary</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span>, <span style="color: #228b22;">double</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">{</span>
    <span style="color: #7388d6;">{</span><span style="color: #8b2252;">"xm"</span>, 67.5<span style="color: #7388d6;">}</span>,
    <span style="color: #7388d6;">{</span><span style="color: #8b2252;">"xh"</span>, 97.5<span style="color: #7388d6;">}</span>,
    <span style="color: #7388d6;">{</span><span style="color: #8b2252;">"xl"</span>, 75<span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>;
<span style="color: #228b22;">double</span> <span style="color: #a0522d;">s1</span> = d2<span style="color: #707183;">[</span><span style="color: #8b2252;">"xh"</span><span style="color: #707183;">]</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s1<span style="color: #707183;">)</span>;

<span style="color: #228b22;">bool</span> <span style="color: #a0522d;">isSuccess</span> = d2.<span style="color: #0000ff;">TryAdd</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"xm"</span>, 100<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>isSuccess<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">foreach</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #008b8b;">value</span> <span style="color: #a020f0;">in</span> d2.Values<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #008b8b;">value</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5ae3ed1" class="outline-4">
<h4 id="org5ae3ed1"><span class="section-number-4">15.2.3.</span> Queue&lt;T&gt;</h4>
<div class="outline-text-4" id="text-15-2-3">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">q1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Queue</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;()</span>;
q1.<span style="color: #0000ff;">Enqueue</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#23567;&#26126;"</span><span style="color: #707183;">)</span>;
q1.<span style="color: #0000ff;">Enqueue</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#23567;&#20848;"</span><span style="color: #707183;">)</span>;
q1.<span style="color: #0000ff;">Enqueue</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#23567;&#26417;"</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">n1</span> = q1.<span style="color: #0000ff;">Dequeue</span><span style="color: #707183;">()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>n1<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org71a1d2e" class="outline-4">
<h4 id="org71a1d2e"><span class="section-number-4">15.2.4.</span> Stack&lt;T&gt;</h4>
<div class="outline-text-4" id="text-15-2-4">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">s1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Stack</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;()</span>;
s1.<span style="color: #0000ff;">Push</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#23567;&#26126;"</span><span style="color: #707183;">)</span>;
s1.<span style="color: #0000ff;">Push</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#23567;&#20848;"</span><span style="color: #707183;">)</span>;
s1.<span style="color: #0000ff;">Push</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#23567;&#26417;"</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">n1</span> = s1.<span style="color: #0000ff;">Pop</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">n2</span> = s1.<span style="color: #0000ff;">Peek</span><span style="color: #707183;">()</span>;

<span style="color: #228b22;">bool</span> <span style="color: #a0522d;">shibushichenggongle</span> = s1.<span style="color: #0000ff;">TryPop</span><span style="color: #707183;">(</span><span style="color: #a020f0;">out</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">n3</span><span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>shibushichenggongle<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org85be6fd" class="outline-4">
<h4 id="org85be6fd"><span class="section-number-4">15.2.5.</span> LinkedList&lt;T&gt;</h4>
<div class="outline-text-4" id="text-15-2-5">
<p>
<a href="https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.generic.linkedlist-1?view=net-5.0">https://docs.microsoft.com/zh-cn/dotnet/api/system.collections.generic.linkedlist-1?view=net-5.0</a>
</p>
</div>
</div>

<div id="outline-container-org4f819f4" class="outline-4">
<h4 id="org4f819f4"><span class="section-number-4">15.2.6.</span> HashSet&lt;T&gt;</h4>
<div class="outline-text-4" id="text-15-2-6">
<ul class="org-ul">
<li>无序</li>
<li>唯一</li>
</ul>

<div class="org-src-container">
<pre class="src src-cs"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">hs1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HashSet</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;()</span>;
hs1.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #707183;">)</span>;
hs1.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"world"</span><span style="color: #707183;">)</span>;
hs1.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"!"</span><span style="color: #707183;">)</span>;
hs1.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"!"</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">hs2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HashSet</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;()</span>;
hs2.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"aaa"</span><span style="color: #707183;">)</span>;
hs2.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"world"</span><span style="color: #707183;">)</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>hs1.Count<span style="color: #707183;">)</span>;
hs1.<span style="color: #0000ff;">IntersectWith</span><span style="color: #707183;">(</span>hs2<span style="color: #707183;">)</span>;
hs1.<span style="color: #0000ff;">UnionWith</span><span style="color: #707183;">(</span>hs2<span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#21435;&#37325;&#30340;&#19968;&#31181;&#26041;&#27861;</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">list1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">int</span><span style="color: #707183;">&gt;</span> <span style="color: #707183;">{</span> 1, 2, 11, 22, 2, 3, 1, 2, 33, 44, 22 <span style="color: #707183;">}</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">hs3</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HashSet</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">int</span><span style="color: #707183;">&gt;(</span>list1<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">foreach</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #0000ff;">o</span> <span style="color: #a020f0;">in</span> hs3.<span style="color: #0000ff;">ToList</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>o<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfde6f3a" class="outline-4">
<h4 id="orgfde6f3a"><span class="section-number-4">15.2.7.</span> SortedList/Set/Dictionary&lt;&gt;</h4>
</div>
</div>

<div id="outline-container-org5849224" class="outline-3">
<h3 id="org5849224"><span class="section-number-3">15.3.</span> System.Collections.Immutable</h3>
<div class="outline-text-3" id="text-15-3">
<p>
ImmutableList:
</p>
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">list1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">&gt;</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #8b2252;">"hello"</span>, <span style="color: #8b2252;">"world"</span>, <span style="color: #8b2252;">"!"</span>
    <span style="color: #7388d6;">}</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>list1.Count<span style="color: #7388d6;">)</span>;
    <span style="color: #0000ff;">Xxx</span><span style="color: #7388d6;">(</span>list1.<span style="color: #0000ff;">ToImmutableList</span><span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>list1.Count<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Xxx</span><span style="color: #707183;">(</span><span style="color: #228b22;">ImmutableList</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">l</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    l.<span style="color: #0000ff;">Add</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"kkkkkkk"</span><span style="color: #7388d6;">)</span>;
    l.<span style="color: #0000ff;">Add</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"kkkkkk2"</span><span style="color: #7388d6;">)</span>;
    l = l.<span style="color: #0000ff;">Add</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"kkkk"</span><span style="color: #7388d6;">)</span>.<span style="color: #0000ff;">Add</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"1"</span><span style="color: #7388d6;">)</span>.<span style="color: #0000ff;">Add</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"33"</span><span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">foreach</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">s</span> <span style="color: #a020f0;">in</span> l<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>s<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>



<section id="outline-container-org6d182ea" class="outline-2">
<h2 id="org6d182ea"><span class="section-number-2">16.</span> IEnumerable/Linq</h2>
<div class="outline-text-2" id="text-16">
<ol class="org-ol">
<li>string/array/List/Dict 虽然不是同一种类型，但是很像，有没有内在相似的逻辑? [思考]</li>
<li>a) 容器 b) 遍历</li>
<li>将上述两点逻辑，抽象为接口 IEnumerable/IEnumerator(MoveNext,Current)</li>
<li>为了便于使用这个接口，出现 foreach 语法</li>
<li>通过插件的形式，推出了 Linq 的机制 (Where/Select/OrderBy/Avg/Sum)
<ul class="org-ul">
<li>Method 语法</li>
<li>Query 表达式语法 (Linq to Object)</li>
</ul></li>
<li>Linq Provider (Linq 供应商/提供者):
<ul class="org-ul">
<li>Linq to XML</li>
<li>Linq to SQL</li>
<li>Linq to Entity</li>
</ul></li>
</ol>
</div>

<div id="outline-container-orge14a4af" class="outline-3">
<h3 id="orge14a4af"><span class="section-number-3">16.1.</span> IEnumerable/IEnumerator/foreach</h3>
<div class="outline-text-3" id="text-16-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s1</span> = <span style="color: #8b2252;">"hello world"</span>;
        <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">a1</span> = <span style="color: #909183;">{</span>1, 2, 3, 4<span style="color: #909183;">}</span>;
        <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">double</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">l1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">double</span><span style="color: #909183;">&gt;</span> <span style="color: #909183;">{</span>1.2, 2.3, 4.6<span style="color: #909183;">}</span>;

        <span style="color: #228b22;">Rainbow</span> <span style="color: #a0522d;">rb</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Rainbow</span><span style="color: #909183;">()</span>;

        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">e</span> <span style="color: #a020f0;">in</span> rb<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #228b22;">e</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Rainbow</span> : <span style="color: #228b22;">IEnumerable</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">colors</span> = <span style="color: #7388d6;">{</span><span style="color: #8b2252;">"Red"</span>, <span style="color: #8b2252;">"Orange"</span>, <span style="color: #8b2252;">"Yellow"</span>, <span style="color: #8b2252;">"Green"</span>, <span style="color: #8b2252;">"Blue"</span>, <span style="color: #8b2252;">"Dian"</span>, <span style="color: #8b2252;">"Purple"</span><span style="color: #7388d6;">}</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Show</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#25105;&#26377; {colors.Length} &#31181;&#39068;&#33394;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IEnumerator</span> <span style="color: #0000ff;">GetEnumerator</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyEnumerator</span><span style="color: #909183;">(</span>colors<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyEnumerator</span> : <span style="color: #228b22;">IEnumerator</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">private</span> <span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">colors</span>;
        <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">index</span> = 0;

        <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">MyEnumerator</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">cs</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            colors = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">string</span><span style="color: #709870;">[</span>cs.Length<span style="color: #709870;">]</span>;
            <span style="color: #a020f0;">for</span> <span style="color: #709870;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; cs.Length; i++<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                colors<span style="color: #907373;">[</span>i<span style="color: #907373;">]</span> = cs<span style="color: #907373;">[</span>i<span style="color: #907373;">]</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">bool</span> <span style="color: #0000ff;">MoveNext</span><span style="color: #909183;">()</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>index &gt; colors.Length - 1 || index &lt; 0<span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">false</span>;
            <span style="color: #709870;">}</span>

            index++;
            <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">true</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">object</span> <span style="color: #a0522d;">Current</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">get</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">return</span> colors<span style="color: #907373;">[</span>index - 1<span style="color: #907373;">]</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Reset</span><span style="color: #909183;">()</span>
        <span style="color: #909183;">{</span>
            index = 0;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
泛型版本:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Rainbow</span> : <span style="color: #228b22;">IEnumerable</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">colors</span> = <span style="color: #7388d6;">{</span><span style="color: #8b2252;">"Red"</span>, <span style="color: #8b2252;">"Orange"</span>, <span style="color: #8b2252;">"Yellow"</span>, <span style="color: #8b2252;">"Green"</span>, <span style="color: #8b2252;">"Blue"</span>, <span style="color: #8b2252;">"Dian"</span>, <span style="color: #8b2252;">"Purple"</span><span style="color: #7388d6;">}</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Show</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#25105;&#26377; {colors.Length} &#31181;&#39068;&#33394;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IEnumerator</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">&gt;</span> <span style="color: #0000ff;">GetEnumerator</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"222"</span>;
        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"333"</span>;
        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"444"</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">IEnumerator</span> IEnumerable.<span style="color: #0000ff;">GetEnumerator</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> <span style="color: #0000ff;">GetEnumerator</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgecb87b8" class="outline-3">
<h3 id="orgecb87b8"><span class="section-number-3">16.2.</span> Iterator</h3>
<div class="outline-text-3" id="text-16-2">
<p>
语法糖。
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">public</span> <span style="color: #228b22;">IEnumerator</span> <span style="color: #0000ff;">GetEnumerator</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; colors.Length; i++<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">return</span> colors<span style="color: #909183;">[</span>i<span style="color: #909183;">]</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
灵活的遍历逻辑:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s1</span> = <span style="color: #8b2252;">"hello world"</span>;
        <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">a1</span> = <span style="color: #909183;">{</span>1, 2, 3, 4<span style="color: #909183;">}</span>;
        <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">double</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">l1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">double</span><span style="color: #909183;">&gt;</span> <span style="color: #909183;">{</span>1.2, 2.3, 4.6<span style="color: #909183;">}</span>;
        <span style="color: #228b22;">Dictionary</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">d</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Dictionary</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">&gt;()</span>;

        <span style="color: #228b22;">Rainbow</span> <span style="color: #a0522d;">rb</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Rainbow</span><span style="color: #909183;">()</span>;

        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">e</span> <span style="color: #a020f0;">in</span> rb.GetMyEnumerator4<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #228b22;">e</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Rainbow</span> : <span style="color: #228b22;">IEnumerable</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">colors</span> = <span style="color: #7388d6;">{</span><span style="color: #8b2252;">"Red"</span>, <span style="color: #8b2252;">"Orange"</span>, <span style="color: #8b2252;">"Yellow"</span>, <span style="color: #8b2252;">"Green"</span>, <span style="color: #8b2252;">"Blue"</span>, <span style="color: #8b2252;">"Dian"</span>, <span style="color: #8b2252;">"Purple"</span><span style="color: #7388d6;">}</span>;

    <span style="color: #a020f0;">public</span>  <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Show</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"&#25105;&#26377; {colors.Length} &#31181;&#39068;&#33394;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IEnumerator</span> <span style="color: #0000ff;">GetEnumerator</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> <span style="color: #0000ff;">GetMyEnumerator1</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">IEnumerator</span> <span style="color: #0000ff;">GetMyEnumerator1</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; colors.Length; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">return</span> colors<span style="color: #709870;">[</span>i<span style="color: #709870;">]</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">IEnumerator</span> <span style="color: #a0522d;">GetMyEnumerator2</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">get</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&#36196;"</span>;
            <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&#27225;"</span>;
            <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&#40644;"</span>;
            <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">return</span> <span style="color: #8b2252;">"&#32511;"</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IEnumerable</span> <span style="color: #0000ff;">GetMyEnumerator3</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">return</span> 1;
        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">return</span> 2;
        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">return</span> 3;
        <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">return</span> 4;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">IEnumerable</span> <span style="color: #a0522d;">GetMyEnumerator4</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">get</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">yield</span> <span style="color: #a020f0;">return</span> 666;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orga09ac9a" class="outline-3">
<h3 id="orga09ac9a"><span class="section-number-3">16.3.</span> Linq</h3>
<div class="outline-text-3" id="text-16-3">
<p>
Linq (Language Integrated Query，语言集成扩展)：
</p>
<ul class="org-ul">
<li>基于 IEnumerable&lt;T&gt; 类型进行的 <b>扩展</b></li>
<li>实现在 System.Linq.Enumerable 类中，通过扩展方法的形式实现的</li>
<li>支持两种语法: Method Syntax 和 Query Syntax</li>
</ul>
</div>

<div id="outline-container-org7a8df59" class="outline-4">
<h4 id="org7a8df59"><span class="section-number-4">16.3.1.</span> Method Syntax</h4>
<div class="outline-text-4" id="text-16-3-1">
<ul class="org-ul">
<li>筛选操作符: Where/OfType</li>
<li>投射操作符: Select/SelectMany</li>
<li>顺序操作符: OrderBy/ThenBy/OrderByDescending/ThenByDescending/Reverse</li>
<li>连接操作符: Join/GroupJoin</li>
<li>组合操作符: GroupBy/ToLookup</li>
<li>限定操作符: Any/All/Contains</li>
<li>范围操作符: Take/Skip/TakeWhile/SkipWhile</li>
<li>集合操作符: Distinct/Union/Intersect/Except/Zip</li>
<li>返回单元素: First/FirstOrDefault/Last/LastOrDefault/ElementAt/ElementAtOrDefault/Single/SingleOrDefault</li>
<li>聚合操作符: Count/Sum/Min/Max/Average/Aggregate</li>
<li>转换操作符: ToArray/AsEnumerable/ToList/ToDictionary/Cast</li>
<li>生成操作符: Empty/Range/Repeat</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s1</span> = <span style="color: #8b2252;">"hello world"</span>;
        <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">a1</span> = <span style="color: #909183;">{</span>1, 2, 666, 4, 6, 7, 5, 3, 4<span style="color: #909183;">}</span>;
        <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">a11</span> = <span style="color: #909183;">{</span>666, 777, 888<span style="color: #909183;">}</span>;
        <span style="color: #228b22;">object</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">a2</span> = <span style="color: #909183;">{</span> 1, 2, <span style="color: #8b2252;">"666"</span>, 4, 6, <span style="color: #8b2252;">"7"</span>, 5.5, 3, 4 <span style="color: #909183;">}</span>;
        <span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">a3</span> = <span style="color: #909183;">{</span><span style="color: #8b2252;">"Hello"</span>, <span style="color: #8b2252;">"World"</span>, <span style="color: #8b2252;">"where"</span>, <span style="color: #8b2252;">"are"</span>, <span style="color: #8b2252;">"You"</span><span style="color: #909183;">}</span>;
        <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">double</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">l1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">double</span><span style="color: #909183;">&gt;</span> <span style="color: #909183;">{</span>1.2, 2.3, 4.6<span style="color: #909183;">}</span>;
        <span style="color: #228b22;">Dictionary</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">d</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Dictionary</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span>, <span style="color: #228b22;">string</span><span style="color: #909183;">&gt;()</span>;

        <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">BookType</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">types</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">BookType</span><span style="color: #909183;">&gt;</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BookType</span><span style="color: #709870;">(</span>1, <span style="color: #8b2252;">"&#31185;&#25216;&#31867;"</span><span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BookType</span><span style="color: #709870;">(</span>2, <span style="color: #8b2252;">"&#31185;&#24187;&#31867;"</span><span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BookType</span><span style="color: #709870;">(</span>3, <span style="color: #8b2252;">"&#31185;&#23398;&#31867;"</span><span style="color: #709870;">)</span>,
        <span style="color: #909183;">}</span>;
        <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">books</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #909183;">&gt;</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #709870;">(</span>1, <span style="color: #8b2252;">"C# &#32534;&#31243;&#35821;&#35328;"</span>, 222, 1<span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #709870;">(</span>2, <span style="color: #8b2252;">"VueJS"</span>, 22, 1<span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #709870;">(</span>3, <span style="color: #8b2252;">"&#19977;&#20307;"</span>, 23, 2<span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #709870;">(</span>4, <span style="color: #8b2252;">"&#26143;&#38469;&#31359;&#36234;"</span>, 54, 2<span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #709870;">(</span>5, <span style="color: #8b2252;">"&#20185;&#21073;"</span>, 64, 2<span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #709870;">(</span>6, <span style="color: #8b2252;">"&#21160;&#29289;&#19990;&#30028;"</span>, 222, 3<span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #709870;">(</span>9, <span style="color: #8b2252;">"&#38050;&#38081;&#26159;&#24590;&#20040;&#28860;&#25104;&#30340;"</span>, 11, 3<span style="color: #709870;">)</span>,
        <span style="color: #909183;">}</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36807;&#28388;&#12289;&#31579;&#36873;</span>
        <span style="color: #228b22;">IEnumerable</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">r1</span> = a1.<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>x =&gt; x &gt; 5<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r2</span> = a2.<span style="color: #0000ff;">OfType</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span><span style="color: #909183;">&gt;()</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r3</span> = a2.<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>x =&gt; x <span style="color: #a020f0;">is</span> <span style="color: #228b22;">string</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25237;&#23556;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r4</span> = a1.<span style="color: #0000ff;">Select</span><span style="color: #909183;">(</span>x =&gt; x &gt; 10 ? x : x + 10<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r5</span> = a1.<span style="color: #0000ff;">Select</span><span style="color: #909183;">(</span>x =&gt; $<span style="color: #8b2252;">"&#36825;&#20010;&#25968;&#26159;: {x + 1}"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r6</span> = a1.<span style="color: #0000ff;">Select</span><span style="color: #909183;">(</span>x =&gt; <span style="color: #709870;">(</span><span style="color: #228b22;">x</span>, $<span style="color: #8b2252;">"{x + 1}"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25490;&#24207;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r7</span> = a1.<span style="color: #0000ff;">Reverse</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r8</span> = a1.<span style="color: #0000ff;">OrderBy</span><span style="color: #909183;">(</span>x =&gt; -x<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r9</span> = a1.<span style="color: #0000ff;">OrderByDescending</span><span style="color: #909183;">(</span>x =&gt; x<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r10</span> = a3.<span style="color: #0000ff;">OrderBy</span><span style="color: #909183;">(</span>x =&gt; x.Length<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r11</span> = a3.<span style="color: #0000ff;">OrderBy</span><span style="color: #909183;">(</span>x =&gt; x.Length<span style="color: #909183;">)</span>.<span style="color: #0000ff;">ThenByDescending</span><span style="color: #909183;">(</span>x =&gt; x<span style="color: #709870;">[</span>0<span style="color: #709870;">]</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r12</span> = books.<span style="color: #0000ff;">OrderBy</span><span style="color: #909183;">(</span>x =&gt; x.Price<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r13</span> = books.<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>x =&gt; x.TypeId != 2<span style="color: #909183;">)</span>.<span style="color: #0000ff;">OrderBy</span><span style="color: #909183;">(</span>x =&gt; x.Price<span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36830;&#25509;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r14</span> = books.<span style="color: #0000ff;">Join</span><span style="color: #909183;">(</span>
            <span style="color: #228b22;">types</span>,
            book =&gt; book.TypeId,
            type =&gt; type.ID,
            <span style="color: #709870;">(</span><span style="color: #228b22;">book</span>, <span style="color: #228b22;">type</span><span style="color: #709870;">)</span> =&gt; <span style="color: #709870;">(</span>typeName: type.Name, <span style="color: #228b22;">book</span><span style="color: #709870;">)</span>
        <span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r15</span> = books
            .<span style="color: #0000ff;">Join</span><span style="color: #909183;">(</span>
                <span style="color: #228b22;">types</span>,
                book =&gt; book.TypeId,
                type =&gt; type.ID,
                <span style="color: #709870;">(</span><span style="color: #228b22;">book</span>, <span style="color: #228b22;">type</span><span style="color: #709870;">)</span> =&gt; <span style="color: #709870;">(</span>typeName: type.Name, <span style="color: #228b22;">book</span><span style="color: #709870;">)</span>
            <span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>o =&gt; o.typeName == <span style="color: #8b2252;">"&#31185;&#24187;&#31867;"</span><span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Select</span><span style="color: #909183;">(</span>o =&gt; o.book<span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#33539;&#22260;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r16</span> = a1.<span style="color: #0000ff;">Take</span><span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">limit 3</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r17</span> = a1.<span style="color: #0000ff;">TakeLast</span><span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r18</span> = a1.<span style="color: #0000ff;">TakeWhile</span><span style="color: #909183;">(</span>x =&gt; x &lt; 5<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r19</span> = a1.<span style="color: #0000ff;">Skip</span><span style="color: #909183;">(</span>2<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Take</span><span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r20</span> = a1.<span style="color: #0000ff;">SkipLast</span><span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>x =&gt; x &gt; 1<span style="color: #909183;">)</span>.<span style="color: #0000ff;">OrderBy</span><span style="color: #909183;">(</span>x =&gt; x<span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38598;&#21512;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r21</span> = a1.<span style="color: #0000ff;">Except</span><span style="color: #909183;">(</span><span style="color: #228b22;">a11</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r22</span> = a1.<span style="color: #0000ff;">Union</span><span style="color: #909183;">(</span><span style="color: #228b22;">a11</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r23</span> = a1.<span style="color: #0000ff;">Distinct</span><span style="color: #909183;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21435;&#37325;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r24</span> = a1.<span style="color: #0000ff;">Zip</span><span style="color: #909183;">(</span>a1.<span style="color: #0000ff;">Select</span><span style="color: #709870;">(</span>x =&gt; x + 100<span style="color: #709870;">)</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238;&#21333;&#20010;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r25</span> = a1.<span style="color: #0000ff;">Zip</span><span style="color: #909183;">(</span>a1.<span style="color: #0000ff;">Select</span><span style="color: #709870;">(</span>x =&gt; x + 100<span style="color: #709870;">)</span><span style="color: #909183;">)</span>.<span style="color: #0000ff;">First</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r26</span> = a1.<span style="color: #0000ff;">Zip</span><span style="color: #909183;">(</span>a1.<span style="color: #0000ff;">Select</span><span style="color: #709870;">(</span>x =&gt; x + 100<span style="color: #709870;">)</span><span style="color: #909183;">)</span>.<span style="color: #0000ff;">Last</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r27</span> = a1.<span style="color: #0000ff;">Zip</span><span style="color: #909183;">(</span>a1.<span style="color: #0000ff;">Select</span><span style="color: #709870;">(</span>x =&gt; x + 100<span style="color: #709870;">)</span><span style="color: #909183;">)</span>.<span style="color: #0000ff;">ElementAt</span><span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r28</span> = a1.<span style="color: #0000ff;">Zip</span><span style="color: #909183;">(</span>a1.<span style="color: #0000ff;">Select</span><span style="color: #709870;">(</span>x =&gt; x + 100<span style="color: #709870;">)</span><span style="color: #909183;">)</span>.<span style="color: #0000ff;">Take</span><span style="color: #909183;">(</span>1<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Single</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r29</span> = a1.<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>x =&gt; x &gt; 10000<span style="color: #909183;">)</span>.<span style="color: #0000ff;">FirstOrDefault</span><span style="color: #909183;">()</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#32858;&#21512;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r30</span> = a1.<span style="color: #0000ff;">Sum</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r31</span> = a1.<span style="color: #0000ff;">Average</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r32</span> = a1.<span style="color: #0000ff;">Max</span><span style="color: #909183;">()</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36716;&#25442; (IEnumerable)</span>
        <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">r33</span> = a1.<span style="color: #0000ff;">Take</span><span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>.<span style="color: #0000ff;">ToArray</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">r34</span> = a1.<span style="color: #0000ff;">Take</span><span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>.<span style="color: #0000ff;">ToList</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">Dictionary</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">string</span>, <span style="color: #228b22;">int</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">r35</span> = a1.<span style="color: #0000ff;">Take</span><span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>.<span style="color: #0000ff;">ToDictionary</span><span style="color: #909183;">(</span>x =&gt; $<span style="color: #8b2252;">"id-{x}"</span>, x =&gt; x<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">r36</span>  = <span style="color: #228b22;">string</span>.<span style="color: #0000ff;">Concat</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"hello, world"</span>.<span style="color: #0000ff;">Select</span><span style="color: #709870;">(</span>x =&gt; <span style="color: #907373;">(</span><span style="color: #228b22;">char</span><span style="color: #907373;">)</span> <span style="color: #907373;">(</span>x + 1<span style="color: #907373;">)</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38745;&#24577;&#12289;&#29983;&#25104;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r37</span> = Enumerable.<span style="color: #0000ff;">Empty</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span><span style="color: #909183;">&gt;()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#29983;&#25104;&#19968;&#20010;&#31354;&#30340; int &#30340;&#21487;&#26522;&#20030;&#31867;</span>
        <span style="color: #228b22;">IEnumerable</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">r38</span> = Enumerable.<span style="color: #0000ff;">Range</span><span style="color: #909183;">(</span>1, 100<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r39</span> = Enumerable.<span style="color: #0000ff;">Repeat</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"xxx"</span>, 10<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r40</span> = <span style="color: #228b22;">string</span>.<span style="color: #0000ff;">Concat</span><span style="color: #909183;">(</span>Enumerable.<span style="color: #0000ff;">Repeat</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"-"</span>, 100<span style="color: #709870;">)</span><span style="color: #909183;">)</span>;

        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">r40</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">//</span><span style="color: #b22222;">foreach (var e in r39)</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">{</span>
        <span style="color: #b22222;">//    </span><span style="color: #b22222;">Console.WriteLine(e);</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org04f3d4b" class="outline-4">
<h4 id="org04f3d4b"><span class="section-number-4">16.3.2.</span> Query Syntax/Expression</h4>
<div class="outline-text-4" id="text-16-3-2">
<ul class="org-ul">
<li>Query 表达式，最终会被通过 Provider 提供的机制翻译成相关的方法调用。最终效果是一样的。不过 Provider 可能会进行一定程度的优化</li>
<li>在一个 Query 表达式中，from 和 select/group 是必须的，其他可选</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">s1</span> = <span style="color: #8b2252;">"hello world"</span>;
        <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">a1</span> = <span style="color: #909183;">{</span>1, 2, 666, 4, 6, 7, 5, 3, 4<span style="color: #909183;">}</span>;
        <span style="color: #228b22;">int</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">a11</span> = <span style="color: #909183;">{</span>666, 777, 888<span style="color: #909183;">}</span>;
        <span style="color: #228b22;">object</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">a2</span> = <span style="color: #909183;">{</span> 1, 2, <span style="color: #8b2252;">"666"</span>, 4, 6, <span style="color: #8b2252;">"7"</span>, 5.5, 3, 4 <span style="color: #909183;">}</span>;
        <span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">a3</span> = <span style="color: #909183;">{</span><span style="color: #8b2252;">"Hello"</span>, <span style="color: #8b2252;">"World"</span>, <span style="color: #8b2252;">"where"</span>, <span style="color: #8b2252;">"are"</span>, <span style="color: #8b2252;">"You"</span><span style="color: #909183;">}</span>;

        <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">BookType</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">types</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">BookType</span><span style="color: #909183;">&gt;</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BookType</span><span style="color: #709870;">(</span>1, <span style="color: #8b2252;">"&#31185;&#25216;&#31867;"</span><span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BookType</span><span style="color: #709870;">(</span>2, <span style="color: #8b2252;">"&#31185;&#24187;&#31867;"</span><span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BookType</span><span style="color: #709870;">(</span>3, <span style="color: #8b2252;">"&#31185;&#23398;&#31867;"</span><span style="color: #709870;">)</span>,
        <span style="color: #909183;">}</span>;
        <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">books</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #909183;">&gt;</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #709870;">(</span>1, <span style="color: #8b2252;">"C# &#32534;&#31243;&#35821;&#35328;"</span>, 222, 1<span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #709870;">(</span>2, <span style="color: #8b2252;">"VueJS"</span>, 22, 1<span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #709870;">(</span>3, <span style="color: #8b2252;">"&#19977;&#20307;"</span>, 23, 2<span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #709870;">(</span>4, <span style="color: #8b2252;">"&#26143;&#38469;&#31359;&#36234;"</span>, 54, 2<span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #709870;">(</span>5, <span style="color: #8b2252;">"&#20185;&#21073;"</span>, 64, 2<span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #709870;">(</span>6, <span style="color: #8b2252;">"&#21160;&#29289;&#19990;&#30028;"</span>, 222, 3<span style="color: #709870;">)</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #709870;">(</span>9, <span style="color: #8b2252;">"&#38050;&#38081;&#26159;&#24590;&#20040;&#28860;&#25104;&#30340;"</span>, 11, 3<span style="color: #709870;">)</span>,
        <span style="color: #909183;">}</span>;

        <span style="color: #228b22;">IEnumerable</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">r0</span> = <span style="color: #a020f0;">from</span> x <span style="color: #a020f0;">in</span> a1 <span style="color: #a020f0;">select</span> x;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r1</span> = a1.<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>x =&gt; x &gt; 5<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Select</span><span style="color: #909183;">(</span>x =&gt; x<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r2</span> = <span style="color: #a020f0;">from</span> x <span style="color: #a020f0;">in</span> a1 <span style="color: #a020f0;">where</span> x &gt; 5 <span style="color: #a020f0;">select</span> x;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r3</span> = <span style="color: #a020f0;">from</span> x <span style="color: #a020f0;">in</span> a1 <span style="color: #a020f0;">where</span> x &gt; 5 <span style="color: #a020f0;">select</span> x + 1000;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r4</span> = <span style="color: #a020f0;">from</span> x <span style="color: #a020f0;">in</span> a1 <span style="color: #a020f0;">where</span> x &gt; 5 <span style="color: #a020f0;">select</span> $<span style="color: #8b2252;">"I am {x * x}"</span>;

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r5</span> = <span style="color: #a020f0;">from</span> x <span style="color: #a020f0;">in</span> a1 <span style="color: #a020f0;">where</span> x &gt; 5 <span style="color: #a020f0;">orderby</span> x <span style="color: #a020f0;">select</span> x;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r6</span> = <span style="color: #a020f0;">from</span> x <span style="color: #a020f0;">in</span> a1 <span style="color: #a020f0;">where</span> x &gt; 5 <span style="color: #a020f0;">orderby</span> x <span style="color: #a020f0;">descending</span> <span style="color: #a020f0;">select</span> x;

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r7</span> =
            <span style="color: #a020f0;">from</span> book <span style="color: #a020f0;">in</span> books
            <span style="color: #a020f0;">join</span> type <span style="color: #a020f0;">in</span> types
            <span style="color: #a020f0;">on</span> book.TypeId <span style="color: #a020f0;">equals</span> type.ID
            <span style="color: #a020f0;">select</span> <span style="color: #909183;">(</span>type.<span style="color: #228b22;">Name</span>, <span style="color: #228b22;">book</span>, <span style="color: #228b22;">type</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r8</span> = <span style="color: #a020f0;">from</span> book <span style="color: #a020f0;">in</span> books
            <span style="color: #a020f0;">join</span> type <span style="color: #a020f0;">in</span> types <span style="color: #a020f0;">on</span> book.TypeId <span style="color: #a020f0;">equals</span> type.ID
            <span style="color: #a020f0;">where</span> type.Name == <span style="color: #8b2252;">"&#31185;&#24187;&#31867;"</span>
            <span style="color: #a020f0;">select</span> book;

        <span style="color: #228b22;">double</span> <span style="color: #a0522d;">avg1</span> = r8.<span style="color: #0000ff;">Average</span><span style="color: #909183;">(</span>book =&gt; book.Price<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">double</span> <span style="color: #a0522d;">avg2</span> = r8.<span style="color: #0000ff;">Select</span><span style="color: #909183;">(</span>book =&gt; book.Price<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Average</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">double</span> <span style="color: #a0522d;">avg3</span> =
            <span style="color: #909183;">(</span>
                <span style="color: #a020f0;">from</span> book <span style="color: #a020f0;">in</span> books
                <span style="color: #a020f0;">join</span> type <span style="color: #a020f0;">in</span> types <span style="color: #a020f0;">on</span> book.TypeId <span style="color: #a020f0;">equals</span> type.ID
                <span style="color: #a020f0;">where</span> type.Name == <span style="color: #8b2252;">"&#31185;&#24187;&#31867;"</span>
                <span style="color: #a020f0;">select</span> book
            <span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Average</span><span style="color: #909183;">(</span>book =&gt; book.Price<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">double</span> <span style="color: #a0522d;">avg4</span> = <span style="color: #909183;">(</span>
            <span style="color: #a020f0;">from</span> book <span style="color: #a020f0;">in</span> books
            <span style="color: #a020f0;">join</span> type <span style="color: #a020f0;">in</span> types <span style="color: #a020f0;">on</span> book.TypeId <span style="color: #a020f0;">equals</span> type.ID
            <span style="color: #a020f0;">where</span> type.Name == <span style="color: #8b2252;">"&#31185;&#24187;&#31867;"</span>
            <span style="color: #a020f0;">select</span> book.Price
        <span style="color: #909183;">)</span>.<span style="color: #0000ff;">Average</span><span style="color: #909183;">()</span>;

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r9</span> =
            <span style="color: #a020f0;">from</span> x <span style="color: #a020f0;">in</span> a1
            <span style="color: #a020f0;">let</span> y = x * x
            <span style="color: #a020f0;">where</span> y &gt; 5
            <span style="color: #a020f0;">orderby</span> y
            <span style="color: #a020f0;">select</span> y;

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r10</span> =
            <span style="color: #a020f0;">from</span> book <span style="color: #a020f0;">in</span> books
            <span style="color: #a020f0;">group</span> book <span style="color: #a020f0;">by</span> book.TypeId;

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r11</span> = <span style="color: #a020f0;">from</span> a <span style="color: #a020f0;">in</span> books
            <span style="color: #a020f0;">join</span> b <span style="color: #a020f0;">in</span> types <span style="color: #a020f0;">on</span> a.TypeId <span style="color: #a020f0;">equals</span> b.ID <span style="color: #a020f0;">into</span> xxx <span style="color: #b22222;">// </span><span style="color: #b22222;">into</span>
            <span style="color: #a020f0;">from</span> c <span style="color: #a020f0;">in</span> xxx
            <span style="color: #a020f0;">select</span> c;

        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">c1</span> = <span style="color: #909183;">(</span><span style="color: #a020f0;">from</span> x <span style="color: #a020f0;">in</span> a1 <span style="color: #a020f0;">where</span> x &gt; 5 <span style="color: #a020f0;">select</span> x<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Take</span><span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Count</span><span style="color: #909183;">()</span>;

        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">e</span> <span style="color: #a020f0;">in</span> r10<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #228b22;">e</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0334bbb" class="outline-3">
<h3 id="org0334bbb"><span class="section-number-3">16.4.</span> Linq to XML</h3>
<div class="outline-text-3" id="text-16-4">
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #a020f0;">?xml</span> <span style="color: #a0522d;">version</span>="1.0" <span style="color: #a0522d;">encoding</span>="utf-8"?&gt;

&lt;<span style="color: #0000ff;">books</span>&gt;
  &lt;<span style="color: #0000ff;">book</span>&gt;
    &lt;<span style="color: #0000ff;">name</span>&gt;jQuery&lt;/<span style="color: #0000ff;">name</span>&gt;
    &lt;<span style="color: #0000ff;">price</span>&gt;23&lt;/<span style="color: #0000ff;">price</span>&gt;
  &lt;/<span style="color: #0000ff;">book</span>&gt;
  &lt;<span style="color: #0000ff;">book</span>&gt;
    &lt;<span style="color: #0000ff;">name</span>&gt;VueJS&lt;/<span style="color: #0000ff;">name</span>&gt;
    &lt;<span style="color: #0000ff;">price</span>&gt;123.5&lt;/<span style="color: #0000ff;">price</span>&gt;
  &lt;/<span style="color: #0000ff;">book</span>&gt;
  &lt;<span style="color: #0000ff;">book</span>&gt;
    &lt;<span style="color: #0000ff;">name</span>&gt;CSharp&lt;/<span style="color: #0000ff;">name</span>&gt;
    &lt;<span style="color: #0000ff;">price</span>&gt;26.5&lt;/<span style="color: #0000ff;">price</span>&gt;
  &lt;/<span style="color: #0000ff;">book</span>&gt;
  &lt;<span style="color: #0000ff;">book</span>&gt;
    &lt;<span style="color: #0000ff;">name</span>&gt;Java&lt;/<span style="color: #0000ff;">name</span>&gt;
    &lt;<span style="color: #0000ff;">price</span>&gt;53.5&lt;/<span style="color: #0000ff;">price</span>&gt;
  &lt;/<span style="color: #0000ff;">book</span>&gt;
&lt;/<span style="color: #0000ff;">books</span>&gt;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">xml</span> = XElement.<span style="color: #0000ff;">Load</span><span style="color: #909183;">(</span>@<span style="color: #8b2252;">"e:\ccc.xml"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">price1</span> = <span style="color: #909183;">(</span><span style="color: #709870;">(</span><span style="color: #228b22;">XElement</span><span style="color: #709870;">)(</span><span style="color: #907373;">(</span><span style="color: #228b22;">XElement</span><span style="color: #907373;">)</span> xml.LastNode<span style="color: #709870;">)</span>.LastNode<span style="color: #909183;">)</span>.Value;

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">count1</span> = xml.<span style="color: #0000ff;">Elements</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"book"</span><span style="color: #909183;">)</span>.<span style="color: #0000ff;">Count</span><span style="color: #909183;">()</span>;

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r1</span> = xml.<span style="color: #0000ff;">Elements</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"book"</span><span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">OrderByDescending</span><span style="color: #909183;">(</span><span style="color: #228b22;">GetBookPrice</span><span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Take</span><span style="color: #909183;">(</span>2<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Select</span><span style="color: #909183;">(</span><span style="color: #228b22;">GetBookPrice</span><span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Average</span><span style="color: #909183;">()</span>;

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r2</span> = xml.<span style="color: #0000ff;">Elements</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"book"</span><span style="color: #909183;">)</span>.<span style="color: #0000ff;">Select</span><span style="color: #909183;">(</span><span style="color: #228b22;">GetBookPrice</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r3</span> = r2.<span style="color: #0000ff;">OrderByDescending</span><span style="color: #909183;">(</span>x =&gt; x<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Take</span><span style="color: #909183;">(</span>2<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Average</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r4</span> = r2.<span style="color: #0000ff;">Average</span><span style="color: #909183;">()</span>;

        <span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(r3 - r4);</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(r2.OrderByDescending(x =&gt; x).Take(2).Average() - r2.Average());</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">Query Expression</span>

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r5</span> = <span style="color: #a020f0;">from</span> book <span style="color: #a020f0;">in</span> xml.<span style="color: #0000ff;">Elements</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"book"</span><span style="color: #909183;">)</span>
                 <span style="color: #a020f0;">where</span> <span style="color: #0000ff;">GetBookName</span><span style="color: #909183;">(</span><span style="color: #228b22;">book</span><span style="color: #909183;">)</span> != <span style="color: #8b2252;">"jQuery"</span>
                 <span style="color: #a020f0;">orderby</span> <span style="color: #0000ff;">GetBookPrice</span><span style="color: #909183;">(</span><span style="color: #228b22;">book</span><span style="color: #909183;">)</span>
                 <span style="color: #a020f0;">select</span> <span style="color: #909183;">(</span><span style="color: #0000ff;">GetBookName</span><span style="color: #709870;">(</span><span style="color: #228b22;">book</span><span style="color: #709870;">)</span>, <span style="color: #0000ff;">GetBookPrice</span><span style="color: #709870;">(</span><span style="color: #228b22;">book</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r6</span> = <span style="color: #909183;">(</span><span style="color: #a020f0;">from</span> book <span style="color: #a020f0;">in</span> xml.<span style="color: #0000ff;">Elements</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"book"</span><span style="color: #709870;">)</span>
                  <span style="color: #a020f0;">where</span> <span style="color: #0000ff;">GetBookName</span><span style="color: #709870;">(</span><span style="color: #228b22;">book</span><span style="color: #709870;">)</span> != <span style="color: #8b2252;">"jQuery"</span>
                  <span style="color: #a020f0;">orderby</span> <span style="color: #0000ff;">GetBookPrice</span><span style="color: #709870;">(</span><span style="color: #228b22;">book</span><span style="color: #709870;">)</span>
                  <span style="color: #a020f0;">select</span> <span style="color: #0000ff;">GetBookPrice</span><span style="color: #709870;">(</span><span style="color: #228b22;">book</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>.<span style="color: #0000ff;">Average</span><span style="color: #909183;">()</span>;

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r7</span> = <span style="color: #a020f0;">from</span> book <span style="color: #a020f0;">in</span> xml.<span style="color: #0000ff;">Elements</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"book"</span><span style="color: #909183;">)</span> <span style="color: #a020f0;">where</span> <span style="color: #0000ff;">GetBookName</span><span style="color: #909183;">(</span><span style="color: #228b22;">book</span><span style="color: #909183;">)</span> != <span style="color: #8b2252;">"jQuery"</span> <span style="color: #a020f0;">select</span> <span style="color: #0000ff;">GetBookPrice</span><span style="color: #909183;">(</span><span style="color: #228b22;">book</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r8</span> = r7.<span style="color: #0000ff;">OrderByDescending</span><span style="color: #909183;">(</span>x =&gt; x<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Take</span><span style="color: #909183;">(</span>2<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Average</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r9</span> = r7.<span style="color: #0000ff;">Average</span><span style="color: #909183;">()</span>;

        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">r</span> <span style="color: #a020f0;">in</span> r5<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #228b22;">r</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #0000ff;">book</span> <span style="color: #a020f0;">in</span> XElement.<span style="color: #0000ff;">Load</span><span style="color: #709870;">(</span>@<span style="color: #8b2252;">"e:\ccc.xml"</span><span style="color: #709870;">)</span>.<span style="color: #0000ff;">Elements</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"book"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>book.<span style="color: #0000ff;">Elements</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"name"</span><span style="color: #907373;">)</span>.<span style="color: #0000ff;">First</span><span style="color: #907373;">()</span>.Value<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #909183;">(</span>
            <span style="color: #a020f0;">from</span> book <span style="color: #a020f0;">in</span> XElement.<span style="color: #0000ff;">Load</span><span style="color: #709870;">(</span>@<span style="color: #8b2252;">"e:\ccc.xml"</span><span style="color: #709870;">)</span>.<span style="color: #0000ff;">Elements</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"book"</span><span style="color: #709870;">)</span>
            <span style="color: #a020f0;">let</span> name = <span style="color: #0000ff;">GetBookName</span><span style="color: #709870;">(</span><span style="color: #228b22;">book</span><span style="color: #709870;">)</span>
            <span style="color: #a020f0;">let</span> price = <span style="color: #0000ff;">GetBookPrice</span><span style="color: #709870;">(</span><span style="color: #228b22;">book</span><span style="color: #709870;">)</span>
            <span style="color: #a020f0;">where</span> price &gt; 100 <span style="color: #a020f0;">orderby</span> price
            <span style="color: #a020f0;">select</span> <span style="color: #709870;">(</span><span style="color: #228b22;">name</span>, <span style="color: #228b22;">price</span><span style="color: #709870;">)</span>
        <span style="color: #909183;">)</span>.<span style="color: #0000ff;">ToList</span><span style="color: #909183;">()</span>.<span style="color: #0000ff;">ForEach</span><span style="color: #909183;">(</span>x =&gt; Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{x.name} &#30340;&#20215;&#26684;&#20026; {x.price}"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetBookPrice</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">XElement</span> <span style="color: #a0522d;">bookElement</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> <span style="color: #228b22;">double</span>.<span style="color: #0000ff;">Parse</span><span style="color: #909183;">(</span>bookElement.<span style="color: #0000ff;">Descendants</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"price"</span><span style="color: #709870;">)</span>.<span style="color: #0000ff;">First</span><span style="color: #709870;">()</span>.Value<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">GetBookName</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">XElement</span> <span style="color: #a0522d;">bookElement</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> bookElement.<span style="color: #0000ff;">Descendants</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"name"</span><span style="color: #909183;">)</span>.<span style="color: #0000ff;">First</span><span style="color: #909183;">()</span>.Value;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org82eaf28" class="outline-2">
<h2 id="org82eaf28"><span class="section-number-2">17.</span> 泛型 (Generic)</h2>
<div class="outline-text-2" id="text-17">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ps</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyStack</span><span style="color: #909183;">()</span>;
        ps.<span style="color: #0000ff;">Push</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
        ps.<span style="color: #0000ff;">Push</span><span style="color: #909183;">(</span>2222<span style="color: #909183;">)</span>;
        ps.<span style="color: #0000ff;">Push</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#19981;&#31616;&#27905;&#65292;&#38656;&#35201;&#25163;&#21160;&#36716;&#22411;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#19981;&#23433;&#20840;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20302;&#25928;&#29575;</span>

        <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">p</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">Person</span><span style="color: #909183;">)</span>ps.<span style="color: #0000ff;">Pop</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">p</span><span style="color: #909183;">)</span>;
        <span style="color: #909183;">(</span><span style="color: #709870;">(</span><span style="color: #228b22;">Person</span><span style="color: #709870;">)</span>ps.<span style="color: #0000ff;">Pop</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>.<span style="color: #0000ff;">Say</span><span style="color: #909183;">()</span>;


        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#33258;&#28982;&#32780;&#28982;&#30340;&#35299;&#20915;&#26041;&#26696;: &#20026;&#27599;&#31181;&#31867;&#22411;&#21019;&#24314;&#19968;&#20010;&#21333;&#29420;&#30340; Stack</span>

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ps2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">PersonStack</span><span style="color: #909183;">()</span>;
        ps2.<span style="color: #0000ff;">Push</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
        ps2.<span style="color: #0000ff;">Push</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">p1</span>= ps2.<span style="color: #0000ff;">Pop</span><span style="color: #909183;">()</span>;
        p1.<span style="color: #0000ff;">Say</span><span style="color: #909183;">()</span>;

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ps3</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StudentStack</span><span style="color: #909183;">()</span>;
        ps3.<span style="color: #0000ff;">Push</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
        ps3.<span style="color: #0000ff;">Push</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;

        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>ps3.<span style="color: #0000ff;">Pop</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#19978;&#36848;&#30340;&#26041;&#26696;&#21487;&#20197;&#35299;&#20915;&#25152;&#26377;&#38382;&#39064;&#65292;&#20294;&#24102;&#26469;&#20102;&#26032;&#30340;&#38382;&#39064;: &#27599;&#27425;&#37325;&#22797;&#23450;&#20041;&#36825;&#20123;&#31867;&#22411;&#24456;&#40635;&#28902;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#37027;&#33021;&#19981;&#33021;&#36890;&#36807;&#26576;&#31181;&#26041;&#27861;&#65292;&#33258;&#21160;&#29983;&#25104;&#36825;&#20123;&#31867;&#22411;&#21602;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">CSharp &#32473;&#20986;&#30340;&#35299;&#20915;&#26041;&#26696;&#26159;: &#27867;&#22411;</span>

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ps4</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyStack</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Person</span><span style="color: #909183;">&gt;()</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ps5</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyStack</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Student</span><span style="color: #909183;">&gt;()</span>;
        <span style="color: #228b22;">MyStack</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">ps6</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyStack</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">int</span><span style="color: #909183;">&gt;()</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ps7</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyStack</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">double</span><span style="color: #909183;">&gt;()</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ps9</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyStack</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">FileInfo</span><span style="color: #909183;">&gt;()</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ps8</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyStack</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Stack</span><span style="color: #909183;">&gt;()</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ps0</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyStack</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">bool</span><span style="color: #909183;">&gt;()</span>;

        ps4.<span style="color: #0000ff;">Push</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
        ps4.<span style="color: #0000ff;">Push</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">Person</span> <span style="color: #a0522d;">p9</span> = ps4.<span style="color: #0000ff;">Pop</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Person</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Say</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"Hello"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Student</span>
<span style="color: #707183;">{</span>

<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyStack</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">X</span><span style="color: #707183;">&gt;</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27169;&#26495;</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">stackTop</span> = 0; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26632;&#39030;</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">X</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">_items</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">X</span><span style="color: #7388d6;">[</span>200<span style="color: #7388d6;">]</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Push</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">X</span> <span style="color: #a0522d;">w</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        _items<span style="color: #909183;">[</span>stackTop<span style="color: #909183;">]</span> = w;
        stackTop = stackTop + 1;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">X</span> <span style="color: #0000ff;">Pop</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        stackTop = stackTop - 1;
        <span style="color: #a020f0;">return</span> _items<span style="color: #909183;">[</span>stackTop<span style="color: #909183;">]</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">X</span> <span style="color: #0000ff;">Peek</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> _items<span style="color: #909183;">[</span>stackTop - 1<span style="color: #909183;">]</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">Count</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">get</span> =&gt; stackTop;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Clear</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        stackTop = 0;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">PersonStack</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">stackTop</span> = 0; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26632;&#39030;</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">Person</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">_items</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Person</span><span style="color: #7388d6;">[</span>200<span style="color: #7388d6;">]</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Push</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Person</span> <span style="color: #a0522d;">w</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        _items<span style="color: #909183;">[</span>stackTop<span style="color: #909183;">]</span> = w;
        stackTop = stackTop + 1;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Person</span> <span style="color: #0000ff;">Pop</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        stackTop = stackTop - 1;
        <span style="color: #a020f0;">return</span> _items<span style="color: #909183;">[</span>stackTop<span style="color: #909183;">]</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Person</span> <span style="color: #0000ff;">Peek</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> _items<span style="color: #909183;">[</span>stackTop - 1<span style="color: #909183;">]</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">Count</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">get</span> =&gt; stackTop;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Clear</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        stackTop = 0;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">StudentStack</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">stackTop</span> = 0; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26632;&#39030;</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">Student</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">_items</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #7388d6;">[</span>200<span style="color: #7388d6;">]</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Push</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Student</span> <span style="color: #a0522d;">w</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        _items<span style="color: #909183;">[</span>stackTop<span style="color: #909183;">]</span> = w;
        stackTop = stackTop + 1;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Student</span> <span style="color: #0000ff;">Pop</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        stackTop = stackTop - 1;
        <span style="color: #a020f0;">return</span> _items<span style="color: #909183;">[</span>stackTop<span style="color: #909183;">]</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Student</span> <span style="color: #0000ff;">Peek</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> _items<span style="color: #909183;">[</span>stackTop - 1<span style="color: #909183;">]</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">Count</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">get</span> =&gt; stackTop;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Clear</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        stackTop = 0;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>

<div id="outline-container-org38a7ec1" class="outline-3">
<h3 id="org38a7ec1"><span class="section-number-3">17.1.</span> 方法泛型</h3>
<div class="outline-text-3" id="text-17-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">Count</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">TSource</span><span style="color: #707183;">&gt;(</span><span style="color: #a020f0;">this</span> <span style="color: #228b22;">IEnumerable</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">TSource</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">source</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>

<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org5501efc" class="outline-2">
<h2 id="org5501efc"><span class="section-number-2">18.</span> 事件 (Event)</h2>
<div class="outline-text-2" id="text-18">
<ul class="org-ul">
<li>不是现在发生的事，而是未来发生的</li>
<li>满足某个条件之后，才会发生的</li>
<li>满足一定条件时，要执行的代码逻辑</li>
<li>比如，你们要毕业，你们要做些什么</li>
<li>比如，如果发生火灾，你要做些什么</li>
<li>比如，在页面上，用户做了某些动作，会导致执行什么逻辑</li>
<li>这种被动式被执行的逻辑，称作事件</li>
</ul>

<p>
每个同学毕业的时候，都有自己的计划。这就是 [毕业事件]:
</p>
<ul class="org-ul">
<li>达成的条件是，毕业的日期到了</li>
<li>条件达成后，每个同学有不同的计划</li>
</ul>
</div>

<div id="outline-container-orga0b7177" class="outline-3">
<h3 id="orga0b7177"><span class="section-number-3">18.1.</span> 如果使用一般的写法</h3>
<div class="outline-text-3" id="text-18-1">
<p>
每个同学，需要不停判断，毕业的时间有没有达成。如果达成了，就做某件事。反复判断。
</p>

<p>
自己判断，自己触发:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">A &#21516;&#23398;</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">t1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Thread</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">while</span> <span style="color: #909183;">(</span><span style="color: #008b8b;">true</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>DateTime.Now.Second % 10 == 5<span style="color: #709870;">)</span>
        <span style="color: #709870;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#32487;&#25215;&#23478;&#20135;"</span><span style="color: #907373;">)</span>;
        <span style="color: #709870;">}</span>
        Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #709870;">(</span>100<span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">B &#21516;&#23398;</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">t2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Thread</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">while</span> <span style="color: #909183;">(</span><span style="color: #008b8b;">true</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>DateTime.Now.Second % 10 == 5<span style="color: #709870;">)</span>
        <span style="color: #709870;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#22238;&#23478;&#21827;&#32769;"</span><span style="color: #907373;">)</span>;
        <span style="color: #709870;">}</span>
        Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #709870;">(</span>100<span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">C&#12289;D&#12289;E... &#21516;&#23398;&#37117;&#26159;&#30456;&#20284;&#30340;&#36923;&#36753;</span>

t1.<span style="color: #0000ff;">Start</span><span style="color: #707183;">()</span>;
t2.<span style="color: #0000ff;">Start</span><span style="color: #707183;">()</span>;

t1.<span style="color: #0000ff;">Join</span><span style="color: #707183;">()</span>;
t2.<span style="color: #0000ff;">Join</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org2338b03" class="outline-3">
<h3 id="org2338b03"><span class="section-number-3">18.2.</span> 上述的写法虽然没有错误，但是存在一些问题</h3>
<div class="outline-text-3" id="text-18-2">
<ul class="org-ul">
<li>逻辑重复严重，冗余很大</li>
<li>不停判断条件是否达成的代码过于繁琐，每个同学自己维护这段代码，有些不合理</li>
</ul>

<p>
因此，我们需要 1) 将重复的代码剥离出来 2) 条件的判断只需要交付一个专门的人处理就可以了
</p>

<p>
专人判断，集中逻辑:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">t1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Thread</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">while</span> <span style="color: #909183;">(</span><span style="color: #008b8b;">true</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>DateTime.Now.Second % 10 == 5<span style="color: #709870;">)</span>
        <span style="color: #709870;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#22238;&#23478;&#32487;&#25215;&#23478;&#20135;"</span><span style="color: #907373;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">A</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#25644;&#30742;"</span><span style="color: #907373;">)</span>;        <span style="color: #b22222;">// </span><span style="color: #b22222;">B</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#21019;&#19994;"</span><span style="color: #907373;">)</span>;        <span style="color: #b22222;">// </span><span style="color: #b22222;">C</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#22238;&#23478;&#21827;&#32769;"</span><span style="color: #907373;">)</span>;    <span style="color: #b22222;">// </span><span style="color: #b22222;">D</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#32467;&#23130;"</span><span style="color: #907373;">)</span>;        <span style="color: #b22222;">// </span><span style="color: #b22222;">E...</span>
        <span style="color: #709870;">}</span>
        Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #709870;">(</span>100<span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;
t1.<span style="color: #0000ff;">Start</span><span style="color: #707183;">()</span>;
t1.<span style="color: #0000ff;">Join</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b57f0d" class="outline-3">
<h3 id="org6b57f0d"><span class="section-number-3">18.3.</span> 上述代码虽然简洁了，但是条件和最后要执行的逻辑写在一起，耦合度太大</h3>
<div class="outline-text-3" id="text-18-3">
<p>
因此，我们需要一种方式，将它们分开。这时候我们想到，委托是实现逻辑分离最佳的工具。
</p>

<p>
专人判断，分离目标:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">BiYe</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Action</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt; <span style="color: #7388d6;">{</span> <span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#19987;&#38376;&#36127;&#36131;&#21028;&#26029;&#26465;&#20214;&#26159;&#21542;&#36798;&#25104; (&#21457;&#24067;&#20107;&#20214;&#30340; Publisher)</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">t1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Thread</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">while</span> <span style="color: #909183;">(</span><span style="color: #008b8b;">true</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>DateTime.Now.Second % 10 == 5<span style="color: #709870;">)</span>
        <span style="color: #709870;">{</span>
            <span style="color: #0000ff;">BiYe</span><span style="color: #907373;">()</span>;
        <span style="color: #709870;">}</span>
        Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #709870;">(</span>100<span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#21482;&#38656;&#35201;&#21521;&#30456;&#24212;&#22996;&#25176;&#20869;&#28155;&#21152;&#33258;&#24049;&#30340;&#35745;&#21010;&#36753; (&#35746;&#38405;&#19978;&#36848;&#20107;&#20214; Subcriber)</span>
BiYe += <span style="color: #707183;">()</span> =&gt; Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#25644;&#30742;"</span><span style="color: #707183;">)</span>;
BiYe += <span style="color: #707183;">()</span> =&gt; Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#32467;&#23130;"</span><span style="color: #707183;">)</span>;
BiYe += <span style="color: #707183;">()</span> =&gt; Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#21827;&#32769;"</span><span style="color: #707183;">)</span>;

t1.<span style="color: #0000ff;">Start</span><span style="color: #707183;">()</span>;
t1.<span style="color: #0000ff;">Join</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org714a70d" class="outline-3">
<h3 id="org714a70d"><span class="section-number-3">18.4.</span> 接下来，可以将第一段代码单独抽出来，作为单独的 Publisher，从而实现更好的分离</h3>
<div class="outline-text-3" id="text-18-4">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#20107;&#20214;&#30340;&#21457;&#24067;&#32773;&#65292;&#26292;&#38706;&#20102;&#19968;&#20010;&#21483; BiYe &#30340;&#20107;&#20214;</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Teacher</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Action</span> <span style="color: #a0522d;">BiYe</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Start</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">t1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Thread</span><span style="color: #909183;">(</span><span style="color: #709870;">()</span> =&gt;
        <span style="color: #709870;">{</span>
            <span style="color: #a020f0;">while</span> <span style="color: #907373;">(</span><span style="color: #008b8b;">true</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">{</span>
                <span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>DateTime.Now.Second % 10 == 5<span style="color: #6276ba;">)</span>
                <span style="color: #6276ba;">{</span>
                    <span style="color: #0000ff;">BiYe</span><span style="color: #858580;">()</span>;
                <span style="color: #6276ba;">}</span>
                Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #6276ba;">(</span>100<span style="color: #6276ba;">)</span>;
            <span style="color: #907373;">}</span>
        <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
        t1.<span style="color: #0000ff;">Start</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20351;&#29992;&#32773;&#65292;&#21482;&#38656;&#35201;&#35746;&#38405;&#65292;&#23436;&#20840;&#19981;&#38656;&#35201;&#20851;&#24515;&#21457;&#24067;&#32773;&#26159;&#24590;&#20040;&#23454;&#29616;&#30340;&#20869;&#22312;&#36923;&#36753;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#23436;&#32654;&#30340;&#35299;&#32806;&#21512; (&#20998;&#31163;)</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">t</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Teacher</span><span style="color: #707183;">()</span>;
t.BiYe += <span style="color: #707183;">(</span>s, e<span style="color: #707183;">)</span> =&gt; Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#22238;&#23478;&#21507;&#39277;"</span><span style="color: #707183;">)</span>;
t.BiYe += <span style="color: #707183;">(</span>s, e<span style="color: #707183;">)</span> =&gt; Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#22238;&#23478;&#25265;&#23043;"</span><span style="color: #707183;">)</span>;
t.<span style="color: #0000ff;">Start</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbec16d7" class="outline-3">
<h3 id="orgbec16d7"><span class="section-number-3">18.5.</span> 通过上述实现，我们可以看到事件是通过委托实现的，但还是有些缺点</h3>
<div class="outline-text-3" id="text-18-5">
<ul class="org-ul">
<li>Action 等名字不够直观，没法做到望文生义</li>
<li>按道理，订阅者没有权力在外部去操作 BiYe 的执行。但现在的权限控制完全做不到这样的限制</li>
</ul>

<p>
因此，C# 提供了标准的 event 关键词和 EventHandler 委托，解决上述痛点:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Teacher</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">event</span> <span style="color: #228b22;">EventHandler</span> <span style="color: #a0522d;">BiYe</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Start</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">t1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Thread</span><span style="color: #909183;">(</span><span style="color: #709870;">()</span> =&gt;
        <span style="color: #709870;">{</span>
            <span style="color: #a020f0;">while</span> <span style="color: #907373;">(</span><span style="color: #008b8b;">true</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">{</span>
                <span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>DateTime.Now.Second % 10 == 5<span style="color: #6276ba;">)</span>
                <span style="color: #6276ba;">{</span>
                    BiYe.<span style="color: #0000ff;">Invoke</span><span style="color: #858580;">(</span><span style="color: #008b8b;">null</span>, <span style="color: #008b8b;">null</span><span style="color: #858580;">)</span>;
                <span style="color: #6276ba;">}</span>
                Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #6276ba;">(</span>100<span style="color: #6276ba;">)</span>;
            <span style="color: #907373;">}</span>
        <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
        t1.<span style="color: #0000ff;">Start</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
上述的事件声明，可以扩展为属性:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">private</span> <span style="color: #228b22;">EventHandler</span> <span style="color: #a0522d;">_biye</span>;

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">event</span> <span style="color: #228b22;">EventHandler</span> <span style="color: #a0522d;">BiYe</span>;
<span style="color: #707183;">{</span>
    add
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#21487;&#20197;&#28155;&#21152;&#26356;&#22810;&#33258;&#24049;&#30340;&#36923;&#36753;"</span><span style="color: #909183;">)</span>;
        _biye += <span style="color: #008b8b;">value</span>;
    <span style="color: #7388d6;">}</span>
    remove
    <span style="color: #7388d6;">{</span>
        _biye -= <span style="color: #008b8b;">value</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8b4d25c" class="outline-3">
<h3 id="org8b4d25c"><span class="section-number-3">18.6.</span> 接下来，要考虑的是，能不能在事件触发的时候，传递一些参数</h3>
<div class="outline-text-3" id="text-18-6">
<p>
EventHandler 两个参数:
</p>
<ul class="org-ul">
<li>object sender，用来表示谁是订阅者</li>
<li>EventArgs args，用来传递一些参数</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Teacher</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">event</span> <span style="color: #228b22;">EventHandler</span> <span style="color: #a0522d;">BiYe</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Start</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">t1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Thread</span><span style="color: #909183;">(</span><span style="color: #709870;">()</span> =&gt;
        <span style="color: #709870;">{</span>
            <span style="color: #a020f0;">while</span> <span style="color: #907373;">(</span><span style="color: #008b8b;">true</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">{</span>
                <span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>DateTime.Now.Second % 10 == 5<span style="color: #6276ba;">)</span>
                <span style="color: #6276ba;">{</span>
                    <span style="color: #b22222;">// </span><span style="color: #b22222;">BiYe(this, new MyEventArgs(5));</span>
                    BiYe.<span style="color: #0000ff;">Invoke</span><span style="color: #858580;">(</span><span style="color: #a020f0;">this</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MyEventArgs</span><span style="color: #80a880;">(</span>5<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>;
                <span style="color: #6276ba;">}</span>
                Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #6276ba;">(</span>100<span style="color: #6276ba;">)</span>;
            <span style="color: #907373;">}</span>
        <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
        t1.<span style="color: #0000ff;">Start</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyEventArgs</span> : <span style="color: #228b22;">EventArgs</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">MyEventArgs</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">canshu</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Canshu = canshu;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">Canshu</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org952b77e" class="outline-2">
<h2 id="org952b77e"><span class="section-number-2">19.</span> 异常 (Exception)</h2>
<div class="outline-text-2" id="text-19">
</div>
<div id="outline-container-org8acbb25" class="outline-3">
<h3 id="org8acbb25"><span class="section-number-3">19.1.</span> 传统方式</h3>
<div class="outline-text-3" id="text-19-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#19981;&#22815;&#30452;&#35266;&#65292;&#21861;&#26159; int&#65292;&#20998;&#21035;&#26377;&#21861;&#21547;&#20041;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20195;&#30721;&#21464;&#21872;&#21990;&#20102;&#65292;&#19981;&#31616;&#27905;&#20102;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#32534;&#30721;&#38590;&#24230;&#21464;&#22823;&#20102;&#65292;&#38169;&#35823;&#30340;&#22788;&#29702;&#65292;&#24178;&#25200;&#20027;&#24178;&#36923;&#36753;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#35843;&#29992;&#36825;&#38656;&#35201;&#30693;&#36947;&#23450;&#20041;&#32773;&#65292;&#27599;&#20010;&#38169;&#35823;&#36923;&#36753;&#30340;&#21547;&#20041;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#38169;&#35823;&#30340;&#22788;&#29702;&#65292;&#19981;&#26159;&#24378;&#21046;&#24615;&#30340;&#65292;&#25152;&#20197;&#23481;&#26131;&#38544;&#34255; BUG&#65292;&#24456;&#38590;&#25490;&#26597;</span>
<span style="color: #a020f0;">static</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">Kuaijiang</span> <span style="color: #707183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">gender</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>gender == <span style="color: #8b2252;">"&#30007;"</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#20320;&#30495;&#24069;!"</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> 0;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>gender == <span style="color: #8b2252;">"&#22899;"</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#33021;&#21152;&#20320;&#24494;&#20449;&#21527;?"</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> 0;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">return</span> 111;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf237683" class="outline-3">
<h3 id="orgf237683"><span class="section-number-3">19.2.</span> 通过 Exception 提供 <b>解耦合</b> 的处理方式</h3>
<div class="outline-text-3" id="text-19-2">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">try</span>
        <span style="color: #909183;">{</span>
            <span style="color: #0000ff;">Kuaijiang</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#22899;&#23401;&#20799;"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">catch</span><span style="color: #909183;">(</span><span style="color: #228b22;">GenderTooLongException</span> <span style="color: #a0522d;">ex</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24590;&#20040;&#25630;&#30340;&#65292;&#36825;&#37117;&#33021;&#38169;&#65311;"</span> + ex.Message<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">ex</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#35843;&#29992;&#22833;&#36133;: "</span> + ex.Message<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>

        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#20570;&#20854;&#20182;&#20107;&#24773;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Kuaijiang</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">gender</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>gender.Length &gt; 2<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">GenderTooLongException</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24615;&#21035;&#24590;&#20040;&#21487;&#33021;&#22823;&#32422;2?"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>gender != <span style="color: #8b2252;">"&#30007;"</span> &amp;&amp; gender != <span style="color: #8b2252;">"&#22899;"</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">ex</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Exception</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24615;&#21035;&#38169;&#35823;"</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">throw</span> ex;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>gender == <span style="color: #8b2252;">"&#30007;"</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#20320;&#30495;&#24069;!"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>gender == <span style="color: #8b2252;">"&#22899;"</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#33021;&#21152;&#20320;&#24494;&#20449;&#21527;?"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">GenderTooLongException</span> : <span style="color: #228b22;">Exception</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">GenderTooLongException</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">message</span><span style="color: #7388d6;">)</span> : <span style="color: #a020f0;">base</span><span style="color: #7388d6;">(</span>message<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd8f87c4" class="outline-3">
<h3 id="orgd8f87c4"><span class="section-number-3">19.3.</span> 异常的嵌套，以及 finally</h3>
<div class="outline-text-3" id="text-19-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>.<span style="color: #a0522d;">Collections</span>.<span style="color: #a0522d;">Generic</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>.<span style="color: #a0522d;">IO</span>;

<span style="color: #a020f0;">namespace</span> <span style="color: #a0522d;">SampleOfException1</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">static</span> <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">validGenders</span> = <span style="color: #a020f0;">new</span><span style="color: #909183;">()</span> <span style="color: #909183;">{</span> <span style="color: #8b2252;">"&#30007;"</span>, <span style="color: #8b2252;">"&#22899;"</span> <span style="color: #909183;">}</span>;

        <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">try</span>
            <span style="color: #709870;">{</span>
                &#22840;&#22870;<span style="color: #907373;">(</span><span style="color: #8b2252;">"&#22899;&#23401;&#20799;"</span><span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"1111"</span><span style="color: #907373;">)</span>;
                <span style="color: #a020f0;">return</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">catch</span><span style="color: #709870;">(</span><span style="color: #228b22;">GenderTooLongException</span> <span style="color: #a0522d;">ex</span><span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">try</span>
                <span style="color: #907373;">{</span>
                    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"&#24590;&#20040;&#25630;&#30340;&#65292;&#36825;&#37117;&#33021;&#38169;&#65311;"</span> + ex.Message<span style="color: #6276ba;">)</span>;
                    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"22222"</span><span style="color: #6276ba;">)</span>;
                    <span style="color: #a020f0;">return</span>;
                <span style="color: #907373;">}</span>
                <span style="color: #a020f0;">catch</span>
                <span style="color: #907373;">{</span>
                    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"4444"</span><span style="color: #6276ba;">)</span>;
                <span style="color: #907373;">}</span>
                <span style="color: #a020f0;">finally</span>
                <span style="color: #907373;">{</span>
                    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #6276ba;">(</span><span style="color: #8b2252;">"666"</span><span style="color: #6276ba;">)</span>;
                <span style="color: #907373;">}</span>
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">catch</span> <span style="color: #709870;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">ex</span><span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#35843;&#29992;&#22833;&#36133;: "</span> + ex.Message<span style="color: #907373;">)</span>;
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"555"</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">finally</span>
            <span style="color: #709870;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"3333"</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>

            <span style="color: #b22222;">//</span><span style="color: #b22222;">try</span>
            <span style="color: #b22222;">//</span><span style="color: #b22222;">{</span>
            <span style="color: #b22222;">//    </span><span style="color: #b22222;">Kuaijiang("&#22899;2");</span>
            <span style="color: #b22222;">//</span><span style="color: #b22222;">}</span>
            <span style="color: #b22222;">//</span><span style="color: #b22222;">catch</span>
            <span style="color: #b22222;">//</span><span style="color: #b22222;">{</span>

            <span style="color: #b22222;">//</span><span style="color: #b22222;">}</span>
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#22840;&#22870;</span> <span style="color: #909183;">(</span><span style="color: #228b22;">string</span>  <span style="color: #a0522d;">gender</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">try</span>
            <span style="color: #709870;">{</span>
                <span style="color: #0000ff;">Kuaijiang</span><span style="color: #907373;">(</span><span style="color: #228b22;">gender</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">catch</span>
            <span style="color: #709870;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"[&#29240;&#29240;] &#21704;&#21704;&#65292;&#20986;&#38169;&#20102;&#21543;"</span><span style="color: #907373;">)</span>;
                <span style="color: #a020f0;">throw</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">finally</span>
            <span style="color: #709870;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"[&#29240;&#29240;] &#25105;&#22788;&#29702;&#23436;&#20102;!"</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Kuaijiang</span> <span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">gender</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>gender.Length &gt; 2<span style="color: #709870;">)</span>
                <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">GenderTooLongException</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24615;&#21035;&#24590;&#20040;&#21487;&#33021;&#22823;&#32422;2?"</span><span style="color: #709870;">)</span>;

            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>!validGenders.<span style="color: #0000ff;">Contains</span><span style="color: #907373;">(</span><span style="color: #228b22;">gender</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>
                <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Exception</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#24615;&#21035;&#38169;&#35823;"</span><span style="color: #709870;">)</span>;

            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>gender == <span style="color: #8b2252;">"&#30007;"</span><span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#20320;&#30495;&#24069;!"</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>gender == <span style="color: #8b2252;">"&#22899;"</span><span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#33021;&#21152;&#20320;&#24494;&#20449;&#21527;?"</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">class</span> <span style="color: #228b22;">GenderTooLongException</span> : <span style="color: #228b22;">Exception</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">GenderTooLongException</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">message</span><span style="color: #909183;">)</span> : <span style="color: #a020f0;">base</span><span style="color: #909183;">(</span>message<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org035e25c" class="outline-2">
<h2 id="org035e25c"><span class="section-number-2">20.</span> 反射和特性 (Reflection/Attribute)</h2>
<div class="outline-text-2" id="text-20">
</div>
<div id="outline-container-org255be30" class="outline-3">
<h3 id="org255be30"><span class="section-number-3">20.1.</span> 反射 (Reflection)</h3>
<div class="outline-text-3" id="text-20-1">
<ul class="org-ul">
<li>反射就是运行时查看程序集 (Assembly) 元数据 (metadata) 的行为</li>
<li>元数据，就是程序集所包含的所有的类型、属性、参数等数据</li>
<li>C# 通过 <code>System.Reflection</code> 这个命名空间下的类，给出了反射的实现</li>
<li>为了能够实现反射，运行时在运行的时候，会为每一个 Class 创建一个对应的 <code>Type</code> 类型的对象
<ul class="org-ul">
<li>typeof</li>
<li>GetType</li>
<li>assembly.GetTypes()</li>
</ul></li>
<li>类 <code>Assembly</code> 中提供了加载程序集和操作元数据的相关方法</li>
<li>可以通过辅助类 <code>Activator</code> 快速创建一个实例</li>
</ul>

<p>
正大光明的类型使用方式:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Student</span> <span style="color: #707183;">{}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">var typeofStudent = new Type(Student);</span>

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s3</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s4</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #707183;">()</span>;

s1.<span style="color: #0000ff;">SayHello</span><span style="color: #707183;">()</span>;
</pre>
</div>

<p>
创建 Assembly 的若干方法:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">ass1</span> = Assembly.<span style="color: #0000ff;">Load</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"DAL"</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">ass2</span> = Assembly.<span style="color: #0000ff;">LoadFile</span><span style="color: #707183;">(</span>@<span style="color: #8b2252;">"e:\Model.dll"</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">ass3</span> = Assembly.<span style="color: #0000ff;">LoadFrom</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"DAL"</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">ass4</span> = Assembly.<span style="color: #0000ff;">LoadFrom</span><span style="color: #707183;">(</span>@<span style="color: #8b2252;">"e:\Model.dll"</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">ass5</span> = Assembly.<span style="color: #0000ff;">GetExecutingAssembly</span><span style="color: #707183;">()</span>;

<span style="color: #228b22;">Type</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">types</span> = ass1.<span style="color: #0000ff;">GetTypes</span><span style="color: #707183;">()</span>;
<span style="color: #a020f0;">foreach</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">type</span> <span style="color: #a020f0;">in</span> types<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"Class: {type}"</span><span style="color: #7388d6;">)</span>;

    <span style="color: #228b22;">MethodInfo</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">methods</span> = type.<span style="color: #0000ff;">GetMethods</span><span style="color: #7388d6;">()</span>;
    <span style="color: #a020f0;">foreach</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">m</span> <span style="color: #a020f0;">in</span> methods<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>m<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">()</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">()</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
获取 Type 的若干方法:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0;
<span style="color: #228b22;">Type</span> <span style="color: #a0522d;">type1</span> = i.<span style="color: #0000ff;">GetType</span><span style="color: #707183;">()</span>;

<span style="color: #228b22;">Student</span> <span style="color: #a0522d;">s</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Student</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">Type</span> <span style="color: #a0522d;">type2</span> = s.<span style="color: #0000ff;">GetType</span><span style="color: #707183;">()</span>;

<span style="color: #228b22;">Type</span> <span style="color: #a0522d;">type3</span> = <span style="color: #a020f0;">typeof</span><span style="color: #707183;">(</span>Student<span style="color: #707183;">)</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">ass</span> = Assembly.<span style="color: #0000ff;">GetExecutingAssembly</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">Type</span> <span style="color: #a0522d;">type4</span> = ass.<span style="color: #0000ff;">GetTypes</span><span style="color: #707183;">()[</span>0<span style="color: #707183;">]</span>;
</pre>
</div>

<p>
通过反射的方式，动态调用方法的过程:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">ass</span> = Assembly.<span style="color: #0000ff;">GetExecutingAssembly</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">object</span> <span style="color: #a0522d;">o</span> = ass.<span style="color: #0000ff;">CreateInstance</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"SampleOfReflection.X"</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">MethodInfo</span> <span style="color: #a0522d;">m</span> = o.<span style="color: #0000ff;">GetType</span><span style="color: #707183;">()</span>.<span style="color: #0000ff;">GetMethod</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"SayHello"</span><span style="color: #707183;">)</span>;
m.<span style="color: #0000ff;">Invoke</span><span style="color: #707183;">(</span>o, <span style="color: #008b8b;">null</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org430a056" class="outline-3">
<h3 id="org430a056"><span class="section-number-3">20.2.</span> [例子] ToModelList</h3>
<div class="outline-text-3" id="text-20-2">
<p>
版本 1:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">List</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">T</span><span style="color: #707183;">&gt;</span> <span style="color: #0000ff;">ToModelList</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">T</span><span style="color: #707183;">&gt;(</span><span style="color: #a020f0;">this</span> <span style="color: #228b22;">DataTable</span> <span style="color: #a0522d;">dt</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">return</span>
        dt.Rows.<span style="color: #0000ff;">Cast</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">DataRow</span><span style="color: #7388d6;">&gt;()</span>
        .<span style="color: #0000ff;">Select</span><span style="color: #7388d6;">(</span>r =&gt;
        <span style="color: #909183;">{</span>
            <span style="color: #228b22;">T</span> <span style="color: #a0522d;">t</span> = <span style="color: #709870;">(</span><span style="color: #228b22;">T</span><span style="color: #709870;">)</span> Activator.<span style="color: #0000ff;">CreateInstance</span><span style="color: #709870;">(</span><span style="color: #a020f0;">typeof</span><span style="color: #907373;">(</span>T<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">foreach</span> <span style="color: #709870;">(</span><span style="color: #228b22;">PropertyInfo</span> <span style="color: #0000ff;">p</span> <span style="color: #a020f0;">in</span> <span style="color: #a020f0;">typeof</span><span style="color: #907373;">(</span>T<span style="color: #907373;">)</span>.<span style="color: #0000ff;">GetProperties</span><span style="color: #907373;">()</span><span style="color: #709870;">)</span>
            <span style="color: #709870;">{</span>
                p.<span style="color: #0000ff;">SetValue</span><span style="color: #907373;">(</span>t, r<span style="color: #6276ba;">[</span>p.Name.<span style="color: #0000ff;">ToLower</span><span style="color: #858580;">()</span><span style="color: #6276ba;">]</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">return</span> t;
        <span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>
        .<span style="color: #0000ff;">ToList</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
版本 2:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">List</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">T</span><span style="color: #707183;">&gt;</span> <span style="color: #0000ff;">ToModelList2</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">T</span><span style="color: #707183;">&gt;(</span><span style="color: #a020f0;">this</span> <span style="color: #228b22;">DataTable</span> <span style="color: #a0522d;">dt</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">T</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">lst</span> = <span style="color: #7388d6;">(</span><span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">T</span><span style="color: #909183;">&gt;</span><span style="color: #7388d6;">)</span>Activator
        .<span style="color: #0000ff;">CreateInstance</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">typeof</span><span style="color: #909183;">(</span><span style="color: #228b22;">List</span><span style="color: #709870;">&lt;&gt;</span><span style="color: #909183;">)</span>.<span style="color: #0000ff;">MakeGenericType</span><span style="color: #909183;">(</span><span style="color: #a020f0;">typeof</span><span style="color: #709870;">(</span>T<span style="color: #709870;">)</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>;

    <span style="color: #a020f0;">foreach</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">DataRow</span> <span style="color: #a0522d;">r</span> <span style="color: #a020f0;">in</span> dt.Rows<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">T</span> <span style="color: #a0522d;">t</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">T</span><span style="color: #909183;">)</span>Activator.<span style="color: #0000ff;">CreateInstance</span><span style="color: #909183;">(</span><span style="color: #a020f0;">typeof</span><span style="color: #709870;">(</span>T<span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">PropertyInfo</span> <span style="color: #0000ff;">p</span> <span style="color: #a020f0;">in</span> <span style="color: #a020f0;">typeof</span><span style="color: #709870;">(</span>T<span style="color: #709870;">)</span>.<span style="color: #0000ff;">GetProperties</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            p.<span style="color: #0000ff;">SetValue</span><span style="color: #709870;">(</span>t, r<span style="color: #907373;">[</span>p.Name.<span style="color: #0000ff;">ToLower</span><span style="color: #6276ba;">()</span><span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        lst.<span style="color: #0000ff;">GetType</span><span style="color: #909183;">()</span>.<span style="color: #0000ff;">GetMethod</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"Add"</span><span style="color: #909183;">)</span>.<span style="color: #0000ff;">Invoke</span><span style="color: #909183;">(</span>lst, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">object</span><span style="color: #709870;">[]</span> <span style="color: #709870;">{</span> t <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">return</span> lst;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
比较原版:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">List</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Group</span><span style="color: #707183;">&gt;</span> <span style="color: #0000ff;">ToModelList</span><span style="color: #707183;">(</span><span style="color: #228b22;">DataTable</span> <span style="color: #a0522d;">dt</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">list</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Group</span><span style="color: #7388d6;">&gt;()</span>;

    <span style="color: #a020f0;">foreach</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">DataRow</span> <span style="color: #a0522d;">r</span> <span style="color: #a020f0;">in</span> dt.Rows<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">g</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Group</span>
        <span style="color: #909183;">{</span>
            <span style="color: #a0522d;">Gno</span> = <span style="color: #709870;">(</span><span style="color: #228b22;">int</span><span style="color: #709870;">)</span>r<span style="color: #709870;">[</span><span style="color: #8b2252;">"gno"</span><span style="color: #709870;">]</span>,
            <span style="color: #a0522d;">Name</span> = <span style="color: #709870;">(</span><span style="color: #228b22;">string</span><span style="color: #709870;">)</span>r<span style="color: #709870;">[</span><span style="color: #8b2252;">"name"</span><span style="color: #709870;">]</span>,
            <span style="color: #a0522d;">Cs</span> = <span style="color: #709870;">(</span><span style="color: #228b22;">int</span><span style="color: #709870;">)</span>r<span style="color: #709870;">[</span><span style="color: #8b2252;">"cs"</span><span style="color: #709870;">]</span>,
            <span style="color: #a0522d;">Fs</span> = <span style="color: #709870;">(</span><span style="color: #228b22;">int</span><span style="color: #709870;">)</span>r<span style="color: #709870;">[</span><span style="color: #8b2252;">"fs"</span><span style="color: #709870;">]</span>
        <span style="color: #909183;">}</span>;
        list.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span>g<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">return</span> list;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org35c2611" class="outline-3">
<h3 id="org35c2611"><span class="section-number-3">20.3.</span> 特性 (Attribute)</h3>
<div class="outline-text-3" id="text-20-3">
<ul class="org-ul">
<li>特性是向程序集添加用户自定义元数据的方式</li>
<li>基本使用过程: [定义] &#x2013; 添加到 [目标 (target)] &#x2013; [消费 (consumer)]</li>
<li>定义特性，只需要继承 Attribute 即可。类的命名以 Attribute 结尾，如 MyIgnoreAttribute</li>
<li>特性的消费，需要使用反射的方式 (type.GetCustomerAttribute)</li>
<li>特性只有被消费才具备其存在的意义。其意义是在消费的时候，使用者赋予的</li>
<li>特性就像人生，定一个小目标，然后去实现它</li>
</ul>
</div>

<div id="outline-container-org297b46c" class="outline-4">
<h4 id="org297b46c"><span class="section-number-4">20.3.1.</span> 特性就是一个普通的类</h4>
<div class="outline-text-4" id="text-20-3-1">
<p>
<b>最好</b> 按照一定的命名规范来命名 (当然，你不按照命名规范，也拿你没办法):
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">RainAttribute</span> : <span style="color: #228b22;">Attribute</span> <span style="color: #707183;">{}</span>
</pre>
</div>

<p>
特新本身是没有任何意义的，但是如果我们将其放到其他的地方。
程序在编译运行的过程中，会记录这些特性 (元数据中会保留特性的信息)。
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #707183;">[</span><span style="color: #a0522d;">Rain</span><span style="color: #707183;">]</span>
<span style="color: #707183;">[</span><span style="color: #a0522d;">RainAttribute</span><span style="color: #707183;">]</span>
<span style="color: #a020f0;">class</span> Xxx <span style="color: #707183;">{}</span>  <span style="color: #b22222;">// </span><span style="color: #b22222;">- Type - &#21453;&#23556; - &#39069;&#22806;&#30340;&#20449;&#24687;&#65292;&#36825;&#20010;&#31867;&#19978;&#26377;&#20010; RainAttribute</span>


<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Yyy</span>
<span style="color: #707183;">{</span>
    <span style="color: #7388d6;">[</span><span style="color: #a0522d;">Rain</span><span style="color: #7388d6;">]</span>
    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">A</span><span style="color: #7388d6;">(){}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6455304" class="outline-4">
<h4 id="org6455304"><span class="section-number-4">20.3.2.</span> 通过反射得到它的实例，然后就可以使用了</h4>
<div class="outline-text-4" id="text-20-3-2">
<p>
在使用反射方式，处理相关逻辑的时候，就可以借题发挥、指鹿为马了:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">rt</span> = type.<span style="color: #0000ff;">GetCustomerAttribute</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">RainAttribute</span><span style="color: #707183;">&gt;()</span>;
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#26082;&#28982;&#19978;&#38754;&#26377;&#36825;&#20010;&#65292;&#37027;&#20040;&#30340;&#35805;&#65292;&#35828;&#26126;&#36825;&#20010;&#31867;&#26159;&#19981;&#33021;&#34987;...&#30340;&#65292;&#33021;&#34987;...&#30340;</span>

<span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span>rt<span style="color: #707183;">)</span> &#19981;&#23454;&#20363;&#21270;;
<span style="color: #a020f0;">if</span> <span style="color: #707183;">(</span>rt<span style="color: #707183;">)</span> &#23454;&#20363;&#21270;&#30340;&#26102;&#20505;&#65292;&#35760;&#24405;&#26085;&#24535;;

<span style="color: #8b2252;">//// &#33719;&#21462;&#26041;&#27861;&#19978;&#38754;&#30340;&#29305;&#24615;</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">mType</span> = yType.<span style="color: #0000ff;">GetMethod</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"A"</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">rt2</span> = mType.<span style="color: #0000ff;">GetCustomerAttribute</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">RainAttribute</span><span style="color: #707183;">&gt;()</span>;
</pre>
</div>
</div>
</div>
</div>
</section>

<section id="outline-container-org176af74" class="outline-2">
<h2 id="org176af74"><span class="section-number-2">21.</span> 依赖注入 (DI/IoC)</h2>
<div class="outline-text-2" id="text-21">
</div>
<div id="outline-container-org52ee22f" class="outline-3">
<h3 id="org52ee22f"><span class="section-number-3">21.1.</span> 正常手段</h3>
<div class="outline-text-3" id="text-21-1">
<p>
很多时候，创建一个对象，可能并没有你想象的那么简单:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">Form1 &#21487;&#33021;&#23384;&#22312;&#22823;&#37327;&#30340;&#8220;&#20381;&#36182;&#8221;</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">f</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Form1</span><span style="color: #707183;">()</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20026;&#20102;&#26500;&#36896;&#20986;&#23436;&#25972;&#30340; Form1&#65292;&#23601;&#38656;&#35201;&#20808;&#26500;&#36896;&#20986;&#23427;&#25152;&#26377;&#30340;&#20197;&#26469;&#65292;&#20197;&#21450;&#20381;&#36182;&#30340;&#20381;&#36182;</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">sbll</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StudentBLL</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">sdal</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StudentDAL</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">dbhelp</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">DbHelper</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">gbll</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">GroupBLL</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">gdal</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">GroupDAL</span><span style="color: #707183;">()</span>;
sbll.dal = sdal;
gbll.dal = gdal;
sdal.dbhelper = dbhelp;
gdal.dbhelper = dbhelp;
f.sbll = sbll;
f.gbll = gbll;
</pre>
</div>

<p>
那么本着一个最基本，最朴素的愿望: 简化上述依赖对象的创建。于是就有了 DI 框架。
</p>
</div>
</div>

<div id="outline-container-org6b77f67" class="outline-3">
<h3 id="org6b77f67"><span class="section-number-3">21.2.</span> DI/IoC</h3>
<div class="outline-text-3" id="text-21-2">
<p>
使用一个容器管理所有实例:
</p>
<ul class="org-ul">
<li>DI: Dependency Injection, 依赖注入</li>
<li>IoC: Inversion of Control, 控制反转</li>
</ul>

<p>
.NET 上相关的 DI 容器:
</p>
<ul class="org-ul">
<li>Microsft Dependency Injection (.Net Core Container)</li>
<li>Autofac</li>
<li>DryIoc</li>
<li>Grace</li>
<li>LightInject</li>
<li>Lamar</li>
<li>Stashbox</li>
<li>Unity</li>
</ul>

<p>
.Net Core Container 的特点:
</p>
<ul class="org-ul">
<li>轻量、高效</li>
<li>简单、快速</li>
<li>支持三种生命周期 (Transient/Singleton/Scope)</li>
<li>支持构造器注入 (Constructor Injection)</li>
</ul>

<p>
.Net Core Container 缺失的功能:
</p>
<ul class="org-ul">
<li>属性或方法注入 (Property/Method Injection)</li>
<li>通过名字注入 (Injection Base on name or key)</li>
<li>子容器 (child container)</li>
<li>定制生命周期 (custom lifetime)</li>
<li>基于规则注册 (Convention-based registration)</li>
<li>缺乏 Lazy Initialize 功能</li>
</ul>
</div>
</div>

<div id="outline-container-org10164ab" class="outline-3">
<h3 id="org10164ab"><span class="section-number-3">21.3.</span> 基本使用</h3>
<div class="outline-text-3" id="text-21-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">container</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ServiceCollection</span><span style="color: #707183;">()</span>
    .<span style="color: #0000ff;">AddSingleton</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Dog</span><span style="color: #707183;">&gt;()</span>
    .<span style="color: #0000ff;">AddSingleton</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Cat</span><span style="color: #707183;">&gt;()</span>
    .<span style="color: #0000ff;">AddSingleton</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Teacher</span><span style="color: #707183;">&gt;()</span>
    .<span style="color: #0000ff;">AddSingleton</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Student</span><span style="color: #707183;">&gt;()</span>
    .<span style="color: #0000ff;">AddSingleton</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Pet</span><span style="color: #707183;">&gt;()</span>
    .<span style="color: #0000ff;">AddTransient</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Class</span><span style="color: #707183;">&gt;()</span>
    .<span style="color: #0000ff;">BuildServiceProvider</span><span style="color: #707183;">()</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">c1</span> = container.<span style="color: #0000ff;">GetService</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Class</span><span style="color: #707183;">&gt;()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#10003;</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">c2</span> = container.<span style="color: #0000ff;">GetService</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Class</span><span style="color: #707183;">&gt;()</span>;

c1.<span style="color: #0000ff;">Say</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd43b4c0" class="outline-3">
<h3 id="orgd43b4c0"><span class="section-number-3">21.4.</span> 三种生命周期</h3>
<div class="outline-text-3" id="text-21-4">
<p>
Object Lifetime:
</p>
<ol class="org-ol">
<li>Transient, 暂时的</li>
<li>Singleton, 单例的，是在第一次 Get 的时候创建的</li>
<li>Scope, 基于作用域的，在同一作用域内，是单例的。作用域结束会释放掉</li>
</ol>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">ServiceCollection</span> <span style="color: #a0522d;">sc</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ServiceCollection</span><span style="color: #707183;">()</span>;
sc.<span style="color: #0000ff;">AddSingleton</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Teacher</span><span style="color: #707183;">&gt;()</span>;
sc.<span style="color: #0000ff;">AddSingleton</span><span style="color: #707183;">(</span><span style="color: #a020f0;">typeof</span><span style="color: #7388d6;">(</span>Student<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
sc.<span style="color: #0000ff;">AddTransient</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Dog</span><span style="color: #707183;">&gt;()</span>;
sc.<span style="color: #0000ff;">AddScoped</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Cat</span><span style="color: #707183;">&gt;()</span>;
<span style="color: #228b22;">ServiceProvider</span> <span style="color: #a0522d;">container</span> = sc.<span style="color: #0000ff;">BuildServiceProvider</span><span style="color: #707183;">()</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">Singleton</span>
<span style="color: #228b22;">Teacher</span> <span style="color: #a0522d;">t1</span> = container.<span style="color: #0000ff;">GetService</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Teacher</span><span style="color: #707183;">&gt;()</span>;
<span style="color: #228b22;">Teacher</span> <span style="color: #a0522d;">t2</span> = container.<span style="color: #0000ff;">GetService</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Teacher</span><span style="color: #707183;">&gt;()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"t1: {t1}, t2: {t2}, {object.ReferenceEquals(t1, t2)}"</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">Transient</span>
<span style="color: #228b22;">Dog</span> <span style="color: #a0522d;">d1</span> = container.<span style="color: #0000ff;">GetService</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Dog</span><span style="color: #707183;">&gt;()</span>;
<span style="color: #228b22;">Dog</span> <span style="color: #a0522d;">d2</span> = container.<span style="color: #0000ff;">GetService</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Dog</span><span style="color: #707183;">&gt;()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"d1: {d1}, d2: {d2}, {d1 == d2}"</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">Scope</span>
<span style="color: #a020f0;">using</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">scope1</span> = container.<span style="color: #0000ff;">CreateScope</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">Cat</span> <span style="color: #a0522d;">s1</span> = scope1.ServiceProvider.<span style="color: #0000ff;">GetService</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Cat</span><span style="color: #7388d6;">&gt;()</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>s1.<span style="color: #0000ff;">GetHashCode</span><span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;

    <span style="color: #228b22;">Cat</span> <span style="color: #a0522d;">s2</span> = scope1.ServiceProvider.<span style="color: #0000ff;">GetService</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Cat</span><span style="color: #7388d6;">&gt;()</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>s2.<span style="color: #0000ff;">GetHashCode</span><span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">using</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">scope2</span> = container.<span style="color: #0000ff;">CreateScope</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">Cat</span> <span style="color: #a0522d;">s3</span> = scope2.ServiceProvider.<span style="color: #0000ff;">GetService</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Cat</span><span style="color: #7388d6;">&gt;()</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>s3.<span style="color: #0000ff;">GetHashCode</span><span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
<span style="color: #228b22;">Cat</span> <span style="color: #a0522d;">s4</span> = container.<span style="color: #0000ff;">GetService</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Cat</span><span style="color: #707183;">&gt;()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s4.<span style="color: #0000ff;">GetHashCode</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">Cat</span> <span style="color: #a0522d;">s5</span> = container.<span style="color: #0000ff;">GetService</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">Cat</span><span style="color: #707183;">&gt;()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s5.<span style="color: #0000ff;">GetHashCode</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org241ceb1" class="outline-3">
<h3 id="org241ceb1"><span class="section-number-3">21.5.</span> 高内聚低耦合</h3>
<div class="outline-text-3" id="text-21-5">
<p>
面向对象编程的基本方针 <b>高内聚*，*低耦合</b> (SOLID):
</p>
<ul class="org-ul">
<li>开闭原则 (Open-Close Principle)，对扩展开放，对修改关闭</li>
<li>单一职责原则 (Single-Responsibility Principle)，一个类，只干一件事</li>
<li>里氏替换原则 (Liskov Substitution Principle)</li>
<li>依赖倒置原则 (Dependence Inversion Principle), 程序要依赖于抽象接口，不要依赖于具体实现</li>
<li>接口分离原则 (Interface Segregation PrincipleISP)</li>
</ul>

<p>
OCP:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Greet</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"Hello"</span><span style="color: #909183;">)</span>;<span style="color: #7388d6;">}</span>
    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">GreetJP</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span> Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"wawawawa"</span><span style="color: #909183;">)</span>;<span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Greet</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>...<span style="color: #909183;">)</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>...<span style="color: #909183;">)</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
        <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>...<span style="color: #909183;">)</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">round-1</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">As</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">Dictionary</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">string</span>, <span style="color: #228b22;">string</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">dics</span> = <span style="color: #a020f0;">new</span><span style="color: #7388d6;">()</span>;
    <span style="color: #a020f0;">static</span> As <span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        dics.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"jp"</span>, <span style="color: #8b2252;">"wawawa"</span><span style="color: #909183;">)</span>;
        dics.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"en"</span>, <span style="color: #8b2252;">"hello"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">A2</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Greet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">message</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">message</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">GreetBy</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">who</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">string</span> <span style="color: #a0522d;">message</span> = As.dics<span style="color: #909183;">[</span>who<span style="color: #909183;">]</span>;
        <span style="color: #0000ff;">Greet</span><span style="color: #909183;">(</span><span style="color: #228b22;">message</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">round-2</span>
<span style="color: #a020f0;">interface</span> <span style="color: #228b22;">IGreeter</span> <span style="color: #707183;">{</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Greet</span><span style="color: #7388d6;">()</span>; <span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">EnglishGreeter</span> : <span style="color: #228b22;">IGreeter</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Greet</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">new EnglishGreeter().Greet();</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">JPGreeter</span> : <span style="color: #228b22;">IGreeter</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Greet</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"baga"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">new JPGreeter().Greet();</span>
</pre>
</div>

<p>
LSP:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Banji161</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">Yanjiusheng</span> <span style="color: #a0522d;">xxx</span>;
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">Banji161</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Yanjiusheng</span> <span style="color: #a0522d;">x</span><span style="color: #7388d6;">)</span> =&gt; xxx = x; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#27169;&#31946;&#21270;</span>

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Teach</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        xxx.<span style="color: #0000ff;">Teach</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">new Banji161(xx).Teach();</span>

<span style="color: #a020f0;">interface</span> <span style="color: #228b22;">ITeachable</span> <span style="color: #707183;">{</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Teach</span><span style="color: #7388d6;">()</span>; <span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Yanjiusheng</span> : <span style="color: #228b22;">ITeachable</span> <span style="color: #707183;">{</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Teach</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>...<span style="color: #7388d6;">}</span>; <span style="color: #707183;">}</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Banji161</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">ITeachable</span> <span style="color: #a0522d;">xxx</span>;
    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">Banji161</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ITeachable</span> <span style="color: #a0522d;">x</span><span style="color: #7388d6;">)</span> =&gt; xxx = x;

    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Teach</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        xxx.<span style="color: #0000ff;">Teach</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">new Banji161(new Yanjiusheng()).Teach();</span>
<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Boshisheng</span> : <span style="color: #228b22;">ITeachable</span> <span style="color: #707183;">{</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Teach</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>...<span style="color: #7388d6;">}</span>; <span style="color: #707183;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">new Banji161(new Boshisheng()).Teach();</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org4c40ce0" class="outline-2">
<h2 id="org4c40ce0"><span class="section-number-2">22.</span> 异步编程</h2>
<div class="outline-text-2" id="text-22">
</div>
<div id="outline-container-org44a15e9" class="outline-3">
<h3 id="org44a15e9"><span class="section-number-3">22.1.</span> Process</h3>
<div class="outline-text-3" id="text-22-1">
<ul class="org-ul">
<li>点击打开程序，会自动创建进程</li>
<li>通过代码的形式，创建进行</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">Process</span> <span style="color: #a0522d;">np</span> = Process.<span style="color: #0000ff;">Start</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"notepad.exe"</span><span style="color: #707183;">)</span>;

np.<span style="color: #0000ff;">Kill</span><span style="color: #707183;">()</span>;
np.<span style="color: #0000ff;">CloseMainWindow</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdbe9107" class="outline-3">
<h3 id="orgdbe9107"><span class="section-number-3">22.2.</span> Thread</h3>
<div class="outline-text-3" id="text-22-2">
<p>
C# 1.0 中加入的。
</p>

<p>
基本语法:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">Thread</span> <span style="color: #a0522d;">t</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Thread</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;
t.<span style="color: #0000ff;">Start</span><span style="color: #707183;">()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"world"</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">Thread</span> <span style="color: #a0522d;">tc</span> = Thread.CurrentThread;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"{t.ManagedThreadId} / {t.Name} / {t.IsAlive} / {t.IsBackground}"</span><span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"{tc.ManagedThreadId} / {tc.Name} / {tc.IsAlive} / {tc.IsBackground}"</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
例子:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">Thread</span> <span style="color: #a0522d;">t</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Thread</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"-"</span><span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;
t.<span style="color: #0000ff;">Start</span><span style="color: #707183;">()</span>;
<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"+"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">()</span>;
</pre>
</div>

<p>
线程之间可以共享数据:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">bool</span> <span style="color: #a0522d;">isFinished</span> = <span style="color: #008b8b;">false</span>;

    <span style="color: #228b22;">Thread</span> <span style="color: #a0522d;">t1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Thread</span><span style="color: #7388d6;">(</span><span style="color: #909183;">()</span> =&gt;
    <span style="color: #909183;">{</span>
        <span style="color: #a020f0;">while</span> <span style="color: #709870;">(</span>!isFinished<span style="color: #709870;">)</span> <span style="color: #709870;">{</span> <span style="color: #709870;">}</span>

        <span style="color: #a020f0;">for</span> <span style="color: #709870;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #709870;">)</span>
        <span style="color: #709870;">{</span>
            Console.<span style="color: #0000ff;">Write</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"-"</span><span style="color: #907373;">)</span>;
        <span style="color: #709870;">}</span>
    <span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>;

    <span style="color: #228b22;">Thread</span> <span style="color: #a0522d;">t2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Thread</span><span style="color: #7388d6;">(</span><span style="color: #909183;">()</span> =&gt;
    <span style="color: #909183;">{</span>
        <span style="color: #a020f0;">for</span> <span style="color: #709870;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #709870;">)</span>
        <span style="color: #709870;">{</span>
            Console.<span style="color: #0000ff;">Write</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"*"</span><span style="color: #907373;">)</span>;
        <span style="color: #709870;">}</span>
        isFinished = <span style="color: #008b8b;">true</span>;
    <span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>;

    t1.<span style="color: #0000ff;">Start</span><span style="color: #7388d6;">()</span>;
    t2.<span style="color: #0000ff;">Start</span><span style="color: #7388d6;">()</span>;

    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"+"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
线程是不是一定能让任务变快:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">Stopwatch</span> <span style="color: #a0522d;">sw</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Stopwatch</span><span style="color: #707183;">()</span>;
sw.<span style="color: #0000ff;">Start</span><span style="color: #707183;">()</span>;
<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 100000000; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">j</span> = 111110;
    Math.<span style="color: #0000ff;">Pow</span><span style="color: #7388d6;">(</span>j, j<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>sw.Elapsed<span style="color: #707183;">)</span>;


<span style="color: #228b22;">Stopwatch</span> <span style="color: #a0522d;">sw</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Stopwatch</span><span style="color: #707183;">()</span>;
sw.<span style="color: #0000ff;">Start</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">Thread</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">ts</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Thread</span><span style="color: #707183;">[</span>10000000<span style="color: #707183;">]</span>;
<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000000; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">t</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Thread</span><span style="color: #7388d6;">(</span><span style="color: #909183;">()</span> =&gt;
    <span style="color: #909183;">{</span>
        <span style="color: #a020f0;">for</span> <span style="color: #709870;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10; i++<span style="color: #709870;">)</span>
        <span style="color: #709870;">{</span>
            <span style="color: #228b22;">int</span> <span style="color: #a0522d;">j</span> = 111110;
            Math.<span style="color: #0000ff;">Pow</span><span style="color: #907373;">(</span>j, j<span style="color: #907373;">)</span>;
        <span style="color: #709870;">}</span>
    <span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>;
    ts<span style="color: #7388d6;">[</span>i<span style="color: #7388d6;">]</span> = t;
    t.<span style="color: #0000ff;">Start</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">foreach</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">t</span> <span style="color: #a020f0;">in</span> ts<span style="color: #707183;">)</span> t.<span style="color: #0000ff;">Join</span><span style="color: #707183;">()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>sw.Elapsed<span style="color: #707183;">)</span>;
</pre>
</div>

<p>
创建很多线程：
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 1000000; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">t</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Thread</span><span style="color: #7388d6;">(</span><span style="color: #909183;">()</span> =&gt;
    <span style="color: #909183;">{</span>
        Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #709870;">(</span>2222222<span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>;
    t.<span style="color: #0000ff;">Start</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"..."</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org0aef5ab" class="outline-3">
<h3 id="org0aef5ab"><span class="section-number-3">22.3.</span> ThreadPool</h3>
<div class="outline-text-3" id="text-22-3">
<p>
C# 2.0 出现线程池。(IoC/DI)
</p>

<div class="org-src-container">
<pre class="src src-csharp">ThreadPool.<span style="color: #0000ff;">QueueUserWorkItem</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"world"</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org4fffd68" class="outline-3">
<h3 id="org4fffd68"><span class="section-number-3">22.4.</span> TPL (Task-Parallel Libary)</h3>
<div class="outline-text-3" id="text-22-4">
<p>
C# 3/4 版本中，出现了更高一层的抽象:
</p>
<ul class="org-ul">
<li>Thread 是一种昂贵的资源，创建和销毁和维护需要时间，而且需要空间 (1M)</li>
<li>因此，充分利用 Thread 的方式，就是创建一个 Pool 来反复使用</li>
<li>但是通过 Pool 的方式，不能够充分屏蔽线程的操作细节，但是 Pool 提供的 API 过于简陋</li>
<li>因此，通过进一步抽象，使用 Task 概念来暴露线程需要完成的工作。
Task 交给背后的 Pool 之后，通过一定的线程调度机制，会使用 Pool 提供的某个线程，
去执行 Task 中的逻辑。</li>
<li>Task 对象用来表示包含了异步逻辑，以及异步的执行结果的对象。Task 可以组合。
我们可以将大任务，分成若干小任务，小任务完成之后组合成大任务。</li>
</ul>
</div>

<div id="outline-container-org42065bf" class="outline-4">
<h4 id="org42065bf"><span class="section-number-4">22.4.1.</span> Task.Run</h4>
<div class="outline-text-4" id="text-22-4-1">
<p>
基本使用:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"-"</span><span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">//</span><span style="color: #b22222;">Task.WaitAll(t1, t2);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Task.WaitAny(t1, t2);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">t1.Wait(); // &#38459;&#22622;&#24403;&#21069;&#32447;&#31243;</span>

<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"+"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
带返回值的使用:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">Promise Style</span>
<span style="color: #228b22;">Task</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;</span> <span style="color: #a0522d;">t</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #228b22;">StringBuilder</span> <span style="color: #a0522d;">sb</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #909183;">()</span>;
    <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        sb.<span style="color: #0000ff;">Append</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"-"</span><span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>
    <span style="color: #a020f0;">return</span> Task.<span style="color: #0000ff;">FromResult</span><span style="color: #909183;">(</span>sb.<span style="color: #0000ff;">ToString</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>t.Result<span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31561;&#24453;&#20219;&#21153;&#23436;&#25104;&#65292;&#38459;&#22622;&#24403;&#21069;</span>

<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"+"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
简化:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">Task</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;</span> <span style="color: #a0522d;">t</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">sb</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #909183;">()</span>;
    <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        sb.<span style="color: #0000ff;">Append</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"-"</span><span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>
    <span style="color: #a020f0;">return</span> sb.<span style="color: #0000ff;">ToString</span><span style="color: #909183;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">this one</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"+"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>t.Result<span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31561;&#24453;&#20219;&#21153;&#23436;&#25104;&#65292;&#38459;&#22622;&#24403;&#21069;</span>
</pre>
</div>

<p>
带 CancellationToken 的 Task.Run:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">cts</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">CancellationTokenSource</span><span style="color: #707183;">()</span>;
cts.<span style="color: #0000ff;">CancelAfter</span><span style="color: #707183;">(</span>1000<span style="color: #707183;">)</span>;
cts.Token.<span style="color: #0000ff;">Register</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt; Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"jieshule"</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Task t = Task.Run(() =&gt;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">{</span>
    <span style="color: #b22222;">//     </span><span style="color: #b22222;">for (int i = 0; i &lt; 10000; i++)</span>
    <span style="color: #b22222;">//     </span><span style="color: #b22222;">{</span>
    <span style="color: #b22222;">//         </span><span style="color: #b22222;">cts.Token.ThrowIfCancellationRequested();</span>
    <span style="color: #b22222;">//         </span><span style="color: #b22222;">Console.Write("O");</span>
    <span style="color: #b22222;">//     </span><span style="color: #b22222;">}</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">}, cts.Token);</span>

    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">i</span> = 0;
    <span style="color: #b22222;">//</span><span style="color: #b22222;">while (!cts.Token.IsCancellationRequested &amp;&amp; i++ &lt; 10000)</span>
    <span style="color: #b22222;">//</span><span style="color: #b22222;">{ </span>
    <span style="color: #b22222;">//    </span><span style="color: #b22222;">Console.Write("O");</span>
    <span style="color: #b22222;">//</span><span style="color: #b22222;">}</span>

    <span style="color: #a020f0;">do</span>
    <span style="color: #909183;">{</span>
        cts.Token.<span style="color: #0000ff;">ThrowIfCancellationRequested</span><span style="color: #709870;">()</span>;
        Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"O"</span><span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span> <span style="color: #a020f0;">while</span> <span style="color: #909183;">(</span>i++ &lt; 1000<span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span>, cts.Token<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>i == 5<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        cts.<span style="color: #0000ff;">Cancel</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
    Console.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"+"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgee0881f" class="outline-4">
<h4 id="orgee0881f"><span class="section-number-4">22.4.2.</span> 其他创建任务的方式</h4>
<div class="outline-text-4" id="text-22-4-2">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TaskFactory</span><span style="color: #707183;">()</span>.<span style="color: #0000ff;">StartNew</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"-"</span><span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"+"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Task</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"-"</span><span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span>, TaskCreationOptions.LongRunning<span style="color: #707183;">)</span>;
t.<span style="color: #0000ff;">Start</span><span style="color: #707183;">()</span>;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10000; i++<span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        Console.<span style="color: #0000ff;">Write</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"-"</span><span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>
    Task.<span style="color: #0000ff;">Run</span><span style="color: #909183;">(</span><span style="color: #709870;">()</span> =&gt;
    <span style="color: #709870;">{</span>
        Console.<span style="color: #0000ff;">Write</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"%"</span><span style="color: #907373;">)</span>;
        Task.<span style="color: #0000ff;">Run</span><span style="color: #907373;">(</span><span style="color: #6276ba;">()</span> =&gt;
        <span style="color: #6276ba;">{</span>
            Console.<span style="color: #0000ff;">Write</span><span style="color: #858580;">(</span><span style="color: #8b2252;">"$"</span><span style="color: #858580;">)</span>;
        <span style="color: #6276ba;">}</span><span style="color: #907373;">)</span>;
    <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org9776dc9" class="outline-4">
<h4 id="org9776dc9"><span class="section-number-4">22.4.3.</span> 任务协作</h4>
<div class="outline-text-4" id="text-22-4-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t1</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25343;&#25195;&#25226;"</span><span style="color: #909183;">)</span>;
    <span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t2</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #909183;">(</span><span style="color: #709870;">()</span> =&gt;
    <span style="color: #709870;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"&#25195;&#22320;"</span><span style="color: #907373;">)</span>;
        <span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t3</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #907373;">(</span><span style="color: #6276ba;">()</span> =&gt;
        <span style="color: #6276ba;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #858580;">(</span><span style="color: #8b2252;">"&#38598;&#21512;"</span><span style="color: #858580;">)</span>;
            <span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t4</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #858580;">(</span><span style="color: #80a880;">()</span> =&gt;
            <span style="color: #80a880;">{</span>
                Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #887070;">(</span><span style="color: #8b2252;">"&#21507;&#39277;"</span><span style="color: #887070;">)</span>;
            <span style="color: #80a880;">}</span><span style="color: #858580;">)</span>;
        <span style="color: #6276ba;">}</span><span style="color: #907373;">)</span>;
    <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;
t1.<span style="color: #0000ff;">Wait</span><span style="color: #707183;">()</span>;
</pre>
</div>

<p>
使用 ContinueWith 简化:
</p>
<div class="org-src-container">
<pre class="src src-csharp">Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25343;&#25195;&#25226;"</span><span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>.<span style="color: #0000ff;">ContinueWith</span><span style="color: #707183;">(</span><span style="color: #7388d6;">(</span>s<span style="color: #7388d6;">)</span> =&gt;
<span style="color: #7388d6;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25195;&#22320;"</span><span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>.<span style="color: #0000ff;">ContinueWith</span><span style="color: #707183;">(</span><span style="color: #7388d6;">(</span>s<span style="color: #7388d6;">)</span> =&gt;
<span style="color: #7388d6;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#38598;&#21512;"</span><span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>.<span style="color: #0000ff;">ContinueWith</span><span style="color: #707183;">(</span><span style="color: #7388d6;">(</span>s<span style="color: #7388d6;">)</span> =&gt;
<span style="color: #7388d6;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#21507;&#39277;"</span><span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>.<span style="color: #0000ff;">Wait</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7449fd7" class="outline-3">
<h3 id="org7449fd7"><span class="section-number-3">22.5.</span> TAL (Task-based Asyncronize Pattern)</h3>
<div class="outline-text-3" id="text-22-5">
<p>
C# 5 中，出现了 async/await 关键词:
</p>
<ul class="org-ul">
<li>*异步方法*，需要使用 <code>async</code> 来修饰
<ul class="org-ul">
<li>返回值必须是 Task 或者 Task&lt;T&gt; (有些情况下可以返回 void),</li>
<li>参数不能是 ref/out 类型,</li>
<li>方法名，按照约定，最好是以 Async 结尾</li>
</ul></li>
<li><code>await</code> 关键词，只能用于 async 修饰的方法内:
<ul class="org-ul">
<li>await 关键词后面跟着的是 awaitable 类型 (实现了 GetAwaiter 方法的类型) 的对象</li>
<li>我们一般来说，没有必要手动创建 awaitable 对象，而是直接使用 Task</li>
<li>await 会检查后面的 awaitable 对象的状态:
<ul class="org-ul">
<li>如果它已经完成，那么拿到返回结果之后继续</li>
<li>如果没有完成，将当前异步方法 *挂起*，然后返回调用这个异步方法的方法继续执行。
如果后续 awaitable 状态变更为完成的话，异步方法将会被 *恢复*，并继续执行接下来的逻辑</li>
</ul></li>
</ul></li>
<li>异步方法的调用，本身不会创建任何线程的</li>
</ul>


<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">static</span> <span style="color: #a020f0;">async</span> <span style="color: #228b22;">Task</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">int</span><span style="color: #707183;">&gt;</span> <span style="color: #0000ff;">GetUrlContentLengthAsync</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">client</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HttpClient</span><span style="color: #7388d6;">()</span>;

    <span style="color: #228b22;">Task</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">getStringTask</span> =
        client.<span style="color: #0000ff;">GetStringAsync</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"https://docs.microsoft.com/dotnet"</span><span style="color: #7388d6;">)</span>;

    <span style="color: #0000ff;">DoIndependentWork</span><span style="color: #7388d6;">()</span>;

    <span style="color: #228b22;">string</span> <span style="color: #a0522d;">contents</span> = <span style="color: #a020f0;">await</span> getStringTask; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#39764;&#27861;&#20043;&#28304;&#12290;&#22914;&#26524;&#20219;&#21153;&#27809;&#32467;&#26463;&#65292;&#25226;&#26041;&#27861;&#25346;&#36215;&#26469;</span>

    <span style="color: #228b22;">string</span> <span style="color: #a0522d;">cbaidu</span> = <span style="color: #a020f0;">await</span> client.<span style="color: #0000ff;">GetStringAsync</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"https://www.baidu.com"</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"&#30334;&#24230;&#30340;&#35775;&#38382;&#32467;&#26463;: {cbaidu.Length}"</span><span style="color: #7388d6;">)</span>;

    <span style="color: #228b22;">string</span> <span style="color: #a0522d;">cbing</span> = <span style="color: #a020f0;">await</span> client.<span style="color: #0000ff;">GetStringAsync</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"https://bing.com"</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"bing&#30340;&#35775;&#38382;&#32467;&#26463;: {cbing.Length}"</span><span style="color: #7388d6;">)</span>;

    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"Finished."</span><span style="color: #7388d6;">)</span>;

    <span style="color: #a020f0;">return</span> contents.Length;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">static</span> <span style="color: #a020f0;">async</span> <span style="color: #228b22;">Task</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"111"</span><span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">Task</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">int</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">t</span> = <span style="color: #0000ff;">GetUrlContentLengthAsync</span><span style="color: #7388d6;">()</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"222"</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">await</span> <span style="color: #228b22;">t</span><span style="color: #7388d6;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">Console.WriteLine(t.Result);</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4f504a1" class="outline-3">
<h3 id="org4f504a1"><span class="section-number-3">22.6.</span> Parallel</h3>
<div class="outline-text-3" id="text-22-6">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">//</span><span style="color: #b22222;">for (int i = 0; i &lt; 1000; i++)</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">{</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">Console.WriteLine(i);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">}</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">Task.WaitAll(</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">Enumerable.Range(0, 1000)</span>
<span style="color: #b22222;">//        </span><span style="color: #b22222;">.Select(n =&gt; Task.Run(() =&gt; Console.WriteLine(n)))</span>
<span style="color: #b22222;">//        </span><span style="color: #b22222;">.ToArray()</span>
<span style="color: #b22222;">//        </span><span style="color: #b22222;">);</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">Parallel.For(0, 1000, (n) =&gt;</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">{</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">Console.WriteLine(n);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">});</span>

<span style="color: #228b22;">List</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">int</span><span style="color: #707183;">&gt;</span> <span style="color: #a0522d;">numbers</span> = Enumerable.<span style="color: #0000ff;">Range</span><span style="color: #707183;">(</span>0, 1000<span style="color: #707183;">)</span>.<span style="color: #0000ff;">ToList</span><span style="color: #707183;">()</span>;
<span style="color: #b22222;">//</span><span style="color: #b22222;">foreach (var n in numbers) Console.WriteLine(n);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Parallel.ForEach(numbers, (n) =&gt; Console.WriteLine(n));</span>

Parallel.<span style="color: #0000ff;">Invoke</span><span style="color: #707183;">(</span>
    <span style="color: #7388d6;">()</span> =&gt;
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">double</span> <span style="color: #a0522d;">ii</span> = 0;
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 100000; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Task.<span style="color: #0000ff;">Delay</span><span style="color: #709870;">(</span>10<span style="color: #709870;">)</span>.<span style="color: #0000ff;">Wait</span><span style="color: #709870;">()</span>;
            ii += Math.<span style="color: #0000ff;">Pow</span><span style="color: #709870;">(</span>i, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Random</span><span style="color: #907373;">()</span>.<span style="color: #0000ff;">Next</span><span style="color: #907373;">(</span>50<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{Task.CurrentId} &#35745;&#31639;&#23436;&#27605;: {ii}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>,
    <span style="color: #7388d6;">()</span> =&gt;
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 100000; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Task.<span style="color: #0000ff;">Delay</span><span style="color: #709870;">(</span>10<span style="color: #709870;">)</span>.<span style="color: #0000ff;">Wait</span><span style="color: #709870;">()</span>;
            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">ii</span> = Math.<span style="color: #0000ff;">Pow</span><span style="color: #709870;">(</span>i, i * i + 3<span style="color: #709870;">)</span> - 1000;
        <span style="color: #909183;">}</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{Task.CurrentId} &#35745;&#31639;&#23436;&#27605;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>,
    <span style="color: #7388d6;">()</span> =&gt;
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 100000; i++<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Task.<span style="color: #0000ff;">Delay</span><span style="color: #709870;">(</span>10<span style="color: #709870;">)</span>.<span style="color: #0000ff;">Wait</span><span style="color: #709870;">()</span>;
            <span style="color: #228b22;">double</span> <span style="color: #a0522d;">ii</span> = Math.<span style="color: #0000ff;">Pow</span><span style="color: #709870;">(</span>i, i * i<span style="color: #709870;">)</span> / 3;
        <span style="color: #909183;">}</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{Task.CurrentId} &#35745;&#31639;&#23436;&#27605;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org05ddd87" class="outline-3">
<h3 id="org05ddd87"><span class="section-number-3">22.7.</span> 任务的同步和协作</h3>
<div class="outline-text-3" id="text-22-7">
</div>
<div id="outline-container-org17ea04d" class="outline-4">
<h4 id="org17ea04d"><span class="section-number-4">22.7.1.</span> Monitor.Enter/Exit</h4>
<div class="outline-text-4" id="text-22-7-1">
<p>
锁的基本使用:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#21019;&#24314;&#38145;</span>
<span style="color: #228b22;">object</span> <span style="color: #a0522d;">o</span> = <span style="color: #a020f0;">new</span> <span style="color: #0000ff;">object</span><span style="color: #707183;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558;&#20854;&#24403;&#25104;&#19968;&#25226;&#38145;&#65292;&#26368;&#22909;&#23601;&#26159; object&#12290;&#23588;&#20854;&#19981;&#35201;&#20351;&#29992; this</span>

Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span>xxx<span style="color: #707183;">)</span>;
Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span>xxx<span style="color: #707183;">)</span>;

<span style="color: #228b22;">void</span> <span style="color: #0000ff;">xxx</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#25250;&#22842;&#38145;</span>
    Monitor.<span style="color: #0000ff;">Enter</span><span style="color: #7388d6;">(</span>o<span style="color: #7388d6;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#25250;&#19981;&#21040;&#65292;&#37027;&#20040;&#31561; (&#38459;&#22622;)</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">3. &#25191;&#34892;&#20851;&#38190;&#20195;&#30721;</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#25191;&#34892;&#20851;&#38190;&#21306;&#22495;&#30340;&#20195;&#30721;"</span><span style="color: #7388d6;">)</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">4. &#37322;&#25918;&#38145;</span>
    Monitor.<span style="color: #0000ff;">Exit</span><span style="color: #7388d6;">(</span>o<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
更加健壮一点的写法:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#21019;&#24314;&#38145;</span>
<span style="color: #228b22;">object</span> <span style="color: #a0522d;">o</span> = <span style="color: #a020f0;">new</span> <span style="color: #0000ff;">object</span><span style="color: #707183;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558;&#20854;&#24403;&#25104;&#19968;&#25226;&#38145;&#65292;&#26368;&#22909;&#23601;&#26159; object&#12290;&#23588;&#20854;&#19981;&#35201;&#20351;&#29992; this</span>

Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span>xxx<span style="color: #707183;">)</span>;
Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span>xxx<span style="color: #707183;">)</span>;

<span style="color: #228b22;">void</span> <span style="color: #0000ff;">xxx</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#25250;&#22842;&#38145;</span>
    Monitor.<span style="color: #0000ff;">Enter</span><span style="color: #7388d6;">(</span>o<span style="color: #7388d6;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#25250;&#19981;&#21040;&#65292;&#37027;&#20040;&#31561; (&#38459;&#22622;)</span>

    <span style="color: #a020f0;">try</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">3. &#25191;&#34892;&#20851;&#38190;&#20195;&#30721;</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25191;&#34892;&#20851;&#38190;&#21306;&#22495;&#30340;&#20195;&#30721;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">finally</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">4. &#37322;&#25918;&#38145;</span>
        Monitor.<span style="color: #0000ff;">Exit</span><span style="color: #909183;">(</span>o<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
我不想等 (我只能等若干时间):
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#21019;&#24314;&#38145;</span>
<span style="color: #228b22;">object</span> <span style="color: #a0522d;">o</span> = <span style="color: #a020f0;">new</span> <span style="color: #0000ff;">object</span><span style="color: #707183;">()</span>;

Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span>xxx<span style="color: #707183;">)</span>;
Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span>xxx<span style="color: #707183;">)</span>;

<span style="color: #228b22;">void</span> <span style="color: #0000ff;">xxx</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#25250;&#22842;&#38145;</span>
    <span style="color: #228b22;">bool</span> <span style="color: #a0522d;">isTaken</span> = Monitor.<span style="color: #0000ff;">TryEnter</span><span style="color: #7388d6;">(</span>o<span style="color: #7388d6;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25105;&#31561;&#19981;&#21040;&#65292;&#23601;&#25289;&#20498; (&#38750;&#38459;&#22622;)</span>
    <span style="color: #228b22;">bool</span> <span style="color: #a0522d;">isTaken</span> = Monitor.<span style="color: #0000ff;">TryEnter</span><span style="color: #7388d6;">(</span>o, 666<span style="color: #7388d6;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25105;&#21482;&#33021;&#31561;&#36825;&#20040;&#20037;</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">3. &#21028;&#26029;&#26377;&#27809;&#26377;&#25343;&#21040;&#38145;</span>
    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>isTaken<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">try</span>
        <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">4. &#25191;&#34892;&#20851;&#38190;&#20195;&#30721;</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25191;&#34892;&#20851;&#38190;&#21306;&#22495;&#30340;&#20195;&#30721;"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">finally</span>
        <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">5. &#37322;&#25918;&#38145;</span>
            Monitor.<span style="color: #0000ff;">Exit</span><span style="color: #709870;">(</span>o<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
另外，一定要避免死锁的产生:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">object</span> <span style="color: #a0522d;">lock1</span> = <span style="color: #a020f0;">new</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">object</span> <span style="color: #a0522d;">lock2</span> = <span style="color: #a020f0;">new</span><span style="color: #707183;">()</span>;

<span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t1</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    Monitor.<span style="color: #0000ff;">Enter</span><span style="color: #909183;">(</span>lock1<span style="color: #909183;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24320;&#22987;"</span><span style="color: #909183;">)</span>;
    Task.<span style="color: #0000ff;">Delay</span><span style="color: #909183;">(</span>2000<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Wait</span><span style="color: #909183;">()</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#32467;&#26463;"</span><span style="color: #909183;">)</span>;

    Monitor.<span style="color: #0000ff;">Enter</span><span style="color: #909183;">(</span>lock2<span style="color: #909183;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#20854;&#20182;&#20107;&#24773;"</span><span style="color: #909183;">)</span>;
    Monitor.<span style="color: #0000ff;">Exit</span><span style="color: #909183;">(</span>lock2<span style="color: #909183;">)</span>;

    Monitor.<span style="color: #0000ff;">Exit</span><span style="color: #909183;">(</span>lock1<span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t2</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    Monitor.<span style="color: #0000ff;">Enter</span><span style="color: #909183;">(</span>lock2<span style="color: #909183;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"My..."</span><span style="color: #909183;">)</span>;

    Monitor.<span style="color: #0000ff;">Enter</span><span style="color: #909183;">(</span>lock1<span style="color: #909183;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"start"</span><span style="color: #909183;">)</span>;
    Task.<span style="color: #0000ff;">Delay</span><span style="color: #909183;">(</span>1500<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Wait</span><span style="color: #909183;">()</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"end"</span><span style="color: #909183;">)</span>;
    Monitor.<span style="color: #0000ff;">Exit</span><span style="color: #909183;">(</span>lock1<span style="color: #909183;">)</span>;

    Monitor.<span style="color: #0000ff;">Exit</span><span style="color: #909183;">(</span>lock2<span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

Task.<span style="color: #0000ff;">WaitAll</span><span style="color: #707183;">(</span>t1, t2<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#22909;&#20102;"</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org734cdbb" class="outline-4">
<h4 id="org734cdbb"><span class="section-number-4">22.7.2.</span> lock</h4>
<div class="outline-text-4" id="text-22-7-2">
<p>
是 Monitor 语法糖。胜在简单，败在不够灵活:
</p>
<ul class="org-ul">
<li>lock 的行为是，如果获取不到锁，就等待</li>
<li>锁的争用会占用资源，拖慢速度</li>
<li>因此，一定要控制好锁的范围 (颗粒)</li>
</ul>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">object</span> <span style="color: #a0522d;">o</span> = <span style="color: #a020f0;">new</span> <span style="color: #707183;">()</span>;

<span style="color: #228b22;">void</span> <span style="color: #0000ff;">xxx</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">lock</span><span style="color: #7388d6;">(</span>o<span style="color: #7388d6;">)</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31561;&#24453;</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25105;&#26159;&#20851;&#38190;&#21306;&#22495;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4af87e0" class="outline-4">
<h4 id="org4af87e0"><span class="section-number-4">22.7.3.</span> ManualResetEventSlim</h4>
<div class="outline-text-4" id="text-22-7-3">
<p>
多任务的简单协同。事件机制。
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">ev1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ManualResetEventSlim</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">ev2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ManualResetEventSlim</span><span style="color: #707183;">()</span>;

<span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t1</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25105;&#26469;&#21040;&#25945;&#23460;"</span><span style="color: #909183;">)</span>;
    ev2.<span style="color: #0000ff;">Wait</span><span style="color: #909183;">()</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25105;&#24320;&#22987;&#35762;&#35838;"</span><span style="color: #909183;">)</span>;
    ev1.<span style="color: #0000ff;">Set</span><span style="color: #909183;">()</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t2</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#20320;&#20204;&#26469;&#21040;&#25945;&#23460;"</span><span style="color: #909183;">)</span>;
    ev2.<span style="color: #0000ff;">Set</span><span style="color: #909183;">()</span>;
    ev1.<span style="color: #0000ff;">Wait</span><span style="color: #909183;">()</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#20320;&#20204;&#24320;&#22987;&#21548;&#35838;"</span><span style="color: #909183;">)</span>;
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

Task.<span style="color: #0000ff;">WaitAll</span><span style="color: #707183;">(</span>t1, t2<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#19979;&#35838;"</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8daa02" class="outline-4">
<h4 id="orgb8daa02"><span class="section-number-4">22.7.4.</span> Interlock</h4>
<div class="outline-text-4" id="text-22-7-4">
<p>
即使 i++ 这样的代码，在 CPU 的角度，也不是原子性的 (从内存中拿取、计算、写入到内存):
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">int</span> <span style="color: #a0522d;">money</span> = 1000000;

<span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t1</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 100000; i++<span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        money++;
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t2</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 100000; i++<span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        money--;
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;
Task.<span style="color: #0000ff;">WaitAll</span><span style="color: #707183;">(</span>t1, t2<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"&#29616;&#22312;&#25105;&#26377;&#38065;: {money}"</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
遇到资源争用出现的问题，基本思路就是上锁:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">object</span> <span style="color: #a0522d;">_lock</span> = <span style="color: #a020f0;">new</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">money</span> = 1000000;

<span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t1</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 100000; i++<span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        <span style="color: #a020f0;">lock</span> <span style="color: #709870;">(</span>_lock<span style="color: #709870;">)</span>
        <span style="color: #709870;">{</span>
            money++;
        <span style="color: #709870;">}</span>
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t2</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 100000; i++<span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        <span style="color: #a020f0;">lock</span><span style="color: #709870;">(</span>_lock<span style="color: #709870;">)</span>
        <span style="color: #709870;">{</span>
            money--;
        <span style="color: #709870;">}</span>
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

Task.<span style="color: #0000ff;">WaitAll</span><span style="color: #707183;">(</span>t1, t2<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"&#29616;&#22312;&#25105;&#26377;&#38065;: {money}"</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
我们可以使用 Interlock 保证线程安全，它比使用上锁的方式，更快、更简单:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">object</span> <span style="color: #a0522d;">_lock</span> = <span style="color: #a020f0;">new</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">money</span> = 1000000000;

<span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t1</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 100000000; i++<span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        Interlocked.<span style="color: #0000ff;">Increment</span><span style="color: #709870;">(</span><span style="color: #a020f0;">ref</span> <span style="color: #228b22;">money</span><span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">Task</span> <span style="color: #a0522d;">t2</span> = Task.<span style="color: #0000ff;">Run</span><span style="color: #707183;">(</span><span style="color: #7388d6;">()</span> =&gt;
<span style="color: #7388d6;">{</span>
    <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 100000000; i++<span style="color: #909183;">)</span>
    <span style="color: #909183;">{</span>
        Interlocked.<span style="color: #0000ff;">Decrement</span><span style="color: #709870;">(</span><span style="color: #a020f0;">ref</span> <span style="color: #228b22;">money</span><span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

Task.<span style="color: #0000ff;">WaitAll</span><span style="color: #707183;">(</span>t1, t2<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"&#29616;&#22312;&#25105;&#26377;&#38065;: {money}"</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org56e5dfd" class="outline-4">
<h4 id="org56e5dfd"><span class="section-number-4">22.7.5.</span> Semaphore</h4>
<div class="outline-text-4" id="text-22-7-5">
<p>
可以看作是 Monitor 方式的增强版。可以控制同一时刻通过核心代码区域的任务数量:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">Semaphore</span> <span style="color: #a0522d;">sem</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Semaphore</span><span style="color: #707183;">(</span>3, 3<span style="color: #707183;">)</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">random</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Random</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">DoSomething</span><span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">n</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">while</span> <span style="color: #7388d6;">(</span><span style="color: #008b8b;">true</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>sem.<span style="color: #0000ff;">WaitOne</span><span style="color: #709870;">(</span>1000<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{n}: --- &#24685;&#21916;&#25105;&#25104;&#21151;&#25343;&#38145; :)"</span><span style="color: #709870;">)</span>;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{n}: &#25105;&#24320;&#22987;&#20570;&#20107;&#21679;"</span><span style="color: #709870;">)</span>;
            Task.<span style="color: #0000ff;">Delay</span><span style="color: #709870;">(</span>random.<span style="color: #0000ff;">Next</span><span style="color: #907373;">(</span>2000<span style="color: #907373;">)</span> + 1000<span style="color: #709870;">)</span>.<span style="color: #0000ff;">Wait</span><span style="color: #709870;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27169;&#25311;&#20570;&#20102;&#28857;&#20107;</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{n}: &#25105;&#20570;&#23436;&#21679;"</span><span style="color: #709870;">)</span>;
            sem.<span style="color: #0000ff;">Release</span><span style="color: #709870;">()</span>;
            <span style="color: #a020f0;">break</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">else</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{n}: --- &#25105;&#25343;&#38145;&#22833;&#36133;&#20102; :("</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>;

<span style="color: #b22222;">//</span><span style="color: #b22222;">List&lt;Task&gt; tasks = new();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">for (int i = 0; i &lt; 10; i++)</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">{</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">var task = Task.Run(() =&gt; DoSomething(i));</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">tasks.Add(task);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">}</span>

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">tasks</span> = Enumerable.<span style="color: #0000ff;">Range</span><span style="color: #707183;">(</span>0, 10<span style="color: #707183;">)</span>
    .<span style="color: #0000ff;">Select</span><span style="color: #707183;">(</span>n =&gt; Task.<span style="color: #0000ff;">Run</span><span style="color: #7388d6;">(</span><span style="color: #909183;">()</span> =&gt; <span style="color: #0000ff;">DoSomething</span><span style="color: #909183;">(</span>n<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
Task.<span style="color: #0000ff;">WaitAll</span><span style="color: #707183;">(</span>tasks.<span style="color: #0000ff;">ToArray</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>


<div id="outline-container-org91c5610" class="outline-4">
<h4 id="org91c5610"><span class="section-number-4">22.7.6.</span> CountdownEvent</h4>
<div class="outline-text-4" id="text-22-7-6">
<p>
看作是 ManualResetEventSlim 的增强版。
</p>

<p>
集齐 7 颗龙珠，召唤神龙:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">cde</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">CountdownEvent</span><span style="color: #707183;">(</span>7<span style="color: #707183;">)</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">random</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Random</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">void</span> <span style="color: #0000ff;">SeekLongZhu</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"{Task.CurrentId} &#24320;&#22987;&#23547;&#25214;..."</span><span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">while</span> <span style="color: #7388d6;">(</span>cde.CurrentCount &gt; 0<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Task.<span style="color: #0000ff;">Delay</span><span style="color: #909183;">(</span>200<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Wait</span><span style="color: #909183;">()</span>;
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>random.<span style="color: #0000ff;">Next</span><span style="color: #709870;">(</span>100<span style="color: #709870;">)</span> == 0<span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            cde.<span style="color: #0000ff;">Signal</span><span style="color: #709870;">()</span>;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"{Task.CurrentId} &#25214;&#21040;&#19968;&#39063;&#40857;&#29664;"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">tasks</span> = Enumerable.<span style="color: #0000ff;">Range</span><span style="color: #707183;">(</span>0, 10<span style="color: #707183;">)</span>
    .<span style="color: #0000ff;">Select</span><span style="color: #707183;">(</span>n =&gt; Task.<span style="color: #0000ff;">Run</span><span style="color: #7388d6;">(</span>SeekLongZhu<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

Task.<span style="color: #0000ff;">WaitAll</span><span style="color: #707183;">(</span>tasks.<span style="color: #0000ff;">ToArray</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>;

cde.<span style="color: #0000ff;">Wait</span><span style="color: #707183;">()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#19971;&#39063;&#40857;&#29664;&#38598;&#40784;&#65292;&#24320;&#22987;&#21484;&#21796;&#31070;&#40857;"</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd739c45" class="outline-3">
<h3 id="orgd739c45"><span class="section-number-3">22.8.</span> 其他几种异步模式</h3>
<div class="outline-text-3" id="text-22-8">
</div>
<div id="outline-container-org8d264a7" class="outline-4">
<h4 id="org8d264a7"><span class="section-number-4">22.8.1.</span> BackgroundWorker</h4>
<div class="outline-text-4" id="text-22-8-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">//</span><span style="color: #b22222;">button1.Click += (s, e) =&gt;</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">{</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">label111.Text = "&#20219;&#21153;&#36827;&#34892;&#20013;...";</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">Thread.Sleep(10000);</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">label111.Text = "&#20219;&#21153;&#24050;&#23436;&#25104;!";</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">};</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">button1.Click += (s, e) =&gt;</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">{</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">label111.Text = "&#20219;&#21153;&#36827;&#34892;&#20013;...";</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">Task.Run(() =&gt;</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">{</span>
<span style="color: #b22222;">//        </span><span style="color: #b22222;">Thread.Sleep(10000);</span>
<span style="color: #b22222;">//        </span><span style="color: #b22222;">label111.Text = "&#20219;&#21153;&#24050;&#23436;&#25104;!";</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">});</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">};</span>

button1.Click += <span style="color: #707183;">(</span>s, e<span style="color: #707183;">)</span> =&gt;
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">bgw</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BackgroundWorker</span><span style="color: #7388d6;">()</span>;
    bgw.DoWork += <span style="color: #7388d6;">(</span>s, e<span style="color: #7388d6;">)</span> =&gt;
    <span style="color: #7388d6;">{</span>
        label111.Text = <span style="color: #8b2252;">"&#20219;&#21153;&#36827;&#34892;&#20013;..."</span>;
        Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #909183;">(</span>10000<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>;
    bgw.RunWorkerCompleted += <span style="color: #7388d6;">(</span>s, e<span style="color: #7388d6;">)</span> =&gt;
    <span style="color: #7388d6;">{</span>
        label111.Text = <span style="color: #8b2252;">"&#20219;&#21153;&#24050;&#23436;&#25104;!"</span>;
    <span style="color: #7388d6;">}</span>;
    bgw.<span style="color: #0000ff;">RunWorkerAsync</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e134ef" class="outline-4">
<h4 id="org8e134ef"><span class="section-number-4">22.8.2.</span> System.Threading.Timer</h4>
<div class="outline-text-4" id="text-22-8-2">
<div class="org-src-container">
<pre class="src src-csharp">button1.Click += <span style="color: #707183;">(</span>s, e<span style="color: #707183;">)</span> =&gt;
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">timer</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">System</span>.Threading.<span style="color: #0000ff;">Timer</span><span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>o<span style="color: #909183;">)</span> =&gt;
    <span style="color: #909183;">{</span>
        label111.Text += <span style="color: #8b2252;">"+"</span>;
        Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #709870;">(</span>1000<span style="color: #709870;">)</span>;
    <span style="color: #909183;">}</span>, <span style="color: #008b8b;">null</span>, 5000, 2000<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>;
</pre>
</div>

<p>
对比一下 Winform 版本的 Timer，它是局部阻塞:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">timer</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">System</span>.Windows.Forms.<span style="color: #0000ff;">Timer</span><span style="color: #707183;">()</span>;
timer.Interval = 3000;
timer.Tick += <span style="color: #707183;">(</span>s, e<span style="color: #707183;">)</span> =&gt;
<span style="color: #707183;">{</span>
    label111.Text += <span style="color: #8b2252;">"+"</span>;
    Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #7388d6;">(</span>2000<span style="color: #7388d6;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312;&#24403;&#21069;&#32447;&#31243;&#20013;&#65292;&#22581;</span>
<span style="color: #707183;">}</span>;
button1.Click += <span style="color: #707183;">(</span>s, e<span style="color: #707183;">)</span> =&gt;
<span style="color: #707183;">{</span>
    timer.<span style="color: #0000ff;">Start</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>;
</pre>
</div>
</div>
</div>
</div>
</section>

<section id="outline-container-org0adc5fa" class="outline-2">
<h2 id="org0adc5fa"><span class="section-number-2">23.</span> IO/Stream</h2>
<div class="outline-text-2" id="text-23">
<p>
驱动器、文件夹、文件的基本操作:
</p>
<ul class="org-ul">
<li>静态的 <code>Path</code> 类，用来处理路径 (路径是一个字符串)</li>
<li>处理驱动器，使用 <code>DriveInfo</code></li>
<li>处理文件夹和文件，使用 <code>FileSystemInfo</code> (抽象类)，实现类:
<ul class="org-ul">
<li>文件夹，使用 <code>DirectoryInfo~。静态的 ~Directory</code></li>
<li>文件，使用 <code>FileInfo~。静态的 ~File</code></li>
</ul></li>
</ul>

<p>
文件内容的读写 (Stream):
</p>
<ul class="org-ul">
<li>抽象的 <code>Stream</code> 表示流，它是所有底层流的基类 (基于 byte)</li>
<li><code>FileStream</code> 用来读写文件的内容</li>
<li><code>MemoryStream</code> 用来将某些内容按照流的方式写到内存中 (从内存中读取)</li>
<li><code>NetworkStream</code> 从网络中进行读写</li>
<li><code>GZipStream</code> 用来进行压缩、解压的</li>
</ul>

<p>
通过不同的跟读写相关的辅助类 (Reader/Writer) 简化了对上述流的使用:
</p>
<ul class="org-ul">
<li>抽象 ~TextReader/TextWriter~，表示从流中读取若干字符 (基于 char)
<ul class="org-ul">
<li><code>StreamReader/StreamWriter</code> 用来包装底层流，增加基于字符读取的能力</li>
<li><code>StringReader/StringWriter</code> 用来从字符串中读写</li>
</ul></li>
<li><code>BinaryReader/BinaryWriter</code> 用来读写现成的类型</li>
<li><code>XmlReader/XmlWriter</code> 专门用来处理 xml 文件</li>
</ul>

<p>
其他的一些流跟相关的类:
</p>
<ul class="org-ul">
<li><code>ZipArchive/DeflateStream</code></li>
<li><code>MemoryMappedFiles</code></li>
<li><code>Pipes</code> 管道流</li>
</ul>
</div>

<div id="outline-container-org9d7cfe4" class="outline-3">
<h3 id="org9d7cfe4"><span class="section-number-3">23.1.</span> Path</h3>
<div class="outline-text-3" id="text-23-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"E:\Workdir\Chengji\Chengji\Program.cs"</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s1</span> = Path.<span style="color: #0000ff;">ChangeExtension</span><span style="color: #707183;">(</span>fn, <span style="color: #8b2252;">"java"</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">d1</span> = @<span style="color: #8b2252;">"E:\ddd\";</span>
<span style="color: #8b2252;">            string n1 = @"</span>aaa.txt<span style="color: #ff0000; font-weight: bold;">"</span><span style="color: #8b2252;">;</span>
<span style="color: #228b22;">var</span> s2 = Path.<span style="color: #0000ff;">Combine</span><span style="color: #707183;">(</span>d1, n1<span style="color: #707183;">)</span>;

<span style="color: #228b22;">bool</span> <span style="color: #a0522d;">b1</span> = Path.<span style="color: #0000ff;">EndsInDirectorySeparator</span><span style="color: #707183;">(</span>d1<span style="color: #707183;">)</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s3</span> = Path.<span style="color: #0000ff;">GetDirectoryName</span><span style="color: #707183;">(</span>fn<span style="color: #707183;">)</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s4</span> = Path.<span style="color: #0000ff;">GetExtension</span><span style="color: #707183;">(</span>fn<span style="color: #707183;">)</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s5</span> = Path.<span style="color: #0000ff;">GetFileName</span><span style="color: #707183;">(</span>fn<span style="color: #707183;">)</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s6</span> = Path.<span style="color: #0000ff;">GetFileNameWithoutExtension</span><span style="color: #707183;">(</span>fn<span style="color: #707183;">)</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s7</span> = Path.<span style="color: #0000ff;">GetFullPath</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"xxx.txt"</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s8</span> = Path.<span style="color: #0000ff;">GetFullPath</span><span style="color: #707183;">(</span>fn<span style="color: #707183;">)</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s9</span> = Path.<span style="color: #0000ff;">GetRandomFileName</span><span style="color: #707183;">()</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"{s9}"</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6828845" class="outline-3">
<h3 id="org6828845"><span class="section-number-3">23.2.</span> Driver</h3>
<div class="outline-text-3" id="text-23-2">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">DriveInfo</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">drives</span> = DriveInfo.<span style="color: #0000ff;">GetDrives</span><span style="color: #707183;">()</span>;
<span style="color: #a020f0;">foreach</span> <span style="color: #707183;">(</span><span style="color: #228b22;">DriveInfo</span> <span style="color: #a0522d;">di</span> <span style="color: #a020f0;">in</span> drives<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">try</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{di.Name}, {di.DriveType}, {di.DriveFormat}, {di.TotalSize}, {di.AvailableFreeSpace}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">catch</span> <span style="color: #7388d6;">{</span> <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org942a5e5" class="outline-3">
<h3 id="org942a5e5"><span class="section-number-3">23.3.</span> Directory</h3>
<div class="outline-text-3" id="text-23-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">d1</span> = @<span style="color: #8b2252;">"e:\demo1\hello"</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">d2</span> = @<span style="color: #8b2252;">"e:\demo1\world"</span>;

Directory.<span style="color: #0000ff;">CreateDirectory</span><span style="color: #707183;">(</span>d1<span style="color: #707183;">)</span>;
Directory.<span style="color: #0000ff;">CreateDirectory</span><span style="color: #707183;">(</span>d2<span style="color: #707183;">)</span>;

<span style="color: #b22222;">//</span><span style="color: #b22222;">Directory.Delete(Directory.GetParent(d).FullName);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Directory.Delete(Directory.GetParent(d).FullName, true);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Directory.Move(d2, d1);</span>

<span style="color: #a020f0;">foreach</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #0000ff;">f</span> <span style="color: #a020f0;">in</span> Directory.<span style="color: #0000ff;">GetDirectories</span><span style="color: #7388d6;">(</span>@<span style="color: #8b2252;">"e:\Workdir"</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>f<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">foreach</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #0000ff;">f</span> <span style="color: #a020f0;">in</span> Directory.<span style="color: #0000ff;">GetFiles</span><span style="color: #7388d6;">(</span>@<span style="color: #8b2252;">"e:\Workdir"</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>f<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #228b22;">IEnumerable</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;</span> <span style="color: #a0522d;">e1</span> = Directory.<span style="color: #0000ff;">EnumerateFiles</span><span style="color: #707183;">(</span>d2<span style="color: #707183;">)</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s1</span> = Directory.<span style="color: #0000ff;">GetCreationTime</span><span style="color: #707183;">(</span>d1<span style="color: #707183;">)</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s2</span> = Directory.<span style="color: #0000ff;">GetCurrentDirectory</span><span style="color: #707183;">()</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">b1</span> = Directory.<span style="color: #0000ff;">Exists</span><span style="color: #707183;">(</span>d2<span style="color: #707183;">)</span>;
Directory.<span style="color: #0000ff;">SetCreationTime</span><span style="color: #707183;">(</span>@<span style="color: #8b2252;">"e:\Video"</span>, DateTime.Now<span style="color: #707183;">)</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>s2<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgecb1704" class="outline-3">
<h3 id="orgecb1704"><span class="section-number-3">23.4.</span> File</h3>
<div class="outline-text-3" id="text-23-4">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"E:\Workdir\Chengji\Chengji\Program.cs"</span>;

<span style="color: #b22222;">//</span><span style="color: #b22222;">File.Exists(fn);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">File.Delete(fn);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">File.Move(fn, "xxx");</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">File.Copy(fn, "xxx");</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">File.Encrypt(fn);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">File.Decrypt(fn);</span>

File.<span style="color: #0000ff;">GetCreationTime</span><span style="color: #707183;">(</span>fn<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>File.<span style="color: #0000ff;">GetAttributes</span><span style="color: #7388d6;">(</span>fn<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org0bb555b" class="outline-3">
<h3 id="org0bb555b"><span class="section-number-3">23.5.</span> Stream</h3>
<div class="outline-text-3" id="text-23-5">
</div>
<div id="outline-container-orgc15377d" class="outline-4">
<h4 id="orgc15377d"><span class="section-number-4">23.5.1.</span> FileSteam</h4>
<div class="outline-text-4" id="text-23-5-1">
<p>
用完要释放; 使用 ReadByte 读取一个字节:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"E:\Workdir\Chengji\Chengji\Program.cs"</span>;

<span style="color: #228b22;">FileStream</span> <span style="color: #a0522d;">stream</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">FileStream</span><span style="color: #707183;">(</span>fn, FileMode.Open<span style="color: #707183;">)</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"{stream.CanRead}, {stream.CanWrite}"</span><span style="color: #707183;">)</span>;

<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 10; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">b</span> = stream.<span style="color: #0000ff;">ReadByte</span><span style="color: #7388d6;">()</span>;
    Console.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"{b:x}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">()</span>;

stream.<span style="color: #0000ff;">Seek</span><span style="color: #707183;">(</span>5, SeekOrigin.Begin<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"{stream.ReadByte():x}"</span><span style="color: #707183;">)</span>;

stream.<span style="color: #0000ff;">Dispose</span><span style="color: #707183;">()</span>;
</pre>
</div>

<p>
使用 using 管理资源 / 使用 Read 进行批量读取:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"E:\Workdir\Chengji\Chengji\Program.cs"</span>;
<span style="color: #a020f0;">using</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">stream</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">FileStream</span><span style="color: #7388d6;">(</span>fn, FileMode.Open<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">byte[] bs = stream.Read(10);</span>

    <span style="color: #228b22;">byte</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">buf</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">byte</span><span style="color: #7388d6;">[</span>10<span style="color: #7388d6;">]</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">n</span> = stream.<span style="color: #0000ff;">Read</span><span style="color: #7388d6;">(</span>buf, 0, 10<span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"&#35835;&#21462;&#25104;&#21151;&#20102; {n} &#20010;"</span><span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; n; i++<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{buf[i]:x}-"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
全文读取:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"E:\Workdir\Chengji\Chengji\Program.cs"</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">var</span> s<span style="color: #a0522d;">tream</span> = <span style="color: #a0522d;">new</span> F<span style="color: #a0522d;">ileStream</span><span style="color: #707183;">(</span><span style="color: #a0522d;">fn</span>, <span style="color: #a0522d;">FileMode</span>.<span style="color: #a0522d;">Open</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">int</span> <span style="color: #a0522d;">n</span>;
<span style="color: #228b22;">byte</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">buf</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">byte</span><span style="color: #707183;">[</span>10<span style="color: #707183;">]</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#32531;&#20914;&#25968;&#32452;</span>
<span style="color: #a020f0;">while</span> <span style="color: #707183;">(</span><span style="color: #7388d6;">(</span>n = stream.<span style="color: #0000ff;">Read</span><span style="color: #909183;">(</span>buf<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span> &gt; 0<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #0000ff;">PrintBuffer</span><span style="color: #7388d6;">(</span>buf, n<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">private</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">PrintBuffer</span><span style="color: #707183;">(</span><span style="color: #228b22;">byte</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">buf</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">limit</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; limit; i++<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{buf[i]:x}-"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
异步读取:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"E:\Workdir\Chengji\Chengji\Program.cs"</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">var</span> s<span style="color: #a0522d;">tream</span> = <span style="color: #a0522d;">new</span> F<span style="color: #a0522d;">ileStream</span><span style="color: #707183;">(</span><span style="color: #a0522d;">fn</span>, <span style="color: #a0522d;">FileMode</span>.<span style="color: #a0522d;">Open</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">int</span> <span style="color: #a0522d;">n</span>;
<span style="color: #228b22;">byte</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">buf</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">byte</span><span style="color: #707183;">[</span>1000000<span style="color: #707183;">]</span>;
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">len</span> = <span style="color: #a020f0;">await</span> stream.<span style="color: #0000ff;">ReadAsync</span><span style="color: #707183;">(</span>buf<span style="color: #707183;">)</span>;
</pre>
</div>

<p>
写:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"E:\Workdir\Chengji\Chengji\Program.cs"</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">var</span> s<span style="color: #a0522d;">tream</span> = <span style="color: #a0522d;">new</span> F<span style="color: #a0522d;">ileStream</span><span style="color: #707183;">(</span><span style="color: #a0522d;">fn</span>, <span style="color: #a0522d;">FileMode</span>.<span style="color: #a0522d;">Open</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#26368;&#24320;&#22987;&#30340;&#20301;&#32622;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#35206;&#30422;</span>
stream.<span style="color: #0000ff;">WriteByte</span><span style="color: #707183;">(</span>255<span style="color: #707183;">)</span>;
stream.<span style="color: #0000ff;">WriteByte</span><span style="color: #707183;">(</span>255<span style="color: #707183;">)</span>;
stream.<span style="color: #0000ff;">WriteByte</span><span style="color: #707183;">(</span>255<span style="color: #707183;">)</span>;
stream.<span style="color: #0000ff;">WriteByte</span><span style="color: #707183;">(</span>255<span style="color: #707183;">)</span>;
stream.<span style="color: #0000ff;">Flush</span><span style="color: #707183;">()</span>;

stream.<span style="color: #0000ff;">Seek</span><span style="color: #707183;">(</span>100, SeekOrigin.Begin<span style="color: #707183;">)</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">ba1</span> = Encoding.UTF8.<span style="color: #0000ff;">GetBytes</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #707183;">)</span>;
stream.<span style="color: #0000ff;">Write</span><span style="color: #707183;">(</span>ba1, 0, ba1.Length<span style="color: #707183;">)</span>;
stream.<span style="color: #0000ff;">Flush</span><span style="color: #707183;">()</span>;
</pre>
</div>

<p>
丰富多彩的构造参数:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"E:\Workdir\Chengji\Chengji\Program222.cs"</span>;
<span style="color: #b22222;">//</span><span style="color: #b22222;">using var stream = new FileStream(fn, FileMode.OpenOrCreate);</span>
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">var</span> s<span style="color: #a0522d;">tream</span> = <span style="color: #a0522d;">new</span> F<span style="color: #a0522d;">ileStream</span><span style="color: #707183;">(</span><span style="color: #a0522d;">fn</span>,
                                  <span style="color: #a0522d;">FileMode</span>.<span style="color: #a0522d;">OpenOrCreate</span>,
                                  <span style="color: #a0522d;">FileAccess</span>.<span style="color: #a0522d;">Write</span>,
                                  <span style="color: #a0522d;">FileShare</span>.<span style="color: #a0522d;">ReadWrite</span>,
                                  <span style="color: #a0522d;">200</span>,
                                  <span style="color: #a0522d;">FileOptions</span>.<span style="color: #a0522d;">DeleteOnClose</span><span style="color: #707183;">)</span>;

stream.<span style="color: #0000ff;">WriteByte</span><span style="color: #707183;">(</span>255<span style="color: #707183;">)</span>;
stream.<span style="color: #0000ff;">WriteByte</span><span style="color: #707183;">(</span>0x65<span style="color: #707183;">)</span>;
</pre>
</div>

<p>
在 File 中存在若干创建流的快捷方式:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"E:\Workdir\Chengji\Chengji\Program222.cs"</span>;
<span style="color: #b22222;">//</span><span style="color: #b22222;">using var stream = new FileStream(fn, FileMode.Open, FileAccess.Read);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">using var stream = File.Open(fn, FileMode.Open);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">using var stream = File.OpenRead(fn);</span>
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">var</span> s<span style="color: #a0522d;">tream</span> = <span style="color: #a0522d;">File</span>.<span style="color: #a0522d;">OpenWrite</span><span style="color: #707183;">(</span><span style="color: #a0522d;">fn</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org58f5eb3" class="outline-4">
<h4 id="org58f5eb3"><span class="section-number-4">23.5.2.</span> MemoryStream</h4>
<div class="outline-text-4" id="text-23-5-2">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">MemoryStream</span> <span style="color: #a0522d;">s</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">MemoryStream</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">byte</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">bs1</span> = Encoding.UTF8.<span style="color: #0000ff;">GetBytes</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#20013;&#22269;"</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">byte</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">bs2</span> = Encoding.UTF8.<span style="color: #0000ff;">GetBytes</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"yyds"</span><span style="color: #707183;">)</span>;
s.<span style="color: #0000ff;">Write</span><span style="color: #707183;">(</span>bs1, 0, bs1.Length<span style="color: #707183;">)</span>;
s.<span style="color: #0000ff;">Write</span><span style="color: #707183;">(</span>bs2, 0, bs2.Length<span style="color: #707183;">)</span>;
s.<span style="color: #0000ff;">ToArray</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9b860a" class="outline-4">
<h4 id="orgf9b860a"><span class="section-number-4">23.5.3.</span> NetworkStream</h4>
<div class="outline-text-4" id="text-23-5-3">
<p>
Socket!!!
</p>
</div>
</div>
</div>

<div id="outline-container-org575a40d" class="outline-3">
<h3 id="org575a40d"><span class="section-number-3">23.6.</span> Reader/Writer</h3>
<div class="outline-text-3" id="text-23-6">
</div>
<div id="outline-container-org165428b" class="outline-4">
<h4 id="org165428b"><span class="section-number-4">23.6.1.</span> StreamReader/StreamWriter</h4>
<div class="outline-text-4" id="text-23-6-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"E:\Workdir\Chengji\Chengji\Program.cs"</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s</span> = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #707183;">(</span>fn<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">var</span> r<span style="color: #a0522d;">eader</span> = <span style="color: #a0522d;">new</span> S<span style="color: #a0522d;">treamReader</span><span style="color: #707183;">(</span><span style="color: #a0522d;">s</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(reader.ReadLine()); </span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(reader.ReadLine()); </span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">reader.Peek();</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(reader.ReadToEnd());</span>

reader.<span style="color: #0000ff;">Read</span><span style="color: #707183;">()</span>;
</pre>
</div>

<p>
可以直接传入文件名:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"E:\Workdir\Chengji\Chengji\Program.cs"</span>;
<span style="color: #b22222;">// </span><span style="color: #b22222;">using var reader = new StreamReader(File.OpenRead(fn));</span>
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">var</span> r<span style="color: #a0522d;">eader</span> = <span style="color: #a0522d;">new</span> S<span style="color: #a0522d;">treamReader</span><span style="color: #707183;">(</span><span style="color: #a0522d;">fn</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
在 File 中提供了大量的快捷使用:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"E:\Workdir\Chengji\Chengji\Program.cs"</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">StreamReader</span> s<span style="color: #a0522d;">r</span> = <span style="color: #a0522d;">File</span>.<span style="color: #a0522d;">OpenText</span><span style="color: #707183;">(</span><span style="color: #a0522d;">fn</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">StreamWriter</span> s<span style="color: #a0522d;">w1</span> = <span style="color: #a0522d;">File</span>.<span style="color: #a0522d;">AppendText</span><span style="color: #707183;">(</span><span style="color: #a0522d;">fn</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">StreamWriter</span> s<span style="color: #a0522d;">w2</span> = <span style="color: #a0522d;">File</span>.<span style="color: #a0522d;">CreateText</span><span style="color: #707183;">(</span><span style="color: #a0522d;">fn</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">string</span> <span style="color: #a0522d;">s1</span> = File.<span style="color: #0000ff;">ReadAllText</span><span style="color: #707183;">(</span>fn<span style="color: #707183;">)</span>;
<span style="color: #228b22;">string</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">ar</span> = File.<span style="color: #0000ff;">ReadAllLines</span><span style="color: #707183;">(</span>fn<span style="color: #707183;">)</span>;
File.<span style="color: #0000ff;">WriteAllText</span><span style="color: #707183;">(</span>fn, <span style="color: #8b2252;">"dkjskdjfskdfjds"</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org2de8f2b" class="outline-4">
<h4 id="org2de8f2b"><span class="section-number-4">23.6.2.</span> StringReader/StringWriter</h4>
<div class="outline-text-4" id="text-23-6-2">
<p>
使用场景: xxxxx
</p>

<p>
优势劣势: xxxxx
</p>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">reader</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringReader</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"hello, world"</span><span style="color: #707183;">)</span>;
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(reader.Read());</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(reader.ReadToEnd());</span>

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">writer</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringWriter</span><span style="color: #707183;">()</span>;
<span style="color: #b22222;">//</span><span style="color: #b22222;">writer.WriteLine("hello");</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">writer.WriteLine("world");</span>
<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 1000; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    writer.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>i<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>writer.<span style="color: #0000ff;">ToString</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org7eb0fb0" class="outline-4">
<h4 id="org7eb0fb0"><span class="section-number-4">23.6.3.</span> BinaryReader/BinaryWriter</h4>
<div class="outline-text-4" id="text-23-6-3">
<p>
BinaryWriter:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"E:\x11111.bin"</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">writer</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BinaryWriter</span><span style="color: #707183;">(</span>File.<span style="color: #0000ff;">OpenWrite</span><span style="color: #7388d6;">(</span>fn<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
writer.<span style="color: #0000ff;">Write</span><span style="color: #707183;">(</span>123<span style="color: #707183;">)</span>;
writer.<span style="color: #0000ff;">Write</span><span style="color: #707183;">(</span><span style="color: #008b8b;">true</span><span style="color: #707183;">)</span>;
writer.<span style="color: #0000ff;">Write</span><span style="color: #707183;">(</span><span style="color: #8b2252;">'X'</span><span style="color: #707183;">)</span>;
writer.<span style="color: #0000ff;">Write</span><span style="color: #707183;">(</span>33.3<span style="color: #707183;">)</span>;
writer.<span style="color: #0000ff;">Flush</span><span style="color: #707183;">()</span>;
<span style="color: #a020f0;">return</span> writer;
</pre>
</div>

<p>
BinaryReader:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">string</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"E:\x11111.bin"</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">reader</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BinaryReader</span><span style="color: #707183;">(</span>File.<span style="color: #0000ff;">OpenRead</span><span style="color: #7388d6;">(</span>fn<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = reader.<span style="color: #0000ff;">ReadInt32</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">bool</span> <span style="color: #a0522d;">b</span> = reader.<span style="color: #0000ff;">ReadBoolean</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">char</span> <span style="color: #a0522d;">c</span> = reader.<span style="color: #0000ff;">ReadChar</span><span style="color: #707183;">()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>c<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org265e218" class="outline-4">
<h4 id="org265e218"><span class="section-number-4">23.6.4.</span> XmlReader/XmlWriter</h4>
<div class="outline-text-4" id="text-23-6-4">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">fn</span> = @<span style="color: #8b2252;">"e:\hello.xml"</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">var</span> x<span style="color: #a0522d;">w</span> = <span style="color: #a0522d;">XmlWriter</span>.<span style="color: #a0522d;">Create</span><span style="color: #707183;">(</span><span style="color: #a0522d;">File</span>.<span style="color: #a0522d;">OpenWrite</span><span style="color: #7388d6;">(</span><span style="color: #a0522d;">fn</span><span style="color: #7388d6;">)</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">XmlWriterSettings</span> <span style="color: #7388d6;">{</span> <span style="color: #a0522d;">Indent</span> = <span style="color: #008b8b;">true</span> <span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">List</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;</span> <span style="color: #a0522d;">books</span> = <span style="color: #a020f0;">new</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #8b2252;">"&#25112;&#20105;&#19982;&#21644;&#24179;"</span>,
    <span style="color: #8b2252;">"&#24754;&#24808;&#30340;&#19990;&#30028;"</span>,
    <span style="color: #8b2252;">"&#20379;&#36135;&#21830;&#25171;&#24320;"</span>,
    <span style="color: #8b2252;">"jQuery"</span>,
    <span style="color: #8b2252;">"Csharp"</span>
<span style="color: #707183;">}</span>;

xw.<span style="color: #0000ff;">WriteStartDocument</span><span style="color: #707183;">()</span>;
xw.<span style="color: #0000ff;">WriteStartElement</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"book"</span><span style="color: #707183;">)</span>;
xw.<span style="color: #0000ff;">WriteComment</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#25105;&#20063;&#19981;&#30693;&#36947;"</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">foreach</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">book</span> <span style="color: #a020f0;">in</span> books<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    xw.<span style="color: #0000ff;">WriteElementString</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"name"</span>, book<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
xw.<span style="color: #0000ff;">WriteEndElement</span><span style="color: #707183;">()</span>;
xw.<span style="color: #0000ff;">Flush</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5138b5a" class="outline-3">
<h3 id="org5138b5a"><span class="section-number-3">23.7.</span> FileSystemWatching</h3>
<div class="outline-text-3" id="text-23-7">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">dn</span> = @<span style="color: #8b2252;">"e:\Tmp"</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">watcher</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">FileSystemWatcher</span>
<span style="color: #707183;">{</span>
    <span style="color: #a0522d;">Path</span> = dn,
    <span style="color: #a0522d;">IncludeSubdirectories</span> = <span style="color: #008b8b;">true</span>,
    <span style="color: #a0522d;">EnableRaisingEvents</span> = <span style="color: #008b8b;">true</span>
<span style="color: #707183;">}</span>;
watcher.Changed += <span style="color: #707183;">(</span>s, e<span style="color: #707183;">)</span> =&gt;
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"&#26377;&#19996;&#35199;&#21457;&#29983;&#20102;&#21464;&#21270;: {e.Name}, {e.ChangeType}"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>;
watcher.Created += <span style="color: #707183;">(</span>s, e<span style="color: #707183;">)</span> =&gt;
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#21019;&#24314;&#20102;&#19968;&#28857;&#20160;&#20040;&#19996;&#35199;&#65292;&#25105;&#20063;&#19981;&#30693;&#37117;&#12290;&#21487;&#33021;&#26159;&#30149;&#27602;&#25226;..."</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>;
Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org36de137" class="outline-2">
<h2 id="org36de137"><span class="section-number-2">24.</span> Socket</h2>
<div class="outline-text-2" id="text-24">
</div>
<div id="outline-container-org198d03f" class="outline-3">
<h3 id="org198d03f"><span class="section-number-3">24.1.</span> OSI 模型</h3>
<div class="outline-text-3" id="text-24-1">
<ul class="org-ul">
<li>计算机网络刚起步的阶段，很多私有协议 (Protocol) 先后出现</li>
<li>后面 ISO (国际标准组织) 出面推出了 OSI (Open System Interconnection) 协议
<ul class="org-ul">
<li>分为 7 层，每次都提供单独的服务，层与层之间紧密合作</li>
<li>大而全，从底层的网线接口，到高层的应用协议，无所不包</li>
<li>率先提出了服务、分层、协议、之类的概念</li>
</ul></li>
</ul>


<figure id="org81c676d">
<img src="img/osi-1.png" alt="osi-1.png">

</figure>

<p>
但是:
</p>
<ul class="org-ul">
<li>它太复杂了 (<a href="img/tcpip-111.png">大而全的 OSI 模型图片</a>)</li>
<li>到现在为止, Windows 操作系统也没有完全实现 OSI 协议</li>
<li>反而在这个过程中，围绕着 TCP 和 IP 这两种协议，衍生出了 TCP/IP Protocol Stack (协议栈) 的概念，并且被广泛使用</li>
<li>TCP/IP 协议栈慢慢就成为了事实上的标准；但是学习的时候，理论上还是以 OSI 为基准</li>
<li>TCP/IP 出现在 OSI 模型之前，但是后面 OSI 出现之后，TCP/IP 借鉴了其中很多想法，包括分层</li>
<li>正因为如此，OSI 模型，现在变成了 <b>参考</b> 模型</li>
</ul>
</div>
</div>

<div id="outline-container-orgf520b62" class="outline-3">
<h3 id="orgf520b62"><span class="section-number-3">24.2.</span> TCP/IP 协议栈</h3>
<div class="outline-text-3" id="text-24-2">

<figure id="orgc5f4949">
<img src="img/tcpipstack.png" alt="tcpipstack.png">

</figure>



<figure id="orgbf661ff">
<img src="img/tcpip-2222.png" alt="tcpip-2222.png">

</figure>



<figure id="orgd70ade1">
<img src="img/tcpip-3332.png" alt="tcpip-3332.png">

</figure>
</div>
</div>

<div id="outline-container-orgad2a3f5" class="outline-3">
<h3 id="orgad2a3f5"><span class="section-number-3">24.3.</span> Uri/UriBuilder</h3>
<div class="outline-text-3" id="text-24-3">
<p>
URI (Uniform Resource Identifier), 统一资源标识符:
</p>
<ul class="org-ul">
<li>url: Uniform Resource Locator, 统一资源定位器</li>
<li>urn: Uniform Resource Name, 统一资源名称</li>
</ul>

<p>
示例:
</p>
<pre class="example" id="org8e8ee8f">
ftp://ftp.is.co.za/rfc/rfc1808.txt (also a URL because of the protocol)
http://www.ietf.org/rfc/rfc2396.txt (also a URL because of the protocol)
ldap://[2001:db8::7]/c=GB?objectClass?one (also a URL because of the protocol)
mailto:John.Doe@example.com (also a URL because of the protocol)
news:comp.infosystems.www.servers.unix (also a URL because of the protocol)
tel:+1-816-555-1212
telnet://192.0.2.16:80/ (also a URL because of the protocol)
urn:oasis:names:specification:docbook:dtd:xml:4.1.2
</pre>

<p>
Uri 用于结构化 URL 地址:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#19968;&#20010;&#23436;&#25972;&#30340; URL &#22320;&#22336;&#21253;&#25324;&#33509;&#24178;&#37096;&#20998;:</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">&#21327;&#35758;://[&#29992;&#25143;&#21517;@]&#22320;&#22336;[:&#31471;&#21475;]/&#36335;&#24452;?&#26597;&#35810;&#21442;&#25968;#&#27573;</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">schema://host:port/path?query#fragment</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">schema://host</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">http://baidu.com</span>

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s</span> = <span style="color: #8b2252;">"http://wwww.baidu.com:80/aaa/index.html?name=&#24352;&#19977;#333"</span>;
<span style="color: #228b22;">Uri</span> <span style="color: #a0522d;">uri</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Uri</span><span style="color: #707183;">(</span>s<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>uri.Host<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>uri.Port<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>uri.LocalPath<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>uri.AbsolutePath<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>uri.Query<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>uri.Fragment<span style="color: #707183;">)</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">()</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>Uri.<span style="color: #0000ff;">EscapeDataString</span><span style="color: #7388d6;">(</span>s<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>Uri.<span style="color: #0000ff;">EscapeUriString</span><span style="color: #7388d6;">(</span>s<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>Uri.<span style="color: #0000ff;">EscapeDataString</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#24352;&#19977;"</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>Uri.<span style="color: #0000ff;">UnescapeDataString</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"%3d"</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
UriBuilder:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">ub</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">UriBuilder</span><span style="color: #707183;">()</span>;
ub.Scheme = <span style="color: #8b2252;">"https"</span>;
ub.Host = <span style="color: #8b2252;">"182.23.444.55"</span>;
ub.Port = 444;
ub.Path = <span style="color: #8b2252;">"/index.html"</span>;
ub.Query = <span style="color: #8b2252;">"?name=zhangsan"</span>;
ub.UserName = <span style="color: #8b2252;">"admin"</span>;
ub.Password = <span style="color: #8b2252;">"admin2"</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">uri</span> = ub.Uri;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>uri<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org009fd5e" class="outline-3">
<h3 id="org009fd5e"><span class="section-number-3">24.4.</span> IpAddress/Dns</h3>
<div class="outline-text-3" id="text-24-4">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">ipStr</span> = <span style="color: #8b2252;">"8.8.8.8"</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">1.1.1.1 DNS &#26381;&#21153;&#22120;</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">IPAddress ip = new IPAddress(ipStr);</span>
<span style="color: #228b22;">IPAddress</span> <span style="color: #a0522d;">ip</span> = IPAddress.<span style="color: #0000ff;">Parse</span><span style="color: #707183;">(</span>ipStr<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"{ip.Address}, {ip.AddressFamily}"</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">IPAddress</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">ips</span> = Dns.<span style="color: #0000ff;">GetHostAddresses</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"www.baidu.com"</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">foreach</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">i</span> <span style="color: #a020f0;">in</span> ips<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>i<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #228b22;">IPHostEntry</span> <span style="color: #a0522d;">ih</span> = Dns.<span style="color: #0000ff;">GetHostEntry</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"www.bing.com"</span><span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>ih.HostName<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">foreach</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">al</span> <span style="color: #a020f0;">in</span> ih.Aliases<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>al<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd8059e2" class="outline-3">
<h3 id="orgd8059e2"><span class="section-number-3">24.5.</span> Socket</h3>
<div class="outline-text-3" id="text-24-5">
<p>
插座来了。
</p>
</div>

<div id="outline-container-orgc6a387b" class="outline-4">
<h4 id="orgc6a387b"><span class="section-number-4">24.5.1.</span> TCP vs UDP</h4>
<div class="outline-text-4" id="text-24-5-1">
<ul class="org-ul">
<li>TCP (Transmission Control Protocol) 传输控制协议:
<ul class="org-ul">
<li>可靠的连接</li>
<li>三次握手跟四次挥手的连接跟断开</li>
<li>传输过程中，如果存在丢包的话</li>
</ul></li>
<li>UDP (User Datagram Protocol) 用户数据报协议:
<ul class="org-ul">
<li>不需要握手、挥手，直接发数据</li>
<li>具备不可靠性</li>
<li>但是保障速度</li>
</ul></li>
</ul>


<figure id="orga53a3e2">
<img src="img/tcp3333.png" alt="tcp3333.png">

</figure>
</div>
</div>

<div id="outline-container-orgad22831" class="outline-4">
<h4 id="orgad22831"><span class="section-number-4">24.5.2.</span> Socket/TCP</h4>
<div class="outline-text-4" id="text-24-5-2">
<ul class="org-ul">
<li>TCP/IP 协议栈是由操作系统 (内核) 实现的</li>
<li>Socket 是由操作系统提供的面向 TCP/IP 协议编程的接口</li>
<li>C# 中，使用 <code>Socket</code> 对象，来完成对系统 API 调用</li>
</ul>
</div>

<div id="outline-container-org0a6b38a" class="outline-5">
<h5 id="org0a6b38a"><span class="section-number-5">24.5.2.1.</span> 基本语法</h5>
<div class="outline-text-5" id="text-24-5-2-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">TCP &#32534;&#31243;&#19977;&#26495;&#26023;:</span>
<span style="color: #b22222;">//  </span><span style="color: #b22222;">1. bind (&#32465;&#23450;)</span>
<span style="color: #b22222;">//  </span><span style="color: #b22222;">2. listen (&#30417;&#21548;)</span>
<span style="color: #b22222;">//  </span><span style="color: #b22222;">3. accept (&#25509;&#21463;)</span>

<span style="color: #228b22;">Socket</span> <span style="color: #a0522d;">server</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Socket</span><span style="color: #707183;">(</span>AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp<span style="color: #707183;">)</span>;
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#32465;&#23450;&#30417;&#21548;&#26469;&#33258;&#21738;&#20123; IP &#22320;&#22336;&#30340;&#35831;&#27714;&#65292;&#30417;&#21548;&#21738;&#20010;&#31471;&#21475; (1024)</span>
server.<span style="color: #0000ff;">Bind</span><span style="color: #707183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">IPEndPoint</span><span style="color: #7388d6;">(</span>IPAddress.<span style="color: #228b22;">Any</span>, 16789<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#24320;&#22987;&#30417;&#21548;</span>
server.<span style="color: #0000ff;">Listen</span><span style="color: #707183;">()</span>;
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#31561;&#24453;&#26469;&#33258;&#29992;&#25143;&#30340;&#35831;&#27714;</span>
<span style="color: #228b22;">Socket</span> <span style="color: #a0522d;">s</span> = server.<span style="color: #0000ff;">Accept</span><span style="color: #707183;">()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"&#25509;&#21463;&#21040;&#19968;&#20010;&#29992;&#25143;&#30340;&#35831;&#27714; {s}"</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge8a1a0e" class="outline-5">
<h5 id="orge8a1a0e"><span class="section-number-5">24.5.2.2.</span> 简单的 HTTP 服务器</h5>
<div class="outline-text-5" id="text-24-5-2-2">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">Socket</span> <span style="color: #a0522d;">server</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Socket</span><span style="color: #707183;">(</span>AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp<span style="color: #707183;">)</span>;
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#32465;&#23450;&#30417;&#21548;&#26469;&#33258;&#21738;&#20123; IP &#22320;&#22336;&#30340;&#35831;&#27714;&#65292;&#30417;&#21548;&#21738;&#20010;&#31471;&#21475; (1024)</span>
server.<span style="color: #0000ff;">Bind</span><span style="color: #707183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">IPEndPoint</span><span style="color: #7388d6;">(</span>IPAddress.<span style="color: #228b22;">Any</span>, 16780<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#24320;&#22987;&#30417;&#21548;</span>
server.<span style="color: #0000ff;">Listen</span><span style="color: #707183;">(</span>100<span style="color: #707183;">)</span>;

<span style="color: #228b22;">int</span> <span style="color: #a0522d;">count</span> = 0;

<span style="color: #a020f0;">while</span> <span style="color: #707183;">(</span><span style="color: #008b8b;">true</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31561;&#24453;&#26469;&#33258;&#29992;&#25143;&#30340;&#35831;&#27714;</span>
    <span style="color: #228b22;">Socket</span> <span style="color: #a0522d;">s</span> = server.<span style="color: #0000ff;">Accept</span><span style="color: #7388d6;">()</span>;
    Task.<span style="color: #0000ff;">Run</span><span style="color: #7388d6;">(</span><span style="color: #909183;">()</span> =&gt;
    <span style="color: #909183;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"-------- &#31532; {++count} &#20010;&#35831;&#27714; --------\n\n"</span><span style="color: #709870;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25968;&#25454;&#30340;&#35835;&#21462;</span>

        <span style="color: #228b22;">byte</span><span style="color: #709870;">[]</span> <span style="color: #a0522d;">buf</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">byte</span><span style="color: #709870;">[</span>1020000<span style="color: #709870;">]</span>;
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">n</span> = s.<span style="color: #0000ff;">Receive</span><span style="color: #709870;">(</span>buf<span style="color: #709870;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#25509;&#21463;&#21040;&#19968;&#20010;&#29992;&#25143;&#30340;&#35831;&#27714; {s}"</span><span style="color: #709870;">)</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"&#23427;&#21457;&#36865;&#30340;&#25968;&#25454;&#26159; {Encoding.UTF8.GetString(buf, 0, n)}"</span><span style="color: #709870;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21709;&#24212;&#20869;&#23481;</span>

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">content</span> = <span style="color: #8b2252;">"hello, world"</span>;
        <span style="color: #228b22;">StringBuilder</span> <span style="color: #a0522d;">sb</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #709870;">()</span>;
        sb.<span style="color: #0000ff;">Append</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"HTTP/1.1 200 OK\n"</span><span style="color: #709870;">)</span>;
        sb.<span style="color: #0000ff;">Append</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"Content-Type: {content.Length}\n"</span><span style="color: #709870;">)</span>;
        sb.<span style="color: #0000ff;">Append</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"Content-Type: text/html; charset=utf-8\n"</span><span style="color: #709870;">)</span>;
        sb.<span style="color: #0000ff;">Append</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"\r\n"</span><span style="color: #709870;">)</span>;
        sb.<span style="color: #0000ff;">Append</span><span style="color: #709870;">(</span>content<span style="color: #709870;">)</span>;

        s.<span style="color: #0000ff;">Send</span><span style="color: #709870;">(</span>Encoding.UTF8.<span style="color: #0000ff;">GetBytes</span><span style="color: #907373;">(</span>sb.<span style="color: #0000ff;">ToString</span><span style="color: #6276ba;">()</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span>;

        s.<span style="color: #0000ff;">Shutdown</span><span style="color: #709870;">(</span>SocketShutdown.Both<span style="color: #709870;">)</span>;
        s.<span style="color: #0000ff;">Close</span><span style="color: #709870;">()</span>;
    <span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga38c28b" class="outline-5">
<h5 id="orga38c28b"><span class="section-number-5">24.5.2.3.</span> 简单的客户端实现</h5>
<div class="outline-text-5" id="text-24-5-2-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">Socket</span> <span style="color: #a0522d;">socket</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Socket</span><span style="color: #707183;">(</span>AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp<span style="color: #707183;">)</span>;

socket.<span style="color: #0000ff;">Connect</span><span style="color: #707183;">(</span>IPAddress.Loopback, 16780<span style="color: #707183;">)</span>;

socket.<span style="color: #0000ff;">Send</span><span style="color: #707183;">(</span>Encoding.UTF8.<span style="color: #0000ff;">GetBytes</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">byte</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">res</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">byte</span><span style="color: #707183;">[</span>1024<span style="color: #707183;">]</span>;
<span style="color: #228b22;">int</span> <span style="color: #a0522d;">n</span> = socket.<span style="color: #0000ff;">Receive</span><span style="color: #707183;">(</span>res<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"&#25105;&#24471;&#21040;&#30340;&#21709;&#24212;&#20869;&#23481;&#26159; {Encoding.UTF8.GetString(res)}"</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3889b60" class="outline-4">
<h4 id="org3889b60"><span class="section-number-4">24.5.3.</span> Socket/UDP</h4>
<div class="outline-text-4" id="text-24-5-3">
<p>
Sender:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">socket</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Socket</span><span style="color: #707183;">(</span>AddressFamily.InterNetwork, SocketType.Dgram, ProtocolType.Udp<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">while</span> <span style="color: #707183;">(</span><span style="color: #008b8b;">true</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#35831;&#36755;&#20837;&#20320;&#35201;&#21457;&#36865;&#30340;&#20869;&#23481;: "</span><span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">string</span> <span style="color: #a0522d;">content</span> = Console.<span style="color: #0000ff;">ReadLine</span><span style="color: #7388d6;">()</span>;
    socket.<span style="color: #0000ff;">SendTo</span><span style="color: #7388d6;">(</span>Encoding.UTF8.<span style="color: #0000ff;">GetBytes</span><span style="color: #909183;">(</span>content<span style="color: #909183;">)</span>, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">IPEndPoint</span><span style="color: #909183;">(</span>IPAddress.<span style="color: #228b22;">Loopback</span>, 9897<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#21457;&#36865;&#25104;&#21151;!"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
Receiver:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">socket</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Socket</span><span style="color: #707183;">(</span>AddressFamily.InterNetwork, SocketType.Dgram, ProtocolType.Udp<span style="color: #707183;">)</span>;
socket.<span style="color: #0000ff;">Bind</span><span style="color: #707183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">IPEndPoint</span><span style="color: #7388d6;">(</span>IPAddress.<span style="color: #228b22;">Any</span>, 9897<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;

Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#21019;&#24314;&#25104;&#21151;&#65292;&#20934;&#22791;&#24037;&#20316;..."</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">byte</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">buf</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">byte</span><span style="color: #707183;">[</span>10023<span style="color: #707183;">]</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">ep</span> = <span style="color: #707183;">(</span><span style="color: #228b22;">EndPoint</span><span style="color: #707183;">)</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">IPEndPoint</span><span style="color: #707183;">(</span>IPAddress.Any, 9897<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">while</span> <span style="color: #707183;">(</span><span style="color: #008b8b;">true</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">n</span> = socket.<span style="color: #0000ff;">ReceiveFrom</span><span style="color: #7388d6;">(</span>buf, <span style="color: #a020f0;">ref</span> <span style="color: #228b22;">ep</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>$<span style="color: #8b2252;">"&#25509;&#25910;&#21040;&#26469;&#33258; {(ep as IPEndPoint).Address} &#30340;&#20449;&#24687;:"</span><span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>Encoding.UTF8.<span style="color: #0000ff;">GetString</span><span style="color: #909183;">(</span>buf, 0, n<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0ca0d53" class="outline-4">
<h4 id="org0ca0d53"><span class="section-number-4">24.5.4.</span> 通过 NetworkStream 简化对 Socket 读写的操作</h4>
<div class="outline-text-4" id="text-24-5-4">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">var</span> s = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">NetworkStream</span><span style="color: #707183;">(</span>socket<span style="color: #707183;">)</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">sr</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StreamReader</span><span style="color: #707183;">(</span>s<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>$<span style="color: #8b2252;">"&#25105;&#25509;&#25910;&#21040;&#20102;&#25968;&#25454;: {sr.ReadToEnd()}"</span><span style="color: #707183;">)</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">sw</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StreamWriter</span><span style="color: #707183;">(</span>s<span style="color: #707183;">)</span>;
sw.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"hello, world"</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c1e0e3" class="outline-4">
<h4 id="org4c1e0e3"><span class="section-number-4">24.5.5.</span> 飞鸽/FeiQ</h4>
<div class="outline-text-4" id="text-24-5-5">
<p>
<a href="https://blog.csdn.net/ufe_1/article/details/47170615">https://blog.csdn.net/ufe_1/article/details/47170615</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org1fc4ef7" class="outline-3">
<h3 id="org1fc4ef7"><span class="section-number-3">24.6.</span> TcpClient/TcpListener</h3>
<div class="outline-text-3" id="text-24-6">
<p>
服务器端:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">listener</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TcpListener</span><span style="color: #707183;">(</span>IPAddress.Any, 8899<span style="color: #707183;">)</span>;
listener.<span style="color: #0000ff;">Start</span><span style="color: #707183;">()</span>;

<span style="color: #a020f0;">while</span> <span style="color: #707183;">(</span><span style="color: #008b8b;">true</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">TcpClient</span> <span style="color: #a0522d;">tc</span> = listener.<span style="color: #0000ff;">AcceptTcpClient</span><span style="color: #7388d6;">()</span>;
    Task.<span style="color: #0000ff;">Run</span><span style="color: #7388d6;">(</span><span style="color: #909183;">()</span> =&gt;
    <span style="color: #909183;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"---"</span><span style="color: #709870;">)</span>;
        <span style="color: #a020f0;">while</span> <span style="color: #709870;">(</span><span style="color: #008b8b;">true</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">{</span>
            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">reader</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StreamReader</span><span style="color: #907373;">(</span>tc.<span style="color: #0000ff;">GetStream</span><span style="color: #6276ba;">()</span><span style="color: #907373;">)</span>;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>$<span style="color: #8b2252;">"&#25509;&#25910;&#21040;&#20102;&#20449;&#24687;: {reader.ReadLine()}"</span><span style="color: #907373;">)</span>;
            Task.<span style="color: #0000ff;">Delay</span><span style="color: #907373;">(</span>1000<span style="color: #907373;">)</span>.<span style="color: #0000ff;">Wait</span><span style="color: #907373;">()</span>;
        <span style="color: #709870;">}</span>
    <span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
客户端:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">tc</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TcpClient</span><span style="color: #707183;">()</span>;
tc.<span style="color: #0000ff;">Connect</span><span style="color: #707183;">(</span>IPAddress.Loopback, 8899<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">var</span> s<span style="color: #a0522d;">w</span> = <span style="color: #a0522d;">new</span> S<span style="color: #a0522d;">treamWriter</span><span style="color: #707183;">(</span><span style="color: #a0522d;">tc</span>.<span style="color: #a0522d;">GetStream</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">while</span> <span style="color: #707183;">(</span><span style="color: #008b8b;">true</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">Write</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#20869;&#23481;: "</span><span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">string</span> <span style="color: #a0522d;">c</span> = Console.<span style="color: #0000ff;">ReadLine</span><span style="color: #7388d6;">()</span>;

    sw.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>c<span style="color: #7388d6;">)</span>;
    sw.<span style="color: #0000ff;">Flush</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5066e75" class="outline-3">
<h3 id="org5066e75"><span class="section-number-3">24.7.</span> UdpClient</h3>
<div class="outline-text-3" id="text-24-7">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">uc</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">UdpClient</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">s</span> = Encoding.UTF8.<span style="color: #0000ff;">GetBytes</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"hello"</span><span style="color: #707183;">)</span>;
uc.<span style="color: #0000ff;">Send</span><span style="color: #707183;">(</span>s, s.Length, <span style="color: #a020f0;">new</span> <span style="color: #228b22;">IPEndPoint</span><span style="color: #7388d6;">(</span>IPAddress.<span style="color: #228b22;">Loopback</span>, 4344<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb33f00f" class="outline-3">
<h3 id="orgb33f00f"><span class="section-number-3">24.8.</span> HttpClient/HttpListener</h3>
<div class="outline-text-3" id="text-24-8">
</div>
<div id="outline-container-orgdf687fe" class="outline-4">
<h4 id="orgdf687fe"><span class="section-number-4">24.8.1.</span> HttpListener</h4>
<div class="outline-text-4" id="text-24-8-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">root</span> = <span style="color: #8b2252;">"e:/myhtml/"</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">webServer</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">HttpListener</span><span style="color: #707183;">()</span>;
webServer.Prefixes.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"http://localhost:8099/"</span><span style="color: #707183;">)</span>;
webServer.<span style="color: #0000ff;">Start</span><span style="color: #707183;">()</span>;

<span style="color: #a020f0;">while</span> <span style="color: #707183;">(</span><span style="color: #008b8b;">true</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">HttpListenerContext</span> <span style="color: #a0522d;">context</span> = webServer.<span style="color: #0000ff;">GetContext</span><span style="color: #7388d6;">()</span>;

    Task.<span style="color: #0000ff;">Run</span><span style="color: #7388d6;">(</span><span style="color: #909183;">()</span> =&gt;
    <span style="color: #909183;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">req</span> = context.Request;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">resp</span> = context.Response;

        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>req.RemoteEndPoint.Address<span style="color: #709870;">)</span>;
        <span style="color: #a020f0;">using</span> <span style="color: #709870;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">sw</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StreamWriter</span><span style="color: #907373;">(</span>resp.OutputStream<span style="color: #907373;">)</span><span style="color: #709870;">)</span>
        <span style="color: #709870;">{</span>

            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">path</span> = req.Url.LocalPath;
            <span style="color: #228b22;">var</span> <span style="color: #a0522d;">fullPath</span> = Path.<span style="color: #0000ff;">Combine</span><span style="color: #907373;">(</span>root, path.<span style="color: #0000ff;">Substring</span><span style="color: #6276ba;">(</span>1<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>;
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #907373;">(</span>fullPath<span style="color: #907373;">)</span>;
            <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>Path.<span style="color: #0000ff;">GetExtension</span><span style="color: #6276ba;">(</span>path<span style="color: #6276ba;">)</span> == <span style="color: #8b2252;">".html"</span><span style="color: #907373;">)</span>
            <span style="color: #907373;">{</span>
                <span style="color: #a020f0;">if</span> <span style="color: #6276ba;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #858580;">(</span>fullPath<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>
                <span style="color: #6276ba;">{</span>
                    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">content</span> = File.<span style="color: #0000ff;">ReadAllText</span><span style="color: #858580;">(</span>fullPath<span style="color: #858580;">)</span>;
                    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #858580;">(</span>content<span style="color: #858580;">)</span>;
                    sw.<span style="color: #0000ff;">WriteLine</span><span style="color: #858580;">(</span>content<span style="color: #858580;">)</span>;
                <span style="color: #6276ba;">}</span>
                <span style="color: #a020f0;">else</span>
                <span style="color: #6276ba;">{</span>
                    resp.ContentType = <span style="color: #8b2252;">"text/html; charset=\"utf-8\""</span>;
                    sw.<span style="color: #0000ff;">WriteLine</span><span style="color: #858580;">(</span><span style="color: #8b2252;">"&#27809;&#26377;&#25214;&#21040;&#32593;&#39029;"</span><span style="color: #858580;">)</span>;
                    resp.StatusCode = 404;
                <span style="color: #6276ba;">}</span>
            <span style="color: #907373;">}</span>
        <span style="color: #709870;">}</span>
        resp.<span style="color: #0000ff;">Close</span><span style="color: #709870;">()</span>;
    <span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>



<div id="outline-container-orga03b142" class="outline-4">
<h4 id="orga03b142"><span class="section-number-4">24.8.2.</span> HttpWebRequest/WebClient/HttpClient</h4>
</div>
</div>
</section>


<section id="outline-container-orgc60f97b" class="outline-2">
<h2 id="orgc60f97b"><span class="section-number-2">25.</span> Database</h2>
<div class="outline-text-2" id="text-25">
<p>
勤学勤练，温故知新。
</p>
</div>

<div id="outline-container-orgb67f9d8" class="outline-3">
<h3 id="orgb67f9d8"><span class="section-number-3">25.1.</span> ADO.NET</h3>
<div class="outline-text-3" id="text-25-1">
</div>
<div id="outline-container-orgbc4ea68" class="outline-4">
<h4 id="orgbc4ea68"><span class="section-number-4">25.1.1.</span> SqlConnection / SqlCommand / SqlDataReader</h4>
<div class="outline-text-4" id="text-25-1-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#19968;&#27493;: &#21019;&#24314;&#36830;&#25509;</span>
    <span style="color: #b22222;">//</span><span style="color: #b22222;">using var conn = new SqlConnection("server=localhost;database=lagou;uid=sa;pwd=sa");</span>
    <span style="color: #b22222;">//</span><span style="color: #b22222;">using var conn = new SqlConnection("server=.;database=lagou;uid=sa;pwd=sa");</span>
    <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> conn = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlConnection</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"server=.;database=lagou;integrated security=SSPI"</span><span style="color: #7388d6;">)</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#20108;&#27493;: &#32452;&#32455;&#26597;&#35810;&#35821;&#21477;</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">command</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlCommand</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"select top 5 position, city, salary_min from lagou_position"</span>, conn<span style="color: #7388d6;">)</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#19977;&#27493;: &#25171;&#24320;&#25968;&#25454;&#24211;&#65292;&#20934;&#22791;&#26597;&#35810;</span>
    conn.<span style="color: #0000ff;">Open</span><span style="color: #7388d6;">()</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#22235;&#27493;: &#26597;&#35810;</span>
    <span style="color: #228b22;">SqlDataReader</span> <span style="color: #a0522d;">reader</span> = command.<span style="color: #0000ff;">ExecuteReader</span><span style="color: #7388d6;">()</span>;
    <span style="color: #a020f0;">while</span> <span style="color: #7388d6;">(</span>reader.<span style="color: #0000ff;">Read</span><span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">position</span> = reader<span style="color: #909183;">[</span>0<span style="color: #909183;">]</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">city</span> = reader<span style="color: #909183;">[</span>1<span style="color: #909183;">]</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">salary</span> = reader<span style="color: #909183;">[</span>2<span style="color: #909183;">]</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{position}: {city}/{salary}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge4b38fe" class="outline-4">
<h4 id="orge4b38fe"><span class="section-number-4">25.1.2.</span> ExecuteScalar / SQL Injection / Parameters</h4>
<div class="outline-text-4" id="text-25-1-2">
<p>
在珠海，Salary_min 最高的 C# 岗位的 Salary_max 是多少:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #0000ff;">GetSalayMaxFromCity</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#29664;&#28023;"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#36825;&#23601;&#26159;SQL&#27880;&#20837;&#38382;&#39064;</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">city</span> = <span style="color: #8b2252;">"&#29664;&#28023;';drop table lagou_position;select * from lagou_position where 1='"</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">sql0</span> = $<span style="color: #8b2252;">"select * from lagou_position where city = '{city}'"</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">sql0</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">double</span> <span style="color: #0000ff;">GetSalayMaxFromCity</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">city</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#19968;&#27493;: &#21019;&#24314;&#36830;&#25509;</span>
        <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> conn = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlConnection</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"server=.;database=lagou;uid=sa;pwd=sa"</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#20108;&#27493;: &#32452;&#32455;&#35821;&#21477;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">sql</span> = $<span style="color: #8b2252;">"select top 1 salary_max from lagou_position where city = '{city}' and (position like '%c#%' or position like '%.net%') order by salary_min desc"</span>;
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">command</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlCommand</span><span style="color: #909183;">(</span><span style="color: #228b22;">sql</span>, <span style="color: #228b22;">conn</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#19977;&#27493;: &#25171;&#24320;&#25968;&#25454;&#24211;</span>
        conn.<span style="color: #0000ff;">Open</span><span style="color: #909183;">()</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#22235;&#27493;: &#26597;&#35810;</span>
        <span style="color: #228b22;">double</span> <span style="color: #a0522d;">salaryMax</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">double</span><span style="color: #909183;">)</span>command.<span style="color: #0000ff;">ExecuteScalar</span><span style="color: #909183;">()</span>;

        <span style="color: #a020f0;">return</span> salaryMax;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
解决 SQL 注入，最朴素的方式，是对传入的字符串中的特殊字符进行替换:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#20294;&#26159;&#35201;&#27880;&#24847;&#65292;&#36825;&#31181;&#26041;&#24335;&#32477;&#23545;&#19981;&#21487;&#33021; 100% &#38450;&#27490;&#27880;&#20837;</span>
city = city.<span style="color: #0000ff;">Replace</span><span style="color: #707183;">(</span><span style="color: #8b2252;">'-'</span>, <span style="color: #8b2252;">'&#12289;'</span><span style="color: #707183;">)</span>;
city = city.<span style="color: #0000ff;">Replace</span><span style="color: #707183;">(</span><span style="color: #8b2252;">'\''</span>, <span style="color: #8b2252;">'&#8217;'</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
Parameters 可以 a) 简化代码 b) 防止 SQL 注入:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #0000ff;">GetSalayMaxFromCity</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#29664;&#28023;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#36825;&#23601;&#26159;SQL&#27880;&#20837;&#38382;&#39064;</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">city</span> = <span style="color: #8b2252;">"&#29664;&#28023;';drop table lagou_position;select * from lagou_position where 1='"</span>;

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">sql0</span> = $<span style="color: #8b2252;">"select * from lagou_position where city = '{city}'"</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">sql0</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">GetSalayMaxFromCity</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">city</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#19968;&#27493;: &#21019;&#24314;&#36830;&#25509;</span>
        <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> conn = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlConnection</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"server=.;database=lagou;uid=sa;pwd=sa"</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#20108;&#27493;: &#32452;&#32455;&#35821;&#21477;</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">command</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlCommand</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"select top 5 city, position from lagou_position where city=@xxx and salary_min &gt; @aaa"</span>, <span style="color: #228b22;">conn</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">//</span><span style="color: #b22222;">command.Parameters.AddWithValue("xxx", city); // &#32465;&#23450;&#21040;&#20102; xxx &#20301;&#32622;</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">command.Parameters.AddWithValue("aaa", 20);</span>

        command.Parameters.<span style="color: #0000ff;">AddRange</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span><span style="color: #709870;">[]</span>
        <span style="color: #709870;">{</span>
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlParameter</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"xxx"</span>, SqlDbType.<span style="color: #228b22;">VarChar</span><span style="color: #907373;">)</span> <span style="color: #907373;">{</span>Value = city<span style="color: #907373;">}</span>,
            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlParameter</span><span style="color: #907373;">(</span><span style="color: #8b2252;">"aaa"</span>, SqlDbType.<span style="color: #228b22;">Int</span><span style="color: #907373;">)</span> <span style="color: #907373;">{</span>Value = 20<span style="color: #907373;">}</span>
        <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;


        <span style="color: #b22222;">//</span><span style="color: #b22222;">command.Parameters.Add("xxx", SqlDbType.VarChar);</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">command.Parameters["xxx"].Value = city;</span>

        <span style="color: #b22222;">//</span><span style="color: #b22222;">var param = new SqlParameter("xxx", SqlDbType.VarChar);</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">param.Value = city;</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">command.Parameters.Add(param);</span>

        <span style="color: #b22222;">//</span><span style="color: #b22222;">command.Parameters.Add(new SqlParameter("xxx", SqlDbType.VarChar) {Value = city});</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#19977;&#27493;: &#25171;&#24320;&#25968;&#25454;&#24211;</span>
        conn.<span style="color: #0000ff;">Open</span><span style="color: #909183;">()</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#22235;&#27493;: &#26597;&#35810;</span>
        <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> reader = command.<span style="color: #0000ff;">ExecuteReader</span><span style="color: #909183;">()</span>;
        <span style="color: #a020f0;">while</span> <span style="color: #909183;">(</span>reader.<span style="color: #0000ff;">Read</span><span style="color: #709870;">()</span><span style="color: #909183;">)</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span>$<span style="color: #8b2252;">"-- {reader[0]}: {reader["</span>position<span style="color: #8b2252;">"]}"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf83cfa0" class="outline-4">
<h4 id="orgf83cfa0"><span class="section-number-4">25.1.3.</span> SqlDataReader vs SqlDataAdapter/DataTable</h4>
<div class="outline-text-4" id="text-25-1-3">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> conn = DbHelper.<span style="color: #0000ff;">GetConnection</span><span style="color: #7388d6;">()</span>;
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">command</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlCommand</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"select * from students"</span>, conn<span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> reader = command.<span style="color: #0000ff;">ExecuteReader</span><span style="color: #7388d6;">()</span>;

    <span style="color: #228b22;">DataTable</span> <span style="color: #a0522d;">dataTable</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">DataTable</span><span style="color: #7388d6;">()</span>;
    dataTable.<span style="color: #0000ff;">Load</span><span style="color: #7388d6;">(</span>reader<span style="color: #7388d6;">)</span>;

    <span style="color: #a020f0;">foreach</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">DataRow</span> <span style="color: #a0522d;">row</span> <span style="color: #a020f0;">in</span> dataTable.Rows<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"{row[0]}:{row[1]}:{row[2]}"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #707183;">(</span><span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">DataTable</span> <span style="color: #a0522d;">dataTable</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">DataTable</span><span style="color: #7388d6;">()</span>;

    <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> conn = DbHelper.<span style="color: #0000ff;">GetConnection</span><span style="color: #7388d6;">()</span>;
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">adapter</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlDataAdapter</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"select name, tiwen_cishu, tiwen_fenshu from students where gid = @gid"</span>, conn<span style="color: #7388d6;">)</span>;
    adapter.SelectCommand.Parameters.<span style="color: #0000ff;">AddWithValue</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"gid"</span>, 2<span style="color: #7388d6;">)</span>;
    adapter.<span style="color: #0000ff;">Fill</span><span style="color: #7388d6;">(</span>dataTable<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1b59814" class="outline-3">
<h3 id="org1b59814"><span class="section-number-3">25.2.</span> Entity Framework</h3>
<div class="outline-text-3" id="text-25-2">
<ul class="org-ul">
<li><a href="https://docs.microsoft.com/zh-cn/ef/">https://docs.microsoft.com/zh-cn/ef/</a></li>
<li><a href="https://github.com/dotnet/EntityFramework.Docs">https://github.com/dotnet/EntityFramework.Docs</a></li>
</ul>
</div>

<div id="outline-container-org91cd06d" class="outline-4">
<h4 id="org91cd06d"><span class="section-number-4">25.2.1.</span> 历史</h4>
<div class="outline-text-4" id="text-25-2-1">
<p>
Entity Framework:
</p>
<ul class="org-ul">
<li>1.0，.NET 3.5，微软推出了自己的 <b>ORM</b> 框架，叫 Entity Framework，简称 EF</li>
<li>4.0，这个版本因为添加了太多内容，所以微软为了表示与以前不同，就直接跳过了 2/3 到了 4</li>
<li>6.0，这是当前最新的版本</li>
</ul>

<p>
随着 .net core 的发布，Entity Framework 被微软完全重写了。
</p>
</div>
</div>

<div id="outline-container-orgf816245" class="outline-4">
<h4 id="orgf816245"><span class="section-number-4">25.2.2.</span> EF6</h4>
<div class="outline-text-4" id="text-25-2-2">
<p>
<a href="https://docs.microsoft.com/zh-cn/ef/ef6/modeling/">https://docs.microsoft.com/zh-cn/ef/ef6/modeling/</a>
</p>

<p>
优点:
</p>
<ul class="org-ul">
<li>漫长的积淀，非常成熟、非常稳定</li>
<li>功能上相对强大</li>
</ul>
</div>

<div id="outline-container-org8558171" class="outline-5">
<h5 id="org8558171"><span class="section-number-5">25.2.2.1.</span> 模型生成 (基于 edmx)</h5>
<div class="outline-text-5" id="text-25-2-2-1">
<p>
基于 edmx 和 VS Designer 的生成方式:
</p>
<ol class="org-ol">
<li><b>Database First</b> 方式
<ul class="org-ul">
<li>通过在 VS 中添加 [ADO.NET 实体数据模型] - [从数据库生成] 的方式，直接将数据库中的表映射为 edmx 文件</li>
<li>通过修改 edmx 之后再保存，达到自动生成/更新相应的 Model 和相关类的目的</li>
</ul></li>
<li><b>Model First</b> 方式</li>
</ol>

<p>
实体数据模型 edms (Entity Data Model XML):
</p>
<ul class="org-ul">
<li>edmx 主要分为三部分:
<ol class="org-ol">
<li>SSDL (Store Schema Definition Language) 描述数据库中的实体结构</li>
<li>CSDL (Conceptual Schema Definition Language) 描述 Csharp 模型</li>
<li>MSL (Mapping Specification Language) 描述数据库中的对象跟模型对象之间的映射关系</li>
</ol></li>
<li>tt 后缀名的文件，表示的是 <b>t4</b> (Text Template Transformation Toolkit) 引擎的文件，它用来自动生成相关的类文件</li>
<li>在 Entity Framework Core 中，这种方式，已经被遗弃</li>
</ul>

<p>
留下在问题:
</p>
<ul class="org-ul">
<li>edmx 是什么？包含哪几部分？请做描述</li>
<li>基于 edmx 的开发方式，有什么优点和缺点?</li>
</ul>
</div>
</div>

<div id="outline-container-org00357a0" class="outline-5">
<h5 id="org00357a0"><span class="section-number-5">25.2.2.2.</span> 模型生成 (Code First)</h5>
<div class="outline-text-5" id="text-25-2-2-2">
<p>
通过编码的方式，创建 Model 和 Database:
</p>
<ul class="org-ul">
<li><a href="https://docs.microsoft.com/en-us/ef/ef6/modeling/code-first/workflows/new-database">https://docs.microsoft.com/en-us/ef/ef6/modeling/code-first/workflows/new-database</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgd42a80e" class="outline-4">
<h4 id="orgd42a80e"><span class="section-number-4">25.2.3.</span> EFCore</h4>
<div class="outline-text-4" id="text-25-2-3">
<p>
官方文档:
</p>
<ul class="org-ul">
<li><a href="https://docs.microsoft.com/zh-cn/ef/">https://docs.microsoft.com/zh-cn/ef/</a></li>
</ul>

<p>
安装依赖:
</p>
<ul class="org-ul">
<li>Microsoft.EntityFrameworkCore [必须依赖]</li>
<li>Microsoft.EntityFrameworkCore.SqlServer [按照数据库选择相应的]</li>
</ul>

<p>
命令行添加:
</p>
<div class="org-src-container">
<pre class="src src-sh">dotnet new console
dotnet add package Microsoft.EntityFrameworkCore.SqlServer
</pre>
</div>
</div>
</div>

<div id="outline-container-org2501b18" class="outline-4">
<h4 id="org2501b18"><span class="section-number-4">25.2.4.</span> 上下文 (DbContext/DbSet)</h4>
<div class="outline-text-4" id="text-25-2-4">
<p>
DbContext 代表数据库的会话管理：
</p>
<ul class="org-ul">
<li>这个设计本身是轻量级的。new 后，使用，用完，释放。*using 必须要使用*</li>
<li>管理 Entity，需要实现自己的 DbContext</li>
<li>将要管理的 Entity，使用 DbSet&lt;T&gt; 的方式暴露出来</li>
<li>使用 <code>OnConfiguring</code> 来进行 <b>初始配置</b>:
<ul class="org-ul">
<li>配置数据库连接: options.UseSqlServer(connStr)</li>
<li>配置日志的输出: options.LogTo(Console.WriteLine);</li>
</ul></li>
<li>使用 <code>OnModelCreating</code> 方法，用来在模型对象创建之后，做一些 <b>后续调整</b></li>
</ul>
</div>
</div>

<div id="outline-container-orge332288" class="outline-4">
<h4 id="orge332288"><span class="section-number-4">25.2.5.</span> 模型的三个层次</h4>
<div class="outline-text-4" id="text-25-2-5">
<p>
<b>约定</b>:
</p>
<ul class="org-ul">
<li>CoC, Convention Over Configuration, 约定大于配置, Ruby, RoR, Ruby on Rails, Web: CoC</li>
<li>Entity 对应的表的名字，默认为 DbSet 属性的名字</li>
<li>Id 后缀名命名的 int/Guid 类型，会被当成数据库表的主键 (Id -&gt; EntityId)</li>
<li><p>
类型约定:
</p>
<pre class="example">
int -&gt; int,
string -&gt; nvarchar(max)
enum -&gt; int,notnull
double -&gt; float,notnull
DateTime -&gt; datetime2
</pre></li>
<li>字段、只有 get 的属性，是不能被映射到数据库的</li>
</ul>

<p>
<b>[注解]</b> (System.ComponentModel.DataAnnotations):
</p>
<ul class="org-ul">
<li>Table/Column/NotMapped</li>
<li>ForeignKey/Key/DatatableGenerated</li>
<li>Require/StringLength/MinLength/MaxLength/Range</li>
<li>RegularExpression/Phone/EmailAddress/Url/CreditCard</li>
<li>Index</li>
<li><a href="https://blog.csdn.net/a123_z/article/details/112279594">https://blog.csdn.net/a123_z/article/details/112279594</a></li>
</ul>

<p>
<b>Fluent API</b>:
</p>
<ul class="org-ul">
<li>写在 OnModelCreating 里面</li>
<li>它跟注解都能达到配置模型和映射的目的，但他们并不是互斥的关系，而是一种互相补充</li>
<li><a href="https://www.cnblogs.com/yanglang/p/7212203.html">https://www.cnblogs.com/yanglang/p/7212203.html</a></li>
</ul>
</div>
</div>

<div id="outline-container-org731eef2" class="outline-4">
<h4 id="org731eef2"><span class="section-number-4">25.2.6.</span> 模型之间的关系</h4>
<div class="outline-text-4" id="text-25-2-6">
<p>
导航属性:
</p>
<pre class="example" id="org413ffdf">
class Teacher // table teacher: id/name
{
   Id;
   Name;
}
class Student // table student: id/name/teacherid
{
   Id;
   Name;
   TeacherId; // 外键
}

class Blog
{
  Id;
  Url;
  -----
  Posts; // 导航属性
}
class Post
{
  Id;
  Title;
  Content;
  BlogId;
}
</pre>

<p>
基于约定和注解:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BloggingContext</span> : <span style="color: #228b22;">DbContext</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">OnConfiguring</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">DbContextOptionsBuilder</span> <span style="color: #a0522d;">options</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        options.<span style="color: #0000ff;">UseSqlServer</span><span style="color: #909183;">(</span>ConfigurationManager.ConnectionStrings<span style="color: #709870;">[</span><span style="color: #8b2252;">"blogdb"</span><span style="color: #709870;">]</span>.ConnectionString<span style="color: #909183;">)</span>;
        options.<span style="color: #0000ff;">LogTo</span><span style="color: #909183;">(</span>LogHelper.WriteToFile, Microsoft.Extensions.Logging.LogLevel.Information<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">OnModelCreating</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ModelBuilder</span> <span style="color: #a0522d;">modelBuilder</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">base</span>.<span style="color: #0000ff;">OnModelCreating</span><span style="color: #909183;">(</span>modelBuilder<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">DbSet</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Blog</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">Blogs</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">DbSet</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Post</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">Posts</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">DbSet</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">Books</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">DbSet</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">User</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">Users</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">blog vs post</span>

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Blog</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">BlogId</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Url</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Post</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">Posts</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Post</span><span style="color: #7388d6;">&gt;()</span>;
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Post</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">PostId</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Title</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Content</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">BlogId</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Blog</span> <span style="color: #a0522d;">Blog</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">bookStore</span>

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Book</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">BookId</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Name</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">DateTime</span> <span style="color: #a0522d;">PublishedAt</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">AuthorId</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span>? <span style="color: #a0522d;">ReviewerId</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #7388d6;">[</span><span style="color: #0000ff;">ForeignKey</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"AuthorId"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">]</span>
    <span style="color: #a020f0;">public</span> User Author <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #7388d6;">[</span><span style="color: #0000ff;">ForeignKey</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"ReviewerId"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">]</span>
    <span style="color: #a020f0;">public</span> User Reviewer <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Chapter</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">Chapters</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Chapter</span><span style="color: #7388d6;">&gt;()</span>;

    <span style="color: #7388d6;">[</span><span style="color: #0000ff;">InverseProperty</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"Book"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">]</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Comment</span><span style="color: #7388d6;">&gt;</span> Comments <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Comment</span><span style="color: #7388d6;">&gt;()</span>;

<span style="color: #707183;">}</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Chapter</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">Id</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Title</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">BookId</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Book</span> <span style="color: #a0522d;">Book</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Comment</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">Id</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Content</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">BookId</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Book</span> <span style="color: #a0522d;">Book</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">User</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">UserId</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Name</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #7388d6;">[</span><span style="color: #0000ff;">InverseProperty</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"Author"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">]</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #7388d6;">&gt;</span> WriteBooks <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #7388d6;">&gt;()</span>;

    <span style="color: #7388d6;">[</span><span style="color: #0000ff;">InverseProperty</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"Reviewer"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">]</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #7388d6;">&gt;</span> ReviewBooks <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #7388d6;">&gt;()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
错误:
</p>
<pre class="example" id="org550f45d">
Unhandled exception. Microsoft.Data.SqlClient.SqlException (0x80131904): 将 FOREIGN KEY 约束 'FK_Books_Users_ReviewerId' 引入表 'Books' 可能会导 致循环或多重级联路径。请指定 ON DELETE NO ACTION 或 ON UPDATE NO ACTION，或修改其他 FOREIGN KEY 约束。
无法创建约束或索引。请参阅前面的错误。


[Solution] 两种方案:
第一种，将 AuthorId 或 ReviewId 设为可空类型
第二种，使用 FluentAPI 禁止级联删除 .OnDelete(...)
</pre>
</div>
</div>

<div id="outline-container-org272d158" class="outline-4">
<h4 id="org272d158"><span class="section-number-4">25.2.7.</span> 数据查询</h4>
<div class="outline-text-4" id="text-25-2-7">
<p>
Where/Find:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">List&lt;Post&gt; posts = db.Posts.ToList();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(posts.Count());</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">List&lt;Post&gt; posts = await db.Posts.ToListAsync();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(posts.Count());</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">List&lt;Post&gt; posts = db.Posts.ToList();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">var postIdGt5 = posts.Where(p =&gt; p.PostId &gt; 5).ToList();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(postIdGt5.Count());</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">var posts = db.Posts;</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">var postIdGt5 = posts.Where(p =&gt; p.PostId &gt; 5).ToList();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(postIdGt5.Count());</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">DbSet&lt;Post&gt; posts = db.Posts;</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">IQueryable&lt;Post&gt; postIdGt5 = posts.Where(p =&gt; p.PostId &gt; 5);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(postIdGt5.Count());</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">var posts = db.Posts;</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">var postIdGt5 = posts.Where(p =&gt; p.PostId &gt; 5);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(postIdGt5.Count());</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(db.Posts</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.Where(p =&gt; p.PostId &gt; 5)</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.Where(p =&gt; p.Title.Length &gt; 0)</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.Count());</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(db.Posts</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.Where(p =&gt; p.PostId &gt; 5 &amp;&amp; p.Title.Length &gt; 2)</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.Where(p =&gt; p.Content != null)</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">//.Pagination(5)</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.Count()) ;</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Post post = db.Posts.Where(p =&gt; p.PostId == 1).ToList()[0];</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(post.BlogId);</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Post post = db.Posts.Where(p =&gt; p.PostId == 1).First();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(post.BlogId);</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Post post = db.Posts.Where(p =&gt; p.PostId == 1).Single();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(post.PostId);</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Post post = db.Posts.Find(1);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(post.PostId);</span>

<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">var</span> d<span style="color: #a0522d;">b</span> = <span style="color: #a0522d;">new</span> B<span style="color: #a0522d;">loggingContext</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">Post</span> <span style="color: #a0522d;">p</span> = db.Posts.<span style="color: #0000ff;">FromSqlRaw</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"select * from Posts join xxx on xxx... where postid = 3"</span><span style="color: #707183;">)</span>.<span style="color: #0000ff;">Single</span><span style="color: #707183;">()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>p.Title<span style="color: #707183;">)</span>;
</pre>
</div>

<p>
关联查询:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#26174;&#24335;&#12289;&#25163;&#21160;&#12289;&#20027;&#21160;&#21152;&#36733;</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Blog b = db.Blogs.Find(1);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">db.Entry(b).Collection(b =&gt; b.Posts).Load();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">db.Entry(b).Collection(b =&gt; b.Bs).Load();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">db.Entry(b).Collection(b =&gt; b.Cs).Load();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine($"{b.BlogId}, {b.Url}");</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(b.Posts.Count());</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Post p = db.Posts.Find(1);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">db.Entry(p).Reference(p =&gt; p.Blog).Load();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine($"{p.Title}");</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(p.Blog.Url);</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Post p = db.Posts.Find(1);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(p.Title);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Thread.Sleep(10000);</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">db.Entry(p).Reload();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(p.Title);</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#21160;&#24577;&#12289;&#23454;&#26102;&#21152;&#36733;</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Post p = db.Posts</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.Where(p =&gt; p.PostId == 1)</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.Include(p =&gt; p.Blog)</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.Single();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(p.Blog.Url);</span>

<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">var</span> d<span style="color: #a0522d;">b</span> = <span style="color: #a0522d;">new</span> B<span style="color: #a0522d;">loggingContext</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">Post</span> <span style="color: #a0522d;">p</span> = db.Posts
    .<span style="color: #0000ff;">Where</span><span style="color: #707183;">(</span>p =&gt; p.PostId == 1<span style="color: #707183;">)</span>
    .<span style="color: #0000ff;">Include</span><span style="color: #707183;">(</span>p =&gt; p.Blog<span style="color: #707183;">)</span>
    .<span style="color: #0000ff;">ThenInclude</span><span style="color: #707183;">(</span>b =&gt; b.Posts<span style="color: #707183;">)</span>
    .<span style="color: #0000ff;">Single</span><span style="color: #707183;">()</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>p.Blog.Posts.<span style="color: #0000ff;">Count</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">//</span><span style="color: #b22222;">using var db = new BloggingContext();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Post p = db.Posts</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.Where(p =&gt; p.PostId == 1)</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.Include(p =&gt; p.Blog)</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.ThenInclude(b =&gt; b.Posts)</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.AsSplitQuery()</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.Single();</span>
<span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(p.Blog.Posts.Count());</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20195;&#29702;&#26041;&#24335; Proxy</span>

<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">var</span> d<span style="color: #a0522d;">b</span> = <span style="color: #a0522d;">new</span> B<span style="color: #a0522d;">loggingContext</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">Blog</span> <span style="color: #a0522d;">p1</span> = db.Blogs.<span style="color: #0000ff;">Find</span><span style="color: #707183;">(</span>1<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>p1.Posts.<span style="color: #0000ff;">Count</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org20ced09" class="outline-4">
<h4 id="org20ced09"><span class="section-number-4">25.2.8.</span> 数据修改</h4>
</div>
<div id="outline-container-org8a170b5" class="outline-4">
<h4 id="org8a170b5"><span class="section-number-4">25.2.9.</span> 日志</h4>
<div class="outline-text-4" id="text-25-2-9">
</div>
<div id="outline-container-org449e710" class="outline-5">
<h5 id="org449e710"><span class="section-number-5">25.2.9.1.</span> 使用 options.LogTo 方法</h5>
<div class="outline-text-5" id="text-25-2-9-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#35760;&#24405;&#21040;&#25511;&#21046;&#21488;</span>
options.<span style="color: #0000ff;">LogTo</span><span style="color: #707183;">(</span>Console.<span style="color: #228b22;">WriteLine</span>, Microsoft.Extensions.Logging.LogLevel.<span style="color: #228b22;">Information</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#35760;&#24405;&#21040;&#25991;&#20214;</span>
options.<span style="color: #0000ff;">LogTo</span><span style="color: #707183;">(</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">log</span><span style="color: #7388d6;">)</span> =&gt;
<span style="color: #7388d6;">{</span>
    File.<span style="color: #0000ff;">AppendAllText</span><span style="color: #909183;">(</span>@<span style="color: #8b2252;">"e:\log1111.txt"</span>, $<span style="color: #8b2252;">"\n\n{log}"</span><span style="color: #909183;">)</span>;
    <span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(log);</span>
<span style="color: #7388d6;">}</span>, Microsoft.Extensions.Logging.LogLevel.Information<span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#21487;&#20197;&#31616;&#21270;&#20026;:</span>
options.<span style="color: #0000ff;">LogTo</span><span style="color: #707183;">(</span>log =&gt; File.<span style="color: #0000ff;">AppendAllText</span><span style="color: #7388d6;">(</span>@<span style="color: #8b2252;">"e:\log1111.txt"</span>, $<span style="color: #8b2252;">"\n\n{log}"</span><span style="color: #7388d6;">)</span>, Microsoft.Extensions.Logging.LogLevel.Information<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgda84140" class="outline-4">
<h4 id="orgda84140"><span class="section-number-4">25.2.10.</span> 集成容器</h4>
<div class="outline-text-4" id="text-25-2-10">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">//</span><span style="color: #b22222;">var di = new ServiceCollection()</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.AddTransient&lt;BloggingContext&gt;()</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.AddSingleton&lt;PostService&gt;()</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.BuildServiceProvider();</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">var di = new ServiceCollection()</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.AddDbContext&lt;BloggingContext&gt;()</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.AddSingleton&lt;PostService&gt;()</span>
<span style="color: #b22222;">//    </span><span style="color: #b22222;">.BuildServiceProvider();</span>

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">di</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ServiceCollection</span><span style="color: #707183;">()</span>
    .<span style="color: #0000ff;">AddDbContext</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">BloggingContext</span><span style="color: #707183;">&gt;(</span>options =&gt; options.<span style="color: #0000ff;">UseSqlServer</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"server=.;database=ccc;uid=sa;pwd=sa"</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
    .<span style="color: #0000ff;">AddSingleton</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">PostService</span><span style="color: #707183;">&gt;()</span>
    .<span style="color: #0000ff;">BuildServiceProvider</span><span style="color: #707183;">()</span>;

di.<span style="color: #0000ff;">GetService</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">PostService</span><span style="color: #707183;">&gt;()</span>.<span style="color: #0000ff;">Xxxx</span><span style="color: #707183;">()</span>;
<span style="color: #b22222;">//</span><span style="color: #b22222;">new PostService().Xxxx();</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1bdad3d" class="outline-4">
<h4 id="org1bdad3d"><span class="section-number-4">25.2.11.</span> 三层架构</h4>
</div>

<div id="outline-container-orgebd8559" class="outline-4">
<h4 id="orgebd8559"><span class="section-number-4">25.2.12.</span> 随堂代码</h4>
<div class="outline-text-4" id="text-25-2-12">
</div>
<div id="outline-container-orgeb840c2" class="outline-5">
<h5 id="orgeb840c2"><span class="section-number-5">25.2.12.1.</span> 2021年11月10日 (基本使用)</h5>
<div class="outline-text-5" id="text-25-2-12-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BloggingContext</span> : <span style="color: #228b22;">DbContext</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">DbSet</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Blog</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">BlogSet</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">DbSet</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Post</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">Posts</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">OnConfiguring</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">DbContextOptionsBuilder</span> <span style="color: #a0522d;">options</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">options.UseSqlServer("server=.;database=ccc;uid=sa;pwd=sa");</span>
        options.<span style="color: #0000ff;">UseSqlServer</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"blogdb"</span><span style="color: #909183;">)</span>;

    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">OnModelCreating</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ModelBuilder</span> <span style="color: #a0522d;">modelBuilder</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">base</span>.<span style="color: #0000ff;">OnModelCreating</span><span style="color: #909183;">(</span>modelBuilder<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Blog</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">BlogId</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Url</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Post</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">Posts</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #7388d6;">}</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Post</span><span style="color: #7388d6;">&gt;()</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">ToString</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> $<span style="color: #8b2252;">"{{{nameof(BlogId)}={BlogId.ToString()}, {nameof(Url)}={Url}, {nameof(Posts)}={Posts}}}"</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Post</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">PostId</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Title</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Content</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">Desc</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">BlogId</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Blog</span> <span style="color: #a0522d;">Blog</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #0000ff;">NewMethod</span><span style="color: #909183;">()</span>;

    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">BloggingContext</span> <span style="color: #0000ff;">NewMethod</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">db</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BloggingContext</span><span style="color: #909183;">()</span>;

        db.BlogSet.<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.BlogId == 99<span style="color: #909183;">)</span>;
        db.BlogSet.<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.BlogId == 96<span style="color: #909183;">)</span>;
        db.BlogSet.<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.BlogId == 95<span style="color: #909183;">)</span>;

        <span style="color: #b22222;">//</span><span style="color: #b22222;">IQueryable&lt;Blog&gt; blogs = db.Blogs.Where(b =&gt; b.BlogId &gt; 94);</span>

        <span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(blogs.Count());</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(blogs.Max(b =&gt; b.BlogId));</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(blogs.OrderBy(b =&gt; b.Url).Last());</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(blogs.Count());</span>

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">blogs</span> = db.BlogSet
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.BlogId &gt; 94<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.Url.Length &gt; 3<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">OrderByDescending</span><span style="color: #909183;">(</span>b =&gt; b.BlogId<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.Url.Length % 2 == 0 &amp;&amp; b.BlogId % 2 == 1<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.Posts.<span style="color: #0000ff;">Any</span><span style="color: #709870;">(</span>p =&gt; p.Title.Length &gt; 20<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.Url.Length &gt; 3<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">OrderByDescending</span><span style="color: #909183;">(</span>b =&gt; b.Url<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.BlogId % 2 != 1<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Pagination</span><span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.Posts.<span style="color: #0000ff;">Any</span><span style="color: #709870;">(</span>p =&gt; p.Title.Length &gt; 20<span style="color: #709870;">)</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">//</span><span style="color: #b22222;">blogs = Pagination(blogs, 3);</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">blogs = blogs.Where(b =&gt; b.Posts.Any(p =&gt; p.Title.Length &gt; 20));</span>

        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">b</span> <span style="color: #a020f0;">in</span> blogs<span style="color: #909183;">)</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">b</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> db;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">IQueryable</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Blog</span><span style="color: #7388d6;">&gt;</span> <span style="color: #0000ff;">Pagination</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">IQueryable</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Blog</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">query</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">pageNum</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">pageSize</span> = 5<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> query.<span style="color: #0000ff;">Skip</span><span style="color: #909183;">(</span><span style="color: #709870;">(</span>pageNum - 1<span style="color: #709870;">)</span> * pageSize<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Take</span><span style="color: #909183;">(</span><span style="color: #228b22;">pageSize</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyExtendMethods1</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">IQueryable</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">T</span><span style="color: #7388d6;">&gt;</span> <span style="color: #0000ff;">Pagination</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">T</span><span style="color: #7388d6;">&gt;(</span><span style="color: #a020f0;">this</span> <span style="color: #228b22;">IQueryable</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">T</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">query</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">pageNum</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">pageSize</span> = 5<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> query.<span style="color: #0000ff;">Skip</span><span style="color: #909183;">(</span><span style="color: #709870;">(</span>pageNum - 1<span style="color: #709870;">)</span> * pageSize<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Take</span><span style="color: #909183;">(</span><span style="color: #228b22;">pageSize</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8ed44a" class="outline-5">
<h5 id="orgb8ed44a"><span class="section-number-5">25.2.12.2.</span> 2021年11月11日 (模型创建)</h5>
<div class="outline-text-5" id="text-25-2-12-2">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BloggingContext</span> : <span style="color: #228b22;">DbContext</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">DbSet</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Blog</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">BlogSet</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">DbSet</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Post</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">Posts</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">DbSet</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">User</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">Users</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">OnConfiguring</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">DbContextOptionsBuilder</span> <span style="color: #a0522d;">options</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">options.UseSqlServer("server=.;database=ccc;uid=sa;pwd=sa");</span>
        options.<span style="color: #0000ff;">UseSqlServer</span><span style="color: #909183;">(</span>ConfigurationManager.ConnectionStrings<span style="color: #709870;">[</span><span style="color: #8b2252;">"blogdb"</span><span style="color: #709870;">]</span>.ConnectionString<span style="color: #909183;">)</span>;
        <span style="color: #b22222;">//</span><span style="color: #b22222;">options.UseSqlite(ConfigurationManager.ConnectionStrings["sqlite"].ConnectionString);</span>
        options.<span style="color: #0000ff;">LogTo</span><span style="color: #909183;">(</span>LogHelper.WriteToFile, Microsoft.Extensions.Logging.LogLevel.Information<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">OnModelCreating</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ModelBuilder</span> <span style="color: #a0522d;">modelBuilder</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">base</span>.<span style="color: #0000ff;">OnModelCreating</span><span style="color: #909183;">(</span>modelBuilder<span style="color: #909183;">)</span>;

        modelBuilder.<span style="color: #0000ff;">Entity</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Blog</span><span style="color: #909183;">&gt;()</span>
            .<span style="color: #0000ff;">ToTable</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"MyBlogs"</span><span style="color: #909183;">)</span>;

        modelBuilder
            .<span style="color: #0000ff;">Entity</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">User</span><span style="color: #909183;">&gt;()</span>
            .<span style="color: #0000ff;">HasKey</span><span style="color: #909183;">(</span>u =&gt; u.Username<span style="color: #909183;">)</span>;

        modelBuilder
            .<span style="color: #0000ff;">Entity</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">User</span><span style="color: #909183;">&gt;()</span>
            .<span style="color: #0000ff;">Property</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"Username"</span><span style="color: #909183;">)</span>.<span style="color: #0000ff;">HasColumnName</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"my_usernmae"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>


<span style="color: #707183;">[</span><span style="color: #a0522d;">ComplexType</span><span style="color: #707183;">]</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> X
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">A</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">B</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #707183;">[</span><span style="color: #0000ff;">Table</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"Blogs"</span><span style="color: #7388d6;">)</span><span style="color: #707183;">]</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> Blog
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">BlogId</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #7388d6;">[</span><span style="color: #0000ff;">Column</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"BlogUrl"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">]</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> Url <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Post</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">Posts</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #7388d6;">}</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Post</span><span style="color: #7388d6;">&gt;()</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">enum</span> <span style="color: #228b22;">Zhiliang</span>
<span style="color: #707183;">{</span>
    <span style="color: #a0522d;">Gao</span>, <span style="color: #a0522d;">Di</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Post</span>
<span style="color: #707183;">{</span>
    <span style="color: #7388d6;">[</span><span style="color: #a0522d;">Key</span><span style="color: #7388d6;">]</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> PostId <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #7388d6;">[</span><span style="color: #a0522d;">Required</span><span style="color: #7388d6;">]</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> Title <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #7388d6;">[</span><span style="color: #0000ff;">StringLength</span><span style="color: #909183;">(</span>1000<span style="color: #909183;">)</span><span style="color: #7388d6;">]</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> Content <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #7388d6;">[</span><span style="color: #0000ff;">Column</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"post_desc"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">]</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> Desc <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Zhiliang</span> <span style="color: #a0522d;">ZL</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #7388d6;">[</span><span style="color: #0000ff;">Range</span><span style="color: #909183;">(</span>0, 1000<span style="color: #909183;">)</span><span style="color: #7388d6;">]</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">double</span> Price <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span> = 55.2;
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">DateTime</span> <span style="color: #a0522d;">CreatedAt</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>

    <span style="color: #7388d6;">[</span><span style="color: #0000ff;">ForeignKey</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"fk_hello_blog"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">]</span>
    <span style="color: #7388d6;">[</span><span style="color: #0000ff;">Column</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"xxxx"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">]</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> BlogId <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Blog</span> <span style="color: #a0522d;">Blog</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">User</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span>  <span style="color: #a0522d;">Username</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span>  <span style="color: #a0522d;">Address</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span>  <span style="color: #a0522d;">Weixin</span> <span style="color: #7388d6;">{</span> <span style="color: #a020f0;">get</span>; <span style="color: #a020f0;">set</span>; <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">string</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> db = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BloggingContext</span><span style="color: #909183;">()</span>;
        db.Database.<span style="color: #0000ff;">EnsureDeleted</span><span style="color: #909183;">()</span>;
        db.Database.<span style="color: #0000ff;">EnsureCreated</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">private</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">NewMethod</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">using</span> <span style="color: #228b22;">var</span> db = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BloggingContext</span><span style="color: #909183;">()</span>;
        db.BlogSet.<span style="color: #0000ff;">Add</span><span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Blog</span> <span style="color: #709870;">{</span> <span style="color: #a0522d;">Url</span> = <span style="color: #8b2252;">"http://baidu.com"</span> <span style="color: #709870;">}</span><span style="color: #909183;">)</span>;
        db.<span style="color: #0000ff;">SaveChanges</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">NewMethod4</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">db</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BloggingContext</span><span style="color: #909183;">()</span>;

        db.BlogSet.<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.BlogId == 99<span style="color: #909183;">)</span>;
        db.BlogSet.<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.BlogId == 96<span style="color: #909183;">)</span>;
        db.BlogSet.<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.BlogId == 95<span style="color: #909183;">)</span>;

        <span style="color: #b22222;">//</span><span style="color: #b22222;">IQueryable&lt;Blog&gt; blogs = db.Blogs.Where(b =&gt; b.BlogId &gt; 94);</span>

        <span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(blogs.Count());</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(blogs.Max(b =&gt; b.BlogId));</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(blogs.OrderBy(b =&gt; b.Url).Last());</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(blogs.Count());</span>

        <span style="color: #228b22;">var</span> <span style="color: #a0522d;">blogs</span> = db.BlogSet
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.BlogId &gt; 94<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.Url.Length &gt; 3<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">OrderByDescending</span><span style="color: #909183;">(</span>b =&gt; b.BlogId<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.Url.Length % 2 == 0 &amp;&amp; b.BlogId % 2 == 1<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.Posts.<span style="color: #0000ff;">Any</span><span style="color: #709870;">(</span>p =&gt; p.Title.Length &gt; 20<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.Url.Length &gt; 3<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">OrderByDescending</span><span style="color: #909183;">(</span>b =&gt; b.Url<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.BlogId % 2 != 1<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Pagination</span><span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>
            .<span style="color: #0000ff;">Where</span><span style="color: #909183;">(</span>b =&gt; b.Posts.<span style="color: #0000ff;">Any</span><span style="color: #709870;">(</span>p =&gt; p.Title.Length &gt; 20<span style="color: #709870;">)</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">//</span><span style="color: #b22222;">blogs = Pagination(blogs, 3);</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">blogs = blogs.Where(b =&gt; b.Posts.Any(p =&gt; p.Title.Length &gt; 20));</span>

        <span style="color: #a020f0;">foreach</span> <span style="color: #909183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">b</span> <span style="color: #a020f0;">in</span> blogs<span style="color: #909183;">)</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #228b22;">b</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">MyExtendMethods1</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">IQueryable</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">T</span><span style="color: #7388d6;">&gt;</span> <span style="color: #0000ff;">Pagination</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">T</span><span style="color: #7388d6;">&gt;(</span><span style="color: #a020f0;">this</span> <span style="color: #228b22;">IQueryable</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">T</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">query</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">pageNum</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">pageSize</span> = 5<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> query.<span style="color: #0000ff;">Skip</span><span style="color: #909183;">(</span><span style="color: #709870;">(</span>pageNum - 1<span style="color: #709870;">)</span> * pageSize<span style="color: #909183;">)</span>.<span style="color: #0000ff;">Take</span><span style="color: #909183;">(</span><span style="color: #228b22;">pageSize</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org232efd1" class="outline-4">
<h4 id="org232efd1"><span class="section-number-4">25.2.13.</span> 生成/Reverse</h4>
<div class="outline-text-4" id="text-25-2-13">
<ul class="org-ul">
<li>Enable-Migrations</li>
<li>Add-Migration</li>
<li>Update-Database</li>
</ul>
</div>
</div>

<div id="outline-container-org5744275" class="outline-4">
<h4 id="org5744275"><span class="section-number-4">25.2.14.</span> 总结</h4>
<div class="outline-text-4" id="text-25-2-14">
<p>
请你简单叙述一下使用 EF 框架进行开发的优点和缺点。
</p>
</div>
</div>
</div>

<div id="outline-container-org095a64e" class="outline-3">
<h3 id="org095a64e"><span class="section-number-3">25.3.</span> Dapper/SqlSugar/FreeSQL/NHibernate</h3>
<div class="outline-text-3" id="text-25-3">
</div>
<div id="outline-container-orga7baae3" class="outline-4">
<h4 id="orga7baae3"><span class="section-number-4">25.3.1.</span> Dapper</h4>
<div class="outline-text-4" id="text-25-3-1">
<p>
King of Micro ORM framework, on speed.
</p>

<p>
<a href="https://dapper-tutorial.net/dapper">https://dapper-tutorial.net/dapper</a>
</p>

<p>
使用只需要三步:
</p>
<ol class="org-ol">
<li>创建 IDbConnection 对象</li>
<li>写一个 query 进行 CRUD 操作</li>
<li>在 Execute 方法中传入一个 parameter</li>
</ol>
</div>
</div>

<div id="outline-container-orgccce5c8" class="outline-4">
<h4 id="orgccce5c8"><span class="section-number-4">25.3.2.</span> SqlSugar</h4>
<div class="outline-text-4" id="text-25-3-2">
<p>
<a href="https://gitee.com/dotnetchina/SqlSugar">https://gitee.com/dotnetchina/SqlSugar</a>
</p>
</div>
</div>

<div id="outline-container-org25d8e03" class="outline-4">
<h4 id="org25d8e03"><span class="section-number-4">25.3.3.</span> FreeSQL</h4>
<div class="outline-text-4" id="text-25-3-3">
<p>
<a href="http://www.freesql.net/">http://www.freesql.net/</a>
</p>
</div>
</div>

<div id="outline-container-org9a88460" class="outline-4">
<h4 id="org9a88460"><span class="section-number-4">25.3.4.</span> NHibernate</h4>
<div class="outline-text-4" id="text-25-3-4">
<p>
<a href="https://nhibernate.info/">https://nhibernate.info/</a>
</p>
</div>
</div>

<div id="outline-container-org0cb1fbf" class="outline-4">
<h4 id="org0cb1fbf"><span class="section-number-4">25.3.5.</span> MyBatis.NET</h4>
<div class="outline-text-4" id="text-25-3-5">
<p>
<a href="https://www.codeproject.com/articles/894127/mybatis-net">https://www.codeproject.com/articles/894127/mybatis-net</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgc7102f7" class="outline-3">
<h3 id="orgc7102f7"><span class="section-number-3">25.4.</span> 事务 (Transaction)</h3>
<div class="outline-text-3" id="text-25-4">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">conn</span> = DbHelper.<span style="color: #0000ff;">GetConnection</span><span style="color: #707183;">()</span>;
<span style="color: #228b22;">SqlTransaction</span> <span style="color: #a0522d;">trans</span> = conn.<span style="color: #0000ff;">BeginTransaction</span><span style="color: #707183;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#21019;&#24314;&#20107;&#21153;</span>

<span style="color: #a020f0;">try</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">1. </span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">command1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlCommand</span><span style="color: #7388d6;">(</span>
        <span style="color: #8b2252;">"insert into tiwen (stuid, score) values (@stuid, @score)"</span>,
        conn, trans<span style="color: #7388d6;">)</span>;                           <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#32465;&#23450;&#20107;&#21153;</span>
    command1.Parameters.<span style="color: #0000ff;">AddRange</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">new</span><span style="color: #909183;">[]</span>
    <span style="color: #909183;">{</span>
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlParameter</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"stuid"</span>, stuid<span style="color: #709870;">)</span>,
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlParameter</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"score"</span>, score<span style="color: #709870;">)</span>
    <span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>;
    command1.<span style="color: #0000ff;">ExecuteNonQuery</span><span style="color: #7388d6;">()</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">2</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">command2</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlCommand</span><span style="color: #7388d6;">(</span>@<span style="color: #8b2252;">"update students</span>
<span style="color: #8b2252;">        set tiwen_cishu = tiwen_cishu + 1, tiwen_fenshu = tiwen_fenshu + @score</span>
<span style="color: #8b2252;">        where id = @stuid"</span>, conn, trans<span style="color: #7388d6;">)</span>;
    command2.Parameters.<span style="color: #0000ff;">AddRange</span><span style="color: #7388d6;">(</span><span style="color: #a020f0;">new</span><span style="color: #909183;">[]</span>
    <span style="color: #909183;">{</span>
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlParameter</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"stuid"</span>, stuid<span style="color: #709870;">)</span>,
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SqlParameter</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"score"</span>, score<span style="color: #709870;">)</span>
    <span style="color: #909183;">}</span><span style="color: #7388d6;">)</span>;
    command2.<span style="color: #0000ff;">ExecuteNonQuery</span><span style="color: #7388d6;">()</span>;

    trans.<span style="color: #0000ff;">Commit</span><span style="color: #7388d6;">()</span>;                              <span style="color: #b22222;">// </span><span style="color: #b22222;">3.&#25552;&#20132;&#20107;&#21153;</span>
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">catch</span>
<span style="color: #707183;">{</span>
    trans.<span style="color: #0000ff;">Rollback</span><span style="color: #7388d6;">()</span>;                            <span style="color: #b22222;">// </span><span style="color: #b22222;">4. &#22238;&#25764;&#20107;&#21153;</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
环境事务:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">using</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">ts</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">TransactionScope</span><span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">foreach</span> <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">id</span>, <span style="color: #228b22;">int</span> <span style="color: #a0522d;">score</span><span style="color: #909183;">)</span> <span style="color: #a020f0;">in</span> scores<span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        dal.<span style="color: #0000ff;">AddScore</span><span style="color: #909183;">(</span>id, score<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    ts.<span style="color: #0000ff;">Complete</span><span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcdaf6f1" class="outline-3">
<h3 id="orgcdaf6f1"><span class="section-number-3">25.5.</span> 示例数据库</h3>
<div class="outline-text-3" id="text-25-5">
<ul class="org-ul">
<li>Sakila: <a href="https://github.com/ivanceras/sakila">https://github.com/ivanceras/sakila</a></li>
<li>Northwind/AdventureWorks: <a href="https://github.com/Microsoft/sql-server-samples">https://github.com/Microsoft/sql-server-samples</a></li>
<li>生成示例数据库: <a href="https://mockaroo.com/">https://mockaroo.com/</a></li>
</ul>
</div>
</div>
</section>

<section id="outline-container-org5ebd25d" class="outline-2">
<h2 id="org5ebd25d"><span class="section-number-2">26.</span> BCL (Base-Class Library) 基础类库</h2>
<div class="outline-text-2" id="text-26">
</div>
<div id="outline-container-org8b5c979" class="outline-3">
<h3 id="org8b5c979"><span class="section-number-3">26.1.</span> Console/控制台</h3>
<div class="outline-text-3" id="text-26-1">
<p>
相关方法和属性:
</p>
<ul class="org-ul">
<li>Console.Write/WriteLine，用来向控制台输出内容</li>
<li>Console.Clear，用来清空屏幕内容</li>
<li>Console.ForegroundColor/BackgroudColor/ResetColor，用来设置控制台颜色</li>
<li>Console.ReadLine，用来从控制台读取用户输入的字符串</li>
<li>Console.ReadKey，用来读取按键，返回一个 ConsoleKeyInfo 对象</li>
<li>Console.Beep，用来让控制台发出声音</li>
</ul>

<p>
相关类和结构:
</p>
<ul class="org-ul">
<li>Console</li>
<li>ConsoleColor</li>
<li>ConsoleKey/ConsoleKeyInfo</li>
</ul>

<p>
示例:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span>Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">()</span>;
<span class="linenr"> 2: </span><span style="color: #a020f0;">while</span> <span style="color: #707183;">(</span><span style="color: #008b8b;">true</span><span style="color: #707183;">)</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36890;&#36807; while &#24490;&#29615;&#21487;&#20197;&#23454;&#29616;&#19981;&#26029;&#36755;&#20837;&#19981;&#26029;&#30475;&#21040;&#36755;&#20837;&#32467;&#26524;&#30340;&#36807;&#31243;</span>
<span class="linenr"> 3: </span><span style="color: #707183;">{</span>
<span class="linenr"> 4: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">ReadKey &#26159;&#24494;&#36719;&#23553;&#35013;&#22312; Console &#37324;&#30340;&#19968;&#20010;&#26041;&#27861;&#65292;&#29992;&#26469;&#35835;&#21462;&#25511;&#21046;&#21488;&#19978;&#30340;&#25353;&#38190;</span>
<span class="linenr"> 5: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25105;&#20204;&#19981;&#38656;&#35201;&#20851;&#24515;&#23427;&#24590;&#20040;&#23454;&#29616;&#30340;&#65292;&#25105;&#20204;&#21482;&#38656;&#35201;&#20851;&#24515;&#23427;&#22914;&#20309;&#20351;&#29992;</span>
<span class="linenr"> 6: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24494;&#36719;&#22312;&#23454;&#29616;&#37324;&#65292;&#23558;&#25105;&#20204;&#25353;&#19979;&#30340;&#38190;&#30340;&#20449;&#24687;&#65292;&#23553;&#35013;&#21040;&#20102;&#19968;&#20010;&#21483; ConsoleKeyInfo &#30340;&#25968;&#25454;&#21253;&#37324; (&#23454;&#20363;&#23545;&#35937;)</span>
<span class="linenr"> 7: </span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35843;&#29992; ReadKey &#20043;&#21518;&#65292;&#23601;&#21487;&#20197;&#36890;&#36807;&#36825;&#20010;&#23454;&#20363;&#23545;&#35937; key &#25152;&#25552;&#20379;&#30340;&#21487;&#35775;&#38382;&#25509;&#21475;&#21028;&#26029;&#25353;&#38190;&#20449;&#24687;&#20102;</span>
<span class="linenr"> 8: </span>    <span style="color: #228b22;">ConsoleKeyInfo</span> <span style="color: #a0522d;">key</span> = Console.<span style="color: #0000ff;">ReadKey</span><span style="color: #7388d6;">(</span><span style="color: #008b8b;">true</span><span style="color: #7388d6;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">true &#30340;&#24847;&#24605;&#26159;&#65292;&#19981;&#22312;&#23631;&#24149;&#19978;&#26174;&#31034;&#38190;&#20837;&#30340;&#23383;&#31526;</span>
<span class="linenr"> 9: </span>    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>key.Key == ConsoleKey.D1<span style="color: #7388d6;">)</span>
<span class="linenr">10: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">11: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24744;&#36755;&#20837;&#20102;&#19968;&#20010; 1"</span><span style="color: #909183;">)</span>;
<span class="linenr">12: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">13: </span>    <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>key.Key == ConsoleKey.S<span style="color: #7388d6;">)</span>
<span class="linenr">14: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">15: </span>        Console.<span style="color: #0000ff;">Beep</span><span style="color: #909183;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">Beep &#26159;&#24494;&#36719;&#23454;&#29616;&#22312; Console &#37324;&#30340;&#19968;&#20010;&#26041;&#27861;&#65292;&#29992;&#26469;&#35753;&#25511;&#21046;&#21488;&#21457;&#20986;&#22768;&#38899;</span>
<span class="linenr">16: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">17: </span>    <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>key.KeyChar == <span style="color: #8b2252;">'d'</span><span style="color: #7388d6;">)</span>
<span class="linenr">18: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">19: </span>        Console.<span style="color: #0000ff;">Beep</span><span style="color: #909183;">(</span>600, 200<span style="color: #909183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">Beep &#26041;&#27861;&#26159;&#37325;&#36733;&#30340;&#65292;&#23427;&#21487;&#20197;&#25658;&#24102;&#21442;&#25968;</span>
<span class="linenr">20: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">21: </span>    <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>key.KeyChar == <span style="color: #8b2252;">'f'</span><span style="color: #7388d6;">)</span>
<span class="linenr">22: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">23: </span>        Console.<span style="color: #0000ff;">Beep</span><span style="color: #909183;">(</span>200, 200<span style="color: #909183;">)</span>;
<span class="linenr">24: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">25: </span>    <span style="color: #a020f0;">else</span> <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>key.Key == ConsoleKey.Enter<span style="color: #7388d6;">)</span>
<span class="linenr">26: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">27: </span>        <span style="color: #a020f0;">break</span>;
<span class="linenr">28: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">29: </span>    <span style="color: #a020f0;">else</span>
<span class="linenr">30: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">31: </span>        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span>$<span style="color: #8b2252;">"key: {key}, keyChar: {key.KeyChar}, key: {key.Key}"</span><span style="color: #909183;">)</span>;
<span class="linenr">32: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">33: </span><span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf370806" class="outline-3">
<h3 id="orgf370806"><span class="section-number-3">26.2.</span> Random/Thread</h3>
<div class="outline-text-3" id="text-26-2">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">ConsoleColor</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">colors</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ConsoleColor</span><span style="color: #707183;">[]</span>
<span style="color: #707183;">{</span>
    ConsoleColor.Red, ConsoleColor.Green, ConsoleColor.Yellow
<span style="color: #707183;">}</span>;

<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0;
<span style="color: #a020f0;">while</span> <span style="color: #707183;">(</span><span style="color: #008b8b;">true</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Console.WriteLine("hello {0}", DateTime.Now);</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">var timer = new Timer(null, TimeSpan(1), TimeSpan(2));</span>
    Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #7388d6;">(</span>1000<span style="color: #7388d6;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#39064;&#22806;&#35805;&#65292;&#36825;&#20010; 1000 &#27627;&#31186;&#24182;&#19981;&#26159;&#38750;&#24120;&#20934;&#30830;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">Task.Delay(1000).Wait();</span>

    <span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(colors[i]);</span>
    <span style="color: #b22222;">//</span><span style="color: #b22222;">i = i + 1;</span>
    <span style="color: #b22222;">//</span><span style="color: #b22222;">if (i == 3) i = 0;</span>

    <span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(colors[i]);</span>
    <span style="color: #b22222;">//</span><span style="color: #b22222;">i = (i + 1) % 3;</span>

    <span style="color: #b22222;">//</span><span style="color: #b22222;">Console.WriteLine(colors[(i++) % 3]);</span>

    System.<span style="color: #228b22;">Random</span> <span style="color: #a0522d;">random</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">System</span>.<span style="color: #0000ff;">Random</span><span style="color: #7388d6;">()</span>;
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">r</span> = random.<span style="color: #0000ff;">Next</span><span style="color: #7388d6;">(</span>colors.Length<span style="color: #7388d6;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">Next(3): 0, 1, 2</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>colors<span style="color: #909183;">[</span>r<span style="color: #909183;">]</span><span style="color: #7388d6;">)</span>;

    Console.<span style="color: #0000ff;">Clear</span><span style="color: #7388d6;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#28165;&#31354;&#23631;&#24149;</span>
    Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #7388d6;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#37325;&#32622;&#39068;&#33394;</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org078427d" class="outline-3">
<h3 id="org078427d"><span class="section-number-3">26.3.</span> IDisposable/资源</h3>
<div class="outline-text-3" id="text-26-3">
<ul class="org-ul">
<li>资源，是指需要在操作系统中打开，用完之后，需要手动释放的对象</li>
<li>为什么需要手动释放呢？因为 .NET 平台不是万能的。虽然 .NET 平台有垃圾回收器，你不再需要的
对象，它会自动帮你清理掉，但是有些东西它是无法确定你到底还需不需要，所以无法帮助你自动处理。
你也只能手动释放或关闭</li>
<li>对于一些资源，必须要手动释放或关闭</li>
</ul>

<p>
对于普通的对象，是可以被 GC 自动回收的:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#21019;&#24314;&#30340;&#20219;&#20309;&#23545;&#35937;&#65292;&#37117;&#26159;&#21487;&#20197;&#34987;&#22403;&#22334;&#22238;&#25910;&#22120; (GC) &#33258;&#21160;&#37322;&#25918;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#22240;&#27492;&#65292;&#25105;&#20204;&#21482;&#38656;&#35201; new &#28982;&#21518;&#20351;&#29992;&#23601;&#21487;&#20197;&#20102;&#65292;&#20854;&#20182;&#30340;&#20869;&#23384;&#31649;&#29702;&#26080;&#38656;&#20320;&#20851;&#24515;</span>
<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 100000000; i++<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">a</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #7388d6;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21019;&#24314;&#22810;&#23569;&#20010;&#37117;&#20250;&#34987;&#33258;&#21160;&#37322;&#25918;&#65292;&#32477;&#23545;&#23433;&#20840;</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
但是对于一些依赖系统的资源，必须要手动释放:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#20687;&#25991;&#20214;&#36825;&#26679;&#30340;&#36164;&#28304;&#65292;&#25171;&#24320;&#20043;&#21518;&#65292;&#24517;&#39035;&#35201;&#25163;&#21160;&#37322;&#25918;</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">fs</span> = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #707183;">(</span>fileName<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>5/0<span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20195;&#34920;&#20351;&#29992; (2)</span>
fs.<span style="color: #0000ff;">Close</span><span style="color: #707183;">()</span>;             <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25163;&#21160;&#20851;&#38381;/&#37322;&#25918;</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#19978;&#36848;&#30340;&#20195;&#30721;&#26159;&#26377;&#38382;&#39064;&#30340;&#65292;&#22240;&#20026;&#65292;&#22914;&#26524; (2) &#20986;&#29616;&#38169;&#35823;&#30340;&#35805;&#65292;&#37027;&#20040;&#37322;&#25918;&#30340;&#35821;&#21477;&#23601;&#26080;&#27861;&#25191;&#34892;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20026;&#20102;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;&#65292;&#21487;&#20197;&#20351;&#29992; finally &#35821;&#27861;&#65292;&#23545;&#25972;&#20010;&#36164;&#28304;&#37322;&#25918;&#30340;&#20195;&#30721;&#36827;&#34892;&#37325;&#26500;</span>
<span style="color: #228b22;">FileStream</span> <span style="color: #a0522d;">fs</span> = <span style="color: #008b8b;">null</span>;
<span style="color: #a020f0;">try</span>
<span style="color: #707183;">{</span>
    fs = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #7388d6;">(</span>fileName<span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>fs<span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>5/0<span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#20854;&#20182;&#20320;&#25152;&#38656;&#35201;&#20570;&#30340;&#20107;&#24773;"</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
<span style="color: #a020f0;">finally</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>fs != <span style="color: #008b8b;">null</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">try</span>
        <span style="color: #909183;">{</span>
            fs.<span style="color: #0000ff;">Close</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">catch</span>
        <span style="color: #909183;">{</span>
            Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#20851;&#38381;&#22833;&#36133;"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#21487;&#20197;&#20351;&#29992; using &#23545;&#19978;&#36848;&#20195;&#30721;&#36827;&#34892;&#31616;&#21270;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#24517;&#39035;&#35753; FileStream &#37324;&#38754;&#23454;&#29616;&#19968;&#20010;&#21483; Dispose &#30340;&#26041;&#27861;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#20026;&#20102;&#20445;&#35777;&#20320;&#24517;&#39035;&#23454;&#29616;&#19968;&#20010; Dispose &#26041;&#27861;&#65292;&#20320;&#24517;&#39035;&#35201;&#23454;&#29616; IDisposable &#25509;&#21475;</span>
<span style="color: #a020f0;">using</span> <span style="color: #707183;">(</span><span style="color: #228b22;">FileStream</span> <span style="color: #a0522d;">fs</span> = File.<span style="color: #0000ff;">OpenRead</span><span style="color: #7388d6;">(</span>fileName<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>fs<span style="color: #7388d6;">)</span>;
    Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #7388d6;">(</span>5/0<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#26368;&#26032;&#30340; C# &#29256;&#26412;&#21448;&#32473;&#20102;&#26032;&#30340;&#31958;</span>
<span style="color: #a020f0;">using</span> <span style="color: #a0522d;">FileStream</span> f<span style="color: #a0522d;">s</span> = <span style="color: #a0522d;">File</span>.<span style="color: #a0522d;">OpenRead</span><span style="color: #707183;">(</span><span style="color: #a0522d;">fileName</span><span style="color: #707183;">)</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">fs &#22312;&#21518;&#38754;&#30896;&#21040; } &#21518;&#65292;&#20250;&#33258;&#21160;&#37322;&#25918;</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>fs<span style="color: #707183;">)</span>;
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>5/0<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb5a2b13" class="outline-3">
<h3 id="orgb5a2b13"><span class="section-number-3">26.4.</span> Stopwatch/秒表</h3>
<div class="outline-text-3" id="text-26-4">
<div class="org-src-container">
<pre class="src src-cs"><span style="color: #a020f0;">using</span> <span style="color: #a0522d;">System</span>.<span style="color: #a0522d;">Diagnostics</span>;

<span style="color: #228b22;">Stopwatch</span> <span style="color: #a0522d;">sw</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Stopwatch</span><span style="color: #707183;">()</span>;
sw.<span style="color: #0000ff;">Start</span><span style="color: #707183;">()</span>;
<span style="color: #b22222;">// </span><span style="color: #b22222;">.....</span>
Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">(</span>sw.ElapsedMillionseconds<span style="color: #707183;">)</span>;  <span style="color: #b22222;">// </span><span style="color: #b22222;">1111ms</span>
sw.<span style="color: #0000ff;">Stop</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0a8d63" class="outline-3">
<h3 id="orgd0a8d63"><span class="section-number-3">26.5.</span> ConfigurationManager/配置管理器</h3>
<div class="outline-text-3" id="text-26-5">
<p>
首先，需要引入包:
</p>
<div class="org-src-container">
<pre class="src src-sh">dotnet add package System.Configuration.ConfigurationManager
</pre>
</div>

<p>
其次，在 App.config 或 Web.config 中添加相应配置信息:
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #a020f0;">?xml</span> <span style="color: #a0522d;">version</span>="1.0" <span style="color: #a0522d;">encoding</span>="utf-8" ?&gt;
&lt;<span style="color: #0000ff;">configuration</span>&gt;
  &lt;<span style="color: #0000ff;">connectionStrings</span>&gt;
    &lt;<span style="color: #0000ff;">clear</span>/&gt;
    &lt;<span style="color: #0000ff;">add</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"blogdb"</span> <span style="color: #a0522d;">connectionString</span>=<span style="color: #8b2252;">"server=.;database=ccc;uid=sa;pwd=sa"</span>/&gt;
  &lt;/<span style="color: #0000ff;">connectionStrings</span>&gt;
&lt;/<span style="color: #0000ff;">configuration</span>&gt;
</pre>
</div>

<p>
最后，在程序中使用:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">dbString</span> = ConfigurationManager.ConnectionStrings<span style="color: #707183;">[</span><span style="color: #8b2252;">"blogdb"</span><span style="color: #707183;">]</span>.ConnectionString;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf35d672" class="outline-3">
<h3 id="orgf35d672"><span class="section-number-3">26.6.</span> RegularExpression/正则表达式</h3>
<div class="outline-text-3" id="text-26-6">
<p>
<a href="https://regexlearn.com/">https://regexlearn.com/</a>
</p>

<p>
电话号码:
</p>
<pre class="example">
^1[3578][0-9]{9}$
</pre>


<p>
邮箱地址:
</p>
<pre class="example">
^[a-zA-Z][a-zA-Z0-9_]{5,17}@[a-z0-9]+\.(com|net|edu.cn|org)$
</pre>


<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">xxx1</span> <span style="color: #707183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">input</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">regexp</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">var r = new Regex("^1[3578][0-9]{9}$");</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r</span> = Regex.<span style="color: #0000ff;">IsMatch</span><span style="color: #7388d6;">(</span>input, regexp<span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">return</span> $<span style="color: #8b2252;">"{input}     {regexp}: {r}"</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">xxx2</span> <span style="color: #707183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">input</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">regexp</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #b22222;">//</span><span style="color: #b22222;">var m = Regex.Match(input, regexp);</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ms</span> = Regex.<span style="color: #0000ff;">Matches</span><span style="color: #7388d6;">(</span>input, regexp<span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r</span> = <span style="color: #228b22;">string</span>.<span style="color: #0000ff;">Join</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">" "</span>, ms<span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">return</span> $<span style="color: #8b2252;">"{input}     {regexp}: {r}"</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">xxx3</span> <span style="color: #707183;">(</span><span style="color: #228b22;">string</span> <span style="color: #a0522d;">input</span>, <span style="color: #228b22;">string</span> <span style="color: #a0522d;">regexp</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">return</span> Regex.<span style="color: #0000ff;">Replace</span><span style="color: #7388d6;">(</span>input, regexp, <span style="color: #8b2252;">""</span><span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #0000ff;">xxx4</span> <span style="color: #707183;">()</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">s</span> = <span style="color: #8b2252;">"hello   =   , world,  -      where _ , are"</span>;
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ws</span> = Regex.<span style="color: #0000ff;">Split</span><span style="color: #7388d6;">(</span>s, <span style="color: #8b2252;">"[^a-zA-Z]+"</span><span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">r</span> = <span style="color: #228b22;">string</span>.<span style="color: #0000ff;">Join</span><span style="color: #7388d6;">(</span><span style="color: #8b2252;">"!!"</span>, ws<span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">return</span> $<span style="color: #8b2252;">"{r}"</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org7682cdc" class="outline-2">
<h2 id="org7682cdc"><span class="section-number-2">27.</span> Winform</h2>
<div class="outline-text-2" id="text-27">
</div>
<div id="outline-container-org24de99a" class="outline-3">
<h3 id="org24de99a"><span class="section-number-3">27.1.</span> 布局相关</h3>
<div class="outline-text-3" id="text-27-1">
</div>
<div id="outline-container-org5685a3a" class="outline-4">
<h4 id="org5685a3a"><span class="section-number-4">27.1.1.</span> 基本属性</h4>
<div class="outline-text-4" id="text-27-1-1">
<ul class="org-ul">
<li>通过 Size 设置窗口大小/尺寸</li>
<li>通过 StartPosition 设置窗口的启动位置</li>
<li>通过 FormBorderStyle 设置窗口的风格</li>
<li>通过 MinimizeBox/MaximizeBox 来设置是否显示最大、最小按钮</li>
</ul>
</div>
</div>

<div id="outline-container-org3bdbf58" class="outline-4">
<h4 id="org3bdbf58"><span class="section-number-4">27.1.2.</span> Layout</h4>
<div class="outline-text-4" id="text-27-1-2">
<ul class="org-ul">
<li>Anchor/锚</li>
</ul>

<p>
通过代码的方式，进行自适应布局:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">protected</span> <span style="color: #a020f0;">override</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">OnLayout</span><span style="color: #707183;">(</span><span style="color: #228b22;">LayoutEventArgs</span> <span style="color: #a0522d;">levent</span><span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">base</span>.<span style="color: #0000ff;">OnLayout</span><span style="color: #7388d6;">(</span>levent<span style="color: #7388d6;">)</span>;

    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">ww</span> = <span style="color: #a020f0;">this</span>.ClientSize.Width; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#31383;&#21475;&#30340;&#23485;&#24230;</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">labelW</span> = 40;                <span style="color: #b22222;">// </span><span style="color: #b22222;">label &#30340;&#23485;&#24230;</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">buttonW</span> = 100;              <span style="color: #b22222;">// </span><span style="color: #b22222;">button &#30340;&#23485;&#24230;</span>
    <span style="color: #228b22;">var</span> <span style="color: #a0522d;">gap</span> = 5;                    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25511;&#20214;&#30340;&#38388;&#38548;</span>
    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">inputW</span> = <span style="color: #7388d6;">(</span>ww - labelW * 3 - buttonW - 8 * gap - 6 * 7<span style="color: #7388d6;">)</span> / 3;

    nameLabel.Width = labelW;
    label1.Width = labelW;
    priceLabel.Width = labelW;
    addBookBtn.Width = buttonW;

    nameInput.Width = inputW;
    authorInput.Width = inputW;
    priceInput.Width = inputW;

    nameLabel.Left = gap;
    nameInput.Left = nameLabel.Right + gap;
    label1.Left = nameInput.Right + gap;
    authorInput.Left = label1.Right + gap;
    priceLabel.Left = authorInput.Right + gap;
    priceInput.Left = priceLabel.Right + gap;
    addBookBtn.Left = priceInput.Right + gap;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge7f2856" class="outline-3">
<h3 id="orge7f2856"><span class="section-number-3">27.2.</span> 数据容器</h3>
<div class="outline-text-3" id="text-27-2">
<ul class="org-ul">
<li>ListBox</li>
<li>ListView</li>
<li>TreeView</li>
<li>DataGridView</li>
</ul>


<p>
添加数据到 ListBox 的方式:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#19968;&#31181;</span>
<span style="color: #a020f0;">this</span>.lbStudents.Items.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#24352;&#19977;"</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">this</span>.lbStudents.Items.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#26446;&#22235;"</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">this</span>.lbStudents.Items.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#29579;&#20116;"</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">this</span>.lbStudents.Items.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"&#36213;&#20845;"</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#20108;&#31181;</span>
<span style="color: #a020f0;">this</span>.lbStudents.Items.<span style="color: #0000ff;">AddRange</span><span style="color: #707183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">string</span><span style="color: #7388d6;">[]</span>
<span style="color: #7388d6;">{</span>
    <span style="color: #8b2252;">"Tom"</span>, <span style="color: #8b2252;">"Jerry"</span>, <span style="color: #8b2252;">"&#27966;&#22823;&#26143;"</span>, <span style="color: #8b2252;">"&#22885;&#29305;&#26364;"</span>
<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#19977;&#31181;</span>
<span style="color: #228b22;">List</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;</span> <span style="color: #a0522d;">students1</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">List</span><span style="color: #707183;">&lt;</span><span style="color: #228b22;">string</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">{</span>
    <span style="color: #8b2252;">"aaa"</span>, <span style="color: #8b2252;">"bbb"</span>, <span style="color: #8b2252;">"ccc"</span>
<span style="color: #707183;">}</span>;
<span style="color: #b22222;">//</span><span style="color: #b22222;">this.lbStudents.DataSource = students1;</span>

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#31532;&#22235;&#31181;</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">binding</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BindingSource</span><span style="color: #707183;">()</span>;
binding.DataSource = students1;
binding.<span style="color: #0000ff;">Add</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"ddd"</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">this</span>.lbStudents.DataSource = binding;
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org156e49a" class="outline-2">
<h2 id="org156e49a"><span class="section-number-2">28.</span> 技巧和示例</h2>
<div class="outline-text-2" id="text-28">
</div>
<div id="outline-container-org0ca31ac" class="outline-3">
<h3 id="org0ca31ac"><span class="section-number-3">28.1.</span> 求余</h3>
<div class="outline-text-3" id="text-28-1">
<p>
求余经常用来将某个数 <b>转换</b> 为 0-N 区间的一个数。
</p>

<p>
示例一，结合循环使用:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr">1: </span><span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 1000; i++<span style="color: #707183;">)</span>
<span class="linenr">2: </span><span style="color: #707183;">{</span>
<span class="linenr">3: </span>    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">f</span> = <span style="color: #7388d6;">(</span><span style="color: #909183;">(</span>i % 8<span style="color: #909183;">)</span> * 30<span style="color: #7388d6;">)</span> + 100;
<span class="linenr">4: </span>    Console.<span style="color: #0000ff;">Beep</span><span style="color: #7388d6;">(</span>f, 50<span style="color: #7388d6;">)</span>;
<span class="linenr">5: </span>    Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #7388d6;">(</span>800 - <span style="color: #909183;">(</span>i % 8<span style="color: #909183;">)</span> * 50<span style="color: #7388d6;">)</span>;
<span class="linenr">6: </span><span style="color: #707183;">}</span>
</pre>
</div>

<p>
示例二，求余和数组的结合使用:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr">1: </span><span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">freqs</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #707183;">{</span> 200, 300, 100, 600 <span style="color: #707183;">}</span>;
<span class="linenr">2: </span>
<span class="linenr">3: </span><span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 1000; i++<span style="color: #707183;">)</span>
<span class="linenr">4: </span><span style="color: #707183;">{</span>
<span class="linenr">5: </span>    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">f</span> = freqs<span style="color: #7388d6;">[</span>i % freqs.Length<span style="color: #7388d6;">]</span>;
<span class="linenr">6: </span>    Console.<span style="color: #0000ff;">Beep</span><span style="color: #7388d6;">(</span>f, 50<span style="color: #7388d6;">)</span>;
<span class="linenr">7: </span>    Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #7388d6;">(</span>800 - <span style="color: #909183;">(</span>i % freqs.Length<span style="color: #909183;">)</span> * 50<span style="color: #7388d6;">)</span>;
<span class="linenr">8: </span><span style="color: #707183;">}</span>
</pre>
</div>

<p>
示例三:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span class="linenr"> 1: </span><span style="color: #b22222;">// </span><span style="color: #b22222;">&#38500;&#20102;&#22768;&#38899;&#22806;&#65292;&#28155;&#21152;&#35270;&#35273;&#25928;&#26524;</span>
<span class="linenr"> 2: </span><span style="color: #b22222;">// </span><span style="color: #b22222;">&#21407;&#29702;&#26159;&#19968;&#26679;&#30340;</span>
<span class="linenr"> 3: </span><span style="color: #228b22;">int</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">freqs</span> = <span style="color: #a020f0;">new</span> <span style="color: #707183;">[]</span> <span style="color: #707183;">{</span> 200, 300, 100, 600 <span style="color: #707183;">}</span>;
<span class="linenr"> 4: </span><span style="color: #228b22;">ConsoleColor</span><span style="color: #707183;">[]</span> <span style="color: #a0522d;">colors</span> = <span style="color: #a020f0;">new</span><span style="color: #707183;">[]</span> <span style="color: #707183;">{</span> ConsoleColor.Red, ConsoleColor.Green, ConsoleColor.Blue, ConsoleColor.Yellow <span style="color: #707183;">}</span>;
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; 1000; i++<span style="color: #707183;">)</span>
<span class="linenr"> 7: </span><span style="color: #707183;">{</span>
<span class="linenr"> 8: </span>    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">p</span> = i % freqs.Length;
<span class="linenr"> 9: </span>    <span style="color: #a020f0;">for</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">j</span> = 0; j &lt; freqs.Length; j++<span style="color: #7388d6;">)</span>
<span class="linenr">10: </span>    <span style="color: #7388d6;">{</span>
<span class="linenr">11: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>j == p<span style="color: #909183;">)</span>
<span class="linenr">12: </span>        <span style="color: #909183;">{</span>
<span class="linenr">13: </span>            Console.ForegroundColor = colors<span style="color: #709870;">[</span>p<span style="color: #709870;">]</span>;
<span class="linenr">14: </span>        <span style="color: #909183;">}</span>
<span class="linenr">15: </span>        <span style="color: #a020f0;">else</span>
<span class="linenr">16: </span>        <span style="color: #909183;">{</span>
<span class="linenr">17: </span>            Console.<span style="color: #0000ff;">ResetColor</span><span style="color: #709870;">()</span>;
<span class="linenr">18: </span>        <span style="color: #909183;">}</span>
<span class="linenr">19: </span>        Console.<span style="color: #0000ff;">SetCursorPosition</span><span style="color: #909183;">(</span>j * 3, 0<span style="color: #909183;">)</span>;
<span class="linenr">20: </span>        Console.<span style="color: #0000ff;">Write</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#9679;"</span><span style="color: #909183;">)</span>;
<span class="linenr">21: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">22: </span>    Console.<span style="color: #0000ff;">Beep</span><span style="color: #7388d6;">(</span>freqs<span style="color: #909183;">[</span>p<span style="color: #909183;">]</span>, 50<span style="color: #7388d6;">)</span>;
<span class="linenr">23: </span>
<span class="linenr">24: </span>    Thread.<span style="color: #0000ff;">Sleep</span><span style="color: #7388d6;">(</span>500 - <span style="color: #909183;">(</span>p<span style="color: #909183;">)</span> * 50<span style="color: #7388d6;">)</span>;
<span class="linenr">25: </span><span style="color: #707183;">}</span>
<span class="linenr">26: </span>Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #707183;">()</span>;
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-orgc4fc2ee" class="outline-2">
<h2 id="orgc4fc2ee"><span class="section-number-2">29.</span> 模拟题</h2>
<div class="outline-text-2" id="text-29">
</div>
<div id="outline-container-orgc0f6ff4" class="outline-3">
<h3 id="orgc0f6ff4"><span class="section-number-3">29.1.</span> 继承相关</h3>
<div class="outline-text-3" id="text-29-1">
<p>
请问下面程序的输出是什么:
</p>
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #a020f0;">class</span> <span style="color: #228b22;">A</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"aaa"</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Name</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25105;&#26159; {0}"</span>, <span style="color: #228b22;">name</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#33258;&#25105;&#20171;&#32461;</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #0000ff;">Name</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">B</span> : <span style="color: #228b22;">A</span>
<span style="color: #707183;">{</span>
    <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Name</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"&#20320;&#26159; {0}"</span>, name<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">string</span> <span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"bbb"</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">&#33258;&#25105;&#20171;&#32461;</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">this</span>.<span style="color: #0000ff;">Name</span><span style="color: #909183;">()</span>;
        Console.<span style="color: #0000ff;">WriteLine</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"----"</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">base</span>.<span style="color: #0000ff;">Name</span><span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>

<span style="color: #a020f0;">class</span> <span style="color: #228b22;">Program</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">Main</span><span style="color: #7388d6;">()</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">B</span> <span style="color: #a0522d;">b</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">B</span><span style="color: #909183;">()</span>;
        b.&#33258;&#25105;&#20171;&#32461;<span style="color: #909183;">()</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org939dab5" class="outline-3">
<h3 id="org939dab5"><span class="section-number-3">29.2.</span> 重载 (overload) 和 重写 (override) 有啥区别 (15 分)</h3>
<div class="outline-text-3" id="text-29-2">
<p>
重构 = 重新构造 = 将代码进行重写，让结构发生变化的行为
= 一般来说，是因为现有的代码不合理，所以呢，重新调整一下
= 一般来说，重构只是为了改变代码结构或代码质量，它不会对程序的运行逻辑进行改变
</p>
</div>
</div>
</section>

<section id="outline-container-orgeb3a958" class="outline-2">
<h2 id="orgeb3a958"><span class="section-number-2">30.</span> 问题 (仅作参考)</h2>
<div class="outline-text-2" id="text-30">
</div>
<div id="outline-container-orgb7e73e7" class="outline-3">
<h3 id="orgb7e73e7"><span class="section-number-3">30.1.</span> string 和 StringBuilder 有什么区别</h3>
<div class="outline-text-3" id="text-30-1">
<ul class="org-ul">
<li>string 是一种预定义类型，它表达的是字符的有序组合</li>
<li>StringBuilder 是定义在 BCL 中的类型，它主要用来进行字符串的拼接</li>
<li>string 是不可变的，所以在进行拼接等操作的时候，效率会非常低</li>
<li>StringBuilder 是可变的一种类型，所以在字符串拼接的时候，效率相对高多了</li>
<li>因此，在进行字符串拼接的操作的时候，我们一般使用 StringBuilder 进行构建，从而提升效率</li>
</ul>
</div>
</div>

<div id="outline-container-org1ea4148" class="outline-3">
<h3 id="org1ea4148"><span class="section-number-3">30.2.</span> 什么是抽象类，抽象类有什么用处</h3>
</div>
<div id="outline-container-org137e9b5" class="outline-3">
<h3 id="org137e9b5"><span class="section-number-3">30.3.</span> 什么是接口，什么是面向接口编程，面向接口编程有什么好处</h3>
</div>
<div id="outline-container-org4fd837a" class="outline-3">
<h3 id="org4fd837a"><span class="section-number-3">30.4.</span> 什么是静态类，什么是密封类，什么是分部类</h3>
</div>
<div id="outline-container-org836a79f" class="outline-3">
<h3 id="org836a79f"><span class="section-number-3">30.5.</span> 什么是类，什么是对象，对象的实例化过程是怎么样的</h3>
</div>
<div id="outline-container-org5e43cb0" class="outline-3">
<h3 id="org5e43cb0"><span class="section-number-3">30.6.</span> 什么是面向对象编程，面向对象有什么特点，有什么好处</h3>
</div>
<div id="outline-container-org6dfeb49" class="outline-3">
<h3 id="org6dfeb49"><span class="section-number-3">30.7.</span> 什么是字段，什么是方法，什么是属性。属性有什么好处</h3>
</div>
<div id="outline-container-orgc976762" class="outline-3">
<h3 id="orgc976762"><span class="section-number-3">30.8.</span> 什么是封装，什么是继承，什么是多态</h3>
</div>
<div id="outline-container-orge5fd970" class="outline-3">
<h3 id="orge5fd970"><span class="section-number-3">30.9.</span> 什么是虚方法，它有什么用处</h3>
</div>
<div id="outline-container-org97c53af" class="outline-3">
<h3 id="org97c53af"><span class="section-number-3">30.10.</span> 什么是组合，它跟继承有什么区别，分别用在什么场景</h3>
</div>
<div id="outline-container-org6a9a3d4" class="outline-3">
<h3 id="org6a9a3d4"><span class="section-number-3">30.11.</span> 什么是 DRY，代码复用的手段有哪些</h3>
</div>
<div id="outline-container-org4ff3fe5" class="outline-3">
<h3 id="org4ff3fe5"><span class="section-number-3">30.12.</span> Parse/TryParse 有啥区别</h3>
<div class="outline-text-3" id="text-30-12">
<ul class="org-ul">
<li>这两个都是用来将字符串转换为其他类型</li>
<li>遇到转换失败的时候</li>
<li>Parse 会直接抛出异常</li>
<li>而 TryParse，会根据是否转换成功返回 True/False,
它不会抛出异常</li>
</ul>
</div>
</div>

<div id="outline-container-org2df8eb1" class="outline-3">
<h3 id="org2df8eb1"><span class="section-number-3">30.13.</span> 什么是装箱拆箱</h3>
<div class="outline-text-3" id="text-30-13">
<ul class="org-ul">
<li>装箱是将值类型转换为 object 的过程</li>
<li>拆箱是将装箱后的 object 转换为对应的值类型的过程</li>
</ul>
</div>
</div>

<div id="outline-container-org5b399e5" class="outline-3">
<h3 id="org5b399e5"><span class="section-number-3">30.14.</span> 什么是值类型/引用类型</h3>
<div class="outline-text-3" id="text-30-14">
<ul class="org-ul">
<li>变量位置保存的是类型实例自身，这样的类型叫 <b>值类型</b></li>
<li>变量位置保存的是类型实例的引用，这样的类型叫 <b>引用类型</b></li>
</ul>
</div>
</div>

<div id="outline-container-org38b212d" class="outline-3">
<h3 id="org38b212d"><span class="section-number-3">30.15.</span> is/as 分别是干啥的</h3>
<div class="outline-text-3" id="text-30-15">
<ul class="org-ul">
<li>is 用来判断左边的实例是否是右边的类型。是的 true，不是的话 false。
它常用来跟显式转换配合使用</li>
<li>as 和显式转换相似，但它不会抛出异常，如果成功返回转换结果，失败返回 null</li>
</ul>
</div>
</div>
</section>


<section id="outline-container-org2b28ec2" class="outline-2">
<h2 id="org2b28ec2"><span class="section-number-2">31.</span> 代码生成器</h2>
<div class="outline-text-2" id="text-31">
<ul class="org-ul">
<li>动软代码生成器</li>
<li>Codematic</li>
</ul>

<p>
链接:
</p>
<ul class="org-ul">
<li><a href="https://www.cnblogs.com/huangguojin/p/5299153.html">https://www.cnblogs.com/huangguojin/p/5299153.html</a></li>
</ul>
</div>
</section>

<section id="outline-container-org161d77e" class="outline-2">
<h2 id="org161d77e"><span class="section-number-2">32.</span> Miscellaneous</h2>
<div class="outline-text-2" id="text-32">
</div>
<div id="outline-container-orgfa5d65f" class="outline-3">
<h3 id="orgfa5d65f"><span class="section-number-3">32.1.</span> 模拟 Path 寻找的方式</h3>
<div class="outline-text-3" id="text-32-1">
<div class="org-src-container">
<pre class="src src-csharp"><span style="color: #228b22;">var</span> <span style="color: #a0522d;">cmd</span> = <span style="color: #8b2252;">"sl3"</span>;

<span style="color: #228b22;">var</span> <span style="color: #a0522d;">f1</span> = cmd; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#32477;&#23545;&#36335;&#24452; d:\xxx\sl3.exe</span>
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">f2</span> = Directory.<span style="color: #0000ff;">CurrentDirectory</span><span style="color: #707183;">()</span> + cmd;
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#29615;&#22659;&#21464;&#37327;, &#25805;&#20316;&#31995;&#32479;&#30340;&#20840;&#23616;&#21464;&#37327;&#65292;PATH</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">PATH: dir1;dir2;dir3;dir4  dir5</span>
<span style="color: #228b22;">string</span> <span style="color: #a0522d;">path</span> = <span style="color: #8b2252;">"dir1;dir2;dir3;dir4"</span>;
<span style="color: #228b22;">var</span> <span style="color: #a0522d;">path_arr</span> = <span style="color: #707183;">[</span><span style="color: #8b2252;">"dir1"</span>, <span style="color: #8b2252;">"dir2"</span>, <span style="color: #8b2252;">"dir3"</span>, <span style="color: #8b2252;">"dir4"</span><span style="color: #707183;">]</span>;
<span style="color: #a020f0;">for</span> <span style="color: #707183;">(</span><span style="color: #228b22;">var</span> <span style="color: #a0522d;">d</span> <span style="color: #a020f0;">in</span> path_arr<span style="color: #707183;">)</span>
<span style="color: #707183;">{</span>
    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>File.<span style="color: #0000ff;">Exists</span><span style="color: #909183;">(</span>d + cmd<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
    <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25191;&#34892;</span>
        <span style="color: #a020f0;">break</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">Windows</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org31978ab" class="outline-3">
<h3 id="org31978ab"><span class="section-number-3">32.2.</span> 基本思想</h3>
<div class="outline-text-3" id="text-32-2">
<p>
方法论:
</p>
<ul class="org-ul">
<li>实践中碰都问题，找解决方案。</li>
<li>方案找到之后，推而广之，升华到一定的理论。</li>
<li>通过理论，再反哺到实践运用当中。</li>
</ul>

<p>
概念:
</p>
<ul class="org-ul">
<li>OOP (Object-Oriented Programing)</li>
<li>IoC (Inverse of Control) &#x2013; DI/Spring.NET</li>
<li>ORM (Object-Relation Mapping) &#x2013; Entity Framework / NHibernate</li>
<li>MVC (Model-View-Control) &#x2013; .NET MVC</li>
</ul>
</div>
</div>

<div id="outline-container-org2d4b2ec" class="outline-3">
<h3 id="org2d4b2ec"><span class="section-number-3">32.3.</span> Relation-Database/SQL</h3>
<div class="outline-text-3" id="text-32-3">
<p>
Structured Query Language, 结构化查询语言。
</p>

<p>
它是操作关系型数据的标准语言。
</p>

<p>
发展简史:
</p>
<ul class="org-ul">
<li>1976 左右，IBM 发表了想法</li>
<li>1979 左右，Oracle 给出了实现 (爱里森)</li>
<li>1990 左右，SQL 成了工业标准</li>
</ul>

<p>
分类:
</p>
<ul class="org-ul">
<li>DDL</li>
<li>DML</li>
<li>DCL</li>
<li>TCL</li>
</ul>

<p>
问题:
</p>
<ul class="org-ul">
<li>SQL 语句的分类有哪些？请做简单介绍</li>
<li>函数和存储过程有什么区别？分别用在什么场景</li>
</ul>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 悟饭</p>
<p class="date">Created: 2022-04-07</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
