<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2021-01-22 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SQL 语句</title>
<meta name="generator" content="Org mode">
<meta name="author" content="孙悟空">
<link rel='stylesheet' href='/html/asset/common.css?3344' />
<link rel='stylesheet' href='/yaoliusan/html/asset/common.css?3344' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/html/asset/common.js'></script>
<script src='/yaoliusan/html/asset/common.js'></script>

<style>
 /* From: https://endlessparentheses.com/public/css/endless.css */
 .special-kbd {
   color: #333;
   background-color: #f7f7f7;
   border: 1px solid #ccc;
   border-radius: 6px;
   box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
   display: inline-block;
   font-family: 'Droid Sans Mono', monospace;
   font-size: 80%;
   font-weight: normal;
   line-height: inherit;
   margin: 2px .1em;
   padding: .04em .4em;
   text-shadow: 0 1px 0 #fff;
   word-spacing: -3px;
 }
</style>
</head>
<body>
<div id="content">
<header>
<h1 class="title">SQL 语句</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf8dd469">1. SQL 是什么</a></li>
<li><a href="#org7785d59">2. SQL 的分类</a>
<ul>
<li><a href="#org3d8224c">2.1. DDL (Data Definition Language) 数据定义语言</a></li>
<li><a href="#orgf66a1a8">2.2. DML (Data Manipulation Language) 数据操纵语言</a></li>
<li><a href="#orge6b1e17">2.3. DCL (Data Control Language) 数据控制语言</a></li>
<li><a href="#orgd1f34b3">2.4. TCL (Transaction Control Language) 事务控制语言</a></li>
</ul>
</li>
<li><a href="#orgad9c6b3">3. SQLServer 中的 SQL 语句</a>
<ul>
<li><a href="#org3d8a7bf">3.1. database 的创建和删除</a></li>
<li><a href="#orgc9118f7">3.2. table 的创建</a></li>
<li><a href="#orgc034ae3">3.3. 常见数据类型</a>
<ul>
<li><a href="#org729861d">3.3.1. 数值</a></li>
<li><a href="#org67411c3">3.3.2. 字符串</a></li>
<li><a href="#orgdaee19c">3.3.3. 日期/时间</a></li>
<li><a href="#org5c1f978">3.3.4. 其他类型</a></li>
<li><a href="#org3a81d6d">3.3.5. 使用例子</a></li>
</ul>
</li>
<li><a href="#org720a383">3.4. table 的修改</a></li>
<li><a href="#org877b2eb">3.5. table 的删除</a></li>
<li><a href="#orgf46e263">3.6. constraint 的管理</a></li>
<li><a href="#orged456e4">3.7. insert 插入</a></li>
<li><a href="#orgc74556d">3.8. delete/truncate 删除</a></li>
<li><a href="#org92f5321">3.9. update 更新</a></li>
<li><a href="#org3efb8f5">3.10. select 查询</a>
<ul>
<li><a href="#orgc8463eb">3.10.1. 测试数据</a></li>
<li><a href="#orgd6e70bf">3.10.2. 基本查询</a></li>
<li><a href="#org29881c2">3.10.3. 子查询 (subquery)</a>
<ul>
<li><a href="#org87076c8">3.10.3.1. 作为临时表存在</a></li>
<li><a href="#org65a4a8f">3.10.3.2. 作为字段存在</a></li>
<li><a href="#org0d52b07">3.10.3.3. 作为条件存在</a></li>
<li><a href="#org608f6a7">3.10.3.4. 阶段性作业 (subquery)</a></li>
</ul>
</li>
<li><a href="#org01b2625">3.10.4. 连接查询 (join)</a></li>
<li><a href="#org218a752">3.10.5. 合并 (union)</a></li>
<li><a href="#org6e82e17">3.10.6. 分组、窗口查询 (group by/over)</a></li>
<li><a href="#orge2b8533">3.10.7. 分页查询 (top/row_number/fetch-offset)</a></li>
</ul>
</li>
<li><a href="#org1e8cf5e">3.11. Transaction 事务</a>
<ul>
<li><a href="#orge1f76bd">3.11.1. 什么是事务 (ACID)</a></li>
<li><a href="#orgfcae39c">3.11.2. 事务的状态</a></li>
<li><a href="#orge19d094">3.11.3. SQLServer 中的事务</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd10ac06">4. MySQL 中的 SQL 语句</a>
<ul>
<li><a href="#orgf78308e">4.1. create</a></li>
<li><a href="#orgc4d55d6">4.2. 分页</a></li>
</ul>
</li>
</ul>
</div>
</nav>


<section id="outline-container-orgf8dd469" class="outline-2">
<h2 id="orgf8dd469"><span class="section-number-2">1</span> SQL 是什么</h2>
<div class="outline-text-2" id="text-1">
<p>
Structured Query Language, 结构化查询语言。
</p>

<p>
它是操作<a href="../roam/20200826034745-关系型数据库.html">关系型数据</a>的标准语言。
</p>

<p>
发展简史:
</p>
<ul class="org-ul">
<li>1976 左右，IBM 发表了想法</li>
<li>1979 左右，Oracle 给出了实现</li>
<li>1990 左右，SQL 成了工业标准</li>
</ul>
</div>
</section>

<section id="outline-container-org7785d59" class="outline-2">
<h2 id="org7785d59"><span class="section-number-2">2</span> SQL 的分类</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org3d8224c" class="outline-3">
<h3 id="org3d8224c"><span class="section-number-3">2.1</span> DDL (Data Definition Language) 数据定义语言</h3>
<div class="outline-text-3" id="text-2-1">
<p>
用来对数据的对象进行定义的一些语句:
</p>
<ul class="org-ul">
<li>创建: <code>create 类型 名字 详细定义</code> 例: <code>create table xxx ()</code></li>
<li>修改: <code>alter 类型 名字 你要修改的东西</code> 例: <code>alter table xxx add column (yyy int)</code></li>
<li>删掉: <code>drop 类型 名字</code> 例: <code>drop table xxx</code></li>
</ul>
</div>
</div>

<div id="outline-container-orgf66a1a8" class="outline-3">
<h3 id="orgf66a1a8"><span class="section-number-3">2.2</span> DML (Data Manipulation Language) 数据操纵语言</h3>
<div class="outline-text-3" id="text-2-2">
<p>
对数据的操作:
</p>
<ul class="org-ul">
<li>增(C): <code>insert into</code></li>
<li>删(D): <code>delete from</code></li>
<li>改(U): <code>update</code></li>
<li>查(R): <code>select from</code>  <b>-</b>-</li>
</ul>
</div>
</div>

<div id="outline-container-orge6b1e17" class="outline-3">
<h3 id="orge6b1e17"><span class="section-number-3">2.3</span> DCL (Data Control Language) 数据控制语言</h3>
<div class="outline-text-3" id="text-2-3">
<ul class="org-ul">
<li>授予权限: <code>grant to</code></li>
<li>撤回权限: <code>revoke from</code></li>
</ul>
</div>
</div>

<div id="outline-container-orgd1f34b3" class="outline-3">
<h3 id="orgd1f34b3"><span class="section-number-3">2.4</span> TCL (Transaction Control Language) 事务控制语言</h3>
<div class="outline-text-3" id="text-2-4">
<ul class="org-ul">
<li>设置保存点: <code>savepoint xxx</code></li>
<li>撤回: <code>rollback [xxx]</code></li>
<li>提交: <code>commit</code></li>
</ul>
</div>
</div>
</section>

<section id="outline-container-orgad9c6b3" class="outline-2">
<h2 id="orgad9c6b3"><span class="section-number-2">3</span> SQLServer 中的 SQL 语句</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org3d8a7bf" class="outline-3">
<h3 id="org3d8a7bf"><span class="section-number-3">3.1</span> database 的创建和删除</h3>
<div class="outline-text-3" id="text-3-1">
<p>
最基本的创建语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">create</span> database demo;
<span style="color: #c678dd; font-weight: bold;">go</span>
</pre>
</div>

<p>
带各种参数的创建语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">create</span> database school
<span style="color: #c678dd; font-weight: bold;">on</span>
<span style="color: #8c8c8c;">(</span>
   <span style="color: #c678dd; font-weight: bold;">name</span> = school,                   <span style="color: #687080; font-style: italic;">-- &#20027;&#25968;&#25454;&#25991;&#20214;&#30340;&#36923;&#36753;&#21517;&#31216;</span>
   filename = <span style="color: #98be65;">'d:\data\school.mdf'</span>, <span style="color: #687080; font-style: italic;">-- &#20027;&#25968;&#25454;&#25991;&#20214;&#25968;&#25454;&#20445;&#23384;&#30340;&#20301;&#32622;</span>
   <span style="color: #c678dd; font-weight: bold;">size</span> = 10,                       <span style="color: #687080; font-style: italic;">-- &#20027;&#25968;&#25454;&#25991;&#20214;&#30340;&#21021;&#22987;&#21270;&#22823;&#23567;&#20026; 10M</span>
   maxsize = 500,                   <span style="color: #687080; font-style: italic;">-- &#20027;&#25968;&#25454;&#25991;&#20214;&#30340;&#26368;&#22823;&#20540;&#20026; 500M</span>
   filegrowth = 10%                 <span style="color: #687080; font-style: italic;">-- &#20027;&#25968;&#25454;&#25991;&#20214;&#30340;&#22686;&#38271;&#31574;&#30053;</span>
<span style="color: #8c8c8c;">)</span>
log <span style="color: #c678dd; font-weight: bold;">on</span>
<span style="color: #8c8c8c;">(</span>
   <span style="color: #c678dd; font-weight: bold;">name</span> = school_log,                   <span style="color: #687080; font-style: italic;">-- &#26085;&#24535;&#25991;&#20214;&#30340;&#36923;&#36753;&#21517;&#23383;</span>
   filename = <span style="color: #98be65;">'d:\data\school_log.ldf'</span>, <span style="color: #687080; font-style: italic;">-- &#26085;&#24535;&#25991;&#20214;&#30340;&#20445;&#23384;&#20301;&#32622;</span>
   <span style="color: #c678dd; font-weight: bold;">size</span> = 10,
   maxsize = 100,
   filegrowth = 2
<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">go</span>
</pre>
</div>

<p>
删除的语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">drop</span> database school;
<span style="color: #c678dd; font-weight: bold;">drop</span> database home;
<span style="color: #c678dd; font-weight: bold;">drop</span> database demo;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc9118f7" class="outline-3">
<h3 id="orgc9118f7"><span class="section-number-3">3.2</span> table 的创建</h3>
<div class="outline-text-3" id="text-3-2">
<p>
基本的创建示例:
</p>
<div class="org-src-container">
<pre class="src src-sql">use xxx;
<span style="color: #c678dd; font-weight: bold;">go</span>
<span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">room_type</span>
<span style="color: #8c8c8c;">(</span>
   type_number <span style="color: #61afef;">varchar</span><span style="color: #93a8c6;">(</span>4<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">primary</span> <span style="color: #c678dd; font-weight: bold;">key</span>,
   type_name <span style="color: #61afef;">varchar</span><span style="color: #93a8c6;">(</span>40<span style="color: #93a8c6;">)</span>,
   pricE money,
   <span style="color: #93a8c6;">[</span>coPrice<span style="color: #93a8c6;">]</span> money,
   total_number <span style="color: #61afef;">decimal</span><span style="color: #93a8c6;">(</span>3, 0<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">null</span> <span style="color: #c678dd; font-weight: bold;">default</span> 0
<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">go</span>
</pre>
</div>

<p>
稍复杂一点的例子:
</p>
<div class="org-src-container">
<pre class="src src-sql">use xxx;
<span style="color: #c678dd; font-weight: bold;">go</span>
<span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">stuInfo</span>
<span style="color: #8c8c8c;">(</span>
   stuNo <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">identity</span> <span style="color: #c678dd; font-weight: bold;">primary</span> <span style="color: #c678dd; font-weight: bold;">key</span>,         <span style="color: #687080; font-style: italic;">-- &#20027;&#38190;+&#33258;&#22686;</span>
   stuName <span style="color: #61afef;">varchar</span><span style="color: #93a8c6;">(</span>12<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">null</span>,           <span style="color: #687080; font-style: italic;">-- &#38750;&#31354;&#32422;&#26463;</span>
   stuAge <span style="color: #61afef;">int</span>                              <span style="color: #687080; font-style: italic;">-- &#26377;&#38382;&#39064;!!!</span>
     <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">null</span>                              <span style="color: #687080; font-style: italic;">-- &#38750;&#31354;&#32422;&#26463;</span>
     <span style="color: #c678dd; font-weight: bold;">check</span><span style="color: #93a8c6;">(</span>stuAge &gt;= 0 <span style="color: #c678dd; font-weight: bold;">and</span> stuAge &lt;= 100<span style="color: #93a8c6;">)</span>, <span style="color: #687080; font-style: italic;">-- &#26816;&#26597;&#32422;&#26463;</span>
   stuSex <span style="color: #61afef;">nchar</span><span style="color: #93a8c6;">(</span>1<span style="color: #93a8c6;">)</span>
     <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">null</span>                              <span style="color: #687080; font-style: italic;">-- &#38750;&#31354;&#32422;&#26463;</span>
     <span style="color: #c678dd; font-weight: bold;">check</span><span style="color: #93a8c6;">(</span>stuSex = <span style="color: #98be65;">'&#30007;'</span> <span style="color: #c678dd; font-weight: bold;">or</span> stuSex = <span style="color: #98be65;">'&#22899;'</span><span style="color: #93a8c6;">)</span> <span style="color: #687080; font-style: italic;">-- &#26816;&#26597;&#32422;&#26463;</span>
     <span style="color: #c678dd; font-weight: bold;">default</span> <span style="color: #93a8c6;">(</span><span style="color: #98be65;">'&#30007;'</span><span style="color: #93a8c6;">)</span>,                       <span style="color: #687080; font-style: italic;">-- &#40664;&#35748;&#20540;</span>
   stuTel <span style="color: #61afef;">varchar</span><span style="color: #93a8c6;">(</span>15<span style="color: #93a8c6;">)</span>,
   stuAddress <span style="color: #61afef;">varchar</span><span style="color: #93a8c6;">(</span>50<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">default</span> <span style="color: #93a8c6;">(</span><span style="color: #98be65;">'&#22320;&#22336;&#19981;&#35814;'</span><span style="color: #93a8c6;">)</span>,
   className <span style="color: #61afef;">varchar</span><span style="color: #93a8c6;">(</span>12<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">null</span>
<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">go</span>
<span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">exam</span>
<span style="color: #8c8c8c;">(</span>
  examNo <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">primary</span> <span style="color: #c678dd; font-weight: bold;">key</span> <span style="color: #c678dd; font-weight: bold;">identity</span><span style="color: #93a8c6;">(</span>1, 1<span style="color: #93a8c6;">)</span>,
  stuNo <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">foreign</span> <span style="color: #c678dd; font-weight: bold;">key</span> <span style="color: #c678dd; font-weight: bold;">references</span> stuInfo<span style="color: #93a8c6;">(</span>stuNo<span style="color: #93a8c6;">)</span>,       <span style="color: #687080; font-style: italic;">-- &#22806;&#38190;&#32422;&#26463;</span>
  written <span style="color: #61afef;">float</span> <span style="color: #c678dd; font-weight: bold;">check</span> <span style="color: #93a8c6;">(</span>written &gt;= 0 <span style="color: #c678dd; font-weight: bold;">and</span> written &lt;= 100<span style="color: #93a8c6;">)</span>, <span style="color: #687080; font-style: italic;">-- &#31508;&#35797;</span>
  lab <span style="color: #61afef;">float</span> <span style="color: #c678dd; font-weight: bold;">check</span> <span style="color: #93a8c6;">(</span>lab &gt;= 0 <span style="color: #c678dd; font-weight: bold;">and</span> lab &lt;= 100<span style="color: #93a8c6;">)</span>              <span style="color: #687080; font-style: italic;">-- &#26426;&#35797;</span>
<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">go</span>
</pre>
</div>

<p>
Question:
</p>
<ul class="org-ul">
<li><p>
char/nchar/varchar/nvarchar 类型的区别
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">x</span> <span style="color: #8c8c8c;">(</span>s <span style="color: #61afef;">char</span><span style="color: #93a8c6;">(</span>1<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">y</span> <span style="color: #8c8c8c;">(</span>s <span style="color: #61afef;">nchar</span><span style="color: #93a8c6;">(</span>1<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> y <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'&#30007;'</span><span style="color: #8c8c8c;">)</span>;
</pre>
</div></li>
<li>GBK/UTF8/UTF16 的区别</li>
<li>什么是外键，它有什么作用，是不是必须的? 外键有哪些添加方式?</li>
</ul>

<p>
小结:
</p>
<ul class="org-ul">
<li>默认情况下，字段的大小写不敏感，可以使用 <code>[xxx]</code> 方式强制其敏感</li>
<li>在数据库中，字段/表名字使用的是下划线分割的命名规则</li>
<li>数据应该是静态的，年龄 (Age) 不适合作为一个字段，用 birth 代替</li>
<li>建议使用 <b>代理主键</b> 代替 <b>自然主键</b>，即主键不应与业务有关</li>
<li><p>
表跟列的命名，有不同风格:
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">student</span> <span style="color: #8c8c8c;">(</span>id, <span style="color: #c678dd; font-weight: bold;">name</span>, tel, addr<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">t_student</span> <span style="color: #8c8c8c;">(</span>stu_id, stu_name, stu_tel, stu_addr<span style="color: #8c8c8c;">)</span>;
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgc034ae3" class="outline-3">
<h3 id="orgc034ae3"><span class="section-number-3">3.3</span> 常见数据类型</h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-org729861d" class="outline-4">
<h4 id="org729861d"><span class="section-number-4">3.3.1</span> 数值</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
整数:
</p>
<ul class="org-ul">
<li>tinyint</li>
<li>smallint</li>
<li>int</li>
<li>bigint</li>
</ul>

<p>
浮点:
</p>
<ul class="org-ul">
<li>real</li>
<li>float</li>
<li>decimal(5,2)</li>
</ul>

<p>
另外:
</p>
<ul class="org-ul">
<li>smallmoney</li>
<li>money</li>
</ul>
</div>
</div>

<div id="outline-container-org67411c3" class="outline-4">
<h4 id="org67411c3"><span class="section-number-4">3.3.2</span> 字符串</h4>
<div class="outline-text-4" id="text-3-3-2">
<ul class="org-ul">
<li>char/nchar</li>
<li>varchar/nvarchar，有存储上限的 8000</li>
<li>text/ntext，表示巨大的存储</li>
</ul>
</div>
</div>

<div id="outline-container-orgdaee19c" class="outline-4">
<h4 id="orgdaee19c"><span class="section-number-4">3.3.3</span> 日期/时间</h4>
<div class="outline-text-4" id="text-3-3-3">
<ul class="org-ul">
<li>date</li>
<li>time</li>
<li>datetime</li>
<li>datetime2</li>
<li>getdate()</li>
</ul>
</div>
</div>

<div id="outline-container-org5c1f978" class="outline-4">
<h4 id="org5c1f978"><span class="section-number-4">3.3.4</span> 其他类型</h4>
<div class="outline-text-4" id="text-3-3-4">
<ul class="org-ul">
<li>image</li>
<li>binary</li>
<li>varbinary</li>
</ul>
</div>
</div>

<div id="outline-container-org3a81d6d" class="outline-4">
<h4 id="org3a81d6d"><span class="section-number-4">3.3.5</span> 使用例子</h4>
<div class="outline-text-4" id="text-3-3-5">
<div class="org-src-container">
<pre class="src src-sql">use xxx;
<span style="color: #c678dd; font-weight: bold;">go</span>
<span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">xx13</span> <span style="color: #8c8c8c;">(</span>aaa datetime2 <span style="color: #c678dd; font-weight: bold;">default</span> getdate<span style="color: #93a8c6;">()</span>, b <span style="color: #61afef;">int</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> xx13 <span style="color: #8c8c8c;">(</span>b<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span>1<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">go</span>

<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> xx13;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org720a383" class="outline-3">
<h3 id="org720a383"><span class="section-number-3">3.4</span> table 的修改</h3>
<div class="outline-text-3" id="text-3-4">
<p>
基本修改:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#28155;&#21152;&#23383;&#27573;</span>
<span style="color: #c678dd; font-weight: bold;">alter</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">stuinfo</span> <span style="color: #c678dd; font-weight: bold;">add</span> stuEmail <span style="color: #61afef;">varchar</span><span style="color: #8c8c8c;">(</span>50<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">null</span>;

<span style="color: #687080; font-style: italic;">-- &#20462;&#25913;&#23383;&#27573;</span>
<span style="color: #c678dd; font-weight: bold;">alter</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">stuinfo</span> <span style="color: #c678dd; font-weight: bold;">alter</span> <span style="color: #c678dd; font-weight: bold;">column</span> stuname nvarchar<span style="color: #8c8c8c;">(</span>9<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">null</span>;

<span style="color: #687080; font-style: italic;">-- &#21024;&#38500;&#23383;&#27573;</span>
<span style="color: #c678dd; font-weight: bold;">alter</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">stuinfo</span> <span style="color: #c678dd; font-weight: bold;">drop</span> <span style="color: #c678dd; font-weight: bold;">column</span> stuEmail;

<span style="color: #687080; font-style: italic;">-- &#32422;&#26463;&#30340;&#28155;&#21152;&#21644;&#21024;&#38500;</span>
<span style="color: #c678dd; font-weight: bold;">alter</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">stuinfo</span> <span style="color: #c678dd; font-weight: bold;">add</span> <span style="color: #c678dd; font-weight: bold;">constraint</span> pk_stuno <span style="color: #c678dd; font-weight: bold;">primary</span> <span style="color: #c678dd; font-weight: bold;">key</span> <span style="color: #8c8c8c;">(</span>stuno<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">alter</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">stuinfo</span> <span style="color: #c678dd; font-weight: bold;">drop</span> <span style="color: #c678dd; font-weight: bold;">constraint</span> pk_stuno;
<span style="color: #c678dd; font-weight: bold;">alter</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">stuinfo</span> <span style="color: #c678dd; font-weight: bold;">add</span> <span style="color: #c678dd; font-weight: bold;">constraint</span> fk_stuno <span style="color: #c678dd; font-weight: bold;">foreign</span> <span style="color: #c678dd; font-weight: bold;">key</span> <span style="color: #8c8c8c;">(</span>stuno<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">references</span> xxx<span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">no</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">alter</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">stuinfo</span> <span style="color: #c678dd; font-weight: bold;">drop</span> <span style="color: #c678dd; font-weight: bold;">constraint</span> fk_stuno;
</pre>
</div>
</div>
</div>

<div id="outline-container-org877b2eb" class="outline-3">
<h3 id="org877b2eb"><span class="section-number-3">3.5</span> table 的删除</h3>
<div class="outline-text-3" id="text-3-5">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">drop</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">xxx</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf46e263" class="outline-3">
<h3 id="orgf46e263"><span class="section-number-3">3.6</span> constraint 的管理</h3>
<div class="outline-text-3" id="text-3-6">
<p>
分类:
</p>
<ul class="org-ul">
<li>主键约束 (Primary Key)</li>
<li>唯一约束 (Unique)</li>
<li>检查约束 (Check)</li>
<li>默认约束 (Default)</li>
<li>外键约束 (Foreign Key)</li>
</ul>

<p>
到底使用外键否? 取决于 <b>场景</b> 和 <b>权衡</b>。
</p>

<p>
添加到列上的约束:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">demo_constraint</span>
<span style="color: #8c8c8c;">(</span>
   aaa <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">primary</span> <span style="color: #c678dd; font-weight: bold;">key</span>,
   bbb <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">null</span>,
   ccc <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">default</span> 1,
   ddd <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">check</span> <span style="color: #93a8c6;">(</span>ddd &gt; 5<span style="color: #93a8c6;">)</span>,
   eee <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">unique</span>,
   fff <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">references</span> xxx<span style="color: #93a8c6;">(</span><span style="color: #c678dd; font-weight: bold;">number</span><span style="color: #93a8c6;">)</span>
<span style="color: #8c8c8c;">)</span>;
<span style="color: #687080; font-style: italic;">-- &#22914;&#26524;&#20462;&#25913;&#65292;&#21487;&#20197;&#20351;&#29992; alter table ... alter column ...</span>
</pre>
</div>

<p>
表级约束 (建表的时候添加):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">demo_constraint</span>
<span style="color: #8c8c8c;">(</span>
   aaa <span style="color: #61afef;">int</span>,
   bbb <span style="color: #61afef;">int</span>,
   ccc <span style="color: #61afef;">int</span>,
   ddd <span style="color: #61afef;">int</span>,
   eee <span style="color: #61afef;">int</span>,
   fff <span style="color: #61afef;">int</span>,
   <span style="color: #93a8c6;">[</span><span style="color: #c678dd; font-weight: bold;">constraint</span> pk_aaa<span style="color: #93a8c6;">]</span> <span style="color: #c678dd; font-weight: bold;">primary</span> <span style="color: #c678dd; font-weight: bold;">key</span> <span style="color: #93a8c6;">(</span>aaa<span style="color: #93a8c6;">)</span>,
   <span style="color: #93a8c6;">[</span><span style="color: #c678dd; font-weight: bold;">constraint</span> fk_fff<span style="color: #93a8c6;">]</span> <span style="color: #c678dd; font-weight: bold;">foreign</span> <span style="color: #c678dd; font-weight: bold;">key</span> <span style="color: #93a8c6;">(</span>fff<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">references</span> xxx<span style="color: #93a8c6;">(</span><span style="color: #c678dd; font-weight: bold;">number</span><span style="color: #93a8c6;">)</span>
<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">alter</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">demo_constraint</span> <span style="color: #c678dd; font-weight: bold;">drop</span> <span style="color: #c678dd; font-weight: bold;">constraint</span> pk_aaa;
</pre>
</div>

<p>
表级约束 (建完表之后添加，在实际中更常用):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">demo_constraint</span>
<span style="color: #8c8c8c;">(</span>
   aaa <span style="color: #61afef;">int</span>,
   bbb <span style="color: #61afef;">int</span>,
   ccc <span style="color: #61afef;">int</span>,
   ddd <span style="color: #61afef;">int</span>,
   eee <span style="color: #61afef;">int</span>,
   fff <span style="color: #61afef;">int</span>
<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">alter</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">demo_constraint</span> <span style="color: #c678dd; font-weight: bold;">add</span> <span style="color: #c678dd; font-weight: bold;">constraint</span> pk_aaa <span style="color: #c678dd; font-weight: bold;">primary</span> <span style="color: #c678dd; font-weight: bold;">key</span> <span style="color: #8c8c8c;">(</span>aaa<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">alter</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">demo_constraint</span> <span style="color: #c678dd; font-weight: bold;">add</span> <span style="color: #c678dd; font-weight: bold;">constraint</span> fk_fff <span style="color: #c678dd; font-weight: bold;">foreign</span> <span style="color: #c678dd; font-weight: bold;">key</span> <span style="color: #8c8c8c;">(</span>fff<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">references</span> xxx<span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">number</span><span style="color: #8c8c8c;">)</span>;
</pre>
</div>

<p>
在实际中，可能要综合使用:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">demo_constraint</span>
<span style="color: #8c8c8c;">(</span>
   aaa <span style="color: #61afef;">int</span>,
   bbb <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">null</span>,
   ccc <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">unique</span>,
   ddd <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">default</span> 2,
   eee <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">check</span> <span style="color: #93a8c6;">(</span>eee &gt; 4<span style="color: #93a8c6;">)</span>,
   fff <span style="color: #61afef;">int</span>,
   <span style="color: #c678dd; font-weight: bold;">primary</span> <span style="color: #c678dd; font-weight: bold;">key</span> <span style="color: #93a8c6;">(</span>aaa<span style="color: #93a8c6;">)</span>
<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">alter</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">demo_constraint</span> <span style="color: #c678dd; font-weight: bold;">add</span> <span style="color: #c678dd; font-weight: bold;">constraint</span> fk_fff <span style="color: #c678dd; font-weight: bold;">foreign</span> <span style="color: #c678dd; font-weight: bold;">key</span> <span style="color: #8c8c8c;">(</span>fff<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">references</span> xxx<span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">number</span><span style="color: #8c8c8c;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orged456e4" class="outline-3">
<h3 id="orged456e4"><span class="section-number-3">3.7</span> insert 插入</h3>
<div class="outline-text-3" id="text-3-7">
<p>
基本写法:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">zzz</span> <span style="color: #8c8c8c;">(</span>a <span style="color: #61afef;">int</span>, b text, c <span style="color: #61afef;">date</span><span style="color: #8c8c8c;">)</span>;

<span style="color: #687080; font-style: italic;">-- &#25353;&#29031;&#39034;&#24207;&#23545;&#24212;&#34920;&#20013;&#30340;&#23383;&#27573; (&#19981;&#25512;&#33616;)</span>
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> zzz <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span>111, <span style="color: #98be65;">'abc'</span>, <span style="color: #98be65;">'2009-02-13'</span><span style="color: #8c8c8c;">)</span>;

<span style="color: #687080; font-style: italic;">-- &#22914;&#26524;&#21457;&#29983;&#34920;&#30340;&#23383;&#27573;&#22686;&#21152;&#30340;&#24773;&#20917;&#65292;&#19978;&#36848;&#30340;&#35821;&#21477;&#20250;&#20986;&#38169;</span>
<span style="color: #c678dd; font-weight: bold;">alter</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">zzz</span> <span style="color: #c678dd; font-weight: bold;">add</span> ddd <span style="color: #61afef;">varchar</span><span style="color: #8c8c8c;">(</span>20<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">default</span> <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'bossisevil'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> zzz <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span>111, <span style="color: #98be65;">'abc'</span>, <span style="color: #98be65;">'2009-02-13'</span><span style="color: #8c8c8c;">)</span>; <span style="color: #687080; font-style: italic;">-- &#20986;&#38169;</span>
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> zzz <span style="color: #8c8c8c;">(</span>a, b, c<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span>111, <span style="color: #98be65;">'abc'</span>, <span style="color: #98be65;">'2009-02-13'</span><span style="color: #8c8c8c;">)</span>; <span style="color: #687080; font-style: italic;">-- &#27491;&#30830;&#20889;&#27861;!</span>

<span style="color: #687080; font-style: italic;">-- &#20026;&#25968;&#25454;&#34920;&#65292;&#22686;&#21152;&#19968;&#20010;&#40664;&#35748;&#25554;&#20837;&#26102;&#38388;&#30340;&#23383;&#27573;</span>
<span style="color: #c678dd; font-weight: bold;">alter</span> <span style="color: #c678dd; font-weight: bold;">table</span> zzz <span style="color: #c678dd; font-weight: bold;">add</span> created_at datetime <span style="color: #c678dd; font-weight: bold;">default</span> <span style="color: #61afef;">getdate</span><span style="color: #8c8c8c;">()</span>;
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> zzz <span style="color: #8c8c8c;">(</span>a, b, c<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span>111, <span style="color: #98be65;">'abc'</span>, <span style="color: #98be65;">'2009-02-13'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> zzz; <span style="color: #687080; font-style: italic;">-- created_at &#23383;&#27573;&#34987;&#22635;&#20805;&#20102;&#20540;</span>
</pre>
</div>

<p>
复制表的数据:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#22797;&#21046;&#34920;&#30340;&#32467;&#26524;&#65292;&#20197;&#21450;&#25968;&#25454;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">into</span> zzzzz <span style="color: #c678dd; font-weight: bold;">from</span> zzz;

<span style="color: #687080; font-style: italic;">-- &#21482;&#26159;&#22797;&#21046;&#25968;&#25454;</span>
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> zzzz <span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> zzz <span style="color: #c678dd; font-weight: bold;">where</span> ddd <span style="color: #c678dd; font-weight: bold;">is</span> <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">null</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc74556d" class="outline-3">
<h3 id="orgc74556d"><span class="section-number-3">3.8</span> delete/truncate 删除</h3>
<div class="outline-text-3" id="text-3-8">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#21024;&#38500; zzz &#20013;&#25152;&#26377;&#25968;&#25454;</span>
<span style="color: #c678dd; font-weight: bold;">delete</span> <span style="color: #c678dd; font-weight: bold;">from</span> zzz;

<span style="color: #687080; font-style: italic;">-- &#21024;&#38500; zzz &#20013;&#37096;&#20998;&#25968;&#25454;</span>
<span style="color: #c678dd; font-weight: bold;">delete</span> <span style="color: #c678dd; font-weight: bold;">from</span> zzz <span style="color: #c678dd; font-weight: bold;">where</span> ddd <span style="color: #c678dd; font-weight: bold;">is</span> <span style="color: #c678dd; font-weight: bold;">null</span>;

<span style="color: #687080; font-style: italic;">-- &#21024;&#38500;&#25152;&#26377;&#25968;&#25454;</span>
<span style="color: #687080; font-style: italic;">-- &#27604; delete &#26356;&#39640;&#25928; (&#19981;&#29992;&#35760;&#24405;&#26085;&#24535;)</span>
<span style="color: #687080; font-style: italic;">-- truncate &#19981;&#33021;&#21152;&#26465;&#20214;</span>
<span style="color: #687080; font-style: italic;">-- &#23646;&#20110; DDL &#35821;&#21477;</span>
<span style="color: #687080; font-style: italic;">-- &#22362;&#20915;&#35201;&#24910;&#29992;&#27492;&#35821;&#21477;</span>
truncate <span style="color: #c678dd; font-weight: bold;">table</span> zzz;
</pre>
</div>
</div>
</div>

<div id="outline-container-org92f5321" class="outline-3">
<h3 id="org92f5321"><span class="section-number-3">3.9</span> update 更新</h3>
<div class="outline-text-3" id="text-3-9">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#19968;&#23450;&#19981;&#35201;&#33853;&#19979; where &#26465;&#20214;</span>
<span style="color: #687080; font-style: italic;">-- &#22312;&#26356;&#26032;&#21069;&#65292;&#19968;&#23450;&#20808;&#36890;&#36807; select &#30830;&#23450;&#35201;&#20462;&#25913;&#30340;&#25968;&#25454;&#26465;&#30446;</span>
<span style="color: #c678dd; font-weight: bold;">update</span> zzz <span style="color: #c678dd; font-weight: bold;">set</span> a = 2 <span style="color: #c678dd; font-weight: bold;">where</span> a = 1;
<span style="color: #c678dd; font-weight: bold;">update</span> zzz <span style="color: #c678dd; font-weight: bold;">set</span> a = a + 2 <span style="color: #c678dd; font-weight: bold;">where</span> a = 1;
</pre>
</div>
</div>
</div>

<div id="outline-container-org3efb8f5" class="outline-3">
<h3 id="org3efb8f5"><span class="section-number-3">3.10</span> select 查询</h3>
<div class="outline-text-3" id="text-3-10">
</div>
<div id="outline-container-orgc8463eb" class="outline-4">
<h4 id="orgc8463eb"><span class="section-number-4">3.10.1</span> 测试数据</h4>
<div class="outline-text-4" id="text-3-10-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">CREATE</span> DATABASE oa;
use oa;

<span style="color: #c678dd; font-weight: bold;">CREATE</span> <span style="color: #c678dd; font-weight: bold;">TABLE</span> <span style="color: #61afef;">dept</span> <span style="color: #8c8c8c;">(</span> <span style="color: #687080; font-style: italic;">-- department</span>
  deptno <span style="color: #61afef;">int</span>,
  dname  <span style="color: #61afef;">VARCHAR</span><span style="color: #93a8c6;">(</span>14<span style="color: #93a8c6;">)</span>,
  loc    <span style="color: #61afef;">VARCHAR</span><span style="color: #93a8c6;">(</span>13<span style="color: #93a8c6;">)</span>, <span style="color: #687080; font-style: italic;">-- location/address</span>
  <span style="color: #c678dd; font-weight: bold;">CONSTRAINT</span> pk_dept <span style="color: #c678dd; font-weight: bold;">PRIMARY</span> <span style="color: #c678dd; font-weight: bold;">KEY</span> <span style="color: #93a8c6;">(</span>deptno<span style="color: #93a8c6;">)</span>
<span style="color: #8c8c8c;">)</span>;

<span style="color: #c678dd; font-weight: bold;">CREATE</span> <span style="color: #c678dd; font-weight: bold;">TABLE</span> <span style="color: #61afef;">emp</span> <span style="color: #8c8c8c;">(</span> <span style="color: #687080; font-style: italic;">-- employee</span>
  empno    <span style="color: #61afef;">int</span>,
  ename    <span style="color: #61afef;">VARCHAR</span><span style="color: #93a8c6;">(</span>10<span style="color: #93a8c6;">)</span>,
  job      <span style="color: #61afef;">VARCHAR</span><span style="color: #93a8c6;">(</span>9<span style="color: #93a8c6;">)</span>,
  mgr      <span style="color: #61afef;">int</span>,
  hiredate <span style="color: #61afef;">DATE</span>,
  sal      <span style="color: #61afef;">float</span>,
  comm     <span style="color: #61afef;">float</span>,
  deptno   <span style="color: #61afef;">int</span>,
  <span style="color: #c678dd; font-weight: bold;">CONSTRAINT</span> pk_emp <span style="color: #c678dd; font-weight: bold;">PRIMARY</span> <span style="color: #c678dd; font-weight: bold;">KEY</span> <span style="color: #93a8c6;">(</span>empno<span style="color: #93a8c6;">)</span>,
  <span style="color: #c678dd; font-weight: bold;">CONSTRAINT</span> fk_deptno <span style="color: #c678dd; font-weight: bold;">FOREIGN</span> <span style="color: #c678dd; font-weight: bold;">KEY</span> <span style="color: #93a8c6;">(</span>deptno<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">REFERENCES</span> dept <span style="color: #93a8c6;">(</span>deptno<span style="color: #93a8c6;">)</span>
<span style="color: #8c8c8c;">)</span>;

<span style="color: #c678dd; font-weight: bold;">CREATE</span> <span style="color: #c678dd; font-weight: bold;">TABLE</span> <span style="color: #61afef;">bonus</span> <span style="color: #8c8c8c;">(</span> <span style="color: #687080; font-style: italic;">-- bonus</span>
  ename <span style="color: #61afef;">VARCHAR</span><span style="color: #93a8c6;">(</span>10<span style="color: #93a8c6;">)</span>,
  job   <span style="color: #61afef;">VARCHAR</span><span style="color: #93a8c6;">(</span>9<span style="color: #93a8c6;">)</span>,
  sal   <span style="color: #61afef;">float</span>,
  comm  <span style="color: #61afef;">float</span>
<span style="color: #8c8c8c;">)</span>;

<span style="color: #c678dd; font-weight: bold;">CREATE</span> <span style="color: #c678dd; font-weight: bold;">TABLE</span> <span style="color: #61afef;">salgrade</span> <span style="color: #8c8c8c;">(</span> <span style="color: #687080; font-style: italic;">-- salary grade</span>
  grade <span style="color: #61afef;">int</span>,
  losal <span style="color: #61afef;">float</span>,
  hisal <span style="color: #61afef;">float</span>
<span style="color: #8c8c8c;">)</span>;

<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> dept <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span>10, <span style="color: #98be65;">'ACCOUNTING'</span>, <span style="color: #98be65;">'NEW YORK'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> dept <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span>20, <span style="color: #98be65;">'RESEARCH'</span>, <span style="color: #98be65;">'DALLAS'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> dept <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span>30, <span style="color: #98be65;">'SALES'</span>, <span style="color: #98be65;">'CHICAGO'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> dept <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span>40, <span style="color: #98be65;">'OPERATIONS'</span>, <span style="color: #98be65;">'BOSTON'</span><span style="color: #8c8c8c;">)</span>;

<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> emp <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span> 7839, <span style="color: #98be65;">'KING'</span>, <span style="color: #98be65;">'PRESIDENT'</span>, <span style="color: #c678dd; font-weight: bold;">null</span>, <span style="color: #98be65;">'1981-11-17'</span>, 5000, <span style="color: #c678dd; font-weight: bold;">null</span>, 10 <span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> emp <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span> 7698, <span style="color: #98be65;">'BLAKE'</span>, <span style="color: #98be65;">'MANAGER'</span>, 7839, <span style="color: #98be65;">'1981-05-01'</span>, 2850, <span style="color: #c678dd; font-weight: bold;">null</span>, 30<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> emp <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span> 7782, <span style="color: #98be65;">'CLARK'</span>, <span style="color: #98be65;">'MANAGER'</span>, 7839, <span style="color: #98be65;">'1981-06-09'</span>, 2450, <span style="color: #c678dd; font-weight: bold;">null</span>, 10<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> emp <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span> 7566, <span style="color: #98be65;">'JONES'</span>, <span style="color: #98be65;">'MANAGER'</span>, 7839, <span style="color: #98be65;">'1981-04-02'</span>, 2975, <span style="color: #c678dd; font-weight: bold;">null</span>, 20<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> emp <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span> 7788, <span style="color: #98be65;">'SCOTT'</span>, <span style="color: #98be65;">'ANALYST'</span>, 7566, <span style="color: #98be65;">'1987-07-13'</span>, 3000, <span style="color: #c678dd; font-weight: bold;">null</span>, 20<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> emp <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span> 7902, <span style="color: #98be65;">'FORD'</span>, <span style="color: #98be65;">'ANALYST'</span>, 7566, <span style="color: #98be65;">'1981-12-03'</span>, 3000, <span style="color: #c678dd; font-weight: bold;">null</span>, 20 <span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> emp <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span> 7369, <span style="color: #98be65;">'SMITH'</span>, <span style="color: #98be65;">'CLERK'</span>, 7902, <span style="color: #98be65;">'1980-12-17'</span>, 800, <span style="color: #c678dd; font-weight: bold;">null</span>, 20 <span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> emp <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span> 7499, <span style="color: #98be65;">'ALLEN'</span>, <span style="color: #98be65;">'SALESMAN'</span>, 7698, <span style="color: #98be65;">'1981-02-20'</span>, 1600, 300, 30<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> emp <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span> 7521, <span style="color: #98be65;">'WARD'</span>, <span style="color: #98be65;">'SALESMAN'</span>, 7698, <span style="color: #98be65;">'1981-02-22'</span>, 1250, 500, 30 <span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> emp <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span> 7654, <span style="color: #98be65;">'MARTIN'</span>, <span style="color: #98be65;">'SALESMAN'</span>, 7698, <span style="color: #98be65;">'1981-09-28'</span>, 1250, 1400, 30 <span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> emp <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span> 7844, <span style="color: #98be65;">'TURNER'</span>, <span style="color: #98be65;">'SALESMAN'</span>, 7698, <span style="color: #98be65;">'1981-09-08'</span>, 1500, 0, 30<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> emp <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span> 7876, <span style="color: #98be65;">'ADAMS'</span>, <span style="color: #98be65;">'CLERK'</span>, 7788, <span style="color: #98be65;">'1987-07-13'</span>, 1100, <span style="color: #c678dd; font-weight: bold;">null</span>, 20 <span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> emp <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span> 7900, <span style="color: #98be65;">'JAMES'</span>, <span style="color: #98be65;">'CLERK'</span>, 7698, <span style="color: #98be65;">'1981-12-03'</span>, 950, <span style="color: #c678dd; font-weight: bold;">null</span>, 30 <span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> emp <span style="color: #c678dd; font-weight: bold;">VALUES</span><span style="color: #8c8c8c;">(</span> 7934, <span style="color: #98be65;">'MILLER'</span>, <span style="color: #98be65;">'CLERK'</span>, 7782, <span style="color: #98be65;">'1982-01-23'</span>, 1300, <span style="color: #c678dd; font-weight: bold;">null</span>, 10 <span style="color: #8c8c8c;">)</span>;

<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> salgrade <span style="color: #c678dd; font-weight: bold;">VALUES</span> <span style="color: #8c8c8c;">(</span>1, 700, 1200<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> salgrade <span style="color: #c678dd; font-weight: bold;">VALUES</span> <span style="color: #8c8c8c;">(</span>2, 1201, 1400<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> salgrade <span style="color: #c678dd; font-weight: bold;">VALUES</span> <span style="color: #8c8c8c;">(</span>3, 1401, 2000<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> salgrade <span style="color: #c678dd; font-weight: bold;">VALUES</span> <span style="color: #8c8c8c;">(</span>4, 2001, 3000<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">INSERT</span> <span style="color: #c678dd; font-weight: bold;">INTO</span> salgrade <span style="color: #c678dd; font-weight: bold;">VALUES</span> <span style="color: #8c8c8c;">(</span>5, 3001, 9999<span style="color: #8c8c8c;">)</span>;

<span style="color: #c678dd; font-weight: bold;">go</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd6e70bf" class="outline-4">
<h4 id="orgd6e70bf"><span class="section-number-4">3.10.2</span> 基本查询</h4>
<div class="outline-text-4" id="text-3-10-2">
<p>
基本句式:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">select</span> &#23383;&#27573;&#20204;
  <span style="color: #c678dd; font-weight: bold;">from</span> &#34920;&#21517;
  <span style="color: #c678dd; font-weight: bold;">where</span> &#26465;&#20214; <span style="color: #c678dd; font-weight: bold;">or</span>/<span style="color: #c678dd; font-weight: bold;">and</span>/<span style="color: #c678dd; font-weight: bold;">not</span> &#20854;&#20182;&#26465;&#20214;
  <span style="color: #c678dd; font-weight: bold;">group</span> <span style="color: #c678dd; font-weight: bold;">by</span> &#32452;
  <span style="color: #c678dd; font-weight: bold;">having</span> &#20998;&#32452;&#22522;&#30784;&#19978;&#30340;&#26465;&#20214;
  <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> &#25490;&#24207;&#30340;&#20381;&#25454;;
</pre>
</div>

<p>
基本使用:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#26368;&#31616;&#21333;&#30340;&#26597;&#35810;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp;

<span style="color: #687080; font-style: italic;">-- &#25351;&#23450;&#23383;&#27573;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> empno, ename <span style="color: #c678dd; font-weight: bold;">from</span> emp;

<span style="color: #687080; font-style: italic;">-- &#28155;&#21152;&#26465;&#20214;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> empno, ename, sal, comm <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> sal &lt; 1500;

<span style="color: #687080; font-style: italic;">-- &#32452;&#21512;&#26465;&#20214;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> empno, ename, sal, comm <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> sal &lt; 1500 <span style="color: #c678dd; font-weight: bold;">and</span> comm <span style="color: #c678dd; font-weight: bold;">is</span> <span style="color: #c678dd; font-weight: bold;">null</span>;
<span style="color: #c678dd; font-weight: bold;">select</span> empno, ename, sal, comm <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> <span style="color: #8c8c8c;">(</span>sal &lt; 1500 <span style="color: #c678dd; font-weight: bold;">and</span> comm <span style="color: #c678dd; font-weight: bold;">is</span> <span style="color: #c678dd; font-weight: bold;">null</span><span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">or</span> sal &lt; 1300;
<span style="color: #c678dd; font-weight: bold;">select</span> empno, ename, sal, comm <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> sal + isnull<span style="color: #8c8c8c;">(</span>comm, 0<span style="color: #8c8c8c;">)</span> &lt; 1800;

<span style="color: #687080; font-style: italic;">-- &#20351;&#29992;&#21035;&#21517;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> empno, ename, sal - 200 <span style="color: #c678dd; font-weight: bold;">as</span> sal, comm <span style="color: #c678dd; font-weight: bold;">from</span> emp;
<span style="color: #c678dd; font-weight: bold;">select</span> empno, ename, sal - 200 + isnull<span style="color: #8c8c8c;">(</span>comm, 0<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> total_sal <span style="color: #c678dd; font-weight: bold;">from</span> emp;

<span style="color: #687080; font-style: italic;">-- &#36827;&#34892;&#35745;&#31639;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> empno,
       ename + <span style="color: #98be65;">' - '</span> + job <span style="color: #c678dd; font-weight: bold;">as</span> who,
       sal - 200 + isnull<span style="color: #8c8c8c;">(</span>comm, 0<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> total_sal
  <span style="color: #c678dd; font-weight: bold;">from</span> emp;

<span style="color: #687080; font-style: italic;">-- &#36827;&#34892;&#25490;&#24207;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> empno,
         ename + <span style="color: #98be65;">' - '</span> + job <span style="color: #c678dd; font-weight: bold;">as</span> who,
         sal - 200 + isnull<span style="color: #8c8c8c;">(</span>comm, 0<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> total_sal
    <span style="color: #c678dd; font-weight: bold;">from</span> emp
    <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> total_sal;

<span style="color: #687080; font-style: italic;">-- &#21453;&#21521;&#25490;&#24207;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> empno,
         ename + <span style="color: #98be65;">' - '</span> + job <span style="color: #c678dd; font-weight: bold;">as</span> who,
         sal - 200 + isnull<span style="color: #8c8c8c;">(</span>comm, 0<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> total_sal
    <span style="color: #c678dd; font-weight: bold;">from</span> emp
    <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> total_sal <span style="color: #c678dd; font-weight: bold;">desc</span>; <span style="color: #687080; font-style: italic;">-- Ascending</span>

<span style="color: #687080; font-style: italic;">-- &#22810;&#20010;&#25490;&#24207;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> sal + isnull<span style="color: #8c8c8c;">(</span>comm, 0<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">desc</span>,
           hiredate <span style="color: #c678dd; font-weight: bold;">desc</span>;

<span style="color: #687080; font-style: italic;">-- &#32467;&#21512; where&#65292;&#27880;&#24847;&#39034;&#24207;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> empno &lt;&gt; 7839
  <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> sal + isnull<span style="color: #8c8c8c;">(</span>comm, 0<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">desc</span>,
           hiredate <span style="color: #c678dd; font-weight: bold;">desc</span>;
</pre>
</div>

<p>
统计查询:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #61afef; font-weight: bold;">count</span><span style="color: #8c8c8c;">(</span>*<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp;
<span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #61afef; font-weight: bold;">count</span><span style="color: #8c8c8c;">(</span>1<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp;     <span style="color: #687080; font-style: italic;">-- &#19981;&#25512;&#33616;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #61afef; font-weight: bold;">count</span><span style="color: #8c8c8c;">(</span>empno<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp; <span style="color: #687080; font-style: italic;">-- &#19981;&#25512;&#33616;</span>

<span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #61afef; font-weight: bold;">max</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp;
<span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #61afef; font-weight: bold;">min</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp;
<span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #61afef; font-weight: bold;">avg</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> deptno = 20;
</pre>
</div>

<p>
快捷方式:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#23436;&#20840;&#31561;&#25928;&#65292;&#34920;&#31034;&#21306;&#38388;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> student <span style="color: #c678dd; font-weight: bold;">where</span> score &gt;= 60 <span style="color: #c678dd; font-weight: bold;">and</span> score &lt;= 90;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> student <span style="color: #c678dd; font-weight: bold;">where</span> score <span style="color: #c678dd; font-weight: bold;">between</span> 60 <span style="color: #c678dd; font-weight: bold;">and</span> 90;

<span style="color: #687080; font-style: italic;">-- &#23436;&#20840;&#31561;&#25928;&#65292;&#34920;&#31034;&#36873;&#39033;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> student <span style="color: #c678dd; font-weight: bold;">where</span> <span style="color: #c678dd; font-weight: bold;">class</span>=<span style="color: #98be65;">'163'</span> <span style="color: #c678dd; font-weight: bold;">or</span> <span style="color: #c678dd; font-weight: bold;">class</span>=<span style="color: #98be65;">'165'</span> <span style="color: #c678dd; font-weight: bold;">or</span> <span style="color: #c678dd; font-weight: bold;">class</span>=<span style="color: #98be65;">'168'</span>;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> student <span style="color: #c678dd; font-weight: bold;">where</span> <span style="color: #c678dd; font-weight: bold;">class</span> <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'163'</span>, <span style="color: #98be65;">'165'</span>, <span style="color: #98be65;">'168'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> student <span style="color: #c678dd; font-weight: bold;">where</span> <span style="color: #c678dd; font-weight: bold;">class</span> <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'163'</span>, <span style="color: #98be65;">'165'</span>, <span style="color: #98be65;">'168'</span><span style="color: #8c8c8c;">)</span>;
</pre>
</div>

<p>
小结:
</p>
<ul class="org-ul">
<li>使用 * 代表所有字段，结果会按照定义的顺序返回</li>
<li>使用 count(*) 来统计总数</li>
<li>注意 where/group/order-by 的顺序</li>
<li>使用 != 或 &lt;&gt; 来表示不等于</li>
<li>使用 is null 或 is not null 表示空或非空</li>
<li>SQLServer 中使用 + 连接字符串</li>
</ul>
</div>
</div>

<div id="outline-container-org29881c2" class="outline-4">
<h4 id="org29881c2"><span class="section-number-4">3.10.3</span> 子查询 (subquery)</h4>
<div class="outline-text-4" id="text-3-10-3">
</div>
<div id="outline-container-org87076c8" class="outline-5">
<h5 id="org87076c8"><span class="section-number-5">3.10.3.1</span> 作为临时表存在</h5>
<div class="outline-text-5" id="text-3-10-3-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#23454;&#38469;&#19978;&#65292;&#23601;&#26159;&#20869;&#23384;&#20013;&#30340;&#20020;&#26102;&#34920;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> ename, job <span style="color: #c678dd; font-weight: bold;">from</span> <span style="color: #8c8c8c;">(</span>
    <span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> sal &gt; 2000
  <span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> a1
  <span style="color: #c678dd; font-weight: bold;">where</span> sal &lt; 5000;

<span style="color: #687080; font-style: italic;">-- &#30127;&#29378;&#27169;&#24335;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> ename <span style="color: #c678dd; font-weight: bold;">from</span> <span style="color: #8c8c8c;">(</span>
  <span style="color: #c678dd; font-weight: bold;">select</span> ename <span style="color: #c678dd; font-weight: bold;">from</span> <span style="color: #93a8c6;">(</span>
    <span style="color: #c678dd; font-weight: bold;">select</span> ename <span style="color: #c678dd; font-weight: bold;">from</span> <span style="color: #b0b1a3;">(</span>
      <span style="color: #c678dd; font-weight: bold;">select</span> ename <span style="color: #c678dd; font-weight: bold;">from</span> <span style="color: #97b098;">(</span>
        <span style="color: #c678dd; font-weight: bold;">select</span> ename, job <span style="color: #c678dd; font-weight: bold;">from</span> <span style="color: #aebed8;">(</span>
          <span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> sal &gt; 2000
        <span style="color: #aebed8;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> a1
        <span style="color: #c678dd; font-weight: bold;">where</span> sal &lt; 5000<span style="color: #97b098;">)</span>
      <span style="color: #c678dd; font-weight: bold;">as</span> a2 <span style="color: #b0b1a3;">)</span>
    <span style="color: #c678dd; font-weight: bold;">as</span> a3<span style="color: #93a8c6;">)</span>
  <span style="color: #c678dd; font-weight: bold;">as</span> a4<span style="color: #8c8c8c;">)</span>
<span style="color: #c678dd; font-weight: bold;">as</span> a5;
</pre>
</div>
</div>
</div>

<div id="outline-container-org65a4a8f" class="outline-5">
<h5 id="org65a4a8f"><span class="section-number-5">3.10.3.2</span> 作为字段存在</h5>
<div class="outline-text-5" id="text-3-10-3-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">select</span> empno, ename,
       job, sal, comm,
       deptno,
       sal - <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #61afef; font-weight: bold;">avg</span><span style="color: #93a8c6;">(</span>sal<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> chaju <span style="color: #687080; font-style: italic;">-- &#21333;&#34892;&#21333;&#23383;&#27573;</span>
   <span style="color: #c678dd; font-weight: bold;">from</span> emp
   <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> job;
</pre>
</div>
</div>
</div>

<div id="outline-container-org0d52b07" class="outline-5">
<h5 id="org0d52b07"><span class="section-number-5">3.10.3.3</span> 作为条件存在</h5>
<div class="outline-text-5" id="text-3-10-3-3">
<p>
基本使用:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#26597;&#35810;&#25152;&#26377;&#24037;&#36164;&#25302;&#21518;&#33151;&#30340;&#20154;</span>

<span style="color: #687080; font-style: italic;">-- &#39318;&#20808;&#65292;&#25105;&#20204;&#26597;:</span>
<span style="color: #687080; font-style: italic;">--   select * from emp;</span>
<span style="color: #687080; font-style: italic;">-- &#20854;&#27425;&#65292;&#35201;&#36807;&#28388;&#65292;&#24037;&#36164;&#20302;</span>
<span style="color: #687080; font-style: italic;">--   select * from emp where sal &lt; ?;</span>
<span style="color: #687080; font-style: italic;">-- &#28982;&#21518;&#65292;&#23569;&#20110;&#22810;&#23569;&#21602;&#65311;&#24179;&#22343;&#24037;&#36164;</span>
<span style="color: #687080; font-style: italic;">--   select avg(sal) from emp;</span>
<span style="color: #687080; font-style: italic;">-- &#26368;&#21518;&#65292;&#32467;&#21512;&#36215;&#26469;:</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> sal &lt; <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #61afef; font-weight: bold;">avg</span><span style="color: #93a8c6;">(</span>sal<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp<span style="color: #8c8c8c;">)</span>;

<span style="color: #687080; font-style: italic;">-- &#22686;&#24378;&#29256;: &#23454;&#38469;&#25910;&#20837;&#25302;&#21518;&#33151;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> sal + ISNULL<span style="color: #8c8c8c;">(</span>comm,0<span style="color: #8c8c8c;">)</span> &lt; <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #61afef; font-weight: bold;">AVG</span><span style="color: #93a8c6;">(</span>sal +ISNULL<span style="color: #b0b1a3;">(</span>comm,0<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp<span style="color: #8c8c8c;">)</span>;

<span style="color: #687080; font-style: italic;">-- &#26597;&#35810;&#25152;&#26377;&#30340;&#38750; ANALYST &#20013;&#24037;&#36164;&#27604; ANALYST &#26368;&#20302;&#24037;&#36164;&#36824;&#39640;&#30340;&#20154;</span>
<span style="color: #687080; font-style: italic;">-- &#26597;&#35810;&#25152;&#26377;[&#30340;[&#38750; ANALYST &#20013;][&#24037;&#36164;&#27604; [ANALYST &#26368;&#20302;&#24037;&#36164;]&#36824;&#39640;]]&#30340;&#20154;</span>
<span style="color: #687080; font-style: italic;">-- &#27493;&#39588;&#25286;&#35299;:</span>
<span style="color: #687080; font-style: italic;">-- 1. &#26368;&#20302;&#24037;&#36164;&#26159;&#22810;&#23569;?</span>
<span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #61afef; font-weight: bold;">min</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> job = <span style="color: #98be65;">'ANALYST'</span>;
<span style="color: #687080; font-style: italic;">-- 2. &#36807;&#28388;&#31532;&#19968;&#27493;: &#38750; ANALYST</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> job &lt;&gt; <span style="color: #98be65;">'ANALYST'</span>;
<span style="color: #687080; font-style: italic;">-- 3. &#36807;&#28388;&#31532;&#20108;&#27493;: &#24037;&#36164;&#27604; ? &#39640;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> sal &gt; <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #61afef; font-weight: bold;">min</span><span style="color: #93a8c6;">(</span>sal<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> job = <span style="color: #98be65;">'ANALYST'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #687080; font-style: italic;">-- 4. &#25972;&#21512;&#25152;&#26377;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> job &lt;&gt; <span style="color: #98be65;">'ANALYST'</span>
    <span style="color: #c678dd; font-weight: bold;">and</span> sal &gt; <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #61afef; font-weight: bold;">min</span><span style="color: #93a8c6;">(</span>sal<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> job = <span style="color: #98be65;">'ANALYST'</span><span style="color: #8c8c8c;">)</span>;
</pre>
</div>

<p>
IN 语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#20351;&#29992; in &#32467;&#21512; subquery &#23558;&#26465;&#20214;&#21160;&#24577;&#21270; (&#22810;&#34892;&#21333;&#21015;)</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> student <span style="color: #c678dd; font-weight: bold;">where</span> <span style="color: #c678dd; font-weight: bold;">class</span> <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span>163, 165, 169<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> student <span style="color: #c678dd; font-weight: bold;">where</span> <span style="color: #c678dd; font-weight: bold;">class</span> <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> classname <span style="color: #c678dd; font-weight: bold;">from</span> <span style="color: #c678dd; font-weight: bold;">class</span><span style="color: #8c8c8c;">)</span>;

<span style="color: #687080; font-style: italic;">-- &#35831;&#24744;&#26597;&#25214;&#25152;&#26377; Research &#37096;&#38376;&#30340;&#20154;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp;          <span style="color: #687080; font-style: italic;">-- &#24754;&#20652;&#30340;&#26159;&#65292;emp &#34920;&#20013;&#27809;&#26377; dname &#23383;&#27573;; &#27427;&#21916;&#30340;&#26159;&#65292;&#23427;&#26377; deptno &#23383;&#27573;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> dname = <span style="color: #98be65;">'RESEARCH'</span>; <span style="color: #687080; font-style: italic;">-- &#36890;&#36807;&#36825;&#27493;&#65292;&#21487;&#20197;&#24471;&#21040; RESEARCH &#37096;&#38376;&#30340;&#32534;&#21495;&#20026; 20</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> deptno = 20;         <span style="color: #687080; font-style: italic;">-- &#32467;&#21512;&#19978;&#19968;&#27493;&#65292;&#31579;&#36873;&#20986;&#31526;&#21512;&#26465;&#20214;&#30340;&#20154;&#21363;&#21487;</span>

<span style="color: #687080; font-style: italic;">-- &#26597;&#25214;&#25152;&#26377;&#30340;&#20154;; &#20854; deptno &#23646;&#20110; dept &#34920;&#20013; dname &#20026; Research &#30340;&#37027;&#20123; dept</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> deptno <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> deptno <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> dname = <span style="color: #98be65;">'RESEARCH'</span><span style="color: #8c8c8c;">)</span>;

<span style="color: #687080; font-style: italic;">-- &#22686;&#24378;&#29256;: &#26597;&#25214;&#25152;&#26377; RESEARCH &#37096;&#38376;&#36824;&#26377;&#22312; BOSTON &#24037;&#20316;&#30340;&#20154;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> deptno <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> deptno <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> dname = <span style="color: #98be65;">'RESEARCH'</span> <span style="color: #c678dd; font-weight: bold;">or</span> loc = <span style="color: #98be65;">'BOSTON'</span><span style="color: #8c8c8c;">)</span>;

<span style="color: #687080; font-style: italic;">-- &#22686;&#24378;&#29256;: &#26597;&#25214;&#25152;&#26377; RESEARCH &#37096;&#38376;&#36824;&#26377;&#22312; BOSTON &#24037;&#20316;&#30340;&#65292;&#24182;&#19988;&#24037;&#36164;&#31561;&#32423;&#20026; 4 &#25110; 5 &#30340;&#20154;</span>
<span style="color: #687080; font-style: italic;">-- &#26029;&#21477;: &#26597;&#25214;&#25152;&#26377;[( RESEARCH &#37096;&#38376;&#36824;&#26377;&#22312; BOSTON &#24037;&#20316;&#30340;)&#65292;&#24182;&#19988;(&#24037;&#36164;&#31561;&#32423;&#20026; 4 &#25110; 5 &#30340;)]&#20154;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> deptno <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> deptno <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> dname = <span style="color: #98be65;">'RESEARCH'</span> <span style="color: #c678dd; font-weight: bold;">or</span> loc = <span style="color: #98be65;">'BOSTON'</span><span style="color: #8c8c8c;">)</span>
    <span style="color: #c678dd; font-weight: bold;">and</span> sal &gt;= 2001;
<span style="color: #687080; font-style: italic;">-- &#20351;&#29992; subquery &#21160;&#24577;&#21270;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> deptno <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> deptno <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> dname = <span style="color: #98be65;">'RESEARCH'</span> <span style="color: #c678dd; font-weight: bold;">or</span> loc = <span style="color: #98be65;">'BOSTON'</span><span style="color: #8c8c8c;">)</span>
    <span style="color: #c678dd; font-weight: bold;">and</span> sal &gt;= <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> losal <span style="color: #c678dd; font-weight: bold;">from</span> salgrade <span style="color: #c678dd; font-weight: bold;">where</span> grade = 4<span style="color: #8c8c8c;">)</span>;
<span style="color: #687080; font-style: italic;">-- &#35753;&#20107;&#24773;&#26356;&#32454;&#33268;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> deptno <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> deptno <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> dname = <span style="color: #98be65;">'RESEARCH'</span> <span style="color: #c678dd; font-weight: bold;">or</span> loc = <span style="color: #98be65;">'BOSTON'</span><span style="color: #8c8c8c;">)</span>
    <span style="color: #c678dd; font-weight: bold;">and</span> sal <span style="color: #c678dd; font-weight: bold;">between</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> losal <span style="color: #c678dd; font-weight: bold;">from</span> salgrade <span style="color: #c678dd; font-weight: bold;">where</span> grade = 4<span style="color: #8c8c8c;">)</span>
                <span style="color: #c678dd; font-weight: bold;">and</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> hisal <span style="color: #c678dd; font-weight: bold;">from</span> salgrade <span style="color: #c678dd; font-weight: bold;">where</span> grade = 5<span style="color: #8c8c8c;">)</span>;
</pre>
</div>

<p>
EXISTS 语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#19979;&#38754;&#20004;&#21477;&#21151;&#33021;&#19978;&#26159;&#31561;&#25928;&#30340;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> deptno <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> deptno <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> loc = <span style="color: #98be65;">'CHICAGO'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> <span style="color: #c678dd; font-weight: bold;">exists</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> emp.deptno = dept.deptno
                                     <span style="color: #c678dd; font-weight: bold;">and</span> dept.loc = <span style="color: #98be65;">'CHICAGO'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #687080; font-style: italic;">-- &#24615;&#33021;&#27604;&#36739; (&#33041;&#34917;)</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> student <span style="color: #c678dd; font-weight: bold;">where</span> cardid <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> id <span style="color: #c678dd; font-weight: bold;">from</span> renkou <span style="color: #c678dd; font-weight: bold;">where</span> shengfen=<span style="color: #98be65;">'&#24191;&#19996;'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> student <span style="color: #c678dd; font-weight: bold;">where</span> <span style="color: #c678dd; font-weight: bold;">exists</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> id <span style="color: #c678dd; font-weight: bold;">from</span> renkou <span style="color: #c678dd; font-weight: bold;">where</span> renkou.id = student.cardid <span style="color: #c678dd; font-weight: bold;">and</span> shenfen = <span style="color: #98be65;">'&#24191;&#19996;'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> student s <span style="color: #c678dd; font-weight: bold;">where</span> <span style="color: #c678dd; font-weight: bold;">exists</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> id <span style="color: #c678dd; font-weight: bold;">from</span> renkou r <span style="color: #c678dd; font-weight: bold;">where</span> r.id = s.cardid <span style="color: #c678dd; font-weight: bold;">and</span> r.shenfen = <span style="color: #98be65;">'&#24191;&#19996;'</span><span style="color: #8c8c8c;">)</span>;
</pre>
</div>

<p>
ALL/ANY/SOME 语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> student s
  <span style="color: #c678dd; font-weight: bold;">where</span> stuno = <span style="color: #c678dd; font-weight: bold;">any</span><span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> stuno <span style="color: #c678dd; font-weight: bold;">from</span> exam e <span style="color: #c678dd; font-weight: bold;">where</span> written &gt;= 60 <span style="color: #c678dd; font-weight: bold;">and</span> lab &gt;= 60<span style="color: #8c8c8c;">)</span>;

<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> student s
  <span style="color: #c678dd; font-weight: bold;">where</span> stuno <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> stuno <span style="color: #c678dd; font-weight: bold;">from</span> exam e <span style="color: #c678dd; font-weight: bold;">where</span> written &gt;= 60 <span style="color: #c678dd; font-weight: bold;">and</span> lab &gt;= 60<span style="color: #8c8c8c;">)</span>;

<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> student s
  <span style="color: #c678dd; font-weight: bold;">where</span> <span style="color: #c678dd; font-weight: bold;">exists</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> exam e <span style="color: #c678dd; font-weight: bold;">where</span> s.stuno = e.stuno <span style="color: #c678dd; font-weight: bold;">and</span> e.written &gt;= 60 <span style="color: #c678dd; font-weight: bold;">and</span> e.lab &gt;= 60<span style="color: #8c8c8c;">)</span>;

<span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">t1</span> <span style="color: #8c8c8c;">(</span>n <span style="color: #61afef;">int</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">t2</span> <span style="color: #8c8c8c;">(</span>n <span style="color: #61afef;">int</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> t1 <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span>2<span style="color: #8c8c8c;">)</span>, <span style="color: #8c8c8c;">(</span>3<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> t2 <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span>1<span style="color: #8c8c8c;">)</span>, <span style="color: #8c8c8c;">(</span>2<span style="color: #8c8c8c;">)</span>, <span style="color: #8c8c8c;">(</span>3<span style="color: #8c8c8c;">)</span>, <span style="color: #8c8c8c;">(</span>4<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> t2 <span style="color: #c678dd; font-weight: bold;">where</span> n &gt; <span style="color: #c678dd; font-weight: bold;">all</span><span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> t1<span style="color: #8c8c8c;">)</span>;   <span style="color: #687080; font-style: italic;">-- 4</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> t2 <span style="color: #c678dd; font-weight: bold;">where</span> n &gt; <span style="color: #c678dd; font-weight: bold;">some</span><span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> t1<span style="color: #8c8c8c;">)</span>;  <span style="color: #687080; font-style: italic;">-- 3, 4</span>
</pre>
</div>

<p>
小结:
</p>
<ul class="org-ul">
<li>很多人不愿意用 exists，而是喜欢用 in，因为 in 更容易理解并且语句更简短</li>
<li><p>
实际上，更推荐使用 exists，因为在很多场合 exists 更有效率
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#39640;&#39069;&#30340;&#31354;&#38388;&#21344;&#29992;</span>
<span style="color: #687080; font-style: italic;">-- &#24040;&#22823;&#30340;&#23545;&#27604;&#27425;&#25968;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> student <span style="color: #c678dd; font-weight: bold;">where</span> cardid <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> id <span style="color: #c678dd; font-weight: bold;">from</span> renkoubiao <span style="color: #c678dd; font-weight: bold;">where</span> shengfen=<span style="color: #98be65;">'&#24191;&#19996;'</span><span style="color: #8c8c8c;">)</span>;
</pre>
</div></li>
<li>ANY/SOME/ALL 是 exists 的语法糖，在某些场景之下，更加直观</li>
</ul>
</div>
</div>

<div id="outline-container-org608f6a7" class="outline-5">
<h5 id="org608f6a7"><span class="section-number-5">3.10.3.4</span> 阶段性作业 (subquery)</h5>
<div class="outline-text-5" id="text-3-10-3-4">
<p>
查询出芝加哥工作的工资最高的人的上司的工资，超出平均工资的数目:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#26597;&#35810;&#33437;&#21152;&#21733;&#24037;&#20316;&#30340;&#25152;&#26377;&#20154;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> deptno = <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> deptno <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> loc = <span style="color: #98be65;">'CHICAGO'</span><span style="color: #8c8c8c;">)</span>;

<span style="color: #687080; font-style: italic;">-- &#26597;&#35810;&#33437;&#21152;&#21733;&#24037;&#36164;&#26368;&#39640;&#30340;&#37027;&#20010;&#20154;</span>
<span style="color: #687080; font-style: italic;">-- &#20998;&#35299;&#39064;&#30446;:</span>
<span style="color: #687080; font-style: italic;">-- 1. &#23450;&#20301;&#21040;&#33437;&#21152;&#21733;&#22478;&#24066;&#30340;&#37096;&#38376;&#32534;&#21495; (select deptno from dept where loc = 'CHICAGO');</span>
<span style="color: #687080; font-style: italic;">-- 2. &#26597;&#25214;&#25152;&#26377;&#22312;&#33437;&#21152;&#21733;&#24037;&#20316;&#30340;&#20154; (&#26681;&#25454;&#19978;&#36848;&#30340;&#37096;&#38376;&#32534;&#21495;) (select * from emp where deptno = ?);</span>
<span style="color: #687080; font-style: italic;">-- 3. &#35745;&#31639;&#25152;&#26377;&#33437;&#21152;&#21733;&#24037;&#20316;&#30340;&#20154;&#30340;&#26368;&#39640;&#24037;&#36164; (select max(sal) from emp where deptno = ?);</span>
<span style="color: #687080; font-style: italic;">-- 4. &#33719;&#21462;&#24037;&#36164;&#26368;&#39640;&#30340;&#20154;&#30340;&#20449;&#24687; (select * from emp where deptno = ? and sal = ?);</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> deptno = <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> deptno <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> loc = <span style="color: #98be65;">'CHICAGO'</span><span style="color: #8c8c8c;">)</span>
    <span style="color: #c678dd; font-weight: bold;">and</span> sal = <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #61afef; font-weight: bold;">max</span><span style="color: #93a8c6;">(</span>sal<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> deptno = <span style="color: #93a8c6;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> deptno <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> loc = <span style="color: #98be65;">'CHICAGO'</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #687080; font-style: italic;">-- &#20511;&#21161;&#25490;&#24207;&#21644; top &#36827;&#34892;&#23454;&#29616;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> top 1 * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> deptno = <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> deptno <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> loc = <span style="color: #98be65;">'CHICAGO'</span><span style="color: #8c8c8c;">)</span>
  <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> sal <span style="color: #c678dd; font-weight: bold;">desc</span>;

<span style="color: #687080; font-style: italic;">-- &#26597;&#35810;&#33437;&#21152;&#21733;&#24037;&#36164;&#26368;&#39640;&#30340;&#37027;&#20010;&#20154;&#30340;&#19978;&#21496;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> empno = <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> top 1 mgr <span style="color: #c678dd; font-weight: bold;">from</span> emp
                   <span style="color: #c678dd; font-weight: bold;">where</span> deptno = <span style="color: #93a8c6;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> deptno <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> loc = <span style="color: #98be65;">'CHICAGO'</span><span style="color: #93a8c6;">)</span>
                   <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> sal <span style="color: #c678dd; font-weight: bold;">desc</span><span style="color: #8c8c8c;">)</span>;

<span style="color: #687080; font-style: italic;">-- &#26597;&#35810;&#33437;&#21152;&#21733;&#24037;&#36164;&#26368;&#39640;&#30340;&#37027;&#20010;&#20154;&#30340;&#19978;&#21496;&#24037;&#36164;&#36319;&#24179;&#22343;&#24037;&#36164;&#30340;&#24046;&#36317;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> *, sal - <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #61afef; font-weight: bold;">AVG</span><span style="color: #93a8c6;">(</span>sal<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> chaju <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> empno = <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> top 1 mgr <span style="color: #c678dd; font-weight: bold;">from</span> emp
                   <span style="color: #c678dd; font-weight: bold;">where</span> deptno = <span style="color: #93a8c6;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> deptno <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> loc = <span style="color: #98be65;">'CHICAGO'</span><span style="color: #93a8c6;">)</span>
                   <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> sal <span style="color: #c678dd; font-weight: bold;">desc</span><span style="color: #8c8c8c;">)</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org01b2625" class="outline-4">
<h4 id="org01b2625"><span class="section-number-4">3.10.4</span> 连接查询 (join)</h4>
<div class="outline-text-4" id="text-3-10-4">
<ul class="org-ul">
<li>emp
<ul class="org-ul">
<li>ename</li>
<li>sal</li>
<li>deptno</li>
</ul></li>
<li>dept
<ul class="org-ul">
<li>deptno</li>
<li>dname</li>
<li>loc</li>
</ul></li>
</ul>

<p>
这其实是三种解决问题的思路:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">---- &#26597;&#35810;&#20986;&#25152;&#26377;&#22312;&#33437;&#21152;&#21733;&#24037;&#20316;&#30340;&#21592;&#24037;</span>

<span style="color: #687080; font-style: italic;">-- 1. &#25105;&#30340;&#32534;&#21495;&#65292;&#22312;&#20320;&#30340;&#32534;&#21495;&#20043;&#20869;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> deptno <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> deptno <span style="color: #c678dd; font-weight: bold;">from</span> dept <span style="color: #c678dd; font-weight: bold;">where</span> loc=<span style="color: #98be65;">'xxx'</span><span style="color: #8c8c8c;">)</span>;

<span style="color: #687080; font-style: italic;">-- 2. &#25105;&#30340;&#25968;&#25454;&#65292;&#35201;&#36880;&#26465;&#36319;&#20320;&#30340;&#27604;&#23545;&#65292;&#36880;&#27493;&#36807;&#28388;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp e
  <span style="color: #c678dd; font-weight: bold;">where</span> <span style="color: #c678dd; font-weight: bold;">exists</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> dept d <span style="color: #c678dd; font-weight: bold;">where</span> d.deptno = e.deptno <span style="color: #c678dd; font-weight: bold;">and</span> d.loc = <span style="color: #98be65;">'xxx'</span><span style="color: #8c8c8c;">)</span>;

<span style="color: #687080; font-style: italic;">-- 3. &#20808;&#25289;&#20320;&#21019;&#24314;&#20020;&#26102;&#34920;&#65292;&#20877;&#32771;&#34385;&#26465;&#20214;&#30340;&#20107;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
   <span style="color: #c678dd; font-weight: bold;">join</span> dept <span style="color: #c678dd; font-weight: bold;">on</span> emp.deptno = dept.deptno
   <span style="color: #c678dd; font-weight: bold;">where</span> loc = <span style="color: #98be65;">'CHICAGO'</span> <span style="color: #c678dd; font-weight: bold;">or</span> dname = <span style="color: #98be65;">'RESEARCH'</span>;
</pre>
</div>

<p>
查找所有 Research 部门的人:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#26681;&#25454;&#25152;&#26377;&#26465;&#20214;&#21019;&#24314;&#19968;&#20010;&#20020;&#26102;&#34920;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> a.*,b.dname,b.loc <span style="color: #c678dd; font-weight: bold;">from</span> emp a
   <span style="color: #c678dd; font-weight: bold;">join</span> dept b <span style="color: #c678dd; font-weight: bold;">on</span> a.deptno = b.deptno <span style="color: #c678dd; font-weight: bold;">and</span> b.dname=<span style="color: #98be65;">'Research'</span>;

<span style="color: #687080; font-style: italic;">-- &#20808;&#21019;&#31435;&#19968;&#24352;&#20020;&#26102;&#34920;&#28982;&#21518;&#26681;&#25454;&#26465;&#20214;&#36827;&#34892;&#31579;&#36873;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> a.*,b.dname,b.loc <span style="color: #c678dd; font-weight: bold;">from</span> emp a
   <span style="color: #c678dd; font-weight: bold;">join</span> dept b <span style="color: #c678dd; font-weight: bold;">on</span> a.deptno = b.deptno
   <span style="color: #c678dd; font-weight: bold;">where</span> b.dname=<span style="color: #98be65;">'Research'</span>;

<span style="color: #687080; font-style: italic;">-- &#38750;&#35268;&#33539;&#26041;&#24335;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp e, dept d
   <span style="color: #c678dd; font-weight: bold;">where</span> e.deptno = d.deptno <span style="color: #c678dd; font-weight: bold;">and</span> d.dname = <span style="color: #98be65;">'Research'</span>;
</pre>
</div>

<p>
左、右、全连接 (Left/Right/Full Join):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#31034;&#20363;&#25968;&#25454;</span>
<span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">t_student</span>
<span style="color: #8c8c8c;">(</span>
  id <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">identity</span> <span style="color: #c678dd; font-weight: bold;">primary</span> <span style="color: #c678dd; font-weight: bold;">key</span>,
  <span style="color: #c678dd; font-weight: bold;">name</span> <span style="color: #61afef;">varchar</span><span style="color: #93a8c6;">(</span>200<span style="color: #93a8c6;">)</span>,
  classname <span style="color: #61afef;">varchar</span><span style="color: #93a8c6;">(</span>200<span style="color: #93a8c6;">)</span>
<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">t_class</span>
<span style="color: #8c8c8c;">(</span>
  classname <span style="color: #61afef;">varchar</span><span style="color: #93a8c6;">(</span>200<span style="color: #93a8c6;">)</span>,
  loc <span style="color: #61afef;">varchar</span><span style="color: #93a8c6;">(</span>200<span style="color: #93a8c6;">)</span>
<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> t_class
       <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'163'</span>, <span style="color: #98be65;">'201'</span><span style="color: #8c8c8c;">)</span>,
              <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'164'</span>, <span style="color: #98be65;">'202'</span><span style="color: #8c8c8c;">)</span>,
              <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'165'</span>, <span style="color: #98be65;">'404'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> t_student <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">name</span>, classname<span style="color: #8c8c8c;">)</span>
       <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'zhangsan'</span>, <span style="color: #98be65;">'164'</span><span style="color: #8c8c8c;">)</span>,
              <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'lisi'</span>, <span style="color: #98be65;">'165'</span><span style="color: #8c8c8c;">)</span>,
              <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'wangwu'</span>, <span style="color: #98be65;">'165'</span><span style="color: #8c8c8c;">)</span>,
              <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'zhaoliu'</span>, <span style="color: #98be65;">'165'</span><span style="color: #8c8c8c;">)</span>,
              <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'sunqi'</span>, <span style="color: #98be65;">''</span><span style="color: #8c8c8c;">)</span>;

<span style="color: #687080; font-style: italic;">-- &#26597;&#25214;&#25152;&#26377;&#23398;&#29983;&#65292;&#20197;&#21450;&#20182;&#30340;&#29677;&#32423;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> t_student s
  <span style="color: #c678dd; font-weight: bold;">join</span> t_class c <span style="color: #c678dd; font-weight: bold;">on</span> s.classname = c.classname;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> t_student s
  <span style="color: #8c8c8c;">[</span><span style="color: #c678dd; font-weight: bold;">inner</span><span style="color: #8c8c8c;">]</span> <span style="color: #c678dd; font-weight: bold;">join</span> t_class c <span style="color: #c678dd; font-weight: bold;">on</span> s.classname = c.classname;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> t_student s
  <span style="color: #8c8c8c;">[</span><span style="color: #c678dd; font-weight: bold;">left</span><span style="color: #8c8c8c;">]</span> <span style="color: #c678dd; font-weight: bold;">join</span> t_class c <span style="color: #c678dd; font-weight: bold;">on</span> s.classname = c.classname;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> t_student s
  <span style="color: #8c8c8c;">[</span><span style="color: #c678dd; font-weight: bold;">right</span><span style="color: #8c8c8c;">]</span> <span style="color: #c678dd; font-weight: bold;">join</span> t_class c <span style="color: #c678dd; font-weight: bold;">on</span> s.classname = c.classname;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> t_student s
  <span style="color: #8c8c8c;">[</span><span style="color: #c678dd; font-weight: bold;">full</span><span style="color: #8c8c8c;">]</span> <span style="color: #c678dd; font-weight: bold;">join</span> t_class c <span style="color: #c678dd; font-weight: bold;">on</span> s.classname = c.classname;
</pre>
</div>

<p>
笛卡儿积 (叉乘):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#24418;&#25104;&#30340;&#25968;&#25454;&#26159;&#27809;&#26377;&#24847;&#24605;&#30340;&#65292;&#22240;&#20026;&#24456;&#22810;&#25968;&#25454;&#26159;&#19981;&#23545;&#30340;</span>
<span style="color: #687080; font-style: italic;">-- &#20294;&#26159;&#65292;&#23427;&#21364;&#26159;&#20854;&#23427;&#26377;&#24847;&#20041;&#30340;&#36830;&#25509;&#30340;&#20869;&#22312;&#22522;&#30784;  </span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp, dept;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #8c8c8c;">[</span><span style="color: #c678dd; font-weight: bold;">cross</span><span style="color: #8c8c8c;">]</span> <span style="color: #c678dd; font-weight: bold;">join</span> dept;
</pre>
</div>
</div>
</div>

<div id="outline-container-org218a752" class="outline-4">
<h4 id="org218a752"><span class="section-number-4">3.10.5</span> 合并 (union)</h4>
<div class="outline-text-4" id="text-3-10-5">
<p>
Union 可以连接一切，有意义的，还有无意义的。
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#27627;&#26080;&#24847;&#20041;&#65288;&#65311;&#65289;&#30340; Union</span>
<span style="color: #c678dd; font-weight: bold;">select</span> empno <span style="color: #c678dd; font-weight: bold;">from</span> emp
<span style="color: #c678dd; font-weight: bold;">union</span>
<span style="color: #c678dd; font-weight: bold;">select</span> deptno, dname <span style="color: #c678dd; font-weight: bold;">from</span> dept;

<span style="color: #687080; font-style: italic;">-- &#31245;&#24494;&#26377;&#28857;&#24847;&#20041;&#30340; Union</span>
<span style="color: #687080; font-style: italic;">-- &#23558;&#25152;&#26377;&#23398;&#29983;&#21644;&#21592;&#24037;&#37117;&#21015;&#20986;&#26469;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> <span style="color: #c678dd; font-weight: bold;">name</span> <span style="color: #c678dd; font-weight: bold;">from</span> t_student
<span style="color: #c678dd; font-weight: bold;">union</span>
<span style="color: #c678dd; font-weight: bold;">select</span> ename <span style="color: #c678dd; font-weight: bold;">from</span> emp;

<span style="color: #687080; font-style: italic;">-- &#20063;&#21487;&#20197;&#36830;&#25509;&#33258;&#36523;&#34920;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> sal &gt; 2000 <span style="color: #c678dd; font-weight: bold;">or</span> sal &lt; 1000;
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> sal &gt; 2000
<span style="color: #c678dd; font-weight: bold;">union</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> sal &lt; 1000;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e82e17" class="outline-4">
<h4 id="org6e82e17"><span class="section-number-4">3.10.6</span> 分组、窗口查询 (group by/over)</h4>
<div class="outline-text-4" id="text-3-10-6">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#21487;&#20197;&#20351;&#29992; union &#25163;&#21160;&#20998;&#32452;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> 10, <span style="color: #61afef; font-weight: bold;">avg</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> deptno = 10
<span style="color: #c678dd; font-weight: bold;">union</span>
<span style="color: #c678dd; font-weight: bold;">select</span> 20, <span style="color: #61afef; font-weight: bold;">avg</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> deptno = 20
<span style="color: #c678dd; font-weight: bold;">union</span>
<span style="color: #c678dd; font-weight: bold;">select</span> 30, <span style="color: #61afef; font-weight: bold;">avg</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">where</span> deptno = 30;

<span style="color: #687080; font-style: italic;">-- &#20351;&#29992;&#20998;&#32452;&#26469;&#31616;&#21270;&#35821;&#21477;&#12290;&#25968;&#25454;&#24211;&#20869;&#37096;&#30340;&#23454;&#29616;&#36923;&#36753;&#36319;&#19978;&#36848; union &#29256;&#26412;&#31867;&#20284;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> deptno, <span style="color: #61afef; font-weight: bold;">AVG</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span>, <span style="color: #61afef; font-weight: bold;">MAX</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span>, <span style="color: #61afef; font-weight: bold;">MIN</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">group</span> <span style="color: #c678dd; font-weight: bold;">by</span> deptno;

<span style="color: #687080; font-style: italic;">-- &#22914;&#26524;&#24819;&#22522;&#20110;&#20998;&#23436;&#30340;&#32452;&#36827;&#34892;&#36807;&#28388;&#65292;&#19979;&#38754;&#20889;&#27861;&#26159; **&#38169;&#30340;**</span>
<span style="color: #c678dd; font-weight: bold;">select</span> deptno, <span style="color: #61afef; font-weight: bold;">AVG</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> a, <span style="color: #61afef; font-weight: bold;">MAX</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> d, <span style="color: #61afef; font-weight: bold;">MIN</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> x <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">group</span> <span style="color: #c678dd; font-weight: bold;">by</span> deptno
  <span style="color: #c678dd; font-weight: bold;">where</span> <span style="color: #61afef; font-weight: bold;">AVG</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> &gt; 1000;

<span style="color: #687080; font-style: italic;">-- &#21487;&#20197;&#20351;&#29992;&#23376;&#26597;&#35810;&#30340;&#24418;&#24335;&#65292;&#35299;&#20915;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span>
<span style="color: #8c8c8c;">(</span> <span style="color: #c678dd; font-weight: bold;">select</span> deptno, <span style="color: #61afef; font-weight: bold;">AVG</span><span style="color: #93a8c6;">(</span>sal<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> a, <span style="color: #61afef; font-weight: bold;">MAX</span><span style="color: #93a8c6;">(</span>sal<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> d, <span style="color: #61afef; font-weight: bold;">MIN</span><span style="color: #93a8c6;">(</span>sal<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> x <span style="color: #c678dd; font-weight: bold;">from</span> emp
        <span style="color: #c678dd; font-weight: bold;">where</span> mgr <span style="color: #c678dd; font-weight: bold;">is</span> <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">null</span>
        <span style="color: #c678dd; font-weight: bold;">group</span> <span style="color: #c678dd; font-weight: bold;">by</span> deptno
<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> v <span style="color: #c678dd; font-weight: bold;">where</span> a &gt; 2000;

<span style="color: #687080; font-style: italic;">-- &#19978;&#36848;&#20889;&#27861;&#34429;&#28982;&#26377;&#25928;&#65292;&#21487;&#26159;&#24182;&#19981;&#22815;&#31616;&#27905;&#65292;&#20110;&#26159;&#26377;&#20102; having &#20851;&#38190;&#35789;</span>
<span style="color: #687080; font-style: italic;">-- having &#26159;&#36319; group by &#25645;&#37197;&#30340; `where`</span>
<span style="color: #687080; font-style: italic;">-- &#20110;&#26159; where -&gt; group by -&gt; having</span>
<span style="color: #687080; font-style: italic;">-- &#20808;&#36807;&#28388;&#65292;&#20877;&#20998;&#32452;&#65292;&#20877;&#22312;&#20998;&#32452;&#32467;&#26524;&#30340;&#22522;&#30784;&#19978;&#36807;&#28388;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> deptno, <span style="color: #61afef; font-weight: bold;">AVG</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> a, <span style="color: #61afef; font-weight: bold;">MAX</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> d, <span style="color: #61afef; font-weight: bold;">MIN</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> x <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> mgr <span style="color: #c678dd; font-weight: bold;">is</span> <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">null</span>
  <span style="color: #c678dd; font-weight: bold;">group</span> <span style="color: #c678dd; font-weight: bold;">by</span> deptno
  <span style="color: #c678dd; font-weight: bold;">having</span> <span style="color: #61afef; font-weight: bold;">AVG</span><span style="color: #8c8c8c;">(</span>sal<span style="color: #8c8c8c;">)</span> &gt; 2000;
</pre>
</div>

<p>
查询所有部门最高工资的人:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span>
  <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> row_number<span style="color: #93a8c6;">()</span> over <span style="color: #93a8c6;">(</span>partition <span style="color: #c678dd; font-weight: bold;">by</span> deptno <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> sal <span style="color: #c678dd; font-weight: bold;">desc</span><span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> rn, * <span style="color: #c678dd; font-weight: bold;">from</span> emp<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> s
  <span style="color: #c678dd; font-weight: bold;">where</span> rn = 1;

<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span>
  <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> rank<span style="color: #93a8c6;">()</span> over <span style="color: #93a8c6;">(</span>partition <span style="color: #c678dd; font-weight: bold;">by</span> deptno <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> sal <span style="color: #c678dd; font-weight: bold;">desc</span><span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> rn, * <span style="color: #c678dd; font-weight: bold;">from</span> emp<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> s
  <span style="color: #c678dd; font-weight: bold;">where</span> rn = 1;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2b8533" class="outline-4">
<h4 id="orge2b8533"><span class="section-number-4">3.10.7</span> 分页查询 (top/row_number/fetch-offset)</h4>
<div class="outline-text-4" id="text-3-10-7">
<p>
只拿出分数据。
</p>

<p>
最经典的分页语句 (top):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">select</span> top 2 * <span style="color: #c678dd; font-weight: bold;">from</span> emp;

<span style="color: #687080; font-style: italic;">-- 2 - 4</span>
<span style="color: #687080; font-style: italic;">-- 1. &#21069; 4 &#34892;</span>
<span style="color: #687080; font-style: italic;">-- 2. &#21453;&#21521;</span>
<span style="color: #687080; font-style: italic;">-- 3. &#21069;&#20004;&#26465;</span>
<span style="color: #687080; font-style: italic;">-- 4. &#21453;&#21521;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> top 3 * <span style="color: #c678dd; font-weight: bold;">from</span> <span style="color: #93a8c6;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> top 4 * <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> empno<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> t <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> empno <span style="color: #c678dd; font-weight: bold;">desc</span><span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> x <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> empno <span style="color: #c678dd; font-weight: bold;">desc</span>;

<span style="color: #687080; font-style: italic;">-- &#21478;&#19968;&#31181;&#24605;&#36335;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> top 3 * <span style="color: #c678dd; font-weight: bold;">from</span> emp
  <span style="color: #c678dd; font-weight: bold;">where</span> empno <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">in</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> top 1 empno <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> empno<span style="color: #8c8c8c;">)</span>;

<span style="color: #687080; font-style: italic;">-- &#20854;&#20182;&#25968;&#25454;&#24211;&#23545;&#27604;</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">limit</span> 3 offset 4; <span style="color: #687080; font-style: italic;">-- mysql/sqlite/postgresql</span>
<span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> *, rownum <span style="color: #c678dd; font-weight: bold;">as</span> rn <span style="color: #c678dd; font-weight: bold;">from</span> emp<span style="color: #8c8c8c;">)</span> rn <span style="color: #c678dd; font-weight: bold;">between</span> 3 <span style="color: #c678dd; font-weight: bold;">and</span> 5; <span style="color: #687080; font-style: italic;">-- oracle</span>
</pre>
</div>

<p>
借助窗口函数进行选取 (<b>row_number</b>):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span>
   <span style="color: #8c8c8c;">(</span><span style="color: #c678dd; font-weight: bold;">select</span> row_number<span style="color: #93a8c6;">()</span> over <span style="color: #93a8c6;">(</span><span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> empno<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> rn, * <span style="color: #c678dd; font-weight: bold;">from</span> emp<span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">as</span> s
   <span style="color: #c678dd; font-weight: bold;">where</span> rn <span style="color: #c678dd; font-weight: bold;">between</span> 2 <span style="color: #c678dd; font-weight: bold;">and</span> 5;
</pre>
</div>

<p>
SQLServer 2012 以后，开始支持标准的 fetch-offset 写法:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">select</span> * <span style="color: #c678dd; font-weight: bold;">from</span> emp <span style="color: #c678dd; font-weight: bold;">fetch</span> <span style="color: #c678dd; font-weight: bold;">next</span> 5 <span style="color: #c678dd; font-weight: bold;">rows</span> offset 4 <span style="color: #c678dd; font-weight: bold;">rows</span> <span style="color: #c678dd; font-weight: bold;">only</span> <span style="color: #c678dd; font-weight: bold;">order</span> <span style="color: #c678dd; font-weight: bold;">by</span> empno;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1e8cf5e" class="outline-3">
<h3 id="org1e8cf5e"><span class="section-number-3">3.11</span> Transaction 事务</h3>
<div class="outline-text-3" id="text-3-11">
</div>
<div id="outline-container-orge1f76bd" class="outline-4">
<h4 id="orge1f76bd"><span class="section-number-4">3.11.1</span> 什么是事务 (ACID)</h4>
<div class="outline-text-4" id="text-3-11-1">
<blockquote>
<p>
要么都成，否则都不成。
</p>
</blockquote>

<p>
事务有哪些属性 (ACID, 酸) <b>[这是一个非常常见的面试题]</b>:
</p>
<ol class="org-ol">
<li>Atomicity (原子性)</li>
<li>Consistency (一致性) 结果上</li>
<li>Isolation (隔离性) 并发访问</li>
<li>Durability (持久性)</li>
</ol>
</div>
</div>

<div id="outline-container-orgfcae39c" class="outline-4">
<h4 id="orgfcae39c"><span class="section-number-4">3.11.2</span> 事务的状态</h4>
<div class="outline-text-4" id="text-3-11-2">
<ul class="org-ul">
<li>活动状态 (active)</li>
<li>部分提交状态 (partially committed)</li>
<li>失败/中止/提交 (failed/abort/commit)</li>
</ul>
</div>
</div>

<div id="outline-container-orge19d094" class="outline-4">
<h4 id="orge19d094"><span class="section-number-4">3.11.3</span> SQLServer 中的事务</h4>
<div class="outline-text-4" id="text-3-11-3">
<p>
首先，默认情况下，SQLServer 中每条语句都会被自动提交。
也就是，任何语句都是一个单独事务，不需要加 commit:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> x <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'xxx'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #687080; font-style: italic;">-- &#36825;&#37324;&#19981;&#38656;&#35201;&#21152; commit &#23601;&#33021;&#25554;&#20837;&#25104;&#21151;</span>
</pre>
</div>

<p>
但是，上述行为存在非常严重的安全隐患，建议关掉。
然后，需要手动使用 commit/rollback 进行事务的终结:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #687080; font-style: italic;">-- &#20851;&#38381;&#33258;&#21160;&#25552;&#20132;</span>
<span style="color: #c678dd; font-weight: bold;">set</span> implicit_transactions <span style="color: #c678dd; font-weight: bold;">off</span>;

<span style="color: #687080; font-style: italic;">-- &#22240;&#27492;&#65292;&#25152;&#26377;&#30340;&#35821;&#21477;&#37117;&#20250;&#22312;&#21516;&#19968;&#20010;&#20107;&#21153;&#20013;</span>
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> x <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'aaa'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> x <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'zzz'</span><span style="color: #8c8c8c;">)</span>;

<span style="color: #687080; font-style: italic;">-- &#38500;&#38750;&#20320;&#35843;&#29992;&#20102; commit/rollback &#21542;&#21017;&#19978;&#36848;&#30340;&#35821;&#21477;&#37117;&#19981;&#20250;&#30495;&#27491;&#20837;&#24211;</span>
<span style="color: #c678dd; font-weight: bold;">commit</span>/<span style="color: #c678dd; font-weight: bold;">rollback</span>;
</pre>
</div>

<p>
另外，如果你想更精细控制事务的范围，可以使用显式的 begin 语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">begin</span> <span style="color: #c678dd; font-weight: bold;">transaction</span>
  <span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> x <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'222'</span><span style="color: #8c8c8c;">)</span>;
  <span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> x <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'212'</span>, 2<span style="color: #8c8c8c;">)</span>;
  <span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> x <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span><span style="color: #98be65;">'232'</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">commit</span> <span style="color: #c678dd; font-weight: bold;">transaction</span>;
</pre>
</div>
</div>
</div>
</div>
</section>

<section id="outline-container-orgd10ac06" class="outline-2">
<h2 id="orgd10ac06"><span class="section-number-2">4</span> MySQL 中的 SQL 语句</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgf78308e" class="outline-3">
<h3 id="orgf78308e"><span class="section-number-3">4.1</span> create</h3>
</div>

<div id="outline-container-orgc4d55d6" class="outline-3">
<h3 id="orgc4d55d6"><span class="section-number-3">4.2</span> 分页</h3>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 孙悟空</p>
<p class="date">Created: 2021-01-22</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
