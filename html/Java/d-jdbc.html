<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2020-10-28 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>JDBC 连接数据库</title>
<meta name="generator" content="Org mode">
<meta name="author" content="孙悟空">
<link rel='stylesheet' href='/html/asset/common.css?3344' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/html/asset/common.js'></script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">JDBC 连接数据库</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org2f06ac5">1. DriverManager 驱动管理类</a></li>
<li><a href="#orga56f0c3">2. Connection 代表的是一个数据库连接</a></li>
<li><a href="#orgf284444">3. Statement 用来提交某个 SQL 语句</a>
<ul>
<li><a href="#org9a3fe6c">3.1. statement.execute/executeUpdate/executeQuery()</a></li>
<li><a href="#org6a7af82">3.2. PreparedStatement 是可以绑定入参的 Statement</a></li>
</ul>
</li>
<li><a href="#orgbef6549">4. ResultSet 用来表示结果集</a></li>
<li><a href="#org1445bc3">5. 小结</a></li>
<li><a href="#org6d60480">6. [案例] JDBC 连接 SQLServer</a>
<ul>
<li><a href="#orgcd44a90">6.1. 创建名字为 xxx 的数据库，创建表 book</a></li>
<li><a href="#orge06b29f">6.2. 下载客户端，即 mssql-jdbc.jar</a></li>
<li><a href="#org7e5409a">6.3. 配置 jdbc.jar 到项目中，让项目能够使用它</a>
<ul>
<li>
<ul>
<li><a href="#org9ddcff1">6.3.0.1. 第一种，直接放到 WebContent/WEB-INF/lib 文件夹下面</a></li>
<li><a href="#orgb53b16a">6.3.0.2. 第二种，配置项目，让项目能够引用到这个 jar 包</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org4aa9275">6.4. 万事俱备，开始使用</a></li>
<li><a href="#org3ec31f1">6.5. 增加异常的处理，让代码更健壮</a></li>
<li><a href="#orga7c73d7">6.6. 基于上述的代码，对相关的处理逻辑进行封装 (复用)</a></li>
<li><a href="#org36e5e4b">6.7. 使用 Try-With-Resource 进行资源的释放</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<p>
JDBC (Java DataBase Connectivity).
</p>


<section id="outline-container-org2f06ac5" class="outline-2">
<h2 id="org2f06ac5"><span class="section-number-2">1</span> DriverManager 驱动管理类</h2>
<div class="outline-text-2" id="text-1">
<p>
通过它可以对连接进行管理。最常用的就是:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">Class.forName &#29616;&#22312;&#21487;&#20197;&#30465;&#30053;</span>
<span style="color: #228b22;">Conenction</span> <span style="color: #a0522d;">conn</span> = DriverManger.getConnection<span style="color: #707183;">(</span>url<span style="color: #707183;">)</span>;
</pre>
</div>

<p>
可以将获取连接进行简单封装:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">DBHelper</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">Connection</span> <span style="color: #0000ff;">getConnection</span><span style="color: #7388d6;">()</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">user</span> = <span style="color: #8b2252;">"sa"</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span> = <span style="color: #8b2252;">"sa"</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">dataBase</span> = <span style="color: #8b2252;">"xxx"</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">host</span> = <span style="color: #8b2252;">"localhost:1434"</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">url</span> = <span style="color: #8b2252;">"jdbc:sqlserver://"</span> + host + <span style="color: #8b2252;">";databaseName="</span> + dataBase + <span style="color: #8b2252;">";user="</span> + user + <span style="color: #8b2252;">";password="</span> + password;

        Class.forName<span style="color: #909183;">(</span><span style="color: #8b2252;">"com.microsoft.sqlserver.jdbc.SQLServerDriver"</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> DriverManager.getConnection<span style="color: #909183;">(</span>url<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</section>

<section id="outline-container-orga56f0c3" class="outline-2">
<h2 id="orga56f0c3"><span class="section-number-2">2</span> Connection 代表的是一个数据库连接</h2>
<div class="outline-text-2" id="text-2">
<p>
后续所有的操作，都必须要基于 Connection 对象。
</p>

<p>
如果使用完毕，请 <b>务必要记得</b> 关闭。
</p>

<blockquote>
<p>
有始有终，方为睿智之士。
</p>
</blockquote>
</div>
</section>

<section id="outline-container-orgf284444" class="outline-2">
<h2 id="orgf284444"><span class="section-number-2">3</span> Statement 用来提交某个 SQL 语句</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org9a3fe6c" class="outline-3">
<h3 id="org9a3fe6c"><span class="section-number-3">3.1</span> statement.execute/executeUpdate/executeQuery()</h3>
<div class="outline-text-3" id="text-3-1">
<p>
execute = executeQuery + executeUpdate
</p>
<ul class="org-ul">
<li>executeQuery 更适合于 select 语句，返回的是 ResultSet 对象，代表结果集</li>
<li>executeUpdate 适合于更新数据，返回的是整形，表示受语句影响的行数</li>
</ul>
</div>
</div>

<div id="outline-container-org6a7af82" class="outline-3">
<h3 id="org6a7af82"><span class="section-number-3">3.2</span> PreparedStatement 是可以绑定入参的 Statement</h3>
<div class="outline-text-3" id="text-3-2">
<p>
PreparedStatement 解决掉的问题:
</p>
<ol class="org-ol">
<li>避免了枯燥拼接 SQL 字符串</li>
<li>可以有效规避 SQL 注入带来的风险!</li>
</ol>

<p>
因此，以后操作数据库，请大家务必使用 PreparedStatement !!!
</p>

<div class="div" id="orgae6285b">
<p>

</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"insert into book (bookname, price) values ('"</span>
                 + name + <span style="color: #8b2252;">"', "</span> + price + <span style="color: #8b2252;">")"</span>;

<span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">conn</span> = DBHelper.getConnection<span style="color: #707183;">()</span>;
<span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">st</span> = conn.createStatement<span style="color: #707183;">()</span>;

st.executeUpdate<span style="color: #707183;">(</span>sql<span style="color: #707183;">)</span>;

st.close<span style="color: #707183;">()</span>;
conn.close<span style="color: #707183;">()</span>;
</pre>
</div>
<p>
:break:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"insert into book (bookname, price) values (?, ?)"</span>;

<span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">conn</span> = DBHelper.getConnection<span style="color: #707183;">()</span>;
<span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">ps</span> = conn.prepareStatement<span style="color: #707183;">(</span>sql<span style="color: #707183;">)</span>;

ps.setString<span style="color: #707183;">(</span>1, <span style="color: #8b2252;">"js tutor"</span><span style="color: #707183;">)</span>;
ps.setFloat<span style="color: #707183;">(</span>2, 22F<span style="color: #707183;">)</span>;
ps.executeUpdate<span style="color: #707183;">()</span>;

ps.close<span style="color: #707183;">()</span>;
conn.close<span style="color: #707183;">()</span>;
</pre>
</div>

</div>
</div>
</div>
</section>

<section id="outline-container-orgbef6549" class="outline-2">
<h2 id="orgbef6549"><span class="section-number-2">4</span> ResultSet 用来表示结果集</h2>
<div class="outline-text-2" id="text-4">
<p>
通用的迭代方法为:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">while</span> <span style="color: #707183;">(</span>rs.next<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">Xxx</span> <span style="color: #a0522d;">i</span> = rs.getXxx<span style="color: #7388d6;">(</span>1<span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">Xxx</span> <span style="color: #a0522d;">j</span> = rs.getXxx<span style="color: #7388d6;">(</span>2<span style="color: #7388d6;">)</span>;
    System.out.println<span style="color: #7388d6;">(</span>i + j<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
小结:
</p>
<ul class="org-ul">
<li>rs.next() 表示将当前的游标 (Cursor)，移到下一行。如果没有下一行，则返回 false</li>
<li>如果使用 rs.getInt/Object 之类的，会在当前行的基础上取数据</li>
<li>rs 使用完毕，最好要将其结束掉</li>
</ul>
</div>
</section>

<section id="outline-container-org1445bc3" class="outline-2">
<h2 id="org1445bc3"><span class="section-number-2">5</span> 小结</h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li>Connection/Statement/ResultSet 都属于资源，使用完毕，务必要 close 掉</li>
<li>建议使用 Try-With-Resource 的语法进行异常的处理跟资源释放</li>
<li>务必使用 PreparedStatement，由于安全问题，生产环境不应该使用 Statement 类</li>
</ul>
</div>
</section>

<section id="outline-container-org6d60480" class="outline-2">
<h2 id="org6d60480"><span class="section-number-2">6</span> [案例] JDBC 连接 SQLServer</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgcd44a90" class="outline-3">
<h3 id="orgcd44a90"><span class="section-number-3">6.1</span> 创建名字为 xxx 的数据库，创建表 book</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">drop</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">book</span>;

<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">book</span>
<span style="color: #707183;">(</span>
       id <span style="color: #228b22;">int</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>,
       <span style="color: #a020f0;">name</span> <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>200<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>,
       price <span style="color: #228b22;">float</span> <span style="color: #a020f0;">default</span> 0
<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> book <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>1, <span style="color: #8b2252;">'x'</span>, 22<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> book <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>2, <span style="color: #8b2252;">'y'</span>, 23<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> book <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>3, <span style="color: #8b2252;">'z'</span>, 21<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> book <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>4, <span style="color: #8b2252;">'a'</span>, 77<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge06b29f" class="outline-3">
<h3 id="orge06b29f"><span class="section-number-3">6.2</span> 下载客户端，即 mssql-jdbc.jar</h3>
<div class="outline-text-3" id="text-6-2">
<p>
去 <a href="http://mvnrepository.com">http://mvnrepository.com</a> 这个地址下载。
</p>


<figure id="org94ae50b">
<img src="img/jdbc-sqlserver-download.png" alt="jdbc-sqlserver-download.png">

</figure>


<p>
下载完成之后，放到 e:/libs 文件夹下面。
</p>

<p>
比如，我们下载完后，保存为 e:/libs/mssql-jdbc-8.2.2.jre8.jar
</p>

<p>
它跟普通的客户端相比，它不需要安装。
</p>
</div>
</div>

<div id="outline-container-org7e5409a" class="outline-3">
<h3 id="org7e5409a"><span class="section-number-3">6.3</span> 配置 jdbc.jar 到项目中，让项目能够使用它</h3>
<div class="outline-text-3" id="text-6-3">
</div>
<div id="outline-container-org9ddcff1" class="outline-5">
<h5 id="org9ddcff1"><span class="section-number-5">6.3.0.1</span> 第一种，直接放到 WebContent/WEB-INF/lib 文件夹下面</h5>
</div>
<div id="outline-container-orgb53b16a" class="outline-5">
<h5 id="orgb53b16a"><span class="section-number-5">6.3.0.2</span> 第二种，配置项目，让项目能够引用到这个 jar 包</h5>
<div class="outline-text-5" id="text-6-3-0-2">

<figure id="orgd807dcf">
<img src="img/jdbc-jar.png" alt="jdbc-jar.png">

</figure>

<p>
点击 Add External JAR 后，选择 E:/libs/mssql-jdbc-8.2.2.jre8.jar 将其添加到项目即可。
</p>
</div>
</div>
</div>

<div id="outline-container-org4aa9275" class="outline-3">
<h3 id="org4aa9275"><span class="section-number-3">6.4</span> 万事俱备，开始使用</h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">main</span><span style="color: #707183;">(</span><span style="color: #228b22;">String</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">0. &#39537;&#21160; [&#20174; JDK6/jdbc4 &#24320;&#22987;&#65292;&#36825;&#21477;&#21487;&#20197;&#19981;&#20889;&#65292;&#23427;&#20250;&#33258;&#21160;&#34987;&#27880;&#20876;&#65307;&#22312; Web &#39033;&#30446;&#20013;&#65292;&#22914;&#26524;&#20986;&#29616;&#39537;&#21160;&#25214;&#19981;&#21040;&#30340;&#38382;&#39064;&#65292;&#23558;&#36825;&#21477;&#20889;&#19978;]</span>
    Class.forName<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"com.microsoft.sqlserver.jdbc.SQLServerDriver"</span><span style="color: #7388d6;">)</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#36830;&#25509;</span>
    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">url</span> = <span style="color: #8b2252;">"jdbc:sqlserver://localhost:1434;databaseName=xxx;user=sa;password="</span>;
    <span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DriverManager.getConnection<span style="color: #7388d6;">(</span>url<span style="color: #7388d6;">)</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#20351;&#29992;</span>
    <span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">statement</span> = connection.createStatement<span style="color: #7388d6;">()</span>;

    statement.executeUpdate<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"create database aabbcc"</span><span style="color: #7388d6;">)</span>;
    statement.executeUpdate<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"use aabbcc"</span><span style="color: #7388d6;">)</span>;
    statement.executeUpdate<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"create table hello (id int, ttt varchar(20))"</span><span style="color: #7388d6;">)</span>;
    statement.executeUpdate<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"insert into hello values (1, 'aaa')"</span><span style="color: #7388d6;">)</span>;
    statement.executeUpdate<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"insert into hello values (2, 'bbb')"</span><span style="color: #7388d6;">)</span>;
    statement.executeUpdate<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"insert into hello values (3, 'ccc')"</span><span style="color: #7388d6;">)</span>;
    statement.executeUpdate<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"insert into hello values (4, 'ddd')"</span><span style="color: #7388d6;">)</span>;

    <span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultset</span> = statement.executeQuery<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"select * from book"</span><span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">while</span> <span style="color: #7388d6;">(</span>resultset.next<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span> = resultset.getInt<span style="color: #909183;">(</span>1<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = resultset.getString<span style="color: #909183;">(</span>2<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">float</span> <span style="color: #a0522d;">price</span> = resultset.getFloat<span style="color: #909183;">(</span>3<span style="color: #909183;">)</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"id: "</span> + id + <span style="color: #8b2252;">" name: "</span> + name + <span style="color: #8b2252;">" price: "</span> + price<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#37322;&#25918;&#36164;&#28304;&#65292;&#35201;&#27880;&#24847;&#37322;&#25918;&#30340;&#39034;&#24207;</span>
    resultset.close<span style="color: #7388d6;">()</span>;
    statement.close<span style="color: #7388d6;">()</span>;
    connection.close<span style="color: #7388d6;">()</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<details id="org9fe791b">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">package</span> <span style="color: #008b8b;">nihao</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">sql</span>.<span style="color: #228b22;">Connection</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">sql</span>.<span style="color: #228b22;">Statement</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">sql</span>.<span style="color: #228b22;">PreparedStatement</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">sql</span>.<span style="color: #228b22;">ResultSet</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">sql</span>.<span style="color: #228b22;">DriverManager</span>;

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">App</span> <span style="color: #707183;">{</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>

        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"Connect to SQL Server and demo Create, Read, Update and Delete operations."</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">//</span><span style="color: #b22222;">Update the username and password below</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">connectionUrl</span> = <span style="color: #8b2252;">"jdbc:sqlserver://localhost:1434;databaseName=master;user=sa;password="</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">Load SQL Server JDBC driver and establish connection.</span>
            System.out.print<span style="color: #709870;">(</span><span style="color: #8b2252;">"Connecting to SQL Server ... "</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">try</span> <span style="color: #709870;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DriverManager.getConnection<span style="color: #907373;">(</span>connectionUrl<span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                System.out.println<span style="color: #907373;">(</span><span style="color: #8b2252;">"Done."</span><span style="color: #907373;">)</span>;

                <span style="color: #b22222;">// </span><span style="color: #b22222;">Create a sample database</span>
                System.out.print<span style="color: #907373;">(</span><span style="color: #8b2252;">"Dropping and creating database 'yyy' ... "</span><span style="color: #907373;">)</span>;
                <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"CREATE DATABASE [yyy]"</span>;
                <span style="color: #a020f0;">try</span> <span style="color: #907373;">(</span><span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">statement</span> = connection.createStatement<span style="color: #6276ba;">()</span><span style="color: #907373;">)</span> <span style="color: #907373;">{</span>
                    statement.executeUpdate<span style="color: #6276ba;">(</span>sql<span style="color: #6276ba;">)</span>;
                    System.out.println<span style="color: #6276ba;">(</span><span style="color: #8b2252;">"Done."</span><span style="color: #6276ba;">)</span>;
                <span style="color: #907373;">}</span>

                <span style="color: #b22222;">// </span><span style="color: #b22222;">Create a Table and insert some sample data</span>
                System.out.print<span style="color: #907373;">(</span><span style="color: #8b2252;">"Creating sample table with data, press ENTER to continue..."</span><span style="color: #907373;">)</span>;
                System.in.read<span style="color: #907373;">()</span>;
                sql = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #907373;">()</span>.append<span style="color: #907373;">(</span><span style="color: #8b2252;">"USE yyy; "</span><span style="color: #907373;">)</span>.append<span style="color: #907373;">(</span><span style="color: #8b2252;">"CREATE TABLE Employees ( "</span><span style="color: #907373;">)</span>
                        .append<span style="color: #907373;">(</span><span style="color: #8b2252;">" Id INT IDENTITY(1,1) NOT NULL PRIMARY KEY, "</span><span style="color: #907373;">)</span>.append<span style="color: #907373;">(</span><span style="color: #8b2252;">" Name NVARCHAR(50), "</span><span style="color: #907373;">)</span>
                        .append<span style="color: #907373;">(</span><span style="color: #8b2252;">" Location NVARCHAR(50) "</span><span style="color: #907373;">)</span>.append<span style="color: #907373;">(</span><span style="color: #8b2252;">"); "</span><span style="color: #907373;">)</span>
                        .append<span style="color: #907373;">(</span><span style="color: #8b2252;">"INSERT INTO Employees (Name, Location) VALUES "</span><span style="color: #907373;">)</span>.append<span style="color: #907373;">(</span><span style="color: #8b2252;">"(N'Jared', N'Australia'), "</span><span style="color: #907373;">)</span>
                        .append<span style="color: #907373;">(</span><span style="color: #8b2252;">"(N'Nikita', N'India'), "</span><span style="color: #907373;">)</span>.append<span style="color: #907373;">(</span><span style="color: #8b2252;">"(N'Tom', N'Germany'); "</span><span style="color: #907373;">)</span>.toString<span style="color: #907373;">()</span>;
                <span style="color: #a020f0;">try</span> <span style="color: #907373;">(</span><span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">statement</span> = connection.createStatement<span style="color: #6276ba;">()</span><span style="color: #907373;">)</span> <span style="color: #907373;">{</span>
                    statement.executeUpdate<span style="color: #6276ba;">(</span>sql<span style="color: #6276ba;">)</span>;
                    System.out.println<span style="color: #6276ba;">(</span><span style="color: #8b2252;">"Done."</span><span style="color: #6276ba;">)</span>;
                <span style="color: #907373;">}</span>

                <span style="color: #b22222;">// </span><span style="color: #b22222;">INSERT demo</span>
                System.out.print<span style="color: #907373;">(</span><span style="color: #8b2252;">"Inserting a new row into table, press ENTER to continue..."</span><span style="color: #907373;">)</span>;
                System.in.read<span style="color: #907373;">()</span>;
                sql = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">StringBuilder</span><span style="color: #907373;">()</span>.append<span style="color: #907373;">(</span><span style="color: #8b2252;">"INSERT Employees (Name, Location) "</span><span style="color: #907373;">)</span>.append<span style="color: #907373;">(</span><span style="color: #8b2252;">"VALUES (?, ?);"</span><span style="color: #907373;">)</span>
                        .toString<span style="color: #907373;">()</span>;
                <span style="color: #a020f0;">try</span> <span style="color: #907373;">(</span><span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #6276ba;">(</span>sql<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> <span style="color: #907373;">{</span>
                    statement.setString<span style="color: #6276ba;">(</span>1, <span style="color: #8b2252;">"Jake"</span><span style="color: #6276ba;">)</span>;
                    statement.setString<span style="color: #6276ba;">(</span>2, <span style="color: #8b2252;">"United States"</span><span style="color: #6276ba;">)</span>;
                    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rowsAffected</span> = statement.executeUpdate<span style="color: #6276ba;">()</span>;
                    System.out.println<span style="color: #6276ba;">(</span>rowsAffected + <span style="color: #8b2252;">" row(s) inserted"</span><span style="color: #6276ba;">)</span>;
                <span style="color: #907373;">}</span>

                <span style="color: #b22222;">// </span><span style="color: #b22222;">UPDATE demo</span>
                <span style="color: #228b22;">String</span> <span style="color: #a0522d;">userToUpdate</span> = <span style="color: #8b2252;">"Nikita"</span>;
                System.out.print<span style="color: #907373;">(</span><span style="color: #8b2252;">"Updating 'Location' for user '"</span> + userToUpdate + <span style="color: #8b2252;">"', press ENTER to continue..."</span><span style="color: #907373;">)</span>;
                System.in.read<span style="color: #907373;">()</span>;
                sql = <span style="color: #8b2252;">"UPDATE Employees SET Location = N'United States' WHERE Name = ?"</span>;
                <span style="color: #a020f0;">try</span> <span style="color: #907373;">(</span><span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #6276ba;">(</span>sql<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> <span style="color: #907373;">{</span>
                    statement.setString<span style="color: #6276ba;">(</span>1, userToUpdate<span style="color: #6276ba;">)</span>;
                    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rowsAffected</span> = statement.executeUpdate<span style="color: #6276ba;">()</span>;
                    System.out.println<span style="color: #6276ba;">(</span>rowsAffected + <span style="color: #8b2252;">" row(s) updated"</span><span style="color: #6276ba;">)</span>;
                <span style="color: #907373;">}</span>

                <span style="color: #b22222;">// </span><span style="color: #b22222;">DELETE demo</span>
                <span style="color: #228b22;">String</span> <span style="color: #a0522d;">userToDelete</span> = <span style="color: #8b2252;">"Jared"</span>;
                System.out.print<span style="color: #907373;">(</span><span style="color: #8b2252;">"Deleting user '"</span> + userToDelete + <span style="color: #8b2252;">"', press ENTER to continue..."</span><span style="color: #907373;">)</span>;
                System.in.read<span style="color: #907373;">()</span>;
                sql = <span style="color: #8b2252;">"DELETE FROM Employees WHERE Name = ?;"</span>;
                <span style="color: #a020f0;">try</span> <span style="color: #907373;">(</span><span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #6276ba;">(</span>sql<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> <span style="color: #907373;">{</span>
                    statement.setString<span style="color: #6276ba;">(</span>1, userToDelete<span style="color: #6276ba;">)</span>;
                    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rowsAffected</span> = statement.executeUpdate<span style="color: #6276ba;">()</span>;
                    System.out.println<span style="color: #6276ba;">(</span>rowsAffected + <span style="color: #8b2252;">" row(s) deleted"</span><span style="color: #6276ba;">)</span>;
                <span style="color: #907373;">}</span>

                <span style="color: #b22222;">// </span><span style="color: #b22222;">READ demo</span>
                System.out.print<span style="color: #907373;">(</span><span style="color: #8b2252;">"Reading data from table, press ENTER to continue..."</span><span style="color: #907373;">)</span>;
                System.in.read<span style="color: #907373;">()</span>;
                sql = <span style="color: #8b2252;">"SELECT Id, Name, Location FROM Employees;"</span>;
                <span style="color: #a020f0;">try</span> <span style="color: #907373;">(</span><span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">statement</span> = connection.createStatement<span style="color: #6276ba;">()</span>;
                        <span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultSet</span> = statement.executeQuery<span style="color: #6276ba;">(</span>sql<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span> <span style="color: #907373;">{</span>
                    <span style="color: #a020f0;">while</span> <span style="color: #6276ba;">(</span>resultSet.next<span style="color: #858580;">()</span><span style="color: #6276ba;">)</span> <span style="color: #6276ba;">{</span>
                        System.out.println<span style="color: #858580;">(</span>
                                resultSet.getInt<span style="color: #80a880;">(</span>1<span style="color: #80a880;">)</span> + <span style="color: #8b2252;">" "</span> + resultSet.getString<span style="color: #80a880;">(</span>2<span style="color: #80a880;">)</span> + <span style="color: #8b2252;">" "</span> + resultSet.getString<span style="color: #80a880;">(</span>3<span style="color: #80a880;">)</span><span style="color: #858580;">)</span>;
                    <span style="color: #6276ba;">}</span>
                <span style="color: #907373;">}</span>
                connection.close<span style="color: #907373;">()</span>;
                System.out.println<span style="color: #907373;">(</span><span style="color: #8b2252;">"All done."</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            System.out.println<span style="color: #709870;">()</span>;
            e.printStackTrace<span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</details>
</div>
</div>

<div id="outline-container-org3ec31f1" class="outline-3">
<h3 id="org3ec31f1"><span class="section-number-3">6.5</span> 增加异常的处理，让代码更健壮</h3>
<div class="outline-text-3" id="text-6-5">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">JDBCDemo</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = <span style="color: #008b8b;">null</span>;
        <span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">statement</span> = <span style="color: #008b8b;">null</span>;
        <span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultset</span> = <span style="color: #008b8b;">null</span>;
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#36830;&#25509;</span>
            <span style="color: #228b22;">String</span> <span style="color: #a0522d;">url</span> = <span style="color: #8b2252;">"jdbc:sqlserver://localhost:1434;databaseName=xxx;user=sa;password="</span>;
            connection = DriverManager.getConnection<span style="color: #709870;">(</span>url<span style="color: #709870;">)</span>;

            <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#20351;&#29992;</span>
            statement = connection.createStatement<span style="color: #709870;">()</span>;

            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"create database aabbcc"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"use aabbcc"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"create table hello (id int, ttt varchar(20))"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"insert into hello values (1, 'aaa')"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"insert into hello values (2, 'bbb')"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"insert into hello values (3, 'ccc')"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"insert into hello values (4, 'ddd')"</span><span style="color: #709870;">)</span>;

            resultset = statement.executeQuery<span style="color: #709870;">(</span><span style="color: #8b2252;">"select * from book"</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">while</span> <span style="color: #709870;">(</span>resultset.next<span style="color: #907373;">()</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span> = resultset.getInt<span style="color: #907373;">(</span>1<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = resultset.getString<span style="color: #907373;">(</span>2<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">float</span> <span style="color: #a0522d;">price</span> = resultset.getFloat<span style="color: #907373;">(</span>3<span style="color: #907373;">)</span>;
                System.out.println<span style="color: #907373;">(</span><span style="color: #8b2252;">"id: "</span> + id + <span style="color: #8b2252;">" name: "</span> + name + <span style="color: #8b2252;">" price: "</span> + price<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            System.out.println<span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25968;&#25454;&#24211;&#36830;&#25509;&#30340;&#26102;&#20505;&#20986;&#29616;&#20102;&#38169;&#35823;: "</span> + e.getMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">finally</span> <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>resultset != <span style="color: #008b8b;">null</span><span style="color: #709870;">)</span>
                <span style="color: #a020f0;">try</span> <span style="color: #709870;">{</span>
                    resultset.close<span style="color: #907373;">()</span>;
                <span style="color: #709870;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #709870;">(</span><span style="color: #228b22;">SQLException</span> <span style="color: #a0522d;">e</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>statement != <span style="color: #008b8b;">null</span><span style="color: #709870;">)</span>
                <span style="color: #a020f0;">try</span> <span style="color: #709870;">{</span>
                    statement.close<span style="color: #907373;">()</span>;
                <span style="color: #709870;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #709870;">(</span><span style="color: #228b22;">SQLException</span> <span style="color: #a0522d;">e</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>connection != <span style="color: #008b8b;">null</span><span style="color: #709870;">)</span>
                <span style="color: #a020f0;">try</span> <span style="color: #709870;">{</span>
                    connection.close<span style="color: #907373;">()</span>;
                <span style="color: #709870;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #709870;">(</span><span style="color: #228b22;">SQLException</span> <span style="color: #a0522d;">e</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
请大家务必要去了解为什么关闭语句要写得这么复杂！
</p>
</div>
</div>

<div id="outline-container-orga7c73d7" class="outline-3">
<h3 id="orga7c73d7"><span class="section-number-3">6.6</span> 基于上述的代码，对相关的处理逻辑进行封装 (复用)</h3>
<div class="outline-text-3" id="text-6-6">
<p>
业务类:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">JDBCDemo</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = <span style="color: #008b8b;">null</span>;
        <span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">statement</span> = <span style="color: #008b8b;">null</span>;
        <span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultset</span> = <span style="color: #008b8b;">null</span>;
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#36830;&#25509;</span>
            connection = Xxx.getConnection<span style="color: #709870;">()</span>;

            <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#20351;&#29992;</span>
            statement = connection.createStatement<span style="color: #709870;">()</span>;

            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"create database aabbcc"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"use aabbcc"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"create table hello (id int, ttt varchar(20))"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"insert into hello values (1, 'aaa')"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"insert into hello values (2, 'bbb')"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"insert into hello values (3, 'ccc')"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"insert into hello values (4, 'ddd')"</span><span style="color: #709870;">)</span>;

            resultset = statement.executeQuery<span style="color: #709870;">(</span><span style="color: #8b2252;">"select * from book"</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">while</span> <span style="color: #709870;">(</span>resultset.next<span style="color: #907373;">()</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span> = resultset.getInt<span style="color: #907373;">(</span>1<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = resultset.getString<span style="color: #907373;">(</span>2<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">float</span> <span style="color: #a0522d;">price</span> = resultset.getFloat<span style="color: #907373;">(</span>3<span style="color: #907373;">)</span>;
                System.out.println<span style="color: #907373;">(</span><span style="color: #8b2252;">"id: "</span> + id + <span style="color: #8b2252;">" name: "</span> + name + <span style="color: #8b2252;">" price: "</span> + price<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            System.out.println<span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25968;&#25454;&#24211;&#36830;&#25509;&#30340;&#26102;&#20505;&#20986;&#29616;&#20102;&#38169;&#35823;: "</span> + e.getMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">finally</span> <span style="color: #909183;">{</span>
            Xxx.closeDBResources<span style="color: #709870;">(</span>connection, statement, resultset<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
辅助类:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Xxx</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">Connection</span> <span style="color: #0000ff;">getConnection</span><span style="color: #7388d6;">()</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">SQLException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">url</span> = <span style="color: #8b2252;">"jdbc:sqlserver://localhost:1434;databaseName=xxx;user=sa;password="</span>;
        <span style="color: #a020f0;">return</span> DriverManager.getConnection<span style="color: #909183;">(</span>url<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">closeDBResources</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span>, <span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">statement</span>, <span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultset</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>resultset != <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span>
            <span style="color: #a020f0;">try</span> <span style="color: #909183;">{</span>
                resultset.close<span style="color: #709870;">()</span>;
            <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">SQLException</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>statement != <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span>
            <span style="color: #a020f0;">try</span> <span style="color: #909183;">{</span>
                statement.close<span style="color: #709870;">()</span>;
            <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">SQLException</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #909183;">}</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>connection != <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span>
            <span style="color: #a020f0;">try</span> <span style="color: #909183;">{</span>
                connection.close<span style="color: #709870;">()</span>;
            <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">SQLException</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org36e5e4b" class="outline-3">
<h3 id="org36e5e4b"><span class="section-number-3">6.7</span> 使用 Try-With-Resource 进行资源的释放</h3>
<div class="outline-text-3" id="text-6-7">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">JDBCDemo</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = Xxx.getConnection<span style="color: #709870;">()</span>; <span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">statement</span> = connection.createStatement<span style="color: #709870;">()</span>;<span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"create database aabbcc"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"use aabbcc"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"create table hello (id int, ttt varchar(20))"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"insert into hello values (1, 'aaa')"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"insert into hello values (2, 'bbb')"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"insert into hello values (3, 'ccc')"</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">(</span><span style="color: #8b2252;">"insert into hello values (4, 'ddd')"</span><span style="color: #709870;">)</span>;

            <span style="color: #a020f0;">try</span> <span style="color: #709870;">(</span><span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultset</span> = statement.executeQuery<span style="color: #907373;">(</span><span style="color: #8b2252;">"select * from book"</span><span style="color: #907373;">)</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">while</span> <span style="color: #907373;">(</span>resultset.next<span style="color: #6276ba;">()</span><span style="color: #907373;">)</span> <span style="color: #907373;">{</span>
                    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span> = resultset.getInt<span style="color: #6276ba;">(</span>1<span style="color: #6276ba;">)</span>;
                    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = resultset.getString<span style="color: #6276ba;">(</span>2<span style="color: #6276ba;">)</span>;
                    <span style="color: #228b22;">float</span> <span style="color: #a0522d;">price</span> = resultset.getFloat<span style="color: #6276ba;">(</span>3<span style="color: #6276ba;">)</span>;
                    System.out.println<span style="color: #6276ba;">(</span><span style="color: #8b2252;">"id: "</span> + id + <span style="color: #8b2252;">" name: "</span> + name + <span style="color: #8b2252;">" price: "</span> + price<span style="color: #6276ba;">)</span>;
                <span style="color: #907373;">}</span>
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            System.out.println<span style="color: #709870;">(</span><span style="color: #8b2252;">"&#25968;&#25454;&#24211;&#36830;&#25509;&#30340;&#26102;&#20505;&#20986;&#29616;&#20102;&#38169;&#35823;: "</span> + e.getMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 孙悟空</p>
<p class="date">Created: 2020-10-28</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
