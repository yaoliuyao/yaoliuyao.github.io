<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2021-01-22 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>JDBC 连接数据库</title>
<meta name="generator" content="Org mode">
<meta name="author" content="孙悟空">
<link rel='stylesheet' href='/html/asset/common.css?3344' />
<link rel='stylesheet' href='/yaoliusan/html/asset/common.css?3344' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/html/asset/common.js'></script>
<script src='/yaoliusan/html/asset/common.js'></script>

<style>
 /* From: https://endlessparentheses.com/public/css/endless.css */
 .special-kbd {
   color: #333;
   background-color: #f7f7f7;
   border: 1px solid #ccc;
   border-radius: 6px;
   box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
   display: inline-block;
   font-family: 'Droid Sans Mono', monospace;
   font-size: 80%;
   font-weight: normal;
   line-height: inherit;
   margin: 2px .1em;
   padding: .04em .4em;
   text-shadow: 0 1px 0 #fff;
   word-spacing: -3px;
 }
</style>
</head>
<body>
<div id="content">
<header>
<h1 class="title">JDBC 连接数据库</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org2aa4d06">1. DriverManager 驱动管理类</a></li>
<li><a href="#org1c946f8">2. Connection 代表的是一个数据库连接</a></li>
<li><a href="#org72c3c6e">3. Statement 用来提交某个 SQL 语句</a>
<ul>
<li><a href="#org0fce173">3.1. statement.execute/executeUpdate/executeQuery()</a></li>
<li><a href="#org4bbb004">3.2. PreparedStatement 是可以绑定入参的 Statement</a></li>
</ul>
</li>
<li><a href="#org269ae26">4. ResultSet 用来表示结果集</a></li>
<li><a href="#org871a37a">5. 小结</a></li>
<li><a href="#orge70d70c">6. [案例] JDBC 连接 SQLServer</a>
<ul>
<li><a href="#org680e47a">6.1. 创建名字为 xxx 的数据库，创建表 book</a></li>
<li><a href="#orgbe396bc">6.2. 下载客户端，即 mssql-jdbc.jar</a></li>
<li><a href="#org55a2058">6.3. 配置 jdbc.jar 到项目中，让项目能够使用它</a>
<ul>
<li>
<ul>
<li><a href="#orgae505a9">6.3.0.1. 第一种，直接放到 WebContent/WEB-INF/lib 文件夹下面</a></li>
<li><a href="#orgf139fe3">6.3.0.2. 第二种，配置项目，让项目能够引用到这个 jar 包</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org697d3df">6.4. 万事俱备，开始使用</a></li>
<li><a href="#org3ab397e">6.5. 增加异常的处理，让代码更健壮</a></li>
<li><a href="#orgf677b2d">6.6. 基于上述的代码，对相关的处理逻辑进行封装 (复用)</a></li>
<li><a href="#orga6c49b0">6.7. 使用 Try-With-Resource 进行资源的释放</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<p>
JDBC (Java DataBase Connectivity).
</p>


<section id="outline-container-org2aa4d06" class="outline-2">
<h2 id="org2aa4d06"><span class="section-number-2">1</span> DriverManager 驱动管理类</h2>
<div class="outline-text-2" id="text-1">
<p>
通过它可以对连接进行管理。最常用的就是:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">Class.forName &#29616;&#22312;&#21487;&#20197;&#30465;&#30053;</span>
<span style="color: #61afef;">Conenction</span> <span style="color: #61afef;">conn</span> = DriverManger.getConnection<span style="color: #8c8c8c;">(</span>url<span style="color: #8c8c8c;">)</span>;
</pre>
</div>

<p>
可以将获取连接进行简单封装:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #c678dd; font-weight: bold;">public</span> <span style="color: #c678dd; font-weight: bold;">class</span> <span style="color: #61afef;">DBHelper</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #c678dd; font-weight: bold;">public</span> <span style="color: #c678dd; font-weight: bold;">static</span> <span style="color: #61afef;">Connection</span> <span style="color: #61afef;">getConnection</span><span style="color: #93a8c6;">()</span> <span style="color: #c678dd; font-weight: bold;">throws</span> <span style="color: #61afef;">Exception</span> <span style="color: #93a8c6;">{</span>
        <span style="color: #61afef;">String</span> <span style="color: #61afef;">user</span> = <span style="color: #98be65;">"sa"</span>;
        <span style="color: #61afef;">String</span> <span style="color: #61afef;">password</span> = <span style="color: #98be65;">"sa"</span>;
        <span style="color: #61afef;">String</span> <span style="color: #61afef;">dataBase</span> = <span style="color: #98be65;">"xxx"</span>;
        <span style="color: #61afef;">String</span> <span style="color: #61afef;">host</span> = <span style="color: #98be65;">"localhost:1434"</span>;
        <span style="color: #61afef;">String</span> <span style="color: #61afef;">url</span> = <span style="color: #98be65;">"jdbc:sqlserver://"</span> + host + <span style="color: #98be65;">";databaseName="</span> + dataBase + <span style="color: #98be65;">";user="</span> + user + <span style="color: #98be65;">";password="</span> + password;

        Class.forName<span style="color: #b0b1a3;">(</span><span style="color: #98be65;">"com.microsoft.sqlserver.jdbc.SQLServerDriver"</span><span style="color: #b0b1a3;">)</span>;
        <span style="color: #c678dd; font-weight: bold;">return</span> DriverManager.getConnection<span style="color: #b0b1a3;">(</span>url<span style="color: #b0b1a3;">)</span>;
    <span style="color: #93a8c6;">}</span>
<span style="color: #8c8c8c;">}</span>
</pre>
</div>
</div>
</section>

<section id="outline-container-org1c946f8" class="outline-2">
<h2 id="org1c946f8"><span class="section-number-2">2</span> Connection 代表的是一个数据库连接</h2>
<div class="outline-text-2" id="text-2">
<p>
后续所有的操作，都必须要基于 Connection 对象。
</p>

<p>
如果使用完毕，请 <b>务必要记得</b> 关闭。
</p>

<blockquote>
<p>
有始有终，方为睿智之士。
</p>
</blockquote>
</div>
</section>

<section id="outline-container-org72c3c6e" class="outline-2">
<h2 id="org72c3c6e"><span class="section-number-2">3</span> Statement 用来提交某个 SQL 语句</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org0fce173" class="outline-3">
<h3 id="org0fce173"><span class="section-number-3">3.1</span> statement.execute/executeUpdate/executeQuery()</h3>
<div class="outline-text-3" id="text-3-1">
<p>
execute = executeQuery + executeUpdate
</p>
<ul class="org-ul">
<li>executeQuery 更适合于 select 语句，返回的是 ResultSet 对象，代表结果集</li>
<li>executeUpdate 适合于更新数据，返回的是整形，表示受语句影响的行数</li>
</ul>
</div>
</div>

<div id="outline-container-org4bbb004" class="outline-3">
<h3 id="org4bbb004"><span class="section-number-3">3.2</span> PreparedStatement 是可以绑定入参的 Statement</h3>
<div class="outline-text-3" id="text-3-2">
<p>
PreparedStatement 解决掉的问题:
</p>
<ol class="org-ol">
<li>避免了枯燥拼接 SQL 字符串</li>
<li>可以有效规避 SQL 注入带来的风险!</li>
</ol>

<p>
因此，以后操作数据库，请大家务必使用 PreparedStatement !!!
</p>


<div  class='mc11'>
<div>
<p>

</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #61afef;">String</span> <span style="color: #61afef;">sql</span> = <span style="color: #98be65;">"insert into book (bookname, price) values ('"</span>
                 + name + <span style="color: #98be65;">"', "</span> + price + <span style="color: #98be65;">")"</span>;

<span style="color: #61afef;">Connection</span> <span style="color: #61afef;">conn</span> = DBHelper.getConnection<span style="color: #8c8c8c;">()</span>;
<span style="color: #61afef;">Statement</span> <span style="color: #61afef;">st</span> = conn.createStatement<span style="color: #8c8c8c;">()</span>;

st.executeUpdate<span style="color: #8c8c8c;">(</span>sql<span style="color: #8c8c8c;">)</span>;

st.close<span style="color: #8c8c8c;">()</span>;
conn.close<span style="color: #8c8c8c;">()</span>;
</pre>
</div>
<p>

</div>
<div>

</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #61afef;">String</span> <span style="color: #61afef;">sql</span> = <span style="color: #98be65;">"insert into book (bookname, price) values (?, ?)"</span>;

<span style="color: #61afef;">Connection</span> <span style="color: #61afef;">conn</span> = DBHelper.getConnection<span style="color: #8c8c8c;">()</span>;
<span style="color: #61afef;">PreparedStatement</span> <span style="color: #61afef;">ps</span> = conn.prepareStatement<span style="color: #8c8c8c;">(</span>sql<span style="color: #8c8c8c;">)</span>;

ps.setString<span style="color: #8c8c8c;">(</span>1, <span style="color: #98be65;">"js tutor"</span><span style="color: #8c8c8c;">)</span>;
ps.setFloat<span style="color: #8c8c8c;">(</span>2, 22F<span style="color: #8c8c8c;">)</span>;
ps.executeUpdate<span style="color: #8c8c8c;">()</span>;

ps.close<span style="color: #8c8c8c;">()</span>;
conn.close<span style="color: #8c8c8c;">()</span>;
</pre>
</div>

</div>

</div>
</div>
</div>
</section>

<section id="outline-container-org269ae26" class="outline-2">
<h2 id="org269ae26"><span class="section-number-2">4</span> ResultSet 用来表示结果集</h2>
<div class="outline-text-2" id="text-4">
<p>
通用的迭代方法为:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #c678dd; font-weight: bold;">while</span> <span style="color: #8c8c8c;">(</span>rs.next<span style="color: #93a8c6;">()</span><span style="color: #8c8c8c;">)</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #61afef;">Xxx</span> <span style="color: #61afef;">i</span> = rs.getXxx<span style="color: #93a8c6;">(</span>1<span style="color: #93a8c6;">)</span>;
    <span style="color: #61afef;">Xxx</span> <span style="color: #61afef;">j</span> = rs.getXxx<span style="color: #93a8c6;">(</span>2<span style="color: #93a8c6;">)</span>;
    System.out.println<span style="color: #93a8c6;">(</span>i + j<span style="color: #93a8c6;">)</span>;
<span style="color: #8c8c8c;">}</span>
</pre>
</div>

<p>
小结:
</p>
<ul class="org-ul">
<li>rs.next() 表示将当前的游标 (Cursor)，移到下一行。如果没有下一行，则返回 false</li>
<li>如果使用 rs.getInt/Object 之类的，会在当前行的基础上取数据</li>
<li>rs 使用完毕，最好要将其结束掉</li>
</ul>
</div>
</section>

<section id="outline-container-org871a37a" class="outline-2">
<h2 id="org871a37a"><span class="section-number-2">5</span> 小结</h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li>Connection/Statement/ResultSet 都属于资源，使用完毕，务必要 close 掉</li>
<li>建议使用 Try-With-Resource 的语法进行异常的处理跟资源释放</li>
<li>务必使用 PreparedStatement，由于安全问题，生产环境不应该使用 Statement 类</li>
</ul>
</div>
</section>

<section id="outline-container-orge70d70c" class="outline-2">
<h2 id="orge70d70c"><span class="section-number-2">6</span> [案例] JDBC 连接 SQLServer</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org680e47a" class="outline-3">
<h3 id="org680e47a"><span class="section-number-3">6.1</span> 创建名字为 xxx 的数据库，创建表 book</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #c678dd; font-weight: bold;">drop</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">book</span>;

<span style="color: #c678dd; font-weight: bold;">create</span> <span style="color: #c678dd; font-weight: bold;">table</span> <span style="color: #61afef;">book</span>
<span style="color: #8c8c8c;">(</span>
       id <span style="color: #61afef;">int</span> <span style="color: #c678dd; font-weight: bold;">primary</span> <span style="color: #c678dd; font-weight: bold;">key</span>,
       <span style="color: #c678dd; font-weight: bold;">name</span> <span style="color: #61afef;">varchar</span><span style="color: #93a8c6;">(</span>200<span style="color: #93a8c6;">)</span> <span style="color: #c678dd; font-weight: bold;">not</span> <span style="color: #c678dd; font-weight: bold;">null</span>,
       price <span style="color: #61afef;">float</span> <span style="color: #c678dd; font-weight: bold;">default</span> 0
<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> book <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span>1, <span style="color: #98be65;">'x'</span>, 22<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> book <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span>2, <span style="color: #98be65;">'y'</span>, 23<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> book <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span>3, <span style="color: #98be65;">'z'</span>, 21<span style="color: #8c8c8c;">)</span>;
<span style="color: #c678dd; font-weight: bold;">insert</span> <span style="color: #c678dd; font-weight: bold;">into</span> book <span style="color: #c678dd; font-weight: bold;">values</span> <span style="color: #8c8c8c;">(</span>4, <span style="color: #98be65;">'a'</span>, 77<span style="color: #8c8c8c;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe396bc" class="outline-3">
<h3 id="orgbe396bc"><span class="section-number-3">6.2</span> 下载客户端，即 mssql-jdbc.jar</h3>
<div class="outline-text-3" id="text-6-2">
<p>
去 <a href="http://mvnrepository.com">http://mvnrepository.com</a> 这个地址下载。
</p>


<figure id="orgd7c7d1b">
<img src="img/jdbc-sqlserver-download.png" alt="jdbc-sqlserver-download.png">

</figure>


<p>
下载完成之后，放到 e:/libs 文件夹下面。
</p>

<p>
比如，我们下载完后，保存为 e:/libs/mssql-jdbc-8.2.2.jre8.jar
</p>

<p>
它跟普通的客户端相比，它不需要安装。
</p>
</div>
</div>

<div id="outline-container-org55a2058" class="outline-3">
<h3 id="org55a2058"><span class="section-number-3">6.3</span> 配置 jdbc.jar 到项目中，让项目能够使用它</h3>
<div class="outline-text-3" id="text-6-3">
</div>
<div id="outline-container-orgae505a9" class="outline-5">
<h5 id="orgae505a9"><span class="section-number-5">6.3.0.1</span> 第一种，直接放到 WebContent/WEB-INF/lib 文件夹下面</h5>
</div>
<div id="outline-container-orgf139fe3" class="outline-5">
<h5 id="orgf139fe3"><span class="section-number-5">6.3.0.2</span> 第二种，配置项目，让项目能够引用到这个 jar 包</h5>
<div class="outline-text-5" id="text-6-3-0-2">

<figure id="org9f8ed15">
<img src="img/jdbc-jar.png" alt="jdbc-jar.png">

</figure>

<p>
点击 Add External JAR 后，选择 E:/libs/mssql-jdbc-8.2.2.jre8.jar 将其添加到项目即可。
</p>
</div>
</div>
</div>

<div id="outline-container-org697d3df" class="outline-3">
<h3 id="org697d3df"><span class="section-number-3">6.4</span> 万事俱备，开始使用</h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #c678dd; font-weight: bold;">public</span> <span style="color: #c678dd; font-weight: bold;">static</span> <span style="color: #61afef;">void</span> <span style="color: #61afef;">main</span><span style="color: #8c8c8c;">(</span><span style="color: #61afef;">String</span><span style="color: #93a8c6;">[]</span> <span style="color: #61afef;">args</span><span style="color: #8c8c8c;">)</span> <span style="color: #c678dd; font-weight: bold;">throws</span> <span style="color: #61afef;">Exception</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">0. &#39537;&#21160; [&#20174; JDK6/jdbc4 &#24320;&#22987;&#65292;&#36825;&#21477;&#21487;&#20197;&#19981;&#20889;&#65292;&#23427;&#20250;&#33258;&#21160;&#34987;&#27880;&#20876;&#65307;&#22312; Web &#39033;&#30446;&#20013;&#65292;&#22914;&#26524;&#20986;&#29616;&#39537;&#21160;&#25214;&#19981;&#21040;&#30340;&#38382;&#39064;&#65292;&#23558;&#36825;&#21477;&#20889;&#19978;]</span>
    Class.forName<span style="color: #93a8c6;">(</span><span style="color: #98be65;">"com.microsoft.sqlserver.jdbc.SQLServerDriver"</span><span style="color: #93a8c6;">)</span>;

    <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">1. &#36830;&#25509;</span>
    <span style="color: #61afef;">String</span> <span style="color: #61afef;">url</span> = <span style="color: #98be65;">"jdbc:sqlserver://localhost:1434;databaseName=xxx;user=sa;password="</span>;
    <span style="color: #61afef;">Connection</span> <span style="color: #61afef;">connection</span> = DriverManager.getConnection<span style="color: #93a8c6;">(</span>url<span style="color: #93a8c6;">)</span>;

    <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">2. &#20351;&#29992;</span>
    <span style="color: #61afef;">Statement</span> <span style="color: #61afef;">statement</span> = connection.createStatement<span style="color: #93a8c6;">()</span>;

    statement.executeUpdate<span style="color: #93a8c6;">(</span><span style="color: #98be65;">"create database aabbcc"</span><span style="color: #93a8c6;">)</span>;
    statement.executeUpdate<span style="color: #93a8c6;">(</span><span style="color: #98be65;">"use aabbcc"</span><span style="color: #93a8c6;">)</span>;
    statement.executeUpdate<span style="color: #93a8c6;">(</span><span style="color: #98be65;">"create table hello (id int, ttt varchar(20))"</span><span style="color: #93a8c6;">)</span>;
    statement.executeUpdate<span style="color: #93a8c6;">(</span><span style="color: #98be65;">"insert into hello values (1, 'aaa')"</span><span style="color: #93a8c6;">)</span>;
    statement.executeUpdate<span style="color: #93a8c6;">(</span><span style="color: #98be65;">"insert into hello values (2, 'bbb')"</span><span style="color: #93a8c6;">)</span>;
    statement.executeUpdate<span style="color: #93a8c6;">(</span><span style="color: #98be65;">"insert into hello values (3, 'ccc')"</span><span style="color: #93a8c6;">)</span>;
    statement.executeUpdate<span style="color: #93a8c6;">(</span><span style="color: #98be65;">"insert into hello values (4, 'ddd')"</span><span style="color: #93a8c6;">)</span>;

    <span style="color: #61afef;">ResultSet</span> <span style="color: #61afef;">resultset</span> = statement.executeQuery<span style="color: #93a8c6;">(</span><span style="color: #98be65;">"select * from book"</span><span style="color: #93a8c6;">)</span>;
    <span style="color: #c678dd; font-weight: bold;">while</span> <span style="color: #93a8c6;">(</span>resultset.next<span style="color: #b0b1a3;">()</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>
        <span style="color: #61afef;">int</span> <span style="color: #61afef;">id</span> = resultset.getInt<span style="color: #b0b1a3;">(</span>1<span style="color: #b0b1a3;">)</span>;
        <span style="color: #61afef;">String</span> <span style="color: #61afef;">name</span> = resultset.getString<span style="color: #b0b1a3;">(</span>2<span style="color: #b0b1a3;">)</span>;
        <span style="color: #61afef;">float</span> <span style="color: #61afef;">price</span> = resultset.getFloat<span style="color: #b0b1a3;">(</span>3<span style="color: #b0b1a3;">)</span>;
        System.out.println<span style="color: #b0b1a3;">(</span><span style="color: #98be65;">"id: "</span> + id + <span style="color: #98be65;">" name: "</span> + name + <span style="color: #98be65;">" price: "</span> + price<span style="color: #b0b1a3;">)</span>;
    <span style="color: #93a8c6;">}</span>

    <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">&#37322;&#25918;&#36164;&#28304;&#65292;&#35201;&#27880;&#24847;&#37322;&#25918;&#30340;&#39034;&#24207;</span>
    resultset.close<span style="color: #93a8c6;">()</span>;
    statement.close<span style="color: #93a8c6;">()</span>;
    connection.close<span style="color: #93a8c6;">()</span>;
<span style="color: #8c8c8c;">}</span>
</pre>
</div>

<details class="details"> <summary class="detail-summary"> <span class="detail-title">Microsoft 提供的 jdbc 使用案例</span> </summary> <div class="detail-body"> <div class="org-src-container">
<pre class="src src-java"><span style="color: #c678dd; font-weight: bold;">package</span> <span style="color: #da8548; font-weight: bold;">nihao</span>;

<span style="color: #c678dd; font-weight: bold;">import</span> <span style="color: #da8548; font-weight: bold;">java</span>.<span style="color: #da8548; font-weight: bold;">sql</span>.<span style="color: #61afef;">Connection</span>;
<span style="color: #c678dd; font-weight: bold;">import</span> <span style="color: #da8548; font-weight: bold;">java</span>.<span style="color: #da8548; font-weight: bold;">sql</span>.<span style="color: #61afef;">Statement</span>;
<span style="color: #c678dd; font-weight: bold;">import</span> <span style="color: #da8548; font-weight: bold;">java</span>.<span style="color: #da8548; font-weight: bold;">sql</span>.<span style="color: #61afef;">PreparedStatement</span>;
<span style="color: #c678dd; font-weight: bold;">import</span> <span style="color: #da8548; font-weight: bold;">java</span>.<span style="color: #da8548; font-weight: bold;">sql</span>.<span style="color: #61afef;">ResultSet</span>;
<span style="color: #c678dd; font-weight: bold;">import</span> <span style="color: #da8548; font-weight: bold;">java</span>.<span style="color: #da8548; font-weight: bold;">sql</span>.<span style="color: #61afef;">DriverManager</span>;

<span style="color: #c678dd; font-weight: bold;">public</span> <span style="color: #c678dd; font-weight: bold;">class</span> <span style="color: #61afef;">App</span> <span style="color: #8c8c8c;">{</span>

    <span style="color: #c678dd; font-weight: bold;">public</span> <span style="color: #c678dd; font-weight: bold;">static</span> <span style="color: #61afef;">void</span> <span style="color: #61afef;">main</span><span style="color: #93a8c6;">(</span><span style="color: #61afef;">String</span><span style="color: #b0b1a3;">[]</span> <span style="color: #61afef;">args</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>

        System.out.println<span style="color: #b0b1a3;">(</span><span style="color: #98be65;">"Connect to SQL Server and demo Create, Read, Update and Delete operations."</span><span style="color: #b0b1a3;">)</span>;

        <span style="color: #687080; font-style: italic;">//</span><span style="color: #687080; font-style: italic;">Update the username and password below</span>
        <span style="color: #61afef;">String</span> <span style="color: #61afef;">connectionUrl</span> = <span style="color: #98be65;">"jdbc:sqlserver://localhost:1434;databaseName=master;user=sa;password="</span>;

        <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #b0b1a3;">{</span>
            <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">Load SQL Server JDBC driver and establish connection.</span>
            System.out.print<span style="color: #97b098;">(</span><span style="color: #98be65;">"Connecting to SQL Server ... "</span><span style="color: #97b098;">)</span>;
            <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #97b098;">(</span><span style="color: #61afef;">Connection</span> <span style="color: #61afef;">connection</span> = DriverManager.getConnection<span style="color: #aebed8;">(</span>connectionUrl<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                System.out.println<span style="color: #aebed8;">(</span><span style="color: #98be65;">"Done."</span><span style="color: #aebed8;">)</span>;

                <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">Create a sample database</span>
                System.out.print<span style="color: #aebed8;">(</span><span style="color: #98be65;">"Dropping and creating database 'yyy' ... "</span><span style="color: #aebed8;">)</span>;
                <span style="color: #61afef;">String</span> <span style="color: #61afef;">sql</span> = <span style="color: #98be65;">"CREATE DATABASE [yyy]"</span>;
                <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #aebed8;">(</span><span style="color: #61afef;">Statement</span> <span style="color: #61afef;">statement</span> = connection.createStatement<span style="color: #b0b0b3;">()</span><span style="color: #aebed8;">)</span> <span style="color: #aebed8;">{</span>
                    statement.executeUpdate<span style="color: #b0b0b3;">(</span>sql<span style="color: #b0b0b3;">)</span>;
                    System.out.println<span style="color: #b0b0b3;">(</span><span style="color: #98be65;">"Done."</span><span style="color: #b0b0b3;">)</span>;
                <span style="color: #aebed8;">}</span>

                <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">Create a Table and insert some sample data</span>
                System.out.print<span style="color: #aebed8;">(</span><span style="color: #98be65;">"Creating sample table with data, press ENTER to continue..."</span><span style="color: #aebed8;">)</span>;
                System.in.read<span style="color: #aebed8;">()</span>;
                sql = <span style="color: #c678dd; font-weight: bold;">new</span> <span style="color: #61afef;">StringBuilder</span><span style="color: #aebed8;">()</span>.append<span style="color: #aebed8;">(</span><span style="color: #98be65;">"USE yyy; "</span><span style="color: #aebed8;">)</span>.append<span style="color: #aebed8;">(</span><span style="color: #98be65;">"CREATE TABLE Employees ( "</span><span style="color: #aebed8;">)</span>
                        .append<span style="color: #aebed8;">(</span><span style="color: #98be65;">" Id INT IDENTITY(1,1) NOT NULL PRIMARY KEY, "</span><span style="color: #aebed8;">)</span>.append<span style="color: #aebed8;">(</span><span style="color: #98be65;">" Name NVARCHAR(50), "</span><span style="color: #aebed8;">)</span>
                        .append<span style="color: #aebed8;">(</span><span style="color: #98be65;">" Location NVARCHAR(50) "</span><span style="color: #aebed8;">)</span>.append<span style="color: #aebed8;">(</span><span style="color: #98be65;">"); "</span><span style="color: #aebed8;">)</span>
                        .append<span style="color: #aebed8;">(</span><span style="color: #98be65;">"INSERT INTO Employees (Name, Location) VALUES "</span><span style="color: #aebed8;">)</span>.append<span style="color: #aebed8;">(</span><span style="color: #98be65;">"(N'Jared', N'Australia'), "</span><span style="color: #aebed8;">)</span>
                        .append<span style="color: #aebed8;">(</span><span style="color: #98be65;">"(N'Nikita', N'India'), "</span><span style="color: #aebed8;">)</span>.append<span style="color: #aebed8;">(</span><span style="color: #98be65;">"(N'Tom', N'Germany'); "</span><span style="color: #aebed8;">)</span>.toString<span style="color: #aebed8;">()</span>;
                <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #aebed8;">(</span><span style="color: #61afef;">Statement</span> <span style="color: #61afef;">statement</span> = connection.createStatement<span style="color: #b0b0b3;">()</span><span style="color: #aebed8;">)</span> <span style="color: #aebed8;">{</span>
                    statement.executeUpdate<span style="color: #b0b0b3;">(</span>sql<span style="color: #b0b0b3;">)</span>;
                    System.out.println<span style="color: #b0b0b3;">(</span><span style="color: #98be65;">"Done."</span><span style="color: #b0b0b3;">)</span>;
                <span style="color: #aebed8;">}</span>

                <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">INSERT demo</span>
                System.out.print<span style="color: #aebed8;">(</span><span style="color: #98be65;">"Inserting a new row into table, press ENTER to continue..."</span><span style="color: #aebed8;">)</span>;
                System.in.read<span style="color: #aebed8;">()</span>;
                sql = <span style="color: #c678dd; font-weight: bold;">new</span> <span style="color: #61afef;">StringBuilder</span><span style="color: #aebed8;">()</span>.append<span style="color: #aebed8;">(</span><span style="color: #98be65;">"INSERT Employees (Name, Location) "</span><span style="color: #aebed8;">)</span>.append<span style="color: #aebed8;">(</span><span style="color: #98be65;">"VALUES (?, ?);"</span><span style="color: #aebed8;">)</span>
                        .toString<span style="color: #aebed8;">()</span>;
                <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #aebed8;">(</span><span style="color: #61afef;">PreparedStatement</span> <span style="color: #61afef;">statement</span> = connection.prepareStatement<span style="color: #b0b0b3;">(</span>sql<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span> <span style="color: #aebed8;">{</span>
                    statement.setString<span style="color: #b0b0b3;">(</span>1, <span style="color: #98be65;">"Jake"</span><span style="color: #b0b0b3;">)</span>;
                    statement.setString<span style="color: #b0b0b3;">(</span>2, <span style="color: #98be65;">"United States"</span><span style="color: #b0b0b3;">)</span>;
                    <span style="color: #61afef;">int</span> <span style="color: #61afef;">rowsAffected</span> = statement.executeUpdate<span style="color: #b0b0b3;">()</span>;
                    System.out.println<span style="color: #b0b0b3;">(</span>rowsAffected + <span style="color: #98be65;">" row(s) inserted"</span><span style="color: #b0b0b3;">)</span>;
                <span style="color: #aebed8;">}</span>

                <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">UPDATE demo</span>
                <span style="color: #61afef;">String</span> <span style="color: #61afef;">userToUpdate</span> = <span style="color: #98be65;">"Nikita"</span>;
                System.out.print<span style="color: #aebed8;">(</span><span style="color: #98be65;">"Updating 'Location' for user '"</span> + userToUpdate + <span style="color: #98be65;">"', press ENTER to continue..."</span><span style="color: #aebed8;">)</span>;
                System.in.read<span style="color: #aebed8;">()</span>;
                sql = <span style="color: #98be65;">"UPDATE Employees SET Location = N'United States' WHERE Name = ?"</span>;
                <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #aebed8;">(</span><span style="color: #61afef;">PreparedStatement</span> <span style="color: #61afef;">statement</span> = connection.prepareStatement<span style="color: #b0b0b3;">(</span>sql<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span> <span style="color: #aebed8;">{</span>
                    statement.setString<span style="color: #b0b0b3;">(</span>1, userToUpdate<span style="color: #b0b0b3;">)</span>;
                    <span style="color: #61afef;">int</span> <span style="color: #61afef;">rowsAffected</span> = statement.executeUpdate<span style="color: #b0b0b3;">()</span>;
                    System.out.println<span style="color: #b0b0b3;">(</span>rowsAffected + <span style="color: #98be65;">" row(s) updated"</span><span style="color: #b0b0b3;">)</span>;
                <span style="color: #aebed8;">}</span>

                <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">DELETE demo</span>
                <span style="color: #61afef;">String</span> <span style="color: #61afef;">userToDelete</span> = <span style="color: #98be65;">"Jared"</span>;
                System.out.print<span style="color: #aebed8;">(</span><span style="color: #98be65;">"Deleting user '"</span> + userToDelete + <span style="color: #98be65;">"', press ENTER to continue..."</span><span style="color: #aebed8;">)</span>;
                System.in.read<span style="color: #aebed8;">()</span>;
                sql = <span style="color: #98be65;">"DELETE FROM Employees WHERE Name = ?;"</span>;
                <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #aebed8;">(</span><span style="color: #61afef;">PreparedStatement</span> <span style="color: #61afef;">statement</span> = connection.prepareStatement<span style="color: #b0b0b3;">(</span>sql<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span> <span style="color: #aebed8;">{</span>
                    statement.setString<span style="color: #b0b0b3;">(</span>1, userToDelete<span style="color: #b0b0b3;">)</span>;
                    <span style="color: #61afef;">int</span> <span style="color: #61afef;">rowsAffected</span> = statement.executeUpdate<span style="color: #b0b0b3;">()</span>;
                    System.out.println<span style="color: #b0b0b3;">(</span>rowsAffected + <span style="color: #98be65;">" row(s) deleted"</span><span style="color: #b0b0b3;">)</span>;
                <span style="color: #aebed8;">}</span>

                <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">READ demo</span>
                System.out.print<span style="color: #aebed8;">(</span><span style="color: #98be65;">"Reading data from table, press ENTER to continue..."</span><span style="color: #aebed8;">)</span>;
                System.in.read<span style="color: #aebed8;">()</span>;
                sql = <span style="color: #98be65;">"SELECT Id, Name, Location FROM Employees;"</span>;
                <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #aebed8;">(</span><span style="color: #61afef;">Statement</span> <span style="color: #61afef;">statement</span> = connection.createStatement<span style="color: #b0b0b3;">()</span>;
                        <span style="color: #61afef;">ResultSet</span> <span style="color: #61afef;">resultSet</span> = statement.executeQuery<span style="color: #b0b0b3;">(</span>sql<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span> <span style="color: #aebed8;">{</span>
                    <span style="color: #c678dd; font-weight: bold;">while</span> <span style="color: #b0b0b3;">(</span>resultSet.next<span style="color: #90a890;">()</span><span style="color: #b0b0b3;">)</span> <span style="color: #b0b0b3;">{</span>
                        System.out.println<span style="color: #90a890;">(</span>
                                resultSet.getInt<span style="color: #a2b6da;">(</span>1<span style="color: #a2b6da;">)</span> + <span style="color: #98be65;">" "</span> + resultSet.getString<span style="color: #a2b6da;">(</span>2<span style="color: #a2b6da;">)</span> + <span style="color: #98be65;">" "</span> + resultSet.getString<span style="color: #a2b6da;">(</span>3<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>;
                    <span style="color: #b0b0b3;">}</span>
                <span style="color: #aebed8;">}</span>
                connection.close<span style="color: #aebed8;">()</span>;
                System.out.println<span style="color: #aebed8;">(</span><span style="color: #98be65;">"All done."</span><span style="color: #aebed8;">)</span>;
            <span style="color: #97b098;">}</span>
        <span style="color: #b0b1a3;">}</span> <span style="color: #c678dd; font-weight: bold;">catch</span> <span style="color: #b0b1a3;">(</span><span style="color: #61afef;">Exception</span> <span style="color: #61afef;">e</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
            System.out.println<span style="color: #97b098;">()</span>;
            e.printStackTrace<span style="color: #97b098;">()</span>;
        <span style="color: #b0b1a3;">}</span>
    <span style="color: #93a8c6;">}</span>
<span style="color: #8c8c8c;">}</span>
</pre>
</div>
 </div> </details>
</div>
</div>

<div id="outline-container-org3ab397e" class="outline-3">
<h3 id="org3ab397e"><span class="section-number-3">6.5</span> 增加异常的处理，让代码更健壮</h3>
<div class="outline-text-3" id="text-6-5">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #c678dd; font-weight: bold;">public</span> <span style="color: #c678dd; font-weight: bold;">class</span> <span style="color: #61afef;">JDBCDemo</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #c678dd; font-weight: bold;">public</span> <span style="color: #c678dd; font-weight: bold;">static</span> <span style="color: #61afef;">void</span> <span style="color: #61afef;">main</span><span style="color: #93a8c6;">(</span><span style="color: #61afef;">String</span><span style="color: #b0b1a3;">[]</span> <span style="color: #61afef;">args</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>
        <span style="color: #61afef;">Connection</span> <span style="color: #61afef;">connection</span> = <span style="color: #da8548; font-weight: bold;">null</span>;
        <span style="color: #61afef;">Statement</span> <span style="color: #61afef;">statement</span> = <span style="color: #da8548; font-weight: bold;">null</span>;
        <span style="color: #61afef;">ResultSet</span> <span style="color: #61afef;">resultset</span> = <span style="color: #da8548; font-weight: bold;">null</span>;
        <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #b0b1a3;">{</span>
            <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">1. &#36830;&#25509;</span>
            <span style="color: #61afef;">String</span> <span style="color: #61afef;">url</span> = <span style="color: #98be65;">"jdbc:sqlserver://localhost:1434;databaseName=xxx;user=sa;password="</span>;
            connection = DriverManager.getConnection<span style="color: #97b098;">(</span>url<span style="color: #97b098;">)</span>;

            <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">2. &#20351;&#29992;</span>
            statement = connection.createStatement<span style="color: #97b098;">()</span>;

            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"create database aabbcc"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"use aabbcc"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"create table hello (id int, ttt varchar(20))"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"insert into hello values (1, 'aaa')"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"insert into hello values (2, 'bbb')"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"insert into hello values (3, 'ccc')"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"insert into hello values (4, 'ddd')"</span><span style="color: #97b098;">)</span>;

            resultset = statement.executeQuery<span style="color: #97b098;">(</span><span style="color: #98be65;">"select * from book"</span><span style="color: #97b098;">)</span>;
            <span style="color: #c678dd; font-weight: bold;">while</span> <span style="color: #97b098;">(</span>resultset.next<span style="color: #aebed8;">()</span><span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                <span style="color: #61afef;">int</span> <span style="color: #61afef;">id</span> = resultset.getInt<span style="color: #aebed8;">(</span>1<span style="color: #aebed8;">)</span>;
                <span style="color: #61afef;">String</span> <span style="color: #61afef;">name</span> = resultset.getString<span style="color: #aebed8;">(</span>2<span style="color: #aebed8;">)</span>;
                <span style="color: #61afef;">float</span> <span style="color: #61afef;">price</span> = resultset.getFloat<span style="color: #aebed8;">(</span>3<span style="color: #aebed8;">)</span>;
                System.out.println<span style="color: #aebed8;">(</span><span style="color: #98be65;">"id: "</span> + id + <span style="color: #98be65;">" name: "</span> + name + <span style="color: #98be65;">" price: "</span> + price<span style="color: #aebed8;">)</span>;
            <span style="color: #97b098;">}</span>
        <span style="color: #b0b1a3;">}</span> <span style="color: #c678dd; font-weight: bold;">catch</span> <span style="color: #b0b1a3;">(</span><span style="color: #61afef;">Exception</span> <span style="color: #61afef;">e</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
            System.out.println<span style="color: #97b098;">(</span><span style="color: #98be65;">"&#25968;&#25454;&#24211;&#36830;&#25509;&#30340;&#26102;&#20505;&#20986;&#29616;&#20102;&#38169;&#35823;: "</span> + e.getMessage<span style="color: #aebed8;">()</span><span style="color: #97b098;">)</span>;
        <span style="color: #b0b1a3;">}</span> <span style="color: #c678dd; font-weight: bold;">finally</span> <span style="color: #b0b1a3;">{</span>
            <span style="color: #c678dd; font-weight: bold;">if</span> <span style="color: #97b098;">(</span>resultset != <span style="color: #da8548; font-weight: bold;">null</span><span style="color: #97b098;">)</span>
                <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #97b098;">{</span>
                    resultset.close<span style="color: #aebed8;">()</span>;
                <span style="color: #97b098;">}</span> <span style="color: #c678dd; font-weight: bold;">catch</span> <span style="color: #97b098;">(</span><span style="color: #61afef;">SQLException</span> <span style="color: #61afef;">e</span><span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                <span style="color: #97b098;">}</span>
            <span style="color: #c678dd; font-weight: bold;">if</span> <span style="color: #97b098;">(</span>statement != <span style="color: #da8548; font-weight: bold;">null</span><span style="color: #97b098;">)</span>
                <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #97b098;">{</span>
                    statement.close<span style="color: #aebed8;">()</span>;
                <span style="color: #97b098;">}</span> <span style="color: #c678dd; font-weight: bold;">catch</span> <span style="color: #97b098;">(</span><span style="color: #61afef;">SQLException</span> <span style="color: #61afef;">e</span><span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                <span style="color: #97b098;">}</span>
            <span style="color: #c678dd; font-weight: bold;">if</span> <span style="color: #97b098;">(</span>connection != <span style="color: #da8548; font-weight: bold;">null</span><span style="color: #97b098;">)</span>
                <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #97b098;">{</span>
                    connection.close<span style="color: #aebed8;">()</span>;
                <span style="color: #97b098;">}</span> <span style="color: #c678dd; font-weight: bold;">catch</span> <span style="color: #97b098;">(</span><span style="color: #61afef;">SQLException</span> <span style="color: #61afef;">e</span><span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                <span style="color: #97b098;">}</span>
        <span style="color: #b0b1a3;">}</span>
    <span style="color: #93a8c6;">}</span>
<span style="color: #8c8c8c;">}</span>
</pre>
</div>

<p>
请大家务必要去了解为什么关闭语句要写得这么复杂！
</p>
</div>
</div>

<div id="outline-container-orgf677b2d" class="outline-3">
<h3 id="orgf677b2d"><span class="section-number-3">6.6</span> 基于上述的代码，对相关的处理逻辑进行封装 (复用)</h3>
<div class="outline-text-3" id="text-6-6">
<p>
业务类:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #c678dd; font-weight: bold;">public</span> <span style="color: #c678dd; font-weight: bold;">class</span> <span style="color: #61afef;">JDBCDemo</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #c678dd; font-weight: bold;">public</span> <span style="color: #c678dd; font-weight: bold;">static</span> <span style="color: #61afef;">void</span> <span style="color: #61afef;">main</span><span style="color: #93a8c6;">(</span><span style="color: #61afef;">String</span><span style="color: #b0b1a3;">[]</span> <span style="color: #61afef;">args</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>
        <span style="color: #61afef;">Connection</span> <span style="color: #61afef;">connection</span> = <span style="color: #da8548; font-weight: bold;">null</span>;
        <span style="color: #61afef;">Statement</span> <span style="color: #61afef;">statement</span> = <span style="color: #da8548; font-weight: bold;">null</span>;
        <span style="color: #61afef;">ResultSet</span> <span style="color: #61afef;">resultset</span> = <span style="color: #da8548; font-weight: bold;">null</span>;
        <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #b0b1a3;">{</span>
            <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">1. &#36830;&#25509;</span>
            connection = Xxx.getConnection<span style="color: #97b098;">()</span>;

            <span style="color: #687080; font-style: italic;">// </span><span style="color: #687080; font-style: italic;">2. &#20351;&#29992;</span>
            statement = connection.createStatement<span style="color: #97b098;">()</span>;

            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"create database aabbcc"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"use aabbcc"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"create table hello (id int, ttt varchar(20))"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"insert into hello values (1, 'aaa')"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"insert into hello values (2, 'bbb')"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"insert into hello values (3, 'ccc')"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"insert into hello values (4, 'ddd')"</span><span style="color: #97b098;">)</span>;

            resultset = statement.executeQuery<span style="color: #97b098;">(</span><span style="color: #98be65;">"select * from book"</span><span style="color: #97b098;">)</span>;
            <span style="color: #c678dd; font-weight: bold;">while</span> <span style="color: #97b098;">(</span>resultset.next<span style="color: #aebed8;">()</span><span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                <span style="color: #61afef;">int</span> <span style="color: #61afef;">id</span> = resultset.getInt<span style="color: #aebed8;">(</span>1<span style="color: #aebed8;">)</span>;
                <span style="color: #61afef;">String</span> <span style="color: #61afef;">name</span> = resultset.getString<span style="color: #aebed8;">(</span>2<span style="color: #aebed8;">)</span>;
                <span style="color: #61afef;">float</span> <span style="color: #61afef;">price</span> = resultset.getFloat<span style="color: #aebed8;">(</span>3<span style="color: #aebed8;">)</span>;
                System.out.println<span style="color: #aebed8;">(</span><span style="color: #98be65;">"id: "</span> + id + <span style="color: #98be65;">" name: "</span> + name + <span style="color: #98be65;">" price: "</span> + price<span style="color: #aebed8;">)</span>;
            <span style="color: #97b098;">}</span>
        <span style="color: #b0b1a3;">}</span> <span style="color: #c678dd; font-weight: bold;">catch</span> <span style="color: #b0b1a3;">(</span><span style="color: #61afef;">Exception</span> <span style="color: #61afef;">e</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
            System.out.println<span style="color: #97b098;">(</span><span style="color: #98be65;">"&#25968;&#25454;&#24211;&#36830;&#25509;&#30340;&#26102;&#20505;&#20986;&#29616;&#20102;&#38169;&#35823;: "</span> + e.getMessage<span style="color: #aebed8;">()</span><span style="color: #97b098;">)</span>;
        <span style="color: #b0b1a3;">}</span> <span style="color: #c678dd; font-weight: bold;">finally</span> <span style="color: #b0b1a3;">{</span>
            Xxx.closeDBResources<span style="color: #97b098;">(</span>connection, statement, resultset<span style="color: #97b098;">)</span>;
        <span style="color: #b0b1a3;">}</span>
    <span style="color: #93a8c6;">}</span>
<span style="color: #8c8c8c;">}</span>
</pre>
</div>

<p>
辅助类:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #c678dd; font-weight: bold;">public</span> <span style="color: #c678dd; font-weight: bold;">class</span> <span style="color: #61afef;">Xxx</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #c678dd; font-weight: bold;">public</span> <span style="color: #c678dd; font-weight: bold;">static</span> <span style="color: #61afef;">Connection</span> <span style="color: #61afef;">getConnection</span><span style="color: #93a8c6;">()</span> <span style="color: #c678dd; font-weight: bold;">throws</span> <span style="color: #61afef;">SQLException</span> <span style="color: #93a8c6;">{</span>
        <span style="color: #61afef;">String</span> <span style="color: #61afef;">url</span> = <span style="color: #98be65;">"jdbc:sqlserver://localhost:1434;databaseName=xxx;user=sa;password="</span>;
        <span style="color: #c678dd; font-weight: bold;">return</span> DriverManager.getConnection<span style="color: #b0b1a3;">(</span>url<span style="color: #b0b1a3;">)</span>;
    <span style="color: #93a8c6;">}</span>
    <span style="color: #c678dd; font-weight: bold;">public</span> <span style="color: #c678dd; font-weight: bold;">static</span> <span style="color: #61afef;">void</span> <span style="color: #61afef;">closeDBResources</span><span style="color: #93a8c6;">(</span><span style="color: #61afef;">Connection</span> <span style="color: #61afef;">connection</span>, <span style="color: #61afef;">Statement</span> <span style="color: #61afef;">statement</span>, <span style="color: #61afef;">ResultSet</span> <span style="color: #61afef;">resultset</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>
        <span style="color: #c678dd; font-weight: bold;">if</span> <span style="color: #b0b1a3;">(</span>resultset != <span style="color: #da8548; font-weight: bold;">null</span><span style="color: #b0b1a3;">)</span>
            <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #b0b1a3;">{</span>
                resultset.close<span style="color: #97b098;">()</span>;
            <span style="color: #b0b1a3;">}</span> <span style="color: #c678dd; font-weight: bold;">catch</span> <span style="color: #b0b1a3;">(</span><span style="color: #61afef;">SQLException</span> <span style="color: #61afef;">e</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
            <span style="color: #b0b1a3;">}</span>
        <span style="color: #c678dd; font-weight: bold;">if</span> <span style="color: #b0b1a3;">(</span>statement != <span style="color: #da8548; font-weight: bold;">null</span><span style="color: #b0b1a3;">)</span>
            <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #b0b1a3;">{</span>
                statement.close<span style="color: #97b098;">()</span>;
            <span style="color: #b0b1a3;">}</span> <span style="color: #c678dd; font-weight: bold;">catch</span> <span style="color: #b0b1a3;">(</span><span style="color: #61afef;">SQLException</span> <span style="color: #61afef;">e</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
            <span style="color: #b0b1a3;">}</span>
        <span style="color: #c678dd; font-weight: bold;">if</span> <span style="color: #b0b1a3;">(</span>connection != <span style="color: #da8548; font-weight: bold;">null</span><span style="color: #b0b1a3;">)</span>
            <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #b0b1a3;">{</span>
                connection.close<span style="color: #97b098;">()</span>;
            <span style="color: #b0b1a3;">}</span> <span style="color: #c678dd; font-weight: bold;">catch</span> <span style="color: #b0b1a3;">(</span><span style="color: #61afef;">SQLException</span> <span style="color: #61afef;">e</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
            <span style="color: #b0b1a3;">}</span>
    <span style="color: #93a8c6;">}</span>
<span style="color: #8c8c8c;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6c49b0" class="outline-3">
<h3 id="orga6c49b0"><span class="section-number-3">6.7</span> 使用 Try-With-Resource 进行资源的释放</h3>
<div class="outline-text-3" id="text-6-7">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #c678dd; font-weight: bold;">public</span> <span style="color: #c678dd; font-weight: bold;">class</span> <span style="color: #61afef;">JDBCDemo</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #c678dd; font-weight: bold;">public</span> <span style="color: #c678dd; font-weight: bold;">static</span> <span style="color: #61afef;">void</span> <span style="color: #61afef;">main</span><span style="color: #93a8c6;">(</span><span style="color: #61afef;">String</span><span style="color: #b0b1a3;">[]</span> <span style="color: #61afef;">args</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>
        <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #b0b1a3;">(</span><span style="color: #61afef;">Connection</span> <span style="color: #61afef;">connection</span> = Xxx.getConnection<span style="color: #97b098;">()</span>; <span style="color: #61afef;">Statement</span> <span style="color: #61afef;">statement</span> = connection.createStatement<span style="color: #97b098;">()</span>;<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"create database aabbcc"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"use aabbcc"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"create table hello (id int, ttt varchar(20))"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"insert into hello values (1, 'aaa')"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"insert into hello values (2, 'bbb')"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"insert into hello values (3, 'ccc')"</span><span style="color: #97b098;">)</span>;
            statement.executeUpdate<span style="color: #97b098;">(</span><span style="color: #98be65;">"insert into hello values (4, 'ddd')"</span><span style="color: #97b098;">)</span>;

            <span style="color: #c678dd; font-weight: bold;">try</span> <span style="color: #97b098;">(</span><span style="color: #61afef;">ResultSet</span> <span style="color: #61afef;">resultset</span> = statement.executeQuery<span style="color: #aebed8;">(</span><span style="color: #98be65;">"select * from book"</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                <span style="color: #c678dd; font-weight: bold;">while</span> <span style="color: #aebed8;">(</span>resultset.next<span style="color: #b0b0b3;">()</span><span style="color: #aebed8;">)</span> <span style="color: #aebed8;">{</span>
                    <span style="color: #61afef;">int</span> <span style="color: #61afef;">id</span> = resultset.getInt<span style="color: #b0b0b3;">(</span>1<span style="color: #b0b0b3;">)</span>;
                    <span style="color: #61afef;">String</span> <span style="color: #61afef;">name</span> = resultset.getString<span style="color: #b0b0b3;">(</span>2<span style="color: #b0b0b3;">)</span>;
                    <span style="color: #61afef;">float</span> <span style="color: #61afef;">price</span> = resultset.getFloat<span style="color: #b0b0b3;">(</span>3<span style="color: #b0b0b3;">)</span>;
                    System.out.println<span style="color: #b0b0b3;">(</span><span style="color: #98be65;">"id: "</span> + id + <span style="color: #98be65;">" name: "</span> + name + <span style="color: #98be65;">" price: "</span> + price<span style="color: #b0b0b3;">)</span>;
                <span style="color: #aebed8;">}</span>
            <span style="color: #97b098;">}</span>
        <span style="color: #b0b1a3;">}</span> <span style="color: #c678dd; font-weight: bold;">catch</span> <span style="color: #b0b1a3;">(</span><span style="color: #61afef;">Exception</span> <span style="color: #61afef;">e</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
            System.out.println<span style="color: #97b098;">(</span><span style="color: #98be65;">"&#25968;&#25454;&#24211;&#36830;&#25509;&#30340;&#26102;&#20505;&#20986;&#29616;&#20102;&#38169;&#35823;: "</span> + e.getMessage<span style="color: #aebed8;">()</span><span style="color: #97b098;">)</span>;
        <span style="color: #b0b1a3;">}</span>
    <span style="color: #93a8c6;">}</span>
<span style="color: #8c8c8c;">}</span>
</pre>
</div>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 孙悟空</p>
<p class="date">Created: 2021-01-22</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
