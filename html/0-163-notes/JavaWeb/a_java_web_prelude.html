<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2021-05-20 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Java Web 起步</title>
<meta name="generator" content="Org mode">
<meta name="author" content="悟饭">
<link rel='stylesheet' href='/html/asset/common.css?3344' />
<link rel='stylesheet' href='/yaoliuyao/html/asset/common.css?3344' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/html/asset/common.js'></script>
<script src='/yaoliuyao/html/asset/common.js'></script>

<style>
 /* From: https://endlessparentheses.com/public/css/endless.css */
 .special-kbd {
   color: #333;
   background-color: #f7f7f7;
   border: 1px solid #ccc;
   border-radius: 6px;
   box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
   display: inline-block;
   font-family: 'Droid Sans Mono', monospace;
   font-size: 80%;
   font-weight: normal;
   line-height: inherit;
   margin: 2px .1em;
   padding: .04em .4em;
   text-shadow: 0 1px 0 #fff;
   word-spacing: -3px;
 }
</style>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",
        "HTML-CSS": { scale: 100, linebreaks: { automatic: "false" }, webFont: "TeX" },
        SVG: {scale: 100, linebreaks: { automatic: "false" }, font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"}, MultLineWidth: "85%", TagSide: "right", TagIndent: ".8em" }
    });
</script>
<script src="https://cdn.bootcdn.net/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML" async></script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">Java Web 起步</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org9faf83e">1. CS vs BS</a></li>
<li><a href="#org9b733de">2. 准备工作</a>
<ul>
<li><a href="#orgc5c3cc6">2.1. 下载安装 Chrome 浏览器</a></li>
<li><a href="#orgd524a8a">2.2. 下载安装 JDK8</a>
<ul>
<li><a href="#org0ba77d1">2.2.1. 配置环境变量</a></li>
</ul>
</li>
<li><a href="#orgf7c7421">2.3. 服务器 tomcat 的安装</a></li>
<li><a href="#org61e2776">2.4. 第一个 Java Web 程序</a></li>
<li><a href="#org91c2e69">2.5. 下载、安装 Eclipse 集成开发环境</a></li>
</ul>
</li>
<li><a href="#orga5c57fe">3. 使用 Eclipse 创建第一个 Java Web 项目</a>
<ul>
<li><a href="#org4a47d93">3.1. 第零步，打开 Eclipse</a></li>
<li><a href="#orgf9a201d">3.2. 第一步，创建一个 Dynamic Web Project</a></li>
<li><a href="#org3a16f2d">3.3. 第二步，[可选] 为新建的项目创建一个服务器</a></li>
<li><a href="#org902ad30">3.4. 第三步，创建我们的第一个动态页面</a></li>
<li><a href="#org69242a1">3.5. 最终章，启动服务器，看结果</a></li>
</ul>
</li>
<li><a href="#orgc1172f3">4. JS Event vs Java Servlet</a></li>
<li><a href="#org7a4d981">5. Browser 跟 Server 的数据互动</a>
<ul>
<li><a href="#orgb47aa17">5.1. 第一种方法，在超链接后增加参数</a></li>
<li><a href="#org63f53df">5.2. 第二种方法，使用 Form 表单</a></li>
<li><a href="#org3633896">5.3. 服务器获取参数的方式</a></li>
</ul>
</li>
<li><a href="#orge28d2a3">6. 案例分析 (○ 读取文件)</a>
<ul>
<li><a href="#org0697de0">6.1. 分析题目</a></li>
<li><a href="#orgb8c669c">6.2. 第一步，先创建项目</a></li>
<li><a href="#orgd59ce79">6.3. 第二步，实现逻辑，从文件夹获取随机文件</a></li>
<li><a href="#orgf01411d">6.4. 第三步，实现逻辑，从某个文件中读取文件内容</a></li>
<li><a href="#org562eab1">6.5. 第四步，将上面的两个逻辑，跟 Servlet 结合来实现请求效果</a></li>
</ul>
</li>
<li><a href="#org190370e">7. 案例分析 (↳ 写入文件)</a>
<ul>
<li><a href="#orgd3787ba">7.1. 首先，定义 /write.html 对应的 Servlet，完成写入功能</a></li>
<li><a href="#orgc0bfbfa">7.2. 使用 Form 表单的形式，对接上面的功能</a></li>
</ul>
</li>
<li><a href="#orgf699711">8. 案例分析 (↳ JDBC 重出江湖，使用数据库重构)</a>
<ul>
<li><a href="#org1b990e7">8.1. 表的设计</a></li>
<li><a href="#org3aec1c8">8.2. 查询操作 (/list)</a></li>
<li><a href="#org20cecf8">8.3. 异常处理 (try-with-resource)</a></li>
<li><a href="#orga9ecc24">8.4. 删除操作 (/del)</a></li>
<li><a href="#orgd2aad2e">8.5. 增加操作 (/add)</a>
<ul>
<li><a href="#org68645cb">8.5.1. 首先，我们需要一个请求 (/add) 和相对应的响应 (BookAddServlet)</a></li>
<li><a href="#org7cdd52c">8.5.2. 其次，我们需要在某页面上，使用 Form 表单简化用户触发添加书籍操作</a></li>
<li><a href="#orgf0bab19">8.5.3. 另外，我们将 renderMessageString 抽取到了单独的类中，方便公用</a></li>
</ul>
</li>
<li><a href="#orgc3e236e">8.6. 修改操作 (/edit)</a>
<ul>
<li><a href="#orgacd5c0c">8.6.1. 将请求分为两种，一种是 GET /edit 用来显示修改的页面，一种是 POST /edit 用来执行修改操作</a></li>
<li><a href="#org7926550">8.6.2. 然后，在 /list 页面上增加响应的入口</a></li>
<li><a href="#org9aed62c">8.6.3. 其他，做一些调整即可</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orge5fc8a4">9. 案例分析 (↳ Statement → PreparedStatement)</a>
<ul>
<li><a href="#orge0120b7">9.1. /list</a></li>
<li><a href="#org7d71ae5">9.2. /del</a></li>
<li><a href="#orgb817e0f">9.3. /add</a></li>
<li><a href="#orgd5f0a3c">9.4. /edit</a></li>
</ul>
</li>
<li><a href="#org0c95457">10. 案例分析 (↳ JSP - 革命性的视图改造)</a>
<ul>
<li><a href="#org5b7d7e6">10.1. 苦逼的临时工</a></li>
<li><a href="#orgb5289ce">10.2. 进击的临时工</a></li>
<li><a href="#org392aca2">10.3. 转正的临时工 (分工的革命)</a>
<ul>
<li><a href="#org76faa71">10.3.1. /list</a></li>
<li><a href="#org028d559">10.3.2. /del</a></li>
<li><a href="#orgfcd1334">10.3.3. /add</a></li>
<li><a href="#orgf9bdb4d">10.3.4. /edit</a></li>
<li><a href="#org29bf4b4">10.3.5. 通用的 /bookResult.jsp</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgbddc86f">11. 案例分析 (↳ 编码设置)</a></li>
<li><a href="#org39ed6e2">12. 案例分析 (↳ 访问日志)</a>
<ul>
<li><a href="#org7da2b44">12.1. 首先，需要创建一张表，来承载访问的日志</a></li>
<li><a href="#org5711f37">12.2. 然后，写一个方法，能从 Java 中对这张表进行插入操作</a></li>
<li><a href="#org7eb6631">12.3. 之后[可选] 写一个 main 方法测试一下 insert 到底好不好使</a></li>
<li><a href="#orgc0a6094">12.4. 随后，就可以将上面的 insert 跟我们系统的 Filter 结合了</a></li>
<li><a href="#org7b28f71">12.5. 接下来，在我们实现的 Filter 上面添加地址映射</a></li>
<li><a href="#org23231c6">12.6. 最后，启动服务器，检验结果</a></li>
</ul>
</li>
<li><a href="#org06f2ea0">13. 案例分析 (↳ 重构代码结构)</a>
<ul>
<li><a href="#org7f123b2">13.1. 代码结构，拆分</a></li>
<li><a href="#orgb798fba">13.2. 重点是 BookDAO.java</a></li>
<li><a href="#org41ed1dc">13.3. 其他 BookXxxServlet 就可以将操作数据库的代码进行修改了</a>
<ul>
<li><a href="#org498b9cd">13.3.1. BookListServlet</a></li>
<li><a href="#orge8347d7">13.3.2. BookAddServlet</a></li>
<li><a href="#org7e29cf8">13.3.3. BookDelServlet</a></li>
<li><a href="#org9ea94d6">13.3.4. BookEditServlet</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgef9e78f">14. 案例分析 (↳ 用户的注册和登录)</a>
<ul>
<li><a href="#org984fd24">14.1. 注册</a>
<ul>
<li><a href="#orgdda54f1">14.1.1. 分析问题</a></li>
<li><a href="#orge3f3428">14.1.2. 初步设计</a></li>
<li><a href="#orgefa5566">14.1.3. 实现步骤 [数据库创建表]</a></li>
<li><a href="#orga186d82">14.1.4. 实现步骤 [根据表，创建名为 Account 的 JavaBean 对象]</a></li>
<li><a href="#orgb86c9ce">14.1.5. 实现步骤 [然后就可以在 AccountDAO 中实现 insert 方法了]</a></li>
<li><a href="#orgd36c6e9">14.1.6. 实现步骤 [Servlet#get 方法的实现，用于显示注册页面]</a></li>
<li><a href="#org18ae952">14.1.7. 实现步骤 [Servlet#post 方法的实现，用于完成注册]</a></li>
<li><a href="#org107221a">14.1.8. 打完收工，阶段小结</a></li>
</ul>
</li>
<li><a href="#org46517c6">14.2. 登录</a>
<ul>
<li><a href="#org6e8c79f">14.2.1. 分析问题</a></li>
<li><a href="#org5a6b61c">14.2.2. 初步设计</a></li>
<li><a href="#org9586800">14.2.3. 先搞一个方法 AccountDAO#check 用来校验用户名和密码的正确性</a></li>
<li><a href="#org6ff0b00">14.2.4. 然后，搞一个 LoginServlet 写 get/post 方法，分别用来表示 form 表单和处理登录逻辑</a></li>
<li><a href="#org513e0cd">14.2.5. 最后，在其他页面上，建立到登录的入口</a></li>
</ul>
</li>
<li><a href="#orga0c1901">14.3. 注销</a></li>
<li><a href="#org250a3b0">14.4. 按照是否有登录，来限制某些业务</a></li>
</ul>
</li>
<li><a href="#orgec1af96">15. <span class="done CANCEL">CANCEL</span> 案例分析 (购物车的实现逻辑)</a></li>
<li><a href="#org36f11b7">16. 案例分析 (↳ 简化JSP，EL表达式+JSTL 标签)</a>
<ul>
<li><a href="#orgf5a1eab">16.1. bookList.jsp 中的登录、注册</a></li>
<li><a href="#org382672e">16.2. bookList.jsp 中的表格渲染</a></li>
<li><a href="#org6f1a828">16.3. login/result.jsp 页面</a></li>
</ul>
</li>
<li><a href="#org9cfc9c2">17. 案例分析 (● 结束)</a></li>
<li><a href="#org56794cc">18. 注册和登录 (复盘)</a>
<ul>
<li><a href="#orgb1de8a6">18.1. 预览</a></li>
<li><a href="#orga8590e8">18.2. 首先第一步，要分析题目</a></li>
<li><a href="#org0402a46">18.3. 创建一个动态 Web 项目，复制一些必要文件</a></li>
<li><a href="#orgbaf2a3f">18.4. 然后，创建所需要的表</a></li>
<li><a href="#org185d6a8">18.5. 之后，在 bean 包下创建 User.java</a></li>
<li><a href="#orge040de5">18.6. 随后，为接下来的业务，封装数据库操作的逻辑 (dao)</a></li>
<li><a href="#org63ade75">18.7. 准备工作完成，实现注册</a></li>
<li><a href="#org793ab7f">18.8. 最后，是登录的逻辑</a></li>
</ul>
</li>
<li><a href="#orgd2549e9">19. 手机的增删改查 (复盘)</a>
<ul>
<li><a href="#org1693c2b">19.1. 综述</a></li>
<li><a href="#org3b43673">19.2. 视频步骤</a></li>
<li><a href="#orge230ba0">19.3. 修改功能</a></li>
<li><a href="#orge79334d">19.4. 搜索功能</a></li>
<li><a href="#orgd983be8">19.5. 仓库及代码</a></li>
</ul>
</li>
<li><a href="#org6141a6e">20. 考试上机</a></li>
</ul>
</div>
</nav>

<section id="outline-container-org9faf83e" class="outline-2">
<h2 id="org9faf83e"><span class="section-number-2">1.</span> CS vs BS</h2>
<div class="outline-text-2" id="text-1">
<p>
CS 架构:
</p>
<ul class="org-ul">
<li>Client-Server，客户端-服务端</li>
<li>客户端需要你亲自去写，服务器也是</li>
<li>缺点:
<ul class="org-ul">
<li>开发人员比较烦: 写客户端需要做的事太多了，太麻烦了</li>
<li>用户也比较烦: 我要使用一定功能，必须要先 <b>下载、安装</b> 客户端</li>
</ul></li>
<li>优点:
<ul class="org-ul">
<li>非常灵活，我想怎么写就怎么写</li>
<li>非常安全</li>
</ul></li>
</ul>

<p>
BS 架构:
</p>
<ul class="org-ul">
<li>Browser-Server，浏览器-服务端</li>
<li>优点:
<ul class="org-ul">
<li>开发起来比较简单，修改维护起来也简单，开发的成本变低了，开发的效率变高了</li>
<li>用户也开始开心起来了，只要打开浏览器，输入 url 地址，访问即可</li>
</ul></li>
<li>缺点：
<ul class="org-ul">
<li>某些方面，功能是受限的</li>
<li>必须要考虑各种兼容性的问题。有时候解决兼容性问题带来的成本会非常非常高</li>
<li>所有的代码都是通过 html/css/js 来实现的，这种方式的客户端实现的代码是透明的。在某些场景之下不具备保密的特点</li>
</ul></li>
</ul>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
  <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">img</span> src=xxx.jpg <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">"width: 200px; height: 300px; padding: 2em"</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div>

<p>
根据项目的实际情况，选择适合的方式进行开发。总之:
</p>

<p>
能使用 BS 架构的，就要使用 BS 架构。因为，它简单、成本低、效率高。
</p>

<p>
作为 BS 架构:
</p>
<ol class="org-ol">
<li>客户端使用的是 html/js/css 创建页面</li>
<li>HTTP 协议</li>
<li>服务端，可以使用 <b>Java</b> /.net/C++/Python/Ruby/PHP</li>
</ol>
</div>
</section>

<section id="outline-container-org9b733de" class="outline-2">
<h2 id="org9b733de"><span class="section-number-2">2.</span> 准备工作</h2>
<div class="outline-text-2" id="text-2">
<p>
需要的工具或者软件:
</p>
<ol class="org-ol">
<li><b>符合标准</b> 的浏览器 (Chrome/Edge)</li>
<li>Java 编程语言 (JDK8, Java Development Kit)</li>
<li>服务器 (Tomcat/Jetty)</li>
<li>[可选项] 需要一个趁手的编辑器，最好是 IDE (Eclipse/Intellj Idea)</li>
</ol>
</div>

<div id="outline-container-orgc5c3cc6" class="outline-3">
<h3 id="orgc5c3cc6"><span class="section-number-3">2.1.</span> 下载安装 Chrome 浏览器</h3>
<div class="outline-text-3" id="text-2-1">
<p>
请大家自行安装
</p>
</div>
</div>

<div id="outline-container-orgd524a8a" class="outline-3">
<h3 id="orgd524a8a"><span class="section-number-3">2.2.</span> 下载安装 JDK8</h3>
<div class="outline-text-3" id="text-2-2">
<p>
基本步骤:
</p>
<ol class="org-ol">
<li>打开浏览器，输入 jdk8 进行搜索，得到地址 <a href="https://www.oracle.com/cn/java/technologies/javase/javase-jdk8-downloads.html">https://www.oracle.com/cn/java/technologies/javase/javase-jdk8-downloads.html</a></li>
<li>进入页面，找到 windows_x64 的版本，下载</li>
<li>双击，安装</li>
</ol>

<p>
安装完，得到的最重要的两个命令:
</p>
<ol class="org-ol">
<li>javac，用来将 java 文本文件 <b>编译</b> 成 class 文件</li>
<li>java，用来将 class 文件放到 jvm 环境中 <b>运行</b></li>
</ol>

<p>
使用举例 (e:\demo\Hello.java):
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Hello</span> <span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">public &#26435;&#38480;&#65292;&#22806;&#37096;&#21487;&#20197;&#35775;&#38382;&#30340;&#12289;&#20844;&#24320;&#30340;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">static &#38745;&#24577;&#30340;&#65292;&#19981;&#38656;&#35201; new &#21019;&#24314;&#23454;&#20363;&#65292;&#21363;&#21487;&#35843;&#29992;&#30340;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">void   &#36820;&#22238;&#20540;&#65292;&#36820;&#22238;&#20026;&#31354;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">main   &#20989;&#25968;&#21517;&#65292;&#20837;&#21475;&#20989;&#25968; (&#40664;&#35748;&#20250;&#25191;&#34892;&#30340;&#26041;&#27861;)</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">aaa    &#29992;&#25143;&#30340;&#36755;&#20837;&#65292;&#26159;&#19968;&#20010;&#23383;&#31526;&#20018;&#25968;&#32452;</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">aaa</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25105;&#35201;&#25171;&#21360;&#21442;&#25968;&#20102;"</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span> = 0; i &lt; aaa.<span style="color: #228b22;">length</span>; i++<span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            System.out.println<span style="color: #709870;">(</span>i + <span style="color: #8b2252;">" : "</span> + aaa<span style="color: #907373;">[</span>i<span style="color: #907373;">]</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25171;&#21360;&#32467;&#26463;. &#24635;&#20849;&#25171;&#21360;&#20102; "</span> + aaa.length + <span style="color: #8b2252;">" &#20010;&#21442;&#25968;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bat"><span style="color: #b22222;">REM </span><span style="color: #b22222;">0. &#20999;&#25442;&#21040;&#30456;&#24212;&#30446;&#24405;</span>
<span style="color: #483d8b;">cd</span> e:\demo

<span style="color: #b22222;">REM </span><span style="color: #b22222;">1. &#32534;&#35793;&#65292;&#24471;&#21040;&#19968;&#20010; Hello.class</span>
<span style="color: #8b2252;">"C:\Program Files\Java\jdk1.8.0_231\bin\javac.exe"</span> Hello.java

<span style="color: #b22222;">REM </span><span style="color: #b22222;">2. &#25191;&#34892;&#65292;&#36755;&#20986;&#32467;&#26524;</span>
<span style="color: #8b2252;">"C:\Program Files\Java\jdk1.8.0_231\bin\java.exe"</span> Hello
</pre>
</div>
</div>

<div id="outline-container-org0ba77d1" class="outline-4">
<h4 id="org0ba77d1"><span class="section-number-4">2.2.1.</span> 配置环境变量</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
首先，配置，使得可以方便地调用 javac/java 命令。
</p>

<pre class="example" id="orgb58edd7">
命令行窗口，执行一个命令，那么它需要找到一个对应的可执行文件去执行，其寻找顺序为:
1. 如果当前的命令是全路径的话 (c:\xxx\javac.exe)，则使用路径指定的可执行文件
2. 查看当前目录下面有没有对应的文件 (.\javac.exe)，如果有，那么使用它
3. 查看系统中的 Path 变量 (实际就是使用 ; 分割的一系列文件夹)，然后逐个(文件夹)搜索下面有没有相应可执行文件，找到则使用之
4. 如果上面步骤结束，还是找到，那么报错

因此，如果想让某个命令方便被调用，有如下解决方案:
1. 在窗口中使用 set 重新设置 Path 的值，将命令所在的文件夹添加到 Path 中:
   : set Path=%Path%;c:\xxx\yyy\bin;
2. Windows 提供了一种机制，叫环境变量。可以用来设置全局的默认 Path 以及其他全局的值。

注意:
- 环境变量中 Path 只是比较特殊的一种，除此之外，还有其他相关的一些可能被不同程序依赖，不要轻易删除。
- 在修改之前，最好拷贝出来。如果修改失败，可以重新复制回去
</pre>

<p>
总而言之，环境变量的设置，两点:
</p>
<ol class="org-ol">
<li>添加 JAVA_HOME，对应的值为 JDK 的安装根目录。这个变量将会被 Tomcat 等软件使用到</li>
<li>修改 PATH，将 javac.exe 所在文件夹，追加到后面。这样，就可以在命令行创建直接调用 javac 了</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orgf7c7421" class="outline-3">
<h3 id="orgf7c7421"><span class="section-number-3">2.3.</span> 服务器 tomcat 的安装</h3>
<div class="outline-text-3" id="text-2-3">
<p>
流行的服务器:
</p>
<ul class="org-ul">
<li>Apache Tomcat，开源、免费的</li>
<li>Jetty，免费、开源，不同的机制，速度更有优势</li>
<li>Weblogic，原先属于 BEA，现在已经被 Oracle 收购了</li>
<li>Websphere，属于 IBM 的产品</li>
<li>JBoss，相对于来说，很全面很大</li>
</ul>

<p>
Tomcat:
</p>
<ol class="org-ol">
<li>下载 Tomcat，<a href="https://mirror.bit.edu.cn/apache/tomcat/tomcat-8/v8.5.57/bin/apache-tomcat-8.5.57-windows-x64.zip">https://mirror.bit.edu.cn/apache/tomcat/tomcat-8/v8.5.57/bin/apache-tomcat-8.5.57-windows-x64.zip</a></li>
<li>随便解压到某个目录</li>
</ol>
</div>
</div>

<div id="outline-container-org61e2776" class="outline-3">
<h3 id="org61e2776"><span class="section-number-3">2.4.</span> 第一个 Java Web 程序</h3>
<div class="outline-text-3" id="text-2-4">
<p>
首先，在某个文件夹，创建文件 HelloWeb.java:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">io</span>.*;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.*;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #008b8b;">http</span>.*;

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">HelloWeb</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">IOException</span>, <span style="color: #228b22;">ServletException</span> <span style="color: #7388d6;">{</span>
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"This the first Web Application"</span><span style="color: #909183;">)</span>;
        resp.getWriter<span style="color: #909183;">()</span>.write<span style="color: #909183;">(</span><span style="color: #8b2252;">"&lt;html&gt;&lt;h3&gt;Hello, Web&lt;/h3&gt;&lt;script&gt;alert('hello web')&lt;/script&gt;&lt;/html&gt;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
然后，需要将其 <b>编译</b> 成 class 文件:
</p>
<div class="org-src-container">
<pre class="src src-bat">javac -<span style="color: #228b22;">classpath</span> C:\app\apache-tomcat-8.5.57\lib\servlet-api.jar HelloWeb.java
</pre>
</div>

<p>
接下来，将 HelloWeb.class 文件，复制到 $TOMCAT/webapps/ROOT/WEB-INF/classes 文件夹下面。
</p>

<p>
然后，修改 $TOMCAT/webapps/ROOT/WEB-INF/web.xml:
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #0000ff;">servlet</span>&gt;
  &lt;<span style="color: #0000ff;">servlet-name</span>&gt;aaa&lt;/<span style="color: #0000ff;">servlet-name</span>&gt;
  &lt;<span style="color: #0000ff;">servlet-class</span>&gt;HelloWeb&lt;/<span style="color: #0000ff;">servlet-class</span>&gt;
&lt;/<span style="color: #0000ff;">servlet</span>&gt;

&lt;<span style="color: #0000ff;">servlet-mapping</span>&gt;
  &lt;<span style="color: #0000ff;">servlet-name</span>&gt;aaa&lt;/<span style="color: #0000ff;">servlet-name</span>&gt;
  &lt;<span style="color: #0000ff;">url-pattern</span>&gt;/abc&lt;/<span style="color: #0000ff;">url-pattern</span>&gt;
&lt;/<span style="color: #0000ff;">servlet-mapping</span>&gt;
</pre>
</div>

<p>
之后，就可以启动服务器了，找到 $TOMCAT/bin/startup.bat，双击运行即可。(注意要提前配置 JAVA_HOME 环境变量)。
</p>

<p>
最后，打开浏览器，输入 url 进行访问:
</p>
<pre class="example">
127.0.0.1:8080/abc
localhost:8080/abc
</pre>
</div>
</div>
<div id="outline-container-org91c2e69" class="outline-3">
<h3 id="org91c2e69"><span class="section-number-3">2.5.</span> 下载、安装 Eclipse 集成开发环境</h3>
<div class="outline-text-3" id="text-2-5">
<p>
先熟悉 Eclipse，毕竟还有很多企业在用它。
</p>

<p>
<a href="../Tools/eclipse.html#org01f9999">跳转查看 Eclipse 的安装与配置。</a>
</p>
</div>
</div>
</section>

<section id="outline-container-orga5c57fe" class="outline-2">
<h2 id="orga5c57fe"><span class="section-number-2">3.</span> 使用 Eclipse 创建第一个 Java Web 项目</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org4a47d93" class="outline-3">
<h3 id="org4a47d93"><span class="section-number-3">3.1.</span> 第零步，打开 Eclipse</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Eclipse 占用内存有点点大，所以会慢一些。平常心、平常心！
</p>
</div>
</div>

<div id="outline-container-orgf9a201d" class="outline-3">
<h3 id="orgf9a201d"><span class="section-number-3">3.2.</span> 第一步，创建一个 Dynamic Web Project</h3>
<div class="outline-text-3" id="text-3-2">
<p>
从 File 菜单的 New 中选择 Dynamic Web Project 的选项即可。
</p>


<figure id="org5c3b1aa">
<img src="img/java-web-first-1.png" alt="java-web-first-1.png">

</figure>

<p>
如果点击了 Next:
</p>


<figure id="org4faa604">
<img src="img/java-web-first-2.png" alt="java-web-first-2.png">

</figure>


<p>
再点 Next:
</p>


<figure id="org144d598">
<img src="img/java-web-first-3.png" alt="java-web-first-3.png">

</figure>
</div>
</div>

<div id="outline-container-org3a16f2d" class="outline-3">
<h3 id="org3a16f2d"><span class="section-number-3">3.3.</span> 第二步，[可选] 为新建的项目创建一个服务器</h3>
<div class="outline-text-3" id="text-3-3">
<p>
如果从来没创建过服务器的话，我们需要为新项目的运行创建一个服务器。
如果已有服务器，可以将项目直接 <b>部署</b> 到旧的服务器上即可。
</p>


<figure id="org420ff2b">
<img src="img/java-web-first-4.png" alt="java-web-first-4.png">

</figure>

<p>
在 Servers 标签，点击链接创建服务器，选择 Tomcat8.5 并点 Finish，于是创建完毕:
</p>


<figure id="org91a8dc0">
<img src="img/java-web-first-5.png" alt="java-web-first-5.png">

</figure>

<p>
点击 Add-and-Remove，将我们刚创建的 nihao 添加到服务器即可:
</p>


<figure id="org0c8aa64">
<img src="img/java-web-first-6.png" alt="java-web-first-6.png">

</figure>
</div>
</div>

<div id="outline-container-org902ad30" class="outline-3">
<h3 id="org902ad30"><span class="section-number-3">3.4.</span> 第三步，创建我们的第一个动态页面</h3>
<div class="outline-text-3" id="text-3-4">
<p>
我们的要求是:
</p>

<p>
如果用户访问 <a href="http://localhost:8080/nihao/hello.html">http://localhost:8080/nihao/hello.html</a>, 那么会显示粗体的 <b>Hello Java Web</b>。
</p>

<p>
这时候，我们需要定义一个特别的 Java 类 (符合 Servlet 规范的类)，来响应用户的请求。
</p>

<p>
在 src 下面创建一个 Hello.java 文件:
</p>



<figure id="orgd27d2b0">
<img src="img/java-web-first-7.png" alt="java-web-first-7.png">

</figure>

<p>
nihao/Hello.java 的内容如下:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#21253;&#21517;&#20026; nihao&#65292;&#37027;&#20040;&#36825;&#20010;&#31867;&#30340;&#20840;&#21517;&#23601;&#26159; nihao.Hello&#65292;&#38656;&#35201;&#20445;&#23384;&#20026; nihao/Hello.java</span>
<span style="color: #a020f0;">package</span> <span style="color: #008b8b;">nihao</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#38656;&#35201;&#29992;&#21040;&#30340;&#20854;&#20182;&#21151;&#33021; (&#31867;)&#65292;&#36890;&#36807; import &#24341;&#36827;</span>
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">io</span>.*;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.*;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #008b8b;">http</span>.*;

<span style="color: #b22222;">// </span><span style="color: #b22222;">&#25353;&#29031;&#35268;&#33539;&#65292;&#25105;&#20204;&#38656;&#35201;&#32487;&#25215; HttpServlet &#31867;</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Hello</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22312; service &#26041;&#27861;&#20869;&#65292;&#20889;&#25105;&#20204;&#21709;&#24212;&#32473;&#35775;&#38382;&#32773;&#30340;&#36923;&#36753;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36825;&#20010;&#26041;&#27861;&#22312; HttpServlet &#20013;&#24050;&#32463;&#26377;&#23450;&#20041;&#65292;&#25152;&#20197;&#25105;&#20204;&#38656;&#35201; Override&#65292;&#21363;&#37325;&#20889;&#23427;</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#33719;&#21462;&#19968;&#20010; &#25171;&#21360;&#23545;&#35937;&#65292;&#23427;&#23553;&#35013;&#20102;&#19968;&#20123;&#21521;&#23458;&#25143;&#31471;&#25171;&#21360;&#25991;&#26412;&#20869;&#23481;&#30340;&#26041;&#27861;</span>
        <span style="color: #228b22;">PrintWriter</span> <span style="color: #a0522d;">writer</span> = resp.getWriter<span style="color: #909183;">()</span>;
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21033;&#29992; writer&#65292;&#23558;&#19979;&#38754;&#20869;&#23481;&#36820;&#22238;&#32473;&#35775;&#38382;&#32773;</span>
        writer.write<span style="color: #909183;">(</span><span style="color: #8b2252;">"&lt;html&gt;&lt;h3&gt;Hello Java Web&lt;/h3&gt;&lt;/html&gt;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
这个 Servlet 类实现完成，我们需要用户可以通过 &#x2026;/hello.html 的方式访问，我们需要配置一下。
</p>

<p>
整个项目的核心配置文件就是 WebContent/WEB-INF 下面的 <code>web.xml</code>，我们修改如下:
</p>


<figure id="org23212f7">
<img src="img/java-web-first-80.png" alt="java-web-first-80.png">

</figure>

<p>
于是:
</p>
<ul class="org-ul">
<li>我们在 nihao.Hello 的 service 里面定义了一段逻辑，用来响应用户请求</li>
<li>我们也通过配置文件的方式表示，如果用户的请求是 <del>/xxx</del> /hello.html，那么久执行上面的逻辑来回应他</li>
<li>所以我们需要 <b>委托</b> 我们的服务器来 <b>监听用户请求</b>，如果用户访问到了 /hello.html，那么就调用 nihao.Hello 里的 service 方法以作回应</li>
</ul>
</div>
</div>

<div id="outline-container-org69242a1" class="outline-3">
<h3 id="org69242a1"><span class="section-number-3">3.5.</span> 最终章，启动服务器，看结果</h3>
<div class="outline-text-3" id="text-3-5">

<figure id="org1e93f7f">
<img src="img/java-web-first-9.png" alt="java-web-first-9.png">

</figure>

<p>
现在，一切具备了。访问:
</p>
<pre class="example">
localhost:8080/nihao/hello.html
</pre>
</div>
</div>
</section>
<section id="outline-container-orgc1172f3" class="outline-2">
<h2 id="orgc1172f3"><span class="section-number-2">4.</span> JS Event vs Java Servlet</h2>
<div class="outline-text-2" id="text-4">

<div  class='mc11'>
<div>
<p>

</p>

<p>
写一个寻常函数:
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #a020f0;">function</span> <span style="color: #0000ff;">xxx</span><span style="color: #707183;">(</span><span style="color: #a0522d;">e</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
   console.log<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"kkkk"</span><span style="color: #7388d6;">)</span>;
   alert<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"hello "</span> + e.target.tagName<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">xxx(); // &#21487;&#20197;&#20146;&#33258;&#35843;&#29992;</span>
</pre>
</div>




<p>
我们想让函数在 <b>合适的时机被触发</b> (用户的动作)。
</p>

<p>
为了达到这个目的，我们要拜托浏览器（绑定事件）:
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#32465;&#23450;&#20107;&#20214;&#30340;&#35268;&#21017;</span>
document.body.onclick = xxx;
document.body.addEventListener<span style="color: #707183;">(</span><span style="color: #8b2252;">'click'</span>, xxx<span style="color: #707183;">)</span>;
</pre>
</div>

<p>
之后，浏览器就会 <b>监听</b> 用户的一举一动，只要用户的动作满足了上面的要求，
浏览器就会义无反顾，帮助我们将上面的 xxx 给执行一遍。
</p>

<p>
为了能让 xxx 更好执行，所以，浏览器在调用 xxx 的时候，会将用户动作的相关细节都封装成了一个 event 的对象传进去了。

</div>
<div>

</p>

<p>
写一个寻常的类，里面有个方法 service:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ReadFileServlet</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"hello, world"</span><span style="color: #909183;">)</span>;
        resp.getWriter<span style="color: #909183;">()</span>.write<span style="color: #909183;">(</span><span style="color: #8b2252;">"kdkkfkdk"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">new ReadFileServlet().service(...);</span>
</pre>
</div>


<p>
我们想让这段处理逻辑在 <b>合适的时机被触发</b> (用户的请求)。
</p>

<p>
为了达到这个目的，我们需要拜托服务器 tomcat (绑定请求):
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">&lt;servlet&gt;&lt;servlet-mapping&gt; &lt;!-- &#23558;&#26576;&#20010; url &#23545;&#24212;&#21040;&#36825;&#20010; servlet --&gt;</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">&#36824;&#21487;&#20197;&#30452;&#25509;&#20351;&#29992; @&#27880;&#35299;&#30340;&#26041;&#24335;&#65292;&#23601;&#26159;&#20026;&#20102;&#32465;&#23450;&#35268;&#21017;</span>
<span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/read.html"</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
之后，服务器就会 <b>监听</b> 用户的任何请求，只要用户的请求满足刚刚声明的 url 地址，
服务器就会义无反顾，帮助我们创建一个 Servlet 实例，并且调用 service 方法，将产生的内容返回给请求者。
</p>

<p>
为了能让 service 更好执行，所以，服务器在调用 service 的时候，传进了封装好的两个参数:
</p>
<ol class="org-ol">
<li>request，包含所有跟 <b>请求相关</b> 的信息和方法，获取 url/data/browser..</li>
<li>response，包含了一些跟 <b>响应相关</b> 的信息和一些方法，能够方便我们将内容更容易返回给请求者</li>
</ol>

</div>

</div>
</div>
</section>

<section id="outline-container-org7a4d981" class="outline-2">
<h2 id="org7a4d981"><span class="section-number-2">5.</span> Browser 跟 Server 的数据互动</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgb47aa17" class="outline-3">
<h3 id="orgb47aa17"><span class="section-number-3">5.1.</span> 第一种方法，在超链接后增加参数</h3>
<div class="outline-text-3" id="text-5-1">
<p>
直接在浏览器中输入，带参:
</p>
<pre class="example">
https://cn.bing.com/images/search?q=sdfs&amp;form=HDRSC2&amp;first=1&amp;scenario=ImageBasicHover
</pre>


<p>
可以在 html 代码里:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"/xxx.html?a=3&amp;b=4&amp;c=5"</span><span style="color: #707183;">&gt;</span>&#28857;&#25105;&#30475;&#30475;&#24590;&#20040;&#26679;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #707183;">&gt;</span>
</pre>
</div>

<p>
注意:
</p>
<ul class="org-ul">
<li>url 从 ? 开始的是 k1=v1&amp;k2=v2 的形式，就是上传的数据</li>
<li>数据以 &amp; 为分割，可以分为多个 k/v 对</li>
</ul>
</div>
</div>

<div id="outline-container-org63f53df" class="outline-3">
<h3 id="org63f53df"><span class="section-number-3">5.2.</span> 第二种方法，使用 Form 表单</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span><span style="color: #0000ff;">section</span> <span style="color: #a0522d;">id</span>=<span style="color: #8b2252;">"main"</span><span style="color: #707183;">&gt;</span>
  <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"/xxx"</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">"get|post"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"a"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"b"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">textarea</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"c"</span><span style="color: #707183;">&gt;&lt;</span>/<span style="color: #0000ff;">textarea</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>&#25552;&#20132;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>
  <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">form</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">section</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"/xxx?a=&#31532;&#19968;&#20010;input&amp;b=&#31532;&#20108;&#20010;input"</span><span style="color: #707183;">&gt;</span>&#25552;&#20132;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #707183;">&gt;</span>
</pre>
</div>

<p>
小结:
</p>
<ul class="org-ul">
<li>form 表单跟 a 超链接，完成的是同样的效果，就是向服务器发送一次新的请求</li>
<li>form 跟 a 必须要有请求的地址，form 用 action 表示，a 用 href 表示</li>
<li>form 跟 a 都可以携带参数，form 使用下面的 input/textarea/option 之类的来表达参数，a 只能够写死</li>
<li>如果 action 被省略的话，默认的 action 为当前页面；</li>
<li>如果 method 被省略的话，默认的 method 为 get</li>
<li>除了 get 之外，method 的有效取值还有 post|put|delete|patch，最常用新的还是 get 和 post; 这些都是属于 http 传输协议规定的</li>
</ul>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span><span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"/denglu"</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">"post"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"username"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#29992;&#25143;&#21517;"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#23494;&#30721;"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>&#30331;&#24405;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">form</span><span style="color: #707183;">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3633896" class="outline-3">
<h3 id="org3633896"><span class="section-number-3">5.3.</span> 服务器获取参数的方式</h3>
<div class="outline-text-3" id="text-5-3">
<p>
基本的句式:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #b22222;">// </span><span style="color: #b22222;">&#21442;&#25968;&#65292;&#20195;&#34920;&#30340;&#23601;&#26159;&#29992;&#25143;&#19978;&#20256;&#30340;&#25968;&#25454;&#65292;&#26159;&#19968;&#31181; k/v &#32467;&#26500;</span>
<span style="color: #228b22;">String</span> <span style="color: #a0522d;">value</span> = request.getParameter<span style="color: #707183;">(</span><span style="color: #8b2252;">"key"</span><span style="color: #707183;">)</span>;  <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#27809;&#26377;&#21442;&#25968;&#65292;&#36820;&#22238; null&#65292;&#21542;&#21017;&#36820;&#22238;&#30340;&#26159; key &#23545;&#24212;&#30340;&#19968;&#20010;&#23383;&#31526;&#20018;&#30340;&#20540;</span>
<span style="color: #228b22;">String</span> <span style="color: #a0522d;">valueMap</span> = request.getParameterMap<span style="color: #707183;">()</span>; <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24471;&#21040;&#21253;&#21547;&#25152;&#26377;&#21442;&#25968;&#30340;&#19968;&#20010; Map &#23545;&#35937;</span>
</pre>
</div>

<p>
一个稍微具体点的例子，根据用户的请求参数做做相关的事情:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #707183;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #707183;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">xxx</span> = req.getParameter<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"xxx"</span><span style="color: #7388d6;">)</span>;

    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">dirString</span> = getServletContext<span style="color: #7388d6;">()</span>.getRealPath<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/wenben"</span><span style="color: #7388d6;">)</span>;

    <span style="color: #228b22;">File</span> <span style="color: #a0522d;">file</span> = getRandomFileFromDirectory<span style="color: #7388d6;">(</span>dirString<span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">content</span> = getFileContent<span style="color: #7388d6;">(</span>file<span style="color: #7388d6;">)</span>;

    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">html</span>;
    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>xxx == <span style="color: #008b8b;">null</span> || xxx.equals<span style="color: #909183;">(</span><span style="color: #8b2252;">"ignore"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        html = <span style="color: #8b2252;">"&lt;html&gt;&lt;h3&gt;404&lt;/h3&gt;&lt;p&gt;&#22240;&#20026;&#20320;&#30340;&#21442;&#25968;&#26159; ignore&#65292;&#25152;&#20197;&#25105;&#19981;&#33021;&#20026;&#24744;&#25552;&#20379;&#26356;&#22810;&lt;/p&gt;&lt;/htm&gt;"</span>;
    <span style="color: #7388d6;">}</span> <span style="color: #a020f0;">else</span> <span style="color: #7388d6;">{</span>
        html = <span style="color: #8b2252;">"&lt;html&gt;"</span> + <span style="color: #8b2252;">"&lt;head&gt;&lt;meta charset=utf-8&gt;&lt;/head&gt;"</span> + <span style="color: #8b2252;">"&lt;h3&gt;"</span> + file.getName<span style="color: #909183;">()</span> + <span style="color: #8b2252;">"&lt;/h3&gt;"</span>
                + <span style="color: #8b2252;">"&lt;p&gt;&lt;pre style='display:none'&gt;"</span> + content + <span style="color: #8b2252;">"&lt;/pre&gt;&lt;/p&gt;"</span>
                + <span style="color: #8b2252;">"&lt;button&gt;Click Me&lt;/button&gt;&lt;button class='rf'&gt;Refresh&lt;/button&gt;"</span> + <span style="color: #8b2252;">"&lt;hr&gt;"</span> + <span style="color: #8b2252;">"&lt;p&gt;xxx: "</span> + xxx
                + <span style="color: #8b2252;">"&lt;/p&gt;"</span> + <span style="color: #8b2252;">"&lt;hr&gt;"</span> + <span style="color: #8b2252;">"&lt;input type='text' placeholder='please input your file name'&gt;"</span>
                + <span style="color: #8b2252;">"&lt;input type='text' placeholder='please input your file content'&gt;"</span>
                + <span style="color: #8b2252;">"&lt;input type='submit' value='Submit your file'&gt;"</span> + <span style="color: #8b2252;">"&lt;script&gt;"</span>
                + <span style="color: #8b2252;">"function xxx() { alert(document.querySelector('pre').innerText) }"</span>
                + <span style="color: #8b2252;">"document.querySelector('button').onclick=xxx;"</span>
                + <span style="color: #8b2252;">"document.querySelector('.rf').onclick = () =&gt; location.reload()"</span> + <span style="color: #8b2252;">"&lt;/script&gt;"</span> + <span style="color: #8b2252;">"&lt;/html&gt;"</span>;
    <span style="color: #7388d6;">}</span>
    resp.getWriter<span style="color: #7388d6;">()</span>.write<span style="color: #7388d6;">(</span>html<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-orge28d2a3" class="outline-2">
<h2 id="orge28d2a3"><span class="section-number-2">6.</span> 案例分析 (○ 读取文件)</h2>
<div class="outline-text-2" id="text-6">
<p>
使用 Eclipse 创建一个简单项目 (比如项目名字为 readfile):
</p>
<ul class="org-ul">
<li>在 WebContent 下面放置若干 txt 格式文件 (比如 a.txt, b.txt)</li>
<li>用户可以使用 localhost:8080/readfile/read 的方式进行访问</li>
<li><p>
随机读取任意一个 txt 文本文件的内容，并响应给用户。html 格式为:
</p>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
  <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span><span style="color: #707183; font-style: italic; text-decoration: underline;">[</span><span style="font-style: italic; text-decoration: underline;">&#25991;&#20214;&#21517;</span><span style="color: #707183; font-style: italic; text-decoration: underline;">]</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span>
  <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">p</span><span style="color: #707183;">&gt;</span>
      <span style="color: #707183;">[</span>&#25991;&#20214;&#20869;&#23481;<span style="color: #707183;">]</span>
  <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">p</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div></li>
</ul>
</div>

<div id="outline-container-org0697de0" class="outline-3">
<h3 id="org0697de0"><span class="section-number-3">6.1.</span> 分析题目</h3>
<div class="outline-text-3" id="text-6-1">
<p>
使用 Java:
</p>
<ol class="org-ol">
<li>从某个文件夹随机获取到某个文件</li>
<li>获取到文件之后，读取到文件中的内容</li>
<li>使用文件的名字，以及文件的内容，组装成用户可接受的 html 返回</li>
<li>如果将文件保存到 WebContent 目录，如何去定位这个目录下面的文件</li>
</ol>
</div>
</div>

<div id="outline-container-orgb8c669c" class="outline-3">
<h3 id="orgb8c669c"><span class="section-number-3">6.2.</span> 第一步，先创建项目</h3>
<div class="outline-text-3" id="text-6-2">
<p>
比如:
</p>
<ul class="org-ul">
<li>项目的名字 readfile</li>
<li>Java 源文件的名字 readfile/ReadFileServlet.java</li>
</ul>
</div>
</div>

<div id="outline-container-orgd59ce79" class="outline-3">
<h3 id="orgd59ce79"><span class="section-number-3">6.3.</span> 第二步，实现逻辑，从文件夹获取随机文件</h3>
<div class="outline-text-3" id="text-6-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ReadFileServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">dirName</span> = <span style="color: #8b2252;">"E:\\workspace\\hello"</span>;

        <span style="color: #228b22;">ReadFileServlet</span> <span style="color: #a0522d;">readFileServlet</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ReadFileServlet</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">File</span> <span style="color: #a0522d;">rFile</span> = readFileServlet.getRandomFileFromDirectory<span style="color: #909183;">(</span>dirName<span style="color: #909183;">)</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#24471;&#21040;&#30340;&#38543;&#26426;&#25991;&#20214;&#26159;: "</span> + rFile<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">File</span> <span style="color: #0000ff;">getRandomFileFromDirectory</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">dirName</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#24212;&#35813;&#21015;&#20986;&#25991;&#20214;&#22841;&#19979;&#38754;&#30340;&#25152;&#26377;&#25991;&#20214;&#65292;&#25353;&#29031;&#36947;&#29702;&#36820;&#22238;&#30340;&#26159;&#19968;&#20010;&#25968;&#32452;&#25165;&#23545;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#20174;&#19978;&#38754;&#30340;&#25968;&#32452;&#37324;&#65292;&#38543;&#26426;&#33719;&#21462;&#19968;&#20010;&#20803;&#32032;&#12290;&#24590;&#20040;&#21435;&#38543;&#26426;</span>

        <span style="color: #228b22;">File</span> <span style="color: #a0522d;">dir</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">File</span><span style="color: #909183;">(</span>dirName<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">File</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">files</span> = dir.listFiles<span style="color: #909183;">()</span>;

        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">index</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Random</span><span style="color: #909183;">()</span>.nextInt<span style="color: #909183;">(</span>files.length<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">File</span> <span style="color: #a0522d;">rFile</span> = files<span style="color: #909183;">[</span>index<span style="color: #909183;">]</span>;
        <span style="color: #a020f0;">return</span> rFile;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>


<p>
小结:
</p>
<ol class="org-ol">
<li>我们抽象出来的某些逻辑，最好能 <b>封装</b> 成单独的方法
<ul class="org-ul">
<li>可以方便进行代码复用</li>
<li>代码更整洁，变得易于维护，容易阅读</li>
</ul></li>
<li>操作文件和文件夹，传统的方法是使用 java.io.File 类
<ul class="org-ul">
<li>根据文件名创建 File 对象: <code>File file = new File(filename)</code>;</li>
<li>比如，列出所有文件: <code>file.listFiles()</code>;</li>
</ul></li>
<li>在 Java 中，数组的语法是 <code>File[] files = ..</code>，数组可以通过 for 循环去遍历</li>
<li>在 Java 中，获取随机数的方法:
<ol class="org-ol">
<li>Math.random()，可以获取从 0 到 1 的一个随机 double 类型的值</li>
<li>上面的方法过于底层，所以 Java 又提供了一个叫 java.util.Random 的类，封装了一些方便使用的方法</li>
</ol></li>
</ol>
</div>
</div>

<div id="outline-container-orgf01411d" class="outline-3">
<h3 id="orgf01411d"><span class="section-number-3">6.4.</span> 第三步，实现逻辑，从某个文件中读取文件内容</h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">main</span><span style="color: #707183;">(</span><span style="color: #228b22;">String</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #707183;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">IOException</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">dirName</span> = <span style="color: #8b2252;">"E:\\workspace\\hello"</span>;

    <span style="color: #228b22;">ReadFileServlet</span> <span style="color: #a0522d;">readFileServlet</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ReadFileServlet</span><span style="color: #7388d6;">()</span>;
    <span style="color: #228b22;">File</span> <span style="color: #a0522d;">file</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">File</span><span style="color: #7388d6;">(</span>dirName + <span style="color: #8b2252;">"\\.classpath"</span><span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">cString</span> = readFileServlet.getFileContent<span style="color: #7388d6;">(</span>file<span style="color: #7388d6;">)</span>;
    System.out.println<span style="color: #7388d6;">(</span>cString<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
<span style="color: #228b22;">String</span> <span style="color: #0000ff;">getFileContent</span><span style="color: #707183;">(</span><span style="color: #228b22;">File</span> <span style="color: #a0522d;">file</span><span style="color: #707183;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">IOException</span> <span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#30001;&#20110; File &#31867;&#20986;&#29616;&#22826;&#26089;&#65292;&#35774;&#35745;&#19981;&#22815;&#21512;&#29702;&#65292;&#25152;&#20197; JDK7 &#25512;&#20986;&#20102;&#19968;&#20010;&#26032;&#30340; Path &#31867;&#24819;&#26469;&#26367;&#20195; File</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21478;&#22806;&#65292;JDK7 &#36824;&#25552;&#20379;&#20102;&#19968;&#20010;&#21483; Files &#30340;&#38745;&#24577;&#31867;&#65292;&#23553;&#35013;&#20102;&#24456;&#22810;&#26041;&#20415;&#25805;&#20316;&#25991;&#20214;&#30340;&#26041;&#27861;</span>
    <span style="color: #228b22;">byte</span><span style="color: #7388d6;">[]</span> <span style="color: #a0522d;">bs</span> = Files.readAllBytes<span style="color: #7388d6;">(</span>file.toPath<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;
    <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">String</span><span style="color: #7388d6;">(</span>bs<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
小结:
</p>
<ol class="org-ol">
<li>使用 Files.readXxx(Path) 这样的方法，可以方便读取文件的内容</li>
<li>可以通过 new String(byte[]) 的方法，将一个字节数组转化成一个字符串</li>
<li>我们也可以通过 Stream 的方法更灵活操作文件的读取</li>
</ol>
</div>
</div>

<div id="outline-container-org562eab1" class="outline-3">
<h3 id="org562eab1"><span class="section-number-3">6.5.</span> 第四步，将上面的两个逻辑，跟 Servlet 结合来实现请求效果</h3>
<div class="outline-text-3" id="text-6-5">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/read"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ReadFileServlet</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">dirString</span> = getServletContext<span style="color: #909183;">()</span>.getRealPath<span style="color: #909183;">(</span><span style="color: #8b2252;">"/wenben"</span><span style="color: #909183;">)</span>;
        <span style="color: #b22222;">// </span><span style="color: #b22222;">String dirString = "E:\\workspace\\readfile\\WebContent\\wenben";</span>

        <span style="color: #228b22;">File</span> <span style="color: #a0522d;">file</span> = getRandomFileFromDirectory<span style="color: #909183;">(</span>dirString<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">content</span> = getFileContent<span style="color: #909183;">(</span>file<span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">html</span> = <span style="color: #8b2252;">"&lt;html&gt;"</span>
            + <span style="color: #8b2252;">"&lt;h3&gt;"</span> + file.getName<span style="color: #909183;">()</span> + <span style="color: #8b2252;">"&lt;/h3&gt;"</span>
            + <span style="color: #8b2252;">"&lt;p&gt;&lt;pre&gt;"</span> + content + <span style="color: #8b2252;">"&lt;/pre&gt;&lt;/p&gt;"</span>
            + <span style="color: #8b2252;">"&lt;/html&gt;"</span>;
        resp.getWriter<span style="color: #909183;">()</span>.write<span style="color: #909183;">(</span>html<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">File</span> <span style="color: #0000ff;">getRandomFileFromDirectory</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">dirName</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#24212;&#35813;&#21015;&#20986;&#25991;&#20214;&#22841;&#19979;&#38754;&#30340;&#25152;&#26377;&#25991;&#20214;&#65292;&#25353;&#29031;&#36947;&#29702;&#36820;&#22238;&#30340;&#26159;&#19968;&#20010;&#25968;&#32452;&#25165;&#23545;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#20174;&#19978;&#38754;&#30340;&#25968;&#32452;&#37324;&#65292;&#38543;&#26426;&#33719;&#21462;&#19968;&#20010;&#20803;&#32032;&#12290;&#24590;&#20040;&#21435;&#38543;&#26426;</span>

        <span style="color: #228b22;">File</span> <span style="color: #a0522d;">dir</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">File</span><span style="color: #909183;">(</span>dirName<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">File</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">files</span> = dir.listFiles<span style="color: #909183;">()</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">return files[new Random().nextInt(files.length)];</span>

        <span style="color: #228b22;">Random</span> <span style="color: #a0522d;">random</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Random</span><span style="color: #909183;">()</span>;
        <span style="color: #228b22;">int</span> <span style="color: #a0522d;">index</span> = random.nextInt<span style="color: #909183;">(</span>files.length<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">File</span> <span style="color: #a0522d;">rFile</span> = files<span style="color: #909183;">[</span>index<span style="color: #909183;">]</span>;
        <span style="color: #a020f0;">return</span> rFile;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">String</span> <span style="color: #0000ff;">getFileContent</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">File</span> <span style="color: #a0522d;">file</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20174; JDK7 &#24320;&#22987;&#65292;&#25552;&#20379;&#20102; Files &#30340;&#19968;&#20010;&#38745;&#24577;&#31867;&#65292;&#23553;&#35013;&#20102;&#24456;&#22810;&#26041;&#20415;&#25805;&#20316;&#25991;&#20214;&#20869;&#23481;&#30340;&#26041;&#27861;</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#30001;&#20110; File &#31867;&#20986;&#29616;&#26089;&#36215;&#35774;&#35745;&#19981;&#22815;&#21512;&#29702;&#65292;&#25152;&#20197; JDK7 &#24320;&#22987;&#65292;&#25512;&#20986;&#20102;&#19968;&#20010;&#26032;&#30340; Path &#26469;&#26367;&#20195; File</span>
        <span style="color: #228b22;">byte</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">bs</span> = Files.readAllBytes<span style="color: #909183;">(</span>file.toPath<span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">String</span><span style="color: #909183;">(</span>bs<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org190370e" class="outline-2">
<h2 id="org190370e"><span class="section-number-2">7.</span> 案例分析 (↳ 写入文件)</h2>
<div class="outline-text-2" id="text-7">
<p>
在上次作业的基础上，为页面添加：
</p>
<ul class="org-ul">
<li>一个 input 表示文件名</li>
<li>一个 textarea 表示文件内容</li>
<li>一个 添加文件 按钮，点击之后，请求到服务器，然后服务器根据提交的内容创建包含相应内容的文件</li>
</ul>
</div>

<div id="outline-container-orgd3787ba" class="outline-3">
<h3 id="orgd3787ba"><span class="section-number-3">7.1.</span> 首先，定义 /write.html 对应的 Servlet，完成写入功能</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/write.html"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">CreateFileServlet</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">fileName</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"fileName"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">content</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"content"</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558;&#25991;&#20214;&#20445;&#23384;&#20026; fileName&#65292;&#20869;&#23481;&#20026; content</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">root</span> = <span style="color: #8b2252;">"e:/temp/"</span>;
        Files.write<span style="color: #909183;">(</span>Paths.get<span style="color: #709870;">(</span>root + fileName<span style="color: #709870;">)</span>, content.getBytes<span style="color: #709870;">()</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35774;&#23450;&#20351;&#29992; GBK &#30340;&#26041;&#24335;&#36827;&#34892;&#36716;&#30721;</span>
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"GBK"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">PrintWriter</span> <span style="color: #a0522d;">writer</span> = resp.getWriter<span style="color: #909183;">()</span>;
        writer.write<span style="color: #909183;">(</span><span style="color: #8b2252;">"&lt;html&gt;"</span><span style="color: #909183;">)</span>;
        writer.write<span style="color: #909183;">(</span><span style="color: #8b2252;">"&lt;div&gt;&#20445;&#23384;&#25104;&#21151;&#65281;&lt;/div&gt;"</span><span style="color: #909183;">)</span>;
        writer.write<span style="color: #909183;">(</span><span style="color: #8b2252;">"&lt;/html&gt;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0bfbfa" class="outline-3">
<h3 id="orgc0bfbfa"><span class="section-number-3">7.2.</span> 使用 Form 表单的形式，对接上面的功能</h3>
<div class="outline-text-3" id="text-7-2">
<p>
/readfile/read.html:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/read.html"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">ReadFileServlet</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">xxx</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"xxx"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">dirString</span> = getServletContext<span style="color: #909183;">()</span>.getRealPath<span style="color: #909183;">(</span><span style="color: #8b2252;">"/wenben"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">File</span> <span style="color: #a0522d;">file</span> = getRandomFileFromDirectory<span style="color: #909183;">(</span>dirString<span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">content</span> = getFileContent<span style="color: #909183;">(</span>file<span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">html</span> = <span style="color: #8b2252;">"&lt;html&gt;"</span>
                + <span style="color: #8b2252;">"&lt;head&gt;&lt;meta charset=utf-8&gt;&lt;/head&gt;"</span>

                + <span style="color: #8b2252;">"&lt;form action='/readfile/write.html' method='post'&gt;"</span>
                + <span style="color: #8b2252;">"  &lt;input name='fileName' placeholder='file name'&gt;"</span>
                + <span style="color: #8b2252;">"  &lt;input name='content' placeholder='content'&gt;"</span>
                + <span style="color: #8b2252;">"  &lt;button&gt;Submit&lt;/button&gt;"</span>
                + <span style="color: #8b2252;">"&lt;/form&gt;"</span>

                + <span style="color: #8b2252;">"&lt;hr&gt;"</span>
                + <span style="color: #8b2252;">"&lt;h3&gt;"</span> + file.getName<span style="color: #909183;">()</span> + <span style="color: #8b2252;">"&lt;/h3&gt;"</span>

                + <span style="color: #8b2252;">"&lt;p&gt;&lt;pre style='display:none'&gt;"</span> + content + <span style="color: #8b2252;">"&lt;/pre&gt;&lt;/p&gt;"</span>
                + <span style="color: #8b2252;">"&lt;button class='xx'&gt;Click Me&lt;/button&gt;&lt;button class='rf'&gt;Refresh&lt;/button&gt;"</span>
                + <span style="color: #8b2252;">"&lt;hr&gt;"</span>
                + <span style="color: #8b2252;">"&lt;script&gt;"</span>
                + <span style="color: #8b2252;">"function xxx() { alert(document.querySelector('pre').innerText) }"</span>
                + <span style="color: #8b2252;">"document.querySelector('.xx').onclick=xxx;"</span>
                + <span style="color: #8b2252;">"document.querySelector('.rf').onclick = () =&gt; location.reload()"</span> + <span style="color: #8b2252;">"&lt;/script&gt;"</span> + <span style="color: #8b2252;">"&lt;/html&gt;"</span>;
        resp.getWriter<span style="color: #909183;">()</span>.write<span style="color: #909183;">(</span>html<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">File</span> <span style="color: #0000ff;">getRandomFileFromDirectory</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">dirName</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">File</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">files</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">File</span><span style="color: #909183;">(</span>dirName<span style="color: #909183;">)</span>.listFiles<span style="color: #909183;">()</span>;
        <span style="color: #a020f0;">return</span> files<span style="color: #909183;">[</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Random</span><span style="color: #709870;">()</span>.nextInt<span style="color: #709870;">(</span>files.length<span style="color: #709870;">)</span><span style="color: #909183;">]</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #228b22;">String</span> <span style="color: #0000ff;">getFileContent</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">File</span> <span style="color: #a0522d;">file</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">String</span><span style="color: #909183;">(</span>Files.readAllBytes<span style="color: #709870;">(</span>file.toPath<span style="color: #907373;">()</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
/readfile/write.html:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/write.html"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">CreateFileServlet</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#33719;&#21462;&#29992;&#25143;&#30340;&#35831;&#27714;&#21442;&#25968;</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">fileName</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"fileName"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">content</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"content"</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558;&#25991;&#20214;&#20445;&#23384;&#20026; fileName&#65292;&#20869;&#23481;&#20026; content</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">root</span> = <span style="color: #8b2252;">"e:/temp/"</span>;
        Files.write<span style="color: #909183;">(</span>Paths.get<span style="color: #709870;">(</span>root + fileName<span style="color: #709870;">)</span>, content.getBytes<span style="color: #709870;">()</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35774;&#23450;&#20351;&#29992; GBK &#30340;&#26041;&#24335;&#36827;&#34892;&#36716;&#30721;</span>
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"GBK"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">PrintWriter</span> <span style="color: #a0522d;">writer</span> = resp.getWriter<span style="color: #909183;">()</span>;
        writer.write<span style="color: #909183;">(</span><span style="color: #8b2252;">"&lt;html&gt;"</span><span style="color: #909183;">)</span>;
        writer.write<span style="color: #909183;">(</span><span style="color: #8b2252;">"&lt;div&gt;&#20445;&#23384;&#25104;&#21151;&#65281;&lt;/div&gt;"</span><span style="color: #909183;">)</span>;
        writer.write<span style="color: #909183;">(</span><span style="color: #8b2252;">"&lt;div&gt;&lt;a href='/readfile/read.html'&gt;return back&lt;/a&gt;&lt;/div&gt;"</span><span style="color: #909183;">)</span>;
        writer.write<span style="color: #909183;">(</span><span style="color: #8b2252;">"&lt;/html&gt;"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-orgf699711" class="outline-2">
<h2 id="orgf699711"><span class="section-number-2">8.</span> 案例分析 (↳ JDBC 重出江湖，使用数据库重构)</h2>
<div class="outline-text-2" id="text-8">
<p>
将数据放置到数据库中，可以更高效、更安全进行存储和管理，这是现在通用的数据管理方式。
</p>

<p>
增删改查 (CRUD)。
</p>
</div>

<div id="outline-container-org1b990e7" class="outline-3">
<h3 id="org1b990e7"><span class="section-number-3">8.1.</span> 表的设计</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">book</span>
<span style="color: #707183;">(</span>
    id <span style="color: #228b22;">int</span> <span style="color: #a020f0;">identity</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span> ,
    bookName <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>200<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>,
    price <span style="color: #228b22;">float</span> <span style="color: #a020f0;">default</span> 0
<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> book <span style="color: #707183;">(</span>bookName, price<span style="color: #707183;">)</span> <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'xxx'</span>, 33<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> book <span style="color: #707183;">(</span>bookName, price<span style="color: #707183;">)</span> <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'yyy'</span>, 44<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org3aec1c8" class="outline-3">
<h3 id="org3aec1c8"><span class="section-number-3">8.2.</span> 查询操作 (/list)</h3>
<div class="outline-text-3" id="text-8-2">
<p>
基本步骤:
</p>
<ol class="org-ol">
<li>写一个 Servlet 绑定到 /list 请求</li>
<li>打开数据库连接，并从中获取 (查询) 到所需要的数据</li>
<li>使用得到的数据，拼接成合适的 html 页面，返回给请求者</li>
</ol>

<p>
代码如下:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/list"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookList</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#25171;&#24320;&#25968;&#25454;&#24211;&#36830;&#25509;</span>
            <span style="color: #228b22;">String</span> <span style="color: #a0522d;">url</span> = <span style="color: #8b2252;">"jdbc:sqlserver://localhost:1434;databaseName=xxx;user=sa;password="</span>;
            <span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DriverManager.getConnection<span style="color: #709870;">(</span>url<span style="color: #709870;">)</span>;

            <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#25171;&#24320;&#19968;&#20010;&#25191;&#34892; SQL &#35821;&#21477;&#30340;&#23545;&#35937;</span>
            <span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">statement</span> = connection.createStatement<span style="color: #709870;">()</span>;

            <span style="color: #b22222;">// </span><span style="color: #b22222;">3. &#20351;&#29992;&#19978;&#38754;&#30340; statement &#25191;&#34892;&#35821;&#21477;&#24471;&#21040;&#26597;&#35810;&#32467;&#26524;</span>
            <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"select id, name, price from book"</span>;
            <span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultSet</span> = statement.executeQuery<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span>;

            <span style="color: #b22222;">// </span><span style="color: #b22222;">4. &#36941;&#21382;&#32467;&#26524;&#38598;&#65292;&#20351;&#29992;&#32467;&#26524;&#65292;&#32452;&#21512;&#19968;&#20010; html &#23383;&#31526;&#20018;</span>
            <span style="color: #228b22;">String</span> <span style="color: #a0522d;">html</span> = <span style="color: #8b2252;">""</span>;
            <span style="color: #a020f0;">while</span><span style="color: #709870;">(</span>resultSet.next<span style="color: #907373;">()</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span> = resultSet.getInt<span style="color: #907373;">(</span>1<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = resultSet.getString<span style="color: #907373;">(</span>2<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">float</span> <span style="color: #a0522d;">price</span> = resultSet.getFloat<span style="color: #907373;">(</span>3<span style="color: #907373;">)</span>;
                html += <span style="color: #8b2252;">"&lt;tr&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;td&gt;"</span> + id + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;td&gt;"</span> + name + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;td&gt;"</span> + price + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;/tr&gt;\n"</span>;
            <span style="color: #709870;">}</span>

            <span style="color: #b22222;">// </span><span style="color: #b22222;">5. &#21153;&#24517;&#23558;&#20854;&#20851;&#38381;</span>
            resultSet.close<span style="color: #709870;">()</span>;
            statement.close<span style="color: #709870;">()</span>;
            connection.close<span style="color: #709870;">()</span>;

            <span style="color: #b22222;">// </span><span style="color: #b22222;">6. &#23558;&#32467;&#26524;&#36820;&#22238;&#32473;&#23458;&#25143;&#31471;</span>
            html = <span style="color: #8b2252;">"&lt;html&gt;"</span>
                + <span style="color: #8b2252;">"&lt;head&gt;"</span>
                + <span style="color: #8b2252;">"&lt;meta charset=utf8&gt;"</span>
                + <span style="color: #8b2252;">"&lt;link rel='stylesheet' href='/book/css/xxx.css'&gt;"</span>
                + <span style="color: #8b2252;">"&lt;/head&gt;"</span>
                + <span style="color: #8b2252;">"&lt;body&gt;&lt;table&gt;"</span>
                + html
                + <span style="color: #8b2252;">"&lt;/table&gt;&lt;/body&gt;"</span>
                + <span style="color: #8b2252;">"&lt;/html&gt;"</span>;
            <span style="color: #228b22;">PrintWriter</span> <span style="color: #a0522d;">writer</span> = resp.getWriter<span style="color: #709870;">()</span>;
            writer.write<span style="color: #709870;">(</span>html<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            e.printStackTrace<span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org20cecf8" class="outline-3">
<h3 id="org20cecf8"><span class="section-number-3">8.3.</span> 异常处理 (try-with-resource)</h3>
<div class="outline-text-3" id="text-8-3">
<p>
上面的代码存在很多问题，比如:
</p>
<ol class="org-ol">
<li>如果出错了，没有向用户返回妥善的输出</li>
<li>如果中间出了错，会导致资源文件没有正常关闭(释放)</li>
</ol>

<p>
通过异常处理，可以解决上述问题。
</p>

<p>
建议使用 Try-With-Resource 语法，如下:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/list"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookList</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">html</span> = <span style="color: #8b2252;">""</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"select id, name, price from book"</span>;
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">statement</span> = connection.createStatement<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultSet</span> = statement.executeQuery<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">while</span><span style="color: #709870;">(</span>resultSet.next<span style="color: #907373;">()</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span> = resultSet.getInt<span style="color: #907373;">(</span>1<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = resultSet.getString<span style="color: #907373;">(</span>2<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">float</span> <span style="color: #a0522d;">price</span> = resultSet.getFloat<span style="color: #907373;">(</span>3<span style="color: #907373;">)</span>;
                html += <span style="color: #8b2252;">"&lt;tr&gt;"</span>
                        + <span style="color: #8b2252;">"&lt;td&gt;"</span> + id + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
                        + <span style="color: #8b2252;">"&lt;td&gt;"</span> + name + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
                        + <span style="color: #8b2252;">"&lt;td&gt;"</span> + price + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
                        + <span style="color: #8b2252;">"&lt;/tr&gt;\n"</span>;
            <span style="color: #709870;">}</span>
            html = <span style="color: #8b2252;">"&lt;html&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;head&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;meta charset=utf8&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;link rel='stylesheet' href='/book/css/xxx.css'&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;/head&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;body&gt;&lt;table&gt;"</span>
                    + html
                    + <span style="color: #8b2252;">"&lt;/table&gt;&lt;/body&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;/html&gt;"</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            html = <span style="color: #8b2252;">"&lt;html&gt;&lt;h3&gt;Error Ocurred.&lt;/h3&gt;&lt;p&gt;"</span> + e.getLocalizedMessage<span style="color: #709870;">()</span> + <span style="color: #8b2252;">"&lt;/p&gt;&lt;/html&gt;"</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36755;&#20986;&#26368;&#21518;&#30340;&#32467;&#26524;</span>
        <span style="color: #228b22;">PrintWriter</span> <span style="color: #a0522d;">writer</span> = resp.getWriter<span style="color: #909183;">()</span>;
        writer.write<span style="color: #909183;">(</span>html<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
另外的辅助类:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">DBHelper</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">Connection</span> <span style="color: #0000ff;">getConnection</span><span style="color: #7388d6;">()</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">user</span> = <span style="color: #8b2252;">"sa"</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span> = <span style="color: #8b2252;">"sa"</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">dataBase</span> = <span style="color: #8b2252;">"xxx"</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">host</span> = <span style="color: #8b2252;">"localhost:1434"</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">url</span> = <span style="color: #8b2252;">"jdbc:sqlserver://"</span> + host + <span style="color: #8b2252;">";databaseName="</span> + dataBase + <span style="color: #8b2252;">";user="</span> + user + <span style="color: #8b2252;">";password="</span> + password;

        Class.forName<span style="color: #909183;">(</span><span style="color: #8b2252;">"com.microsoft.sqlserver.jdbc.SQLServerDriver"</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span> DriverManager.getConnection<span style="color: #909183;">(</span>url<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga9ecc24" class="outline-3">
<h3 id="orga9ecc24"><span class="section-number-3">8.4.</span> 删除操作 (/del)</h3>
<div class="outline-text-3" id="text-8-4">
<p>
首先，在上述 /list 的返回页面中，添加删除的超链接:
</p>
<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #a020f0;">while</span><span style="color: #707183;">(</span>resultSet.next<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
<span class="linenr"> 2: </span>    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span> = resultSet.getInt<span style="color: #7388d6;">(</span>1<span style="color: #7388d6;">)</span>;
<span class="linenr"> 3: </span>    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = resultSet.getString<span style="color: #7388d6;">(</span>2<span style="color: #7388d6;">)</span>;
<span class="linenr"> 4: </span>    <span style="color: #228b22;">float</span> <span style="color: #a0522d;">price</span> = resultSet.getFloat<span style="color: #7388d6;">(</span>3<span style="color: #7388d6;">)</span>;
<span class="linenr"> 5: </span>    html += <span style="color: #8b2252;">"&lt;tr&gt;"</span>
<span class="linenr"> 6: </span>        + <span style="color: #8b2252;">"&lt;td&gt;"</span> + id + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
<span class="linenr"> 7: </span>        + <span style="color: #8b2252;">"&lt;td&gt;"</span> + name + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
<span class="linenr"> 8: </span>        + <span style="color: #8b2252;">"&lt;td&gt;"</span> + price + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
<span class="linenr"> 9: </span>        + <span style="color: #8b2252;">"&lt;td&gt;&lt;a href='/book/del?id="</span> + id + <span style="color: #8b2252;">"'&gt;Del&lt;/a&gt;&lt;/td&gt;"</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21482;&#38656;&#35201;&#20462;&#25913;&#36825;&#21477;</span>
<span class="linenr">10: </span>        + <span style="color: #8b2252;">"&lt;/tr&gt;\n"</span>;
<span class="linenr">11: </span><span style="color: #707183;">}</span>
</pre>
</div>

<p>
其次，增加一个 /del 请求逻辑，用来响应上述页面中的删除链接:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/del"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookDelete</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35299;&#20915;&#36820;&#22238;&#20081;&#30721;&#38382;&#39064;</span>
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#33719;&#21462;&#29992;&#25143;&#36755;&#20837;&#30340; id (/del?id=3)</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">idString</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"id"</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#22914;&#26524;&#29992;&#25143;&#30340;&#35831;&#27714;&#19981;&#24102; id&#65292;&#37027;&#20040;&#32473;&#25253;&#38169;</span>
        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>idString == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">1. &#21442;&#25968;&#38169;&#35823;&#39029;&#38754;</span>
            renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"id should not be null. Delete Action ignored."</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25191;&#34892;&#21024;&#38500;&#30340;&#36923;&#36753;</span>
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">statement</span> = connection.createStatement<span style="color: #709870;">()</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"deletexxxx from book where id = "</span> + idString;
            <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rows</span> = statement.executeUpdate<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span>;
            System.out.println<span style="color: #709870;">(</span><span style="color: #8b2252;">"Delete rows count: "</span> + rows<span style="color: #709870;">)</span>;
            <span style="color: #b22222;">// </span><span style="color: #b22222;">2. &#25104;&#21151;&#39029;&#38754;</span>
            renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"Operation Success!"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">3. &#24322;&#24120;&#39029;&#38754;</span>
            renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"Error: "</span> + e.getLocalizedMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25105;&#20204;&#21487;&#20197;&#23558;&#26576;&#20123;&#36923;&#36753;&#21333;&#29420;&#23553;&#35013;&#25104;&#19968;&#20010;&#26041;&#27861;&#65292;&#36825;&#26679;&#23601;&#21487;&#20197;&#21453;&#22797;&#20351;&#29992;&#20102;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#24403;&#28982;&#65292;&#36825;&#26159;&#21487;&#36873;&#30340;&#65292;&#19981;&#36807;&#35201;&#20859;&#25104;&#23558;&#26576;&#20123;&#37325;&#22797;&#36923;&#36753;&#39034;&#25163;&#23553;&#35013;&#20986;&#26469;&#30340;&#20064;&#24815;   </span>
    <span style="color: #228b22;">String</span> <span style="color: #0000ff;">renderMessageString</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">message</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">{</span>
            <span style="color: #228b22;">PrintWriter</span> <span style="color: #a0522d;">writer</span> = resp.getWriter<span style="color: #709870;">()</span>;
            <span style="color: #228b22;">String</span> <span style="color: #a0522d;">ret</span> = <span style="color: #8b2252;">"&lt;html&gt;&lt;p&gt;"</span> + message + <span style="color: #8b2252;">"&lt;/p&gt;&lt;/html&gt;"</span>;
            writer.write<span style="color: #709870;">(</span>ret<span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span> ret;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">RuntimeException</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2aad2e" class="outline-3">
<h3 id="orgd2aad2e"><span class="section-number-3">8.5.</span> 增加操作 (/add)</h3>
<div class="outline-text-3" id="text-8-5">
<pre class="example">
http://localhost:9999/book/add?name=xxx&amp;price=yyy
</pre>
</div>

<div id="outline-container-org68645cb" class="outline-4">
<h4 id="org68645cb"><span class="section-number-4">8.5.1.</span> 首先，我们需要一个请求 (/add) 和相对应的响应 (BookAddServlet)</h4>
<div class="outline-text-4" id="text-8-5-1">
<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/add"</span><span style="color: #707183;">)</span>
<span class="linenr"> 2: </span><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookAdd</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
<span class="linenr"> 3: </span>    <span style="color: #008b8b;">@Override</span>
<span class="linenr"> 4: </span>    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
<span class="linenr"> 5: </span>        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
<span class="linenr"> 6: </span>        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"bookName"</span><span style="color: #909183;">)</span>;
<span class="linenr"> 9: </span>        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">price</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"price"</span><span style="color: #909183;">)</span>;
<span class="linenr">10: </span>
<span class="linenr">11: </span>        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>name == <span style="color: #008b8b;">null</span> || price == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
<span class="linenr">12: </span>            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"&#21442;&#25968;&#19981;&#23545;"</span><span style="color: #709870;">)</span>;
<span class="linenr">13: </span>            <span style="color: #a020f0;">return</span>;
<span class="linenr">14: </span>        <span style="color: #909183;">}</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span>        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
<span class="linenr">17: </span>                <span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">statement</span> = connection.createStatement<span style="color: #709870;">()</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
<span class="linenr">18: </span>            <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"insert into book (bookname, price) values ('"</span> + name + <span style="color: #8b2252;">"', "</span> + price + <span style="color: #8b2252;">")"</span>;
<span class="linenr">19: </span>            System.out.println<span style="color: #709870;">(</span><span style="color: #8b2252;">"&#35201;&#25191;&#34892;&#30340;&#35821;&#21477;&#26159;: "</span> + sql<span style="color: #709870;">)</span>;
<span class="linenr">20: </span>            statement.executeUpdate<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span>;
<span class="linenr">21: </span>
<span class="linenr">22: </span>            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"&#20445;&#23384;&#25104;&#21151;"</span><span style="color: #709870;">)</span>;
<span class="linenr">23: </span>
<span class="linenr">24: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238;&#27491;&#30830;&#30340;&#39029;&#38754;</span>
<span class="linenr">25: </span>        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
<span class="linenr">26: </span>            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238;&#20986;&#38169;&#30340;&#20449;&#24687;</span>
<span class="linenr">27: </span>            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, e.getMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
<span class="linenr">28: </span>        <span style="color: #909183;">}</span>
<span class="linenr">29: </span>    <span style="color: #7388d6;">}</span>
<span class="linenr">30: </span><span style="color: #707183;">}</span>
</pre>
</div>

<p>
测试:
</p>
<pre class="example">
http://localhost:9999/book/add?bookName=aaa&amp;price=333
</pre>


<p>
如果成功，说明逻辑就对了。
</p>
</div>
</div>

<div id="outline-container-org7cdd52c" class="outline-4">
<h4 id="org7cdd52c"><span class="section-number-4">8.5.2.</span> 其次，我们需要在某页面上，使用 Form 表单简化用户触发添加书籍操作</h4>
<div class="outline-text-4" id="text-8-5-2">
<p>
最好就是添加到 /list 页面上 (当然，根据自己的设计，添加到其他地方也可以):
</p>
<div class="org-src-container">
<pre class="src src-java">html = <span style="color: #8b2252;">"&lt;html&gt;"</span>
        + <span style="color: #8b2252;">"&lt;head&gt;"</span>
        + <span style="color: #8b2252;">"&lt;meta charset=utf8&gt;"</span>
        + <span style="color: #8b2252;">"&lt;link rel='stylesheet' href='/book/css/xxx.css'&gt;"</span>
        + <span style="color: #8b2252;">"&lt;/head&gt;"</span>
        + <span style="color: #8b2252;">"&lt;body&gt;"</span>
        + <span style="color: #8b2252;">"&lt;div&gt;"</span>
        + <span style="color: #8b2252;">"  &lt;form action='/book/add'&gt;"</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20462;&#25913;&#36825;&#19968;&#27573;</span>
        + <span style="color: #8b2252;">"      &lt;input type='text' name='bookName' placeholder='&#20070;&#21517;'&gt;"</span>
        + <span style="color: #8b2252;">"      &lt;input type='number' name='price' placeholder='&#20215;&#26684;'&gt;"</span>
        + <span style="color: #8b2252;">"      &lt;button&gt;&#28155;&#21152;&#20070;&#31821;&lt;/button&gt;"</span>
        + <span style="color: #8b2252;">"  &lt;/form&gt;"</span>
        + <span style="color: #8b2252;">"&lt;/div&gt;"</span>
        + <span style="color: #8b2252;">"&lt;table&gt;"</span>
        + html
        + <span style="color: #8b2252;">"&lt;/table&gt;&lt;/body&gt;"</span>
        + <span style="color: #8b2252;">"&lt;/html&gt;"</span>;
</pre>
</div>

<p>
添加完毕，你就可以在 /list 的页面上看到 form 表单了。
</p>

<p>
接下来进行测试即可。
</p>
</div>
</div>

<div id="outline-container-orgf0bab19" class="outline-4">
<h4 id="orgf0bab19"><span class="section-number-4">8.5.3.</span> 另外，我们将 renderMessageString 抽取到了单独的类中，方便公用</h4>
<div class="outline-text-4" id="text-8-5-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">TempUtils</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">renderMessageString</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">message</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">{</span>
            <span style="color: #228b22;">PrintWriter</span> <span style="color: #a0522d;">writer</span> = resp.getWriter<span style="color: #709870;">()</span>;
            <span style="color: #228b22;">String</span> <span style="color: #a0522d;">ret</span> = <span style="color: #8b2252;">"&lt;html&gt;&lt;div style='width: 400px; margin: 1em auto; background: #eee; padding: 2em;'&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;span style='margin-right: 2em'&gt;"</span> + message + <span style="color: #8b2252;">"&lt;/span&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;a href='/book/list'&gt;&#36820;&#22238;&#39318;&#39029;&lt;/a&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;/div&gt;&lt;/html&gt;"</span>;
            writer.write<span style="color: #709870;">(</span>ret<span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span> ret;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">RuntimeException</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc3e236e" class="outline-3">
<h3 id="orgc3e236e"><span class="section-number-3">8.6.</span> 修改操作 (/edit)</h3>
<div class="outline-text-3" id="text-8-6">
<pre class="example">
http://localhost:9999/book/edit?id=x&amp;name=xxx&amp;price=yyy
</pre>
</div>

<div id="outline-container-orgacd5c0c" class="outline-4">
<h4 id="orgacd5c0c"><span class="section-number-4">8.6.1.</span> 将请求分为两种，一种是 GET /edit 用来显示修改的页面，一种是 POST /edit 用来执行修改操作</h4>
<div class="outline-text-4" id="text-8-6-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/edit"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookEdit</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doGet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">id</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"id"</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>id == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"&#21442;&#25968;&#38169;&#35823;"</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"select id, bookName, price from book where id = "</span> + id;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#35201;&#25191;&#34892;&#30340; SQL: "</span> + sql<span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">statement</span> = connection.createStatement<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultSet</span> = statement.executeQuery<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>

            resultSet.next<span style="color: #709870;">()</span>;

            <span style="color: #228b22;">String</span> <span style="color: #a0522d;">html</span> = <span style="color: #8b2252;">"&lt;form action='/book/edit' method='post' class='edit'&gt;"</span>
                    + <span style="color: #8b2252;">"  &lt;input type='text' name='id' readonly placeholder='id' value='"</span> + resultSet.getInt<span style="color: #709870;">(</span>1<span style="color: #709870;">)</span> + <span style="color: #8b2252;">"'&gt;"</span>
                    + <span style="color: #8b2252;">"  &lt;input type='text' name='bookName' placeholder='&#20070;&#21517;' value='"</span> + resultSet.getString<span style="color: #709870;">(</span>2<span style="color: #709870;">)</span> + <span style="color: #8b2252;">"'&gt;"</span>
                    + <span style="color: #8b2252;">"  &lt;input type='number' name='price' placeholder='&#20215;&#26684;' value='"</span> + resultSet.getFloat<span style="color: #709870;">(</span>3<span style="color: #709870;">)</span> + <span style="color: #8b2252;">"'&gt;"</span>
                    + <span style="color: #8b2252;">"  &lt;button&gt;&#26356;&#26032;&#25968;&#25454;&lt;/button&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;/form&gt;"</span>;

            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, html<span style="color: #709870;">)</span>;

        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, e.getLocalizedMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doPost</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">id</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"id"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"bookName"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">price</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"price"</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>id == <span style="color: #008b8b;">null</span> || name == <span style="color: #008b8b;">null</span> || price == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"&#21442;&#25968;&#38169;&#35823;"</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">Statement</span> <span style="color: #a0522d;">statement</span> = connection.createStatement<span style="color: #709870;">()</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>

            <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"update book set bookName='"</span> + name + <span style="color: #8b2252;">"', price='"</span> + price + <span style="color: #8b2252;">"' where id='"</span> + id + <span style="color: #8b2252;">"'"</span>;
            System.out.println<span style="color: #709870;">(</span><span style="color: #8b2252;">"&#35201;&#25191;&#34892;&#30340; SQL: "</span> + sql<span style="color: #709870;">)</span>;
            <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rows</span> = statement.executeUpdate<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span>;

            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>rows == 0<span style="color: #709870;">)</span> <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Exception</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#27809;&#26377;&#26356;&#26032;&#21040;&#20219;&#20309;&#35821;&#21477;"</span><span style="color: #709870;">)</span>;

            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"&#26356;&#26032;&#25104;&#21151;"</span><span style="color: #709870;">)</span>;

        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, e.getLocalizedMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org7926550" class="outline-4">
<h4 id="org7926550"><span class="section-number-4">8.6.2.</span> 然后，在 /list 页面上增加响应的入口</h4>
<div class="outline-text-4" id="text-8-6-2">
<div class="org-src-container">
<pre class="src src-java">html += <span style="color: #8b2252;">"&lt;tr&gt;"</span>
    + <span style="color: #8b2252;">"&lt;td&gt;"</span> + id + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
    + <span style="color: #8b2252;">"&lt;td&gt;"</span> + name + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
    + <span style="color: #8b2252;">"&lt;td&gt;"</span> + price + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
    + <span style="color: #8b2252;">"&lt;td&gt;&lt;a href='/book/del?id="</span> + id + <span style="color: #8b2252;">"'&gt;&#21024;&#38500;&lt;/a&gt;&lt;/td&gt;"</span>
    + <span style="color: #8b2252;">"&lt;td&gt;&lt;a href='/book/edit?id="</span> + id + <span style="color: #8b2252;">"'&gt;&#20462;&#25913;&lt;/a&gt;&lt;/td&gt;"</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36825;&#21477;</span>
    + <span style="color: #8b2252;">"&lt;/tr&gt;\n"</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org9aed62c" class="outline-4">
<h4 id="org9aed62c"><span class="section-number-4">8.6.3.</span> 其他，做一些调整即可</h4>
<div class="outline-text-4" id="text-8-6-3">
<p>
比如，修改返回页面的样式:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">TempUtils</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">renderMessageString</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">message</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">{</span>
            <span style="color: #228b22;">PrintWriter</span> <span style="color: #a0522d;">writer</span> = resp.getWriter<span style="color: #709870;">()</span>;
            <span style="color: #228b22;">String</span> <span style="color: #a0522d;">ret</span> = <span style="color: #8b2252;">"&lt;html&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;head&gt;&lt;link rel='stylesheet' href='/book/css/xxx.css'&gt;&lt;/head&gt;&lt;body&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;div style='width: 400px; margin: 1em auto; background: #eee; padding: 2em;'&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;span style='margin-right: 2em'&gt;"</span> + message + <span style="color: #8b2252;">"&lt;/span&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;a href='/book/list'&gt;&#36820;&#22238;&#39318;&#39029;&lt;/a&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"</span>;
            writer.write<span style="color: #709870;">(</span>ret<span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span> ret;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">RuntimeException</span><span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-css"><span style="color: #0000ff;">table, tr, td, th </span><span style="color: #707183;">{</span>
    <span style="color: #a020f0;">border</span>: 1px solid <span style="color: #ffffff; background-color: #000000;">black</span>;
    <span style="color: #a020f0;">padding</span>: 5px 1em;
    <span style="color: #a020f0;">border-collapse</span>: collapse;
    <span style="color: #a020f0;">text-align</span>: center;
<span style="color: #707183;">}</span>
<span style="color: #0000ff;">table </span><span style="color: #707183;">{</span>
    <span style="color: #a020f0;">width</span>: 400px;
<span style="color: #707183;">}</span>

<span style="color: #0000ff;">.edit input </span><span style="color: #707183;">{</span>
    <span style="color: #a020f0;">display</span>: block;
    <span style="color: #a020f0;">margin-bottom</span>: 10px;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>
</section>

<section id="outline-container-orge5fc8a4" class="outline-2">
<h2 id="orge5fc8a4"><span class="section-number-2">9.</span> 案例分析 (↳ Statement → PreparedStatement)</h2>
<div class="outline-text-2" id="text-9">
<p>
Statement 存在的问题:
</p>
<ol class="org-ol">
<li>拼接字符串，太麻烦了点</li>
<li>非常严重的 SQL 注入的安全问题</li>
</ol>
</div>

<div id="outline-container-orge0120b7" class="outline-3">
<h3 id="orge0120b7"><span class="section-number-3">9.1.</span> /list</h3>
<div class="outline-text-3" id="text-9-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/list"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookList</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">html</span> = <span style="color: #8b2252;">""</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"select id, bookName, price from book"</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span>;
                <span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultSet</span> = statement.executeQuery<span style="color: #709870;">()</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">while</span><span style="color: #709870;">(</span>resultSet.next<span style="color: #907373;">()</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span> = resultSet.getInt<span style="color: #907373;">(</span>1<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = resultSet.getString<span style="color: #907373;">(</span>2<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">float</span> <span style="color: #a0522d;">price</span> = resultSet.getFloat<span style="color: #907373;">(</span>3<span style="color: #907373;">)</span>;
                html += <span style="color: #8b2252;">"&lt;tr&gt;"</span>
                        + <span style="color: #8b2252;">"&lt;td&gt;"</span> + id + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
                        + <span style="color: #8b2252;">"&lt;td&gt;"</span> + name + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
                        + <span style="color: #8b2252;">"&lt;td&gt;"</span> + price + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
                        + <span style="color: #8b2252;">"&lt;td&gt;&lt;a href='/book/del?id="</span> + id + <span style="color: #8b2252;">"'&gt;&#21024;&#38500;&lt;/a&gt;&lt;/td&gt;"</span>
                        + <span style="color: #8b2252;">"&lt;td&gt;&lt;a href='/book/edit?id="</span> + id + <span style="color: #8b2252;">"'&gt;&#20462;&#25913;&lt;/a&gt;&lt;/td&gt;"</span>
                        + <span style="color: #8b2252;">"&lt;/tr&gt;\n"</span>;
            <span style="color: #709870;">}</span>
            html = <span style="color: #8b2252;">"&lt;html&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;head&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;meta charset=utf8&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;link rel='stylesheet' href='/book/css/xxx.css'&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;/head&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;body&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;div&gt;"</span>
                    + <span style="color: #8b2252;">"  &lt;form action='/book/add' method='post'&gt;"</span>
                    + <span style="color: #8b2252;">"      &lt;input type='text' name='bookName' placeholder='&#20070;&#21517;'&gt;"</span>
                    + <span style="color: #8b2252;">"      &lt;input type='number' name='price' placeholder='&#20215;&#26684;'&gt;"</span>
                    + <span style="color: #8b2252;">"      &lt;button&gt;&#28155;&#21152;&#20070;&#31821;&lt;/button&gt;"</span>
                    + <span style="color: #8b2252;">"  &lt;/form&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;/div&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;table&gt;"</span>
                    + html
                    + <span style="color: #8b2252;">"&lt;/table&gt;&lt;/body&gt;"</span>
                    + <span style="color: #8b2252;">"&lt;/html&gt;"</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            html = <span style="color: #8b2252;">"&lt;html&gt;&lt;h3&gt;Error Ocurred.&lt;/h3&gt;&lt;p&gt;"</span> + e.getLocalizedMessage<span style="color: #709870;">()</span> + <span style="color: #8b2252;">"&lt;/p&gt;&lt;/html&gt;"</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36755;&#20986;&#26368;&#21518;&#30340;&#32467;&#26524;</span>
        <span style="color: #228b22;">PrintWriter</span> <span style="color: #a0522d;">writer</span> = resp.getWriter<span style="color: #909183;">()</span>;
        writer.write<span style="color: #909183;">(</span>html<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d71ae5" class="outline-3">
<h3 id="org7d71ae5"><span class="section-number-3">9.2.</span> /del</h3>
<div class="outline-text-3" id="text-9-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/del"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookDelete</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">idString</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"id"</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>idString == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"id should not be null. Delete Action ignored."</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"delete  from book where id = ?"</span>;
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            statement.setInt<span style="color: #709870;">(</span>1, Integer.parseInt<span style="color: #907373;">(</span>idString<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
            <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rows</span> = statement.executeUpdate<span style="color: #709870;">()</span>;
            System.out.println<span style="color: #709870;">(</span><span style="color: #8b2252;">"Delete rows count: "</span> + rows<span style="color: #709870;">)</span>;

            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"Operation Success!"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"Error: "</span> + e.getLocalizedMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb817e0f" class="outline-3">
<h3 id="orgb817e0f"><span class="section-number-3">9.3.</span> /add</h3>
<div class="outline-text-3" id="text-9-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/add"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookAdd</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doPost</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        req.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"bookName"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">price</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"price"</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>name == <span style="color: #008b8b;">null</span> || price == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"&#21442;&#25968;&#19981;&#23545;"</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"insert into book (bookname, price) values (?, ?)"</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#35201;&#25191;&#34892;&#30340;&#35821;&#21477;&#26159;: "</span> + sql<span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            statement.setString<span style="color: #709870;">(</span>1, name<span style="color: #709870;">)</span>;
            statement.setFloat<span style="color: #709870;">(</span>2, Float.parseFloat<span style="color: #907373;">(</span>price<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">()</span>;

            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238;&#27491;&#30830;&#30340;&#39029;&#38754;</span>
            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"&#20445;&#23384;&#25104;&#21151;"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238;&#20986;&#38169;&#30340;&#20449;&#24687;</span>
            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, e.getMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doGet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        TempUtils.renderMessageString<span style="color: #909183;">(</span>resp, <span style="color: #8b2252;">"I don't know what to do"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5f0a3c" class="outline-3">
<h3 id="orgd5f0a3c"><span class="section-number-3">9.4.</span> /edit</h3>
<div class="outline-text-3" id="text-9-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/edit"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookEdit</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doGet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">id</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"id"</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>id == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"&#21442;&#25968;&#38169;&#35823;"</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"select id, bookName, price from book where id = ?"</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#35201;&#25191;&#34892;&#30340; SQL: "</span> + sql<span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            statement.setInt<span style="color: #709870;">(</span>1, Integer.parseInt<span style="color: #907373;">(</span>id<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;

            <span style="color: #a020f0;">try</span> <span style="color: #709870;">(</span><span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultSet</span> = statement.executeQuery<span style="color: #907373;">()</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                resultSet.next<span style="color: #907373;">()</span>;
                <span style="color: #228b22;">String</span> <span style="color: #a0522d;">html</span> = <span style="color: #8b2252;">"&lt;form action='/book/edit' method='post' class='edit'&gt;"</span>
                        + <span style="color: #8b2252;">"  &lt;input type='text' name='id' readonly placeholder='id' value='"</span> + resultSet.getInt<span style="color: #907373;">(</span>1<span style="color: #907373;">)</span> + <span style="color: #8b2252;">"'&gt;"</span>
                        + <span style="color: #8b2252;">"  &lt;input type='text' name='bookName' placeholder='&#20070;&#21517;' value='"</span> + resultSet.getString<span style="color: #907373;">(</span>2<span style="color: #907373;">)</span> + <span style="color: #8b2252;">"'&gt;"</span>
                        + <span style="color: #8b2252;">"  &lt;input type='number' name='price' placeholder='&#20215;&#26684;' value='"</span> + resultSet.getFloat<span style="color: #907373;">(</span>3<span style="color: #907373;">)</span> + <span style="color: #8b2252;">"'&gt;"</span>
                        + <span style="color: #8b2252;">"  &lt;button&gt;&#26356;&#26032;&#25968;&#25454;&lt;/button&gt;"</span>
                        + <span style="color: #8b2252;">"&lt;/form&gt;"</span>;
                TempUtils.renderMessageString<span style="color: #907373;">(</span>resp, html<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, e.getLocalizedMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doPost</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        req.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">id</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"id"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"bookName"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">price</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"price"</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>id == <span style="color: #008b8b;">null</span> || name == <span style="color: #008b8b;">null</span> || price == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"&#21442;&#25968;&#38169;&#35823;"</span><span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"update book set bookName=?, price=? where id=?"</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#35201;&#25191;&#34892;&#30340; SQL: "</span> + sql<span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>

            statement.setString<span style="color: #709870;">(</span>1, name<span style="color: #709870;">)</span>;
            statement.setFloat<span style="color: #709870;">(</span>2, Float.parseFloat<span style="color: #907373;">(</span>price<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
            statement.setInt<span style="color: #709870;">(</span>3, Integer.parseInt<span style="color: #907373;">(</span>id<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
            <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rows</span> = statement.executeUpdate<span style="color: #709870;">()</span>;

            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>rows == 0<span style="color: #709870;">)</span> <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Exception</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#27809;&#26377;&#26356;&#26032;&#21040;&#20219;&#20309;&#35821;&#21477;"</span><span style="color: #709870;">)</span>;

            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, <span style="color: #8b2252;">"&#26356;&#26032;&#25104;&#21151;"</span><span style="color: #709870;">)</span>;

        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            TempUtils.renderMessageString<span style="color: #709870;">(</span>resp, e.getLocalizedMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>
<section id="outline-container-org0c95457" class="outline-2">
<h2 id="org0c95457"><span class="section-number-2">10.</span> 案例分析 (↳ JSP - 革命性的视图改造)</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-org5b7d7e6" class="outline-3">
<h3 id="org5b7d7e6"><span class="section-number-3">10.1.</span> 苦逼的临时工</h3>
<div class="outline-text-3" id="text-10-1">
<p>
将任务一分为二，脏活累活（拼装 html）交给临时工去处理:
</p>
<ol class="org-ol">
<li>使用 request.getRequestDispatcher("/path").forward(request, response) 进行任务的交接</li>
<li>使用 request.setAttribute/getAttribute 来进行数据的传递!</li>
</ol>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/list"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookList</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">html</span> = <span style="color: #8b2252;">""</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"select id, bookName, price from book"</span>;

        <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">books</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ArrayList</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #909183;">&gt;()</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span>;
                <span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultSet</span> = statement.executeQuery<span style="color: #709870;">()</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">while</span><span style="color: #709870;">(</span>resultSet.next<span style="color: #907373;">()</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span> = resultSet.getInt<span style="color: #907373;">(</span>1<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = resultSet.getString<span style="color: #907373;">(</span>2<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">float</span> <span style="color: #a0522d;">price</span> = resultSet.getFloat<span style="color: #907373;">(</span>3<span style="color: #907373;">)</span>;

                <span style="color: #228b22;">Book</span> <span style="color: #a0522d;">book</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #907373;">(</span>id, name, price<span style="color: #907373;">)</span>;
                books.add<span style="color: #907373;">(</span>book<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>

            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558; books &#23545;&#35937;&#65288;&#25968;&#25454;&#65289;&#65292;&#20445;&#23384;&#21040;&#20102; req &#30340; xxx &#19978;</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"xxx"</span>, books<span style="color: #709870;">)</span>;

            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35753; /book/linshigong &#25152;&#20195;&#34920;&#30340;&#37027;&#20010; Servlet &#21435;&#25509;&#21147;&#22788;&#29702;&#25509;&#19979;&#26469;&#30340;&#36923;&#36753;</span>
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/linshigong"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            html = <span style="color: #8b2252;">"&lt;html&gt;&lt;h3&gt;Error Ocurred.&lt;/h3&gt;&lt;p&gt;"</span> + e.getLocalizedMessage<span style="color: #709870;">()</span> + <span style="color: #8b2252;">"&lt;/p&gt;&lt;/html&gt;"</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36755;&#20986;&#26368;&#21518;&#30340;&#32467;&#26524;</span>
        <span style="color: #228b22;">PrintWriter</span> <span style="color: #a0522d;">writer</span> = resp.getWriter<span style="color: #909183;">()</span>;
        writer.write<span style="color: #909183;">(</span>html<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/linshigong"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Linshigong</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">books</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">List</span><span style="color: #709870;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #709870;">&gt;</span><span style="color: #909183;">)</span> req.getAttribute<span style="color: #909183;">(</span><span style="color: #8b2252;">"xxx"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">html</span> = <span style="color: #8b2252;">""</span>;
        <span style="color: #a020f0;">for</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Book</span> <span style="color: #a0522d;">book</span> : books<span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            html += <span style="color: #8b2252;">"&lt;tr&gt;"</span>
                     + <span style="color: #8b2252;">"&lt;td&gt;"</span> + book.id + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
                     + <span style="color: #8b2252;">"&lt;td&gt;"</span> + book.bookName + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
                     + <span style="color: #8b2252;">"&lt;td&gt;"</span> + book.price + <span style="color: #8b2252;">"&lt;/td&gt;"</span>
                     + <span style="color: #8b2252;">"&lt;td&gt;&lt;a href='/book/del?id="</span> + book.id + <span style="color: #8b2252;">"'&gt;&#21024;&#38500;&lt;/a&gt;&lt;/td&gt;"</span>
                     + <span style="color: #8b2252;">"&lt;td&gt;&lt;a href='/book/edit?id="</span> + book.id + <span style="color: #8b2252;">"'&gt;&#20462;&#25913;&lt;/a&gt;&lt;/td&gt;"</span>
                     + <span style="color: #8b2252;">"&lt;/tr&gt;\n"</span>;
        <span style="color: #909183;">}</span>
        html = <span style="color: #8b2252;">"&lt;html&gt;"</span>
                + <span style="color: #8b2252;">"&lt;head&gt;"</span>
                + <span style="color: #8b2252;">"&lt;meta charset=utf8&gt;"</span>
                + <span style="color: #8b2252;">"&lt;meta http-equiv=\"Cache-Control\" content=\"no-store\" /&gt;"</span>
                + <span style="color: #8b2252;">"&lt;link rel='stylesheet' href='/book/css/xxx.css'&gt;"</span>
                + <span style="color: #8b2252;">"&lt;/head&gt;"</span>
                + <span style="color: #8b2252;">"&lt;body&gt;"</span>
                + <span style="color: #8b2252;">"&lt;div&gt;"</span>
                + <span style="color: #8b2252;">"  &lt;form action='/book/add' method='post'&gt;"</span>
                + <span style="color: #8b2252;">"      &lt;input type='text' name='bookName' placeholder='&#20070;&#21517;'&gt;"</span>
                + <span style="color: #8b2252;">"      &lt;input type='number' name='price' placeholder='&#20215;&#26684;'&gt;"</span>
                + <span style="color: #8b2252;">"      &lt;button&gt;&#28155;&#21152;&#20070;&#31821;&lt;/button&gt;"</span>
                + <span style="color: #8b2252;">"  &lt;/form&gt;"</span>
                + <span style="color: #8b2252;">"&lt;/div&gt;"</span>
                + <span style="color: #8b2252;">"&lt;table&gt;"</span>
                + html
                + <span style="color: #8b2252;">"&lt;/table&gt;&lt;/body&gt;"</span>
                + <span style="color: #8b2252;">"&lt;/html&gt;"</span>;
        resp.getWriter<span style="color: #909183;">()</span>.write<span style="color: #909183;">(</span>html<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb5289ce" class="outline-3">
<h3 id="orgb5289ce"><span class="section-number-3">10.2.</span> 进击的临时工</h3>
<div class="outline-text-3" id="text-10-2">
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>%@page <span style="color: #a0522d;">import</span>=<span style="color: #8b2252;">"book.Book"</span>%<span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>%@page <span style="color: #a0522d;">import</span>=<span style="color: #8b2252;">"java.util.List"</span>%<span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>%@page <span style="color: #a0522d;">language</span>=<span style="color: #8b2252;">"java"</span> <span style="color: #a0522d;">contentType</span>=<span style="color: #8b2252;">"text/html;charset=utf-8"</span> <span style="color: #a0522d;">pageEncoding</span>=<span style="color: #8b2252;">"utf-8"</span>%<span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span>%
    List<span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">Book</span><span style="color: #7388d6;">&gt;</span> books = <span style="color: #7388d6;">(</span>List<span style="color: #909183;">&lt;</span><span style="color: #0000ff;">Book</span><span style="color: #909183;">&gt;</span><span style="color: #7388d6;">)</span> request.getAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"xxx"</span><span style="color: #7388d6;">)</span>;
%<span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"utf-8"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">link</span> <span style="color: #a0522d;">rel</span>=<span style="color: #8b2252;">"stylesheet"</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"css/xxx.css"</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">'/book/add'</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">'post'</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">'text'</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">'bookName'</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">'&#20070;&#21517;'</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">'number'</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">'price'</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">'&#20215;&#26684;'</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>&#28155;&#21152;&#20070;&#31821;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">form</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>

    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">table</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">tr</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>&#32534;&#21495;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>&#20070;&#21517;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>&#20215;&#26684;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>&#25805;&#20316;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">tr</span><span style="color: #707183;">&gt;</span>

        <span style="color: #707183;">&lt;</span>% for <span style="color: #7388d6;">(</span>Book book : books<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span> %<span style="color: #88090B;">&gt;</span>
        <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">tr</span><span style="color: #7388d6;">&gt;</span>
            <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;&lt;</span>% out.print<span style="color: #909183;">(</span>book.id<span style="color: #909183;">)</span>; %<span style="color: #7388d6;">&gt;&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>
            <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;&lt;</span>% out.print<span style="color: #909183;">(</span>book.bookName<span style="color: #909183;">)</span>; %<span style="color: #7388d6;">&gt;&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>
            <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;&lt;</span>% out.print<span style="color: #909183;">(</span>book.price<span style="color: #909183;">)</span>; %<span style="color: #7388d6;">&gt;&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>
            <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>
                <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/book/del?id=&lt;%= book.id %&gt;'</span><span style="color: #7388d6;">&gt;</span>&#21024;&#38500;<span style="color: #7388d6;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #7388d6;">&gt;</span>
                <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/book/edit?id=&lt;%= book.id %&gt;'</span><span style="color: #7388d6;">&gt;</span>&#20462;&#25913;<span style="color: #7388d6;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #7388d6;">&gt;</span>
            <span style="color: #7388d6;">&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>
        <span style="color: #7388d6;">&lt;</span>/<span style="color: #0000ff;">tr</span><span style="color: #7388d6;">&gt;</span>
        <span style="color: #7388d6;">&lt;</span>% <span style="color: #88090B;">}</span> %<span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">table</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org392aca2" class="outline-3">
<h3 id="org392aca2"><span class="section-number-3">10.3.</span> 转正的临时工 (分工的革命)</h3>
<div class="outline-text-3" id="text-10-3">

<figure id="org37f0245">
<img src="img/case-servlet+jsp-1.png" alt="case-servlet+jsp-1.png">

</figure>

<p>
逻辑与视图的分离:
</p>
<ul class="org-ul">
<li>各个部分使用自己擅长的技术，更能充分利用技术提高效率 (Java/Html)</li>
<li>更加方便维护，不易出错</li>
<li>老板: 容易招人 (后台，前端)</li>
<li>我们: 学习更有目的性 (全栈，后台，前端，UI，产品)</li>
<li>成本降低了，效率大大提高了</li>
</ul>
</div>

<div id="outline-container-org76faa71" class="outline-4">
<h4 id="org76faa71"><span class="section-number-4">10.3.1.</span> /list</h4>
<div class="outline-text-4" id="text-10-3-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/list"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookList</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"select id, bookName, price from book"</span>;

        <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">books</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ArrayList</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #909183;">&gt;()</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span>;
                <span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultSet</span> = statement.executeQuery<span style="color: #709870;">()</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">while</span><span style="color: #709870;">(</span>resultSet.next<span style="color: #907373;">()</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span> = resultSet.getInt<span style="color: #907373;">(</span>1<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = resultSet.getString<span style="color: #907373;">(</span>2<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">float</span> <span style="color: #a0522d;">price</span> = resultSet.getFloat<span style="color: #907373;">(</span>3<span style="color: #907373;">)</span>;

                <span style="color: #228b22;">Book</span> <span style="color: #a0522d;">book</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #907373;">(</span>id, name, price<span style="color: #907373;">)</span>;
                books.add<span style="color: #907373;">(</span>book<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>

            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558; books &#23545;&#35937;&#65288;&#25968;&#25454;&#65289;&#65292;&#20445;&#23384;&#21040;&#20102; req &#30340; xxx &#19978;</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"xxx"</span>, books<span style="color: #709870;">)</span>;

            <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35753; /book/linshigong &#25152;&#20195;&#34920;&#30340;&#37027;&#20010; Servlet &#21435;&#25509;&#21147;&#22788;&#29702;&#25509;&#19979;&#26469;&#30340;&#36923;&#36753;</span>
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/bookList.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"Error Ocurred."</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>%@page <span style="color: #a0522d;">import</span>=<span style="color: #8b2252;">"book.Book"</span>%<span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>%@page <span style="color: #a0522d;">import</span>=<span style="color: #8b2252;">"java.util.List"</span>%<span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>%@page <span style="color: #a0522d;">language</span>=<span style="color: #8b2252;">"java"</span> <span style="color: #a0522d;">contentType</span>=<span style="color: #8b2252;">"text/html; charset=utf-8"</span> <span style="color: #a0522d;">pageEncoding</span>=<span style="color: #8b2252;">"utf-8"</span>%<span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span>%
    List<span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">Book</span><span style="color: #7388d6;">&gt;</span> books = <span style="color: #7388d6;">(</span>List<span style="color: #909183;">&lt;</span><span style="color: #0000ff;">Book</span><span style="color: #909183;">&gt;</span><span style="color: #7388d6;">)</span> request.getAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"xxx"</span><span style="color: #7388d6;">)</span>;
%<span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"utf-8"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">link</span> <span style="color: #a0522d;">rel</span>=<span style="color: #8b2252;">"stylesheet"</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"css/xxx.css"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">style</span><span style="color: #707183;">&gt;</span>
        <span style="color: #0000ff;">form </span><span style="color: #707183;">{</span>
            <span style="color: #a020f0;">padding-bottom</span>: 1em;
            <span style="color: #a020f0;">width</span>: 98%;
            <span style="color: #a020f0;">display</span>: flex;
            <span style="color: #a020f0;">justify-content</span>: space-between;
        <span style="color: #707183;">}</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">style</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">header</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span><span style="font-style: italic; text-decoration: underline;">163 &#20070;&#31821;&#31649;&#29702;&#31995;&#32479;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">header</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">'/book/add'</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">'post'</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">'text'</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">'bookName'</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">'&#20070;&#21517;'</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">'number'</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">'price'</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">'&#20215;&#26684;'</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>&#28155;&#21152;&#20070;&#31821;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">form</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">table</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">tr</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>&#32534;&#21495;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>&#20070;&#21517;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>&#20215;&#26684;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>&#25805;&#20316;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">th</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">tr</span><span style="color: #707183;">&gt;</span>

        <span style="color: #707183;">&lt;</span>% for <span style="color: #7388d6;">(</span>Book book : books<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span> %<span style="color: #88090B;">&gt;</span>
        <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">tr</span><span style="color: #7388d6;">&gt;</span>
            <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;&lt;</span>%= book.id %<span style="color: #7388d6;">&gt;&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>
            <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;&lt;</span>%= book.bookName %<span style="color: #7388d6;">&gt;&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>
            <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;&lt;</span>%= book.price %<span style="color: #7388d6;">&gt;&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>
            <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>
                <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/book/del?id=&lt;%= book.id %&gt;'</span><span style="color: #7388d6;">&gt;</span>&#21024;&#38500;<span style="color: #7388d6;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #7388d6;">&gt;</span>
                <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/book/edit?id=&lt;%= book.id %&gt;'</span><span style="color: #7388d6;">&gt;</span>&#20462;&#25913;<span style="color: #7388d6;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #7388d6;">&gt;</span>
            <span style="color: #7388d6;">&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>
        <span style="color: #7388d6;">&lt;</span>/<span style="color: #0000ff;">tr</span><span style="color: #7388d6;">&gt;</span>
        <span style="color: #7388d6;">&lt;</span>% <span style="color: #88090B;">}</span> %<span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">table</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org028d559" class="outline-4">
<h4 id="org028d559"><span class="section-number-4">10.3.2.</span> /del</h4>
<div class="outline-text-4" id="text-10-3-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/del"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookDelete</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">service</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">idString</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"id"</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>idString == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"id should not be null. Delete Action ignored."</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"delete  from book where id = ?"</span>;
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            statement.setInt<span style="color: #709870;">(</span>1, Integer.parseInt<span style="color: #907373;">(</span>idString<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
            <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rows</span> = statement.executeUpdate<span style="color: #709870;">()</span>;
            System.out.println<span style="color: #709870;">(</span><span style="color: #8b2252;">"Delete rows count: "</span> + rows<span style="color: #709870;">)</span>;

            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"Operation Success!"</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"Error: "</span> + e.getLocalizedMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfcd1334" class="outline-4">
<h4 id="orgfcd1334"><span class="section-number-4">10.3.3.</span> /add</h4>
<div class="outline-text-4" id="text-10-3-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/add"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookAdd</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doPost</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        req.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"bookName"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">price</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"price"</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>name == <span style="color: #008b8b;">null</span> || price == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#21442;&#25968;&#19981;&#23545;"</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"insert into book (bookname, price) values (?, ?)"</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#35201;&#25191;&#34892;&#30340;&#35821;&#21477;&#26159;: "</span> + sql<span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            statement.setString<span style="color: #709870;">(</span>1, name<span style="color: #709870;">)</span>;
            statement.setFloat<span style="color: #709870;">(</span>2, Float.parseFloat<span style="color: #907373;">(</span>price<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">()</span>;

            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#20445;&#23384;&#25104;&#21151;"</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, e.getLocalizedMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doGet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        req.setAttribute<span style="color: #909183;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"I don't know what to do"</span><span style="color: #909183;">)</span>;
        req.getRequestDispatcher<span style="color: #909183;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #909183;">)</span>.forward<span style="color: #909183;">(</span>req, resp<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9bdb4d" class="outline-4">
<h4 id="orgf9bdb4d"><span class="section-number-4">10.3.4.</span> /edit</h4>
<div class="outline-text-4" id="text-10-3-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/edit"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookEdit</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doGet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">id</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"id"</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>id == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#21442;&#25968;&#38169;&#35823;"</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"select id, bookName, price from book where id = ?"</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#35201;&#25191;&#34892;&#30340; SQL: "</span> + sql<span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            statement.setInt<span style="color: #709870;">(</span>1, Integer.parseInt<span style="color: #907373;">(</span>id<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;

            <span style="color: #a020f0;">try</span> <span style="color: #709870;">(</span><span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultSet</span> = statement.executeQuery<span style="color: #907373;">()</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                resultSet.next<span style="color: #907373;">()</span>;

                <span style="color: #228b22;">Book</span> <span style="color: #a0522d;">book</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #907373;">(</span>
                        resultSet.getInt<span style="color: #6276ba;">(</span>1<span style="color: #6276ba;">)</span>,
                        resultSet.getString<span style="color: #6276ba;">(</span>2<span style="color: #6276ba;">)</span>,
                        resultSet.getFloat<span style="color: #6276ba;">(</span>3<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>;

                req.setAttribute<span style="color: #907373;">(</span><span style="color: #8b2252;">"book"</span>, book<span style="color: #907373;">)</span>;
                req.getRequestDispatcher<span style="color: #907373;">(</span><span style="color: #8b2252;">"/bookEdit.jsp"</span><span style="color: #907373;">)</span>.forward<span style="color: #907373;">(</span>req, resp<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, e.getLocalizedMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doPost</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        req.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        resp.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">id</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"id"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"bookName"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">price</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"price"</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>id == <span style="color: #008b8b;">null</span> || name == <span style="color: #008b8b;">null</span> || price == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#21442;&#25968;&#19981;&#23545;"</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"update book set bookName=?, price=? where id=?"</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#35201;&#25191;&#34892;&#30340; SQL: "</span> + sql<span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>

            statement.setString<span style="color: #709870;">(</span>1, name<span style="color: #709870;">)</span>;
            statement.setFloat<span style="color: #709870;">(</span>2, Float.parseFloat<span style="color: #907373;">(</span>price<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
            statement.setInt<span style="color: #709870;">(</span>3, Integer.parseInt<span style="color: #907373;">(</span>id<span style="color: #907373;">)</span><span style="color: #709870;">)</span>;
            <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rows</span> = statement.executeUpdate<span style="color: #709870;">()</span>;

            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>rows == 0<span style="color: #709870;">)</span> <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Exception</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#27809;&#26377;&#26356;&#26032;&#21040;&#20219;&#20309;&#35821;&#21477;"</span><span style="color: #709870;">)</span>;

            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#26356;&#26032;&#25104;&#21151;"</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, e.getLocalizedMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>%@page <span style="color: #a0522d;">import</span>=<span style="color: #8b2252;">"book.Book"</span>%<span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>%@page <span style="color: #a0522d;">language</span>=<span style="color: #8b2252;">"java"</span> <span style="color: #a0522d;">contentType</span>=<span style="color: #8b2252;">"text/html; charset=UTF-8"</span> <span style="color: #a0522d;">pageEncoding</span>=<span style="color: #8b2252;">"UTF-8"</span>%<span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span>%
    Book book = <span style="color: #7388d6;">(</span>Book<span style="color: #7388d6;">)</span> request.getAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"book"</span><span style="color: #7388d6;">)</span>;
%<span style="color: #707183;">&gt;</span>

&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span><span style="font-weight: bold; text-decoration: underline;">&#32467;&#26524;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">link</span> <span style="color: #a0522d;">rel</span>=<span style="color: #8b2252;">'stylesheet'</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/book/css/xxx.css'</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">div</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'width: 600px; margin: 1em auto; padding: 2em;'</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">'/book/edit'</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">'post'</span> <span style="color: #a0522d;">class</span>=<span style="color: #8b2252;">'edit'</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">'text'</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">'id'</span> readonly <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">'id'</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">'&lt;%= book.id %&gt;'</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">'text'</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">'bookName'</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">'&#20070;&#21517;'</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">'&lt;%= book.bookName %&gt;'</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">'number'</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">'price'</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">'&#20215;&#26684;'</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">'&lt;%= book.price %&gt;'</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>&#26356;&#26032;&#25968;&#25454;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">form</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/book/list'</span><span style="color: #707183;">&gt;</span>&#36820;&#22238;&#39318;&#39029;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org29bf4b4" class="outline-4">
<h4 id="org29bf4b4"><span class="section-number-4">10.3.5.</span> 通用的 /bookResult.jsp</h4>
<div class="outline-text-4" id="text-10-3-5">
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>%@page <span style="color: #a0522d;">language</span>=<span style="color: #8b2252;">"java"</span> <span style="color: #a0522d;">contentType</span>=<span style="color: #8b2252;">"text/html; charset=UTF-8"</span> <span style="color: #a0522d;">pageEncoding</span>=<span style="color: #8b2252;">"UTF-8"</span>%<span style="color: #707183;">&gt;</span>
&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span><span style="font-weight: bold; text-decoration: underline;">&#32467;&#26524;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">link</span> <span style="color: #a0522d;">rel</span>=<span style="color: #8b2252;">'stylesheet'</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/book/css/xxx.css'</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">div</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'width: 400px; margin: 1em auto; background: #eee; padding: 2em;'</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'margin-right: 2em'</span><span style="color: #707183;">&gt;</span>
     <span style="color: #707183;">&lt;</span>%= request.getAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"message"</span><span style="color: #7388d6;">)</span> %<span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/book/list'</span><span style="color: #707183;">&gt;</span>&#36820;&#22238;&#39318;&#39029;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div>
</div>
</div>
</div>
</section>

<section id="outline-container-orgbddc86f" class="outline-2">
<h2 id="orgbddc86f"><span class="section-number-2">11.</span> 案例分析 (↳ 编码设置)</h2>
<div class="outline-text-2" id="text-11">
<p>
使用 Filter 将编码设置提取出来公用:
</p>
<ul class="org-ul">
<li>使用过滤器，将效果作用在所有请求上，简单方便 (implements Filter)</li>
<li>使用 setCharacterEncoding 设置编码格式，建议为通用的 UTF-8</li>
</ul>

<p>
过滤器，好有一比，就是疫情时刻的商场入口测体温。
</p>

<p>
代码示例:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebFilter</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/*"</span><span style="color: #707183;">)</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">* &#30340;&#24847;&#24605;&#26159;: &#25152;&#26377;&#30340;&#35831;&#27714;&#37117;&#24517;&#39035;&#32463;&#36807;&#27492;&#36807;&#28388;&#22120;</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">EncodingFilter</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">Filter</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doFilter</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">ServletResponse</span> <span style="color: #a0522d;">response</span>, <span style="color: #228b22;">FilterChain</span> <span style="color: #a0522d;">chain</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">IOException</span>, <span style="color: #228b22;">ServletException</span> <span style="color: #7388d6;">{</span>
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#36827;&#20837;&#22823;&#38376;&#21475;&#65292;&#25509;&#21463;&#26816;&#26597;"</span><span style="color: #909183;">)</span>;
        request.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        response.setCharacterEncoding<span style="color: #909183;">(</span><span style="color: #8b2252;">"utf-8"</span><span style="color: #909183;">)</span>;
        response.setContentType<span style="color: #909183;">(</span><span style="color: #8b2252;">"text/html;charset=utf8"</span><span style="color: #909183;">)</span>;

        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#26816;&#26597;&#23436;&#27605;&#65292;&#25918;&#34892;"</span><span style="color: #909183;">)</span>;
        chain.doFilter<span style="color: #909183;">(</span>request, response<span style="color: #909183;">)</span>;

        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#20320;&#35201;&#31163;&#24320;&#65292;&#25343;&#22909;&#38450;&#30123;&#25163;&#20876;&#65292;&#19979;&#27425;&#20877;&#26469;&#65292;&#25308;&#25308;"</span><span style="color: #909183;">)</span>;

    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">init</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">FilterConfig</span> <span style="color: #a0522d;">filterConfig</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span> <span style="color: #7388d6;">{</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">destroy</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</section>

<section id="outline-container-org39ed6e2" class="outline-2">
<h2 id="org39ed6e2"><span class="section-number-2">12.</span> 案例分析 (↳ 访问日志)</h2>
<div class="outline-text-2" id="text-12">
<p>
记录所有的用户请求信息 (访问日志)
</p>
</div>

<div id="outline-container-org7da2b44" class="outline-3">
<h3 id="org7da2b44"><span class="section-number-3">12.1.</span> 首先，需要创建一张表，来承载访问的日志</h3>
<div class="outline-text-3" id="text-12-1">
<p>
按照道理，应该至少有如下字段:
</p>
<ul class="org-ul">
<li>id, 作为数据的唯一编号</li>
<li>url, 访问的 url 地址</li>
<li>ip, 访问者的 ip 地址</li>
<li>ua, 访问者浏览器的标识</li>
<li>vdate，访问的日期</li>
</ul>

<details class="details"> <summary class="detail-summary"> <span class="detail-title">创建表的示例</span> </summary> <div class="detail-body"> <div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">book_fangwen_rizhi</span>
<span style="color: #707183;">(</span>
   <span style="color: #b22222;">-- &#23383;&#27573;&#21517; &#23383;&#27573;&#31867;&#22411; [&#22797;&#21046;&#24615;&#30340;&#25551;&#36848;&#12289;&#23646;&#24615;]</span>
   id <span style="color: #228b22;">int</span> <span style="color: #a020f0;">identity</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>,
   url <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>1000<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>,
   ip <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>200<span style="color: #7388d6;">)</span>,
   ua <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>1000<span style="color: #7388d6;">)</span>,
   vdate datetime <span style="color: #a020f0;">default</span> getdate<span style="color: #7388d6;">()</span>
<span style="color: #707183;">)</span>;
</pre>
</div>
 </div> </details>
</div>
</div>

<div id="outline-container-org5711f37" class="outline-3">
<h3 id="org5711f37"><span class="section-number-3">12.2.</span> 然后，写一个方法，能从 Java 中对这张表进行插入操作</h3>
<div class="outline-text-3" id="text-12-2">
<p>
创建一个类 LogDAO.java，在里面写一个方法: insert(url, ip, user)。
</p>

<details class="details"> <summary class="detail-summary"> <span class="detail-title">LogDAO#insert</span> </summary> <div class="detail-body"> <div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">package</span> <span style="color: #008b8b;">book</span>;

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">LogDAO</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">insert</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">url</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">ip</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">userAgent</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
 </div> </details>

<p>
之后，在 insert 方法中，完成使用 JDBC 的语法进行数据的插入操作。
</p>

<details class="details"> <summary class="detail-summary"> <span class="detail-title">向数据库插入日志</span> </summary> <div class="detail-body"> <div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">package</span> <span style="color: #008b8b;">book</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">sql</span>.<span style="color: #228b22;">Connection</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">sql</span>.<span style="color: #228b22;">PreparedStatement</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">utils</span>.<span style="color: #228b22;">DBHelper</span>;

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">LogDAO</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">insert</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">url</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">ip</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">userAgent</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"insert into book_fangwen_rizhi (url, ip, ua) values (?, ?, ?)"</span>;
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">conn</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">st</span> = conn.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            st.setString<span style="color: #709870;">(</span>1, url<span style="color: #709870;">)</span>;
            st.setString<span style="color: #709870;">(</span>2, ip<span style="color: #709870;">)</span>;
            st.setString<span style="color: #709870;">(</span>3, userAgent<span style="color: #709870;">)</span>;
            st.executeUpdate<span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
 </div> </details>
</div>
</div>

<div id="outline-container-org7eb6631" class="outline-3">
<h3 id="org7eb6631"><span class="section-number-3">12.3.</span> 之后[可选] 写一个 main 方法测试一下 insert 到底好不好使</h3>
<div class="outline-text-3" id="text-12-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">LogDAO</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">insert</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">url</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">ip</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">userAgent</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">//</span><span style="color: #b22222;">...</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">LogDAO</span> <span style="color: #a0522d;">logDAO</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">LogDAO</span><span style="color: #909183;">()</span>;
        logDAO.insert<span style="color: #909183;">(</span><span style="color: #8b2252;">"/xxx"</span>, <span style="color: #8b2252;">"1.2.1.1"</span>, <span style="color: #8b2252;">"IE"</span><span style="color: #909183;">)</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#25554;&#20837;&#25104;&#21151;!"</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
在执行上面的代码之前，一定要保证，jdbc.jar 包已经在相应的文件夹下:
</p>


<figure id="org06c1807">
<img src="img/book_test_jdbc_jar.png" alt="book_test_jdbc_jar.png">

</figure>

<p>
之后，就可以 右键 - Run as&#x2026; - Java Application 的方式，运行查看结果了。
</p>
</div>
</div>

<div id="outline-container-orgc0a6094" class="outline-3">
<h3 id="orgc0a6094"><span class="section-number-3">12.4.</span> 随后，就可以将上面的 insert 跟我们系统的 Filter 结合了</h3>
<div class="outline-text-3" id="text-12-4">
<p>
创建过滤器，实现相关的逻辑:
</p>
<ul class="org-ul">
<li>通过 request 获取相关的数据</li>
<li>通过调用 LogDAO.insert 方法，进行插入</li>
</ul>

<details class="details"> <summary class="detail-summary"> <span class="detail-title">过滤器的实现</span> </summary> <div class="detail-body"> <div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">package</span> <span style="color: #008b8b;">book</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">io</span>.<span style="color: #228b22;">IOException</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #228b22;">Filter</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #228b22;">FilterChain</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #228b22;">FilterConfig</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #228b22;">ServletException</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #228b22;">ServletRequest</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #228b22;">ServletResponse</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #008b8b;">http</span>.<span style="color: #228b22;">HttpServletRequest</span>;

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">FangwenRizhiFilter</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">Filter</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doFilter</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">ServletResponse</span> <span style="color: #a0522d;">response</span>, <span style="color: #228b22;">FilterChain</span> <span style="color: #a0522d;">chain</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">IOException</span>, <span style="color: #228b22;">ServletException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25152;&#26377;&#36319;&#35831;&#27714;&#30456;&#20851;&#30340;&#25968;&#25454;&#65292;&#37117;&#34987; tomcat &#23553;&#35013;&#21040;&#20102; request &#23545;&#35937;</span>
        <span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">HttpServletRequest</span><span style="color: #909183;">)</span> request;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">url</span> = req.getRequestURI<span style="color: #909183;">()</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">ip</span> = req.getRemoteAddr<span style="color: #909183;">()</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">userAgent</span> = req.getHeader<span style="color: #909183;">(</span><span style="color: #8b2252;">"user-agent"</span><span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20415;&#20110;&#24320;&#21457;&#30340;&#26102;&#20505;&#26597;&#30475;&#32467;&#26524;</span>
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"url: "</span> + url + <span style="color: #8b2252;">" ip: "</span> + ip + <span style="color: #8b2252;">" userAgent: "</span> + userAgent<span style="color: #909183;">)</span>;

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558;&#30456;&#20851;&#25968;&#25454;&#25554;&#20837;&#21040;&#25968;&#25454;</span>
        <span style="color: #228b22;">LogDAO</span> <span style="color: #a0522d;">logDAO</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">LogDAO</span><span style="color: #909183;">()</span>;
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">{</span>
            logDAO.insert<span style="color: #709870;">(</span>url, ip, userAgent<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            e.printStackTrace<span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #b22222;">// </span><span style="color: #b22222;">&#32487;&#32493;</span>
        chain.doFilter<span style="color: #909183;">(</span>request, response<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">init</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">FilterConfig</span> <span style="color: #a0522d;">filterConfig</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span> <span style="color: #7388d6;">{</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">destroy</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
 </div> </details>
</div>
</div>

<div id="outline-container-org7b28f71" class="outline-3">
<h3 id="org7b28f71"><span class="section-number-3">12.5.</span> 接下来，在我们实现的 Filter 上面添加地址映射</h3>
<div class="outline-text-3" id="text-12-5">
<p>
注意:
</p>
<ul class="org-ul">
<li>是 @WebFilter 不要拼写错了</li>
<li>/* 代表的是所有，/book* 代表所有 /bookxxx 的访问</li>
</ul>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebFilter</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/*"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">FangwenRizhiFilter</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">Filter</span> <span style="color: #707183;">{</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org23231c6" class="outline-3">
<h3 id="org23231c6"><span class="section-number-3">12.6.</span> 最后，启动服务器，检验结果</h3>
<div class="outline-text-3" id="text-12-6">
<p>
小结:
</p>
<ul class="org-ul">
<li>作业必须要在有答案之前做，才会有提升自己的效果!!!</li>
<li>学会怎么去分析问题，要把大的问题拆分成多个小的问题，逐个击破</li>
<li>多写，多练，也没那么难！！！</li>
</ul>

<p>
完整的代码下载地址:
</p>
<ul class="org-ul">
<li><a href="https://github.com/yaollllllsan/3-book/archive/master.zip">https://github.com/yaollllllsan/3-book/archive/master.zip</a></li>
<li><a href="https://github.com/yaollllllsan/3-book">https://github.com/yaollllllsan/3-book</a> 项目地址</li>
<li><a href="https://github.com/yaollllllsan">https://github.com/yaollllllsan</a> Github 首页</li>
</ul>
</div>
</div>
</section>

<section id="outline-container-org06f2ea0" class="outline-2">
<h2 id="org06f2ea0"><span class="section-number-2">13.</span> 案例分析 (↳ 重构代码结构)</h2>
<div class="outline-text-2" id="text-13">
<p>
<a href="https://github.com/yaollllllsan/3-book">https://github.com/yaollllllsan/3-book</a>
</p>
</div>

<div id="outline-container-org7f123b2" class="outline-3">
<h3 id="org7f123b2"><span class="section-number-3">13.1.</span> 代码结构，拆分</h3>
<div class="outline-text-3" id="text-13-1">
<p>
写代码的时候，所有逻辑写在一起的话，当代码越来越多，会变得臃肿而不易维护。
所以，要适当分包分类分方法。
</p>

<p>
一般来说，Web 项目，需要下面几个包:
</p>
<ul class="org-ul">
<li>bean 放置所有的 JavaBean 类</li>
<li>dao 放置所有的数据库操作类</li>
<li>util 放置所有的辅助方法和类</li>
<li>filter 放置所有的过滤器类</li>
<li>web 放置所有的 Servlet</li>
</ul>

<p>
当下，我们项目的结构为:
<img src="img/folder-arch.png" alt="folder-arch.png">
</p>
</div>
</div>

<div id="outline-container-orgb798fba" class="outline-3">
<h3 id="orgb798fba"><span class="section-number-3">13.2.</span> 重点是 BookDAO.java</h3>
<div class="outline-text-3" id="text-13-2">
<p>
它是将跟书籍相关的操作，都抽取出来放到这里了。
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">package</span> book.<span style="color: #008b8b;">dao</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">sql</span>.<span style="color: #228b22;">Connection</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">sql</span>.<span style="color: #228b22;">PreparedStatement</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">sql</span>.<span style="color: #228b22;">ResultSet</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">util</span>.<span style="color: #228b22;">ArrayList</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">util</span>.<span style="color: #228b22;">List</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">book</span>.<span style="color: #008b8b;">bean</span>.<span style="color: #228b22;">Book</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">utils</span>.<span style="color: #228b22;">DBHelper</span>;

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">BookDAO</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Book</span> <span style="color: #0000ff;">get</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"select id, bookName, price from book where id = ?"</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#35201;&#25191;&#34892;&#30340; SQL: "</span> + sql<span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            statement.setInt<span style="color: #709870;">(</span>1, id<span style="color: #709870;">)</span>;

            <span style="color: #a020f0;">try</span> <span style="color: #709870;">(</span><span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultSet</span> = statement.executeQuery<span style="color: #907373;">()</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                resultSet.next<span style="color: #907373;">()</span>;
                <span style="color: #a020f0;">return</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #907373;">(</span>resultSet.getInt<span style="color: #6276ba;">(</span>1<span style="color: #6276ba;">)</span>, resultSet.getString<span style="color: #6276ba;">(</span>2<span style="color: #6276ba;">)</span>, resultSet.getFloat<span style="color: #6276ba;">(</span>3<span style="color: #6276ba;">)</span><span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #7388d6;">&gt;</span> <span style="color: #0000ff;">list</span><span style="color: #7388d6;">()</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">List</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #909183;">&gt;</span> <span style="color: #a0522d;">books</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">ArrayList</span><span style="color: #909183;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #909183;">&gt;()</span>;

        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"select id, bookName, price from book"</span>;
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span>;
                <span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">resultSet</span> = statement.executeQuery<span style="color: #709870;">()</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            <span style="color: #a020f0;">while</span><span style="color: #709870;">(</span>resultSet.next<span style="color: #907373;">()</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span> = resultSet.getInt<span style="color: #907373;">(</span>1<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">String</span> <span style="color: #a0522d;">name</span> = resultSet.getString<span style="color: #907373;">(</span>2<span style="color: #907373;">)</span>;
                <span style="color: #228b22;">float</span> <span style="color: #a0522d;">price</span> = resultSet.getFloat<span style="color: #907373;">(</span>3<span style="color: #907373;">)</span>;

                <span style="color: #228b22;">Book</span> <span style="color: #a0522d;">book</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Book</span><span style="color: #907373;">(</span>id, name, price<span style="color: #907373;">)</span>;
                books.add<span style="color: #907373;">(</span>book<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
            <span style="color: #a020f0;">return</span> books;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">insert</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">bookName</span>, <span style="color: #228b22;">float</span> <span style="color: #a0522d;">price</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"insert into book (bookname, price) values (?, ?)"</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#35201;&#25191;&#34892;&#30340;&#35821;&#21477;&#26159;: "</span> + sql<span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            statement.setString<span style="color: #709870;">(</span>1, bookName<span style="color: #709870;">)</span>;
            statement.setFloat<span style="color: #709870;">(</span>2, price<span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">update</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">bookName</span>, <span style="color: #228b22;">float</span> <span style="color: #a0522d;">price</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"update book set bookName=?, price=? where id=?"</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#35201;&#25191;&#34892;&#30340; SQL: "</span> + sql<span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>

            statement.setString<span style="color: #709870;">(</span>1, bookName<span style="color: #709870;">)</span>;
            statement.setFloat<span style="color: #709870;">(</span>2, price<span style="color: #709870;">)</span>;
            statement.setInt<span style="color: #709870;">(</span>3, id<span style="color: #709870;">)</span>;
            <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rows</span> = statement.executeUpdate<span style="color: #709870;">()</span>;

            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>rows == 0<span style="color: #709870;">)</span> <span style="color: #a020f0;">throw</span> <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Exception</span><span style="color: #709870;">(</span><span style="color: #8b2252;">"&#27809;&#26377;&#26356;&#26032;&#21040;&#20219;&#20309;&#35821;&#21477;"</span><span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">delete</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"delete  from book where id = ?"</span>;
        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            statement.setInt<span style="color: #709870;">(</span>1, id<span style="color: #709870;">)</span>;
            <span style="color: #228b22;">int</span> <span style="color: #a0522d;">rows</span> = statement.executeUpdate<span style="color: #709870;">()</span>;
            System.out.println<span style="color: #709870;">(</span><span style="color: #8b2252;">"Delete rows count: "</span> + rows<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27979;&#35797;&#19978;&#36848;&#26041;&#27861;&#21040;&#24213;&#22909;&#19981;&#22909;&#20351;</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">BookDAO</span> <span style="color: #a0522d;">bookDAO</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BookDAO</span><span style="color: #909183;">()</span>;
        System.out.println<span style="color: #909183;">(</span>bookDAO.get<span style="color: #709870;">(</span>32<span style="color: #709870;">)</span>.bookName<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org41ed1dc" class="outline-3">
<h3 id="org41ed1dc"><span class="section-number-3">13.3.</span> 其他 BookXxxServlet 就可以将操作数据库的代码进行修改了</h3>
<div class="outline-text-3" id="text-13-3">
</div>
<div id="outline-container-org498b9cd" class="outline-4">
<h4 id="org498b9cd"><span class="section-number-4">13.3.1.</span> BookListServlet</h4>
<div class="outline-text-4" id="text-13-3-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">try</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">List</span><span style="color: #7388d6;">&lt;</span><span style="color: #228b22;">Book</span><span style="color: #7388d6;">&gt;</span> <span style="color: #a0522d;">books</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BookDAO</span><span style="color: #7388d6;">()</span>.list<span style="color: #7388d6;">()</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#23558; books &#23545;&#35937;&#65288;&#25968;&#25454;&#65289;&#65292;&#20445;&#23384;&#21040;&#20102; req &#30340; xxx &#19978;</span>
    req.setAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"xxx"</span>, books<span style="color: #7388d6;">)</span>;

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#35753; /book/linshigong &#25152;&#20195;&#34920;&#30340;&#37027;&#20010; Servlet &#21435;&#25509;&#21147;&#22788;&#29702;&#25509;&#19979;&#26469;&#30340;&#36923;&#36753;</span>
    req.getRequestDispatcher<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/bookList.jsp"</span><span style="color: #7388d6;">)</span>.forward<span style="color: #7388d6;">(</span>req, resp<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #707183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    req.setAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"Error Ocurred."</span><span style="color: #7388d6;">)</span>;
    req.getRequestDispatcher<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #7388d6;">)</span>.forward<span style="color: #7388d6;">(</span>req, resp<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge8347d7" class="outline-4">
<h4 id="orge8347d7"><span class="section-number-4">13.3.2.</span> BookAddServlet</h4>
<div class="outline-text-4" id="text-13-3-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">try</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">BookDAO</span> <span style="color: #a0522d;">bookDAO</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BookDAO</span><span style="color: #7388d6;">()</span>;
    bookDAO.insert<span style="color: #7388d6;">(</span>name, Float.parseFloat<span style="color: #909183;">(</span>price<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>;

    req.setAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#20445;&#23384;&#25104;&#21151;"</span><span style="color: #7388d6;">)</span>;
    req.getRequestDispatcher<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #7388d6;">)</span>.forward<span style="color: #7388d6;">(</span>req, resp<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #707183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    req.setAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"message"</span>, e.getLocalizedMessage<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;
    req.getRequestDispatcher<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #7388d6;">)</span>.forward<span style="color: #7388d6;">(</span>req, resp<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e29cf8" class="outline-4">
<h4 id="org7e29cf8"><span class="section-number-4">13.3.3.</span> BookDelServlet</h4>
<div class="outline-text-4" id="text-13-3-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">try</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">BookDAO</span> <span style="color: #a0522d;">bookDAO</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BookDAO</span><span style="color: #7388d6;">()</span>;
    bookDAO.delete<span style="color: #7388d6;">(</span>Integer.parseInt<span style="color: #909183;">(</span>idString<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>;

    req.setAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"Operation Success!"</span><span style="color: #7388d6;">)</span>;
    req.getRequestDispatcher<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #7388d6;">)</span>.forward<span style="color: #7388d6;">(</span>req, resp<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #707183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    req.setAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"Error: "</span> + e.getLocalizedMessage<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;
    req.getRequestDispatcher<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #7388d6;">)</span>.forward<span style="color: #7388d6;">(</span>req, resp<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ea94d6" class="outline-4">
<h4 id="org9ea94d6"><span class="section-number-4">13.3.4.</span> BookEditServlet</h4>
<div class="outline-text-4" id="text-13-3-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">try</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">Book</span> <span style="color: #a0522d;">book</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BookDAO</span><span style="color: #7388d6;">()</span>.get<span style="color: #7388d6;">(</span>Integer.parseInt<span style="color: #909183;">(</span>id<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>;

    req.setAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"book"</span>, book<span style="color: #7388d6;">)</span>;
    req.getRequestDispatcher<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/bookEdit.jsp"</span><span style="color: #7388d6;">)</span>.forward<span style="color: #7388d6;">(</span>req, resp<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #707183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    req.setAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"message"</span>, e.getLocalizedMessage<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;
    req.getRequestDispatcher<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #7388d6;">)</span>.forward<span style="color: #7388d6;">(</span>req, resp<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">try</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">BookDAO</span> <span style="color: #a0522d;">bookDAO</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">BookDAO</span><span style="color: #7388d6;">()</span>;
    bookDAO.update<span style="color: #7388d6;">(</span>Integer.parseInt<span style="color: #909183;">(</span>id<span style="color: #909183;">)</span>, name, Float.parseFloat<span style="color: #909183;">(</span>price<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>;

    req.setAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#26356;&#26032;&#25104;&#21151;"</span><span style="color: #7388d6;">)</span>;
    req.getRequestDispatcher<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #7388d6;">)</span>.forward<span style="color: #7388d6;">(</span>req, resp<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #707183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #707183;">)</span> <span style="color: #707183;">{</span>
    req.setAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"message"</span>, e.getLocalizedMessage<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;
    req.getRequestDispatcher<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #7388d6;">)</span>.forward<span style="color: #7388d6;">(</span>req, resp<span style="color: #7388d6;">)</span>;
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</div>
</section>

<section id="outline-container-orgef9e78f" class="outline-2">
<h2 id="orgef9e78f"><span class="section-number-2">14.</span> 案例分析 (↳ 用户的注册和登录)</h2>
<div class="outline-text-2" id="text-14">
</div>
<div id="outline-container-org984fd24" class="outline-3">
<h3 id="org984fd24"><span class="section-number-3">14.1.</span> 注册</h3>
<div class="outline-text-3" id="text-14-1">
</div>
<div id="outline-container-orgdda54f1" class="outline-4">
<h4 id="orgdda54f1"><span class="section-number-4">14.1.1.</span> 分析问题</h4>
<div class="outline-text-4" id="text-14-1-1">
<p>
本质就是通过页面的形式，让用户提交一定的数据；
然后服务器接收到这些数据之后，进行保存。
因为这些数据具备因人而异的差异性，
而且具备一定的保密性，所以服务器就可以认为，
通过这些数据，就能区别不同的人。
所以，这些数据又叫账号信息。
</p>

<p>
如果我们去实现一个注册逻辑的话:
</p>
<ol class="org-ol">
<li>我们需要给用户呈现页面
<ol class="org-ol">
<li>第一个请求 GET /regist，服务器会响应一个页面，主要包含一个 form 表单</li>
<li>第二个请求 POST /regist，服务器会将提交的数据保存，然后响应一个页面，提醒你注册到底是成功还是失败</li>
</ol></li>
<li>我们需要创建一张表，用来保存用户的注册信息 (user/account)
<ul class="org-ul">
<li>用户名</li>
<li>密码</li>
<li>性别</li>
<li><del>电话</del></li>
<li>邮箱</li>
<li><del>住址</del></li>
<li><del>微信</del></li>
<li><del>QQ</del></li>
<li><del>抖音</del></li>
</ul></li>
</ol>
</div>
</div>

<div id="outline-container-orge3f3428" class="outline-4">
<h4 id="orge3f3428"><span class="section-number-4">14.1.2.</span> 初步设计</h4>
<div class="outline-text-4" id="text-14-1-2">
<p>
首先，Servlet:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/regist"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">RegistServlet</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
   <span style="color: #0000ff;">doGet</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{}</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238; form &#39029;&#38754; </span>
   <span style="color: #0000ff;">doPost</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{}</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25191;&#34892;&#20445;&#23384;&#21160;&#20316;</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
其次，我们需要一个表:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">account</span>
<span style="color: #707183;">(</span>
   id <span style="color: #228b22;">int</span> <span style="color: #a020f0;">identity</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>,
   username <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>200<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>,
   password <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>200<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>,
   gender <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>10<span style="color: #7388d6;">)</span>,
   email <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>100<span style="color: #7388d6;">)</span>,
   created datetime <span style="color: #a020f0;">default</span> getdate<span style="color: #7388d6;">()</span>
<span style="color: #707183;">)</span>;
</pre>
</div>

<p>
需要根据表的内容，创建一个 Java 对象来表示:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Account</span> <span style="color: #707183;">{</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
根据需求，现将数据库的操作实现出来:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">AccountDAO</span> <span style="color: #707183;">{</span>
   <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">insert</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">gender</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">email</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
   <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
接下来，只要将 Servlet 之内的逻辑完成，将页面完成。
</p>
</div>
</div>

<div id="outline-container-orgefa5566" class="outline-4">
<h4 id="orgefa5566"><span class="section-number-4">14.1.3.</span> 实现步骤 [数据库创建表]</h4>
<div class="outline-text-4" id="text-14-1-3">
<p>
打开并连接数据库，根据以上语句创建表:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">account</span>
<span style="color: #707183;">(</span>
   id <span style="color: #228b22;">int</span> <span style="color: #a020f0;">identity</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>,
   username <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>200<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>,
   password <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>200<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>,
   gender <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>10<span style="color: #7388d6;">)</span>,
   email <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>100<span style="color: #7388d6;">)</span>,
   created datetime <span style="color: #a020f0;">default</span> getdate<span style="color: #7388d6;">()</span>
<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga186d82" class="outline-4">
<h4 id="orga186d82"><span class="section-number-4">14.1.4.</span> 实现步骤 [根据表，创建名为 Account 的 JavaBean 对象]</h4>
<div class="outline-text-4" id="text-14-1-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Account</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">gender</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">email</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">Date</span> <span style="color: #a0522d;">created</span>;
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
然后，在 Eclipse 中，通过菜单 source - generate xxx 为这个类生成 Getter 方法、Setter 方法 和构造器方法。
</p>


<figure id="orgc5f1d7a">
<img src="img/aaaa.png" alt="aaaa.png">

</figure>

<p>
最终的代码是:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">package</span> book.<span style="color: #008b8b;">bean</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">sql</span>.<span style="color: #228b22;">Date</span>;

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">Account</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">gender</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">email</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">Date</span> <span style="color: #a0522d;">created</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">Account</span> <span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #0000ff;">Account</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">gender</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">email</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">this</span>.username = username;
        <span style="color: #a020f0;">this</span>.password = password;
        <span style="color: #a020f0;">this</span>.gender = gender;
        <span style="color: #a020f0;">this</span>.email = email;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">getId</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> id;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">setId</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">id</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">this</span>.id = id;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">getUsername</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> username;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">setUsername</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">this</span>.username = username;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">getPassword</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> password;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">setPassword</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">this</span>.password = password;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">getGender</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> gender;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">setGender</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">gender</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">this</span>.gender = gender;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">getEmail</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> email;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">setEmail</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">email</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">this</span>.email = email;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Date</span> <span style="color: #0000ff;">getCreated</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> created;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">setCreated</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Date</span> <span style="color: #a0522d;">created</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">this</span>.created = created;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb86c9ce" class="outline-4">
<h4 id="orgb86c9ce"><span class="section-number-4">14.1.5.</span> 实现步骤 [然后就可以在 AccountDAO 中实现 insert 方法了]</h4>
<div class="outline-text-4" id="text-14-1-5">
<p>
通常的方法，从其他的地方 <code>Ctrl+C</code>，然后在这里 <code>Ctrl+V</code>，最后修修改就可以了：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">AccountDAO</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">insert</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">Account</span> <span style="color: #a0522d;">account</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"insert into account (username, password, gender, email) values (?, ?, ?, ?)"</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#35201;&#25191;&#34892;&#30340;&#35821;&#21477;&#26159;: "</span> + sql<span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            statement.setString<span style="color: #709870;">(</span>1, account.getUsername<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            statement.setString<span style="color: #709870;">(</span>2, account.getPassword<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            statement.setString<span style="color: #709870;">(</span>3, account.getGender<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            statement.setString<span style="color: #709870;">(</span>4, account.getEmail<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21487;&#36873;&#65292;&#20570;&#20010;&#27979;&#35797;</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">Account</span> <span style="color: #a0522d;">account</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Account</span><span style="color: #909183;">(</span><span style="color: #8b2252;">"abc"</span>, <span style="color: #8b2252;">"123456"</span>, <span style="color: #8b2252;">"&#30007;"</span>, <span style="color: #8b2252;">"bunanbunv@younanyounv.com"</span><span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">AccountDAO</span><span style="color: #909183;">()</span>.insert<span style="color: #909183;">(</span>account<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd36c6e9" class="outline-4">
<h4 id="orgd36c6e9"><span class="section-number-4">14.1.6.</span> 实现步骤 [Servlet#get 方法的实现，用于显示注册页面]</h4>
<div class="outline-text-4" id="text-14-1-6">
<p>
RegistServlet.java:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/regist"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">RegistServlet</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doGet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        req.getRequestDispatcher<span style="color: #909183;">(</span><span style="color: #8b2252;">"/regist/regist.jsp"</span><span style="color: #909183;">)</span>.forward<span style="color: #909183;">(</span>req, resp<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
WebContent/regist/regist.jsp:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>%@ page <span style="color: #a0522d;">language</span>=<span style="color: #8b2252;">"java"</span> <span style="color: #a0522d;">contentType</span>=<span style="color: #8b2252;">"text/html; charset=UTF-8"</span> <span style="color: #a0522d;">pageEncoding</span>=<span style="color: #8b2252;">"UTF-8"</span>%<span style="color: #707183;">&gt;</span>
&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span><span style="font-weight: bold; text-decoration: underline;">&#27880;&#20876;&#39029;&#38754;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">style</span><span style="color: #707183;">&gt;</span>
    <span style="color: #0000ff;">label </span><span style="color: #707183;">{</span>
        <span style="color: #a020f0;">display</span>: flex;
    <span style="color: #707183;">}</span>
    <span style="color: #0000ff;">label span </span><span style="color: #707183;">{</span>
        <span style="color: #a020f0;">width</span>: 100px;
    <span style="color: #707183;">}</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">style</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span><span style="font-style: italic; text-decoration: underline;">&#27880;&#20876;&#39029;&#38754;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"/book/regist"</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">"post"</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>&#29992;&#25143;&#21517;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"username"</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>&#23494;&#30721;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"password"</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>&#24615;&#21035;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"radio"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"gender"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"&#30007;"</span><span style="color: #707183;">&gt;</span>&#30007;
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"radio"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"gender"</span> <span style="color: #a0522d;">value</span>=<span style="color: #8b2252;">"&#22899;"</span><span style="color: #707183;">&gt;</span>&#22899;
        <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>&#37038;&#31665;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"email"</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>&#28857;&#20987;&#36827;&#34892;&#27880;&#20876;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">form</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org18ae952" class="outline-4">
<h4 id="org18ae952"><span class="section-number-4">14.1.7.</span> 实现步骤 [Servlet#post 方法的实现，用于完成注册]</h4>
<div class="outline-text-4" id="text-14-1-7">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@Override</span>
<span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doPost</span><span style="color: #707183;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #707183;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #707183;">{</span>
    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span> = req.getParameter<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"username"</span><span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span> = req.getParameter<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"password"</span><span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">gender</span> = req.getParameter<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"gender"</span><span style="color: #7388d6;">)</span>;
    <span style="color: #228b22;">String</span> <span style="color: #a0522d;">email</span> = req.getParameter<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"email"</span><span style="color: #7388d6;">)</span>;

    <span style="color: #a020f0;">if</span> <span style="color: #7388d6;">(</span>username == <span style="color: #008b8b;">null</span> || password == <span style="color: #008b8b;">null</span> || gender == <span style="color: #008b8b;">null</span> || email == <span style="color: #008b8b;">null</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        req.setAttribute<span style="color: #909183;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#23383;&#27573;&#19981;&#33021;&#20026;&#31354;"</span><span style="color: #909183;">)</span>;
        req.getRequestDispatcher<span style="color: #909183;">(</span><span style="color: #8b2252;">"/regist/result.jsp"</span><span style="color: #909183;">)</span>.forward<span style="color: #909183;">(</span>req, resp<span style="color: #909183;">)</span>;
        <span style="color: #a020f0;">return</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #a020f0;">try</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">new</span> <span style="color: #228b22;">AccountDAO</span><span style="color: #909183;">()</span>.insert<span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">Account</span><span style="color: #709870;">(</span>username, password, gender, email<span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
        req.setAttribute<span style="color: #909183;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#27880;&#20876;&#25104;&#21151;"</span><span style="color: #909183;">)</span>;
        req.getRequestDispatcher<span style="color: #909183;">(</span><span style="color: #8b2252;">"/regist/result.jsp"</span><span style="color: #909183;">)</span>.forward<span style="color: #909183;">(</span>req, resp<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        e.printStackTrace<span style="color: #909183;">()</span>;
        req.setAttribute<span style="color: #909183;">(</span><span style="color: #8b2252;">"message"</span>, e.getLocalizedMessage<span style="color: #709870;">()</span><span style="color: #909183;">)</span>;
        req.getRequestDispatcher<span style="color: #909183;">(</span><span style="color: #8b2252;">"/regist/result.jsp"</span><span style="color: #909183;">)</span>.forward<span style="color: #909183;">(</span>req, resp<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
响应的页面，这里为了简单只使用一个 JSP 来实现 WebContent/regist/result.jsp:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>%@ page <span style="color: #a0522d;">language</span>=<span style="color: #8b2252;">"java"</span> <span style="color: #a0522d;">contentType</span>=<span style="color: #8b2252;">"text/html; charset=UTF-8"</span> <span style="color: #a0522d;">pageEncoding</span>=<span style="color: #8b2252;">"UTF-8"</span>%<span style="color: #707183;">&gt;</span>
&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span><span style="font-weight: bold; text-decoration: underline;">&#32467;&#26524;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">link</span> <span style="color: #a0522d;">rel</span>=<span style="color: #8b2252;">'stylesheet'</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/book/css/xxx.css'</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">div</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'width: 400px; margin: 1em auto; background: #eee; padding: 2em;'</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'margin-right: 2em'</span><span style="color: #707183;">&gt;</span>
     <span style="color: #707183;">&lt;</span>%= request.getAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"message"</span><span style="color: #7388d6;">)</span> %<span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/book/regist'</span><span style="color: #707183;">&gt;</span>&#36820;&#22238;&#39318;&#39029;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org107221a" class="outline-4">
<h4 id="org107221a"><span class="section-number-4">14.1.8.</span> 打完收工，阶段小结</h4>
<div class="outline-text-4" id="text-14-1-8">
<ul class="org-ul">
<li>要敢于分析问题</li>
<li>要学会分析问题</li>
<li>要善于分析问题</li>
<li>要舍得投入时间和精力去分析问题</li>
<li>工欲善其事必先利其器；磨刀不误砍柴工；好的开始是成功的一半；心急吃不了热豆腐&#x2026;</li>
<li>整个过程，前面往往比后面难，所以克服困难建立信心很重要</li>
<li>学会 Ctrl-C 和 Ctrl-V 的使用</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org46517c6" class="outline-3">
<h3 id="org46517c6"><span class="section-number-3">14.2.</span> 登录</h3>
<div class="outline-text-3" id="text-14-2">
</div>
<div id="outline-container-org6e8c79f" class="outline-4">
<h4 id="org6e8c79f"><span class="section-number-4">14.2.1.</span> 分析问题</h4>
<div class="outline-text-4" id="text-14-2-1">
<p>
首次:
</p>
<ul class="org-ul">
<li>需要向服务器发送 account/password 等能够表示自己唯一身份的数据</li>
<li>服务器要根据你提交的 account/password 进行校验:
<ul class="org-ul">
<li>如果成功，就在 Session 中保存你是一个合法身份的凭证数据</li>
<li>如果失败，返回登录失败的页面</li>
</ul></li>
</ul>

<p>
后续:
</p>
<ul class="org-ul">
<li>[你再请求服务器的时候，浏览器会悄悄将之前保存在 Cookie 中的 JSESSIONID 随请求一起发送到服务器]</li>
<li>如果有需要，服务器就可以从 Session 从获取之前验证并保存的凭证，从而决定要不要继续接下来的业务</li>
</ul>

<p>
首次登陆:
</p>
<ul class="org-ul">
<li>需要一个请求 GET /login 我们应该能得到一个具备 account/password 输入框的 form 表单</li>
<li>点击登陆之后，POST /login，服务器将会进行校验，将成功的凭证保存在 Session 中</li>
</ul>

<p>
其他:
</p>
<ul class="org-ul">
<li>在 /book/list 上应该添加登录的入口链接，方便用户操作</li>
<li>之后，就可以为某些业务增加身份校验的限制</li>
</ul>
</div>
</div>

<div id="outline-container-org5a6b61c" class="outline-4">
<h4 id="org5a6b61c"><span class="section-number-4">14.2.2.</span> 初步设计</h4>
<div class="outline-text-4" id="text-14-2-2">
<p>
一个 LoginServlet，包含 get/post 方法:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">LoginServlet</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
   <span style="color: #0000ff;">doGet</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{}</span>     <span style="color: #b22222;">// </span><span style="color: #b22222;">login.jsp &#21253;&#21547;&#19968;&#20010; form &#34920;&#21333;</span>
   <span style="color: #0000ff;">doPost</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{}</span>    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36827;&#34892;&#30456;&#20851;&#36923;&#36753;&#65292;&#25104;&#21151;&#12289;&#22833;&#36133;</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
跟数据库校验用户的正确性:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">LoginDAO</span> <span style="color: #707183;">{</span>
   <span style="color: #a020f0;">public</span> <span style="color: #228b22;">boolean</span> <span style="color: #0000ff;">check</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
   <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9586800" class="outline-4">
<h4 id="org9586800"><span class="section-number-4">14.2.3.</span> 先搞一个方法 AccountDAO#check 用来校验用户名和密码的正确性</h4>
<div class="outline-text-4" id="text-14-2-3">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">AccountDAO</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">Account</span> <span style="color: #0000ff;">check</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"select id, username, gender, email from account where username = ? and password = ?"</span>;
        System.out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#35201;&#25191;&#34892;&#30340;&#35821;&#21477;&#26159;: "</span> + sql<span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">connection</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = connection.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            statement.setString<span style="color: #709870;">(</span>1, username<span style="color: #709870;">)</span>;
            statement.setString<span style="color: #709870;">(</span>2, password<span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">try</span> <span style="color: #709870;">(</span><span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">rs</span> = statement.executeQuery<span style="color: #907373;">()</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>rs.next<span style="color: #6276ba;">()</span><span style="color: #907373;">)</span> <span style="color: #907373;">{</span>
                    <span style="color: #228b22;">Account</span> <span style="color: #a0522d;">account</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Account</span><span style="color: #6276ba;">()</span>;
                    account.setId<span style="color: #6276ba;">(</span>rs.getInt<span style="color: #858580;">(</span>1<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>;
                    account.setUsername<span style="color: #6276ba;">(</span>rs.getString<span style="color: #858580;">(</span>2<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>;
                    account.setGender<span style="color: #6276ba;">(</span>rs.getString<span style="color: #858580;">(</span>3<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>;
                    account.setEmail<span style="color: #6276ba;">(</span>rs.getString<span style="color: #858580;">(</span>4<span style="color: #858580;">)</span><span style="color: #6276ba;">)</span>;
                    <span style="color: #a020f0;">return</span> account;
                <span style="color: #907373;">}</span> <span style="color: #a020f0;">else</span> <span style="color: #907373;">{</span>
                    <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">null</span>;
                <span style="color: #907373;">}</span>
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #b22222;">//</span><span style="color: #b22222;">...</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#21487;&#36873;&#65292;&#20570;&#20010;&#27979;&#35797;</span>
    <span style="color: #a020f0;">public</span> <span style="color: #a020f0;">static</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">main</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span><span style="color: #909183;">[]</span> <span style="color: #a0522d;">args</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        System.out.println<span style="color: #909183;">(</span><span style="color: #a020f0;">new</span> <span style="color: #228b22;">AccountDAO</span><span style="color: #709870;">()</span>.check<span style="color: #709870;">(</span><span style="color: #8b2252;">"abc"</span>, <span style="color: #8b2252;">"123456"</span><span style="color: #709870;">)</span><span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ff0b00" class="outline-4">
<h4 id="org6ff0b00"><span class="section-number-4">14.2.4.</span> 然后，搞一个 LoginServlet 写 get/post 方法，分别用来表示 form 表单和处理登录逻辑</h4>
<div class="outline-text-4" id="text-14-2-4">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">package</span> book.<span style="color: #008b8b;">web</span>;

<span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/login"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">LoginServlet</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doGet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        req.getRequestDispatcher<span style="color: #909183;">(</span><span style="color: #8b2252;">"/login/login.jsp"</span><span style="color: #909183;">)</span>.forward<span style="color: #909183;">(</span>req, resp<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doPost</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"username"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"password"</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>username == <span style="color: #008b8b;">null</span> || password == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#23383;&#27573;&#19981;&#33021;&#20026;&#31354;"</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/regist/result.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">{</span>
            <span style="color: #228b22;">Account</span> <span style="color: #a0522d;">account</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">AccountDAO</span><span style="color: #709870;">()</span>.check<span style="color: #709870;">(</span>username, password<span style="color: #709870;">)</span>;

            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>account == <span style="color: #008b8b;">null</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                req.getSession<span style="color: #907373;">()</span>.setAttribute<span style="color: #907373;">(</span><span style="color: #8b2252;">"account"</span>, <span style="color: #008b8b;">null</span><span style="color: #907373;">)</span>;

                req.setAttribute<span style="color: #907373;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#29992;&#25143;&#21517;&#25110;&#32773;&#23494;&#30721;&#38169;&#35823;"</span><span style="color: #907373;">)</span>;
                req.getRequestDispatcher<span style="color: #907373;">(</span><span style="color: #8b2252;">"/login/result.jsp"</span><span style="color: #907373;">)</span>.forward<span style="color: #907373;">(</span>req, resp<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span> <span style="color: #a020f0;">else</span> <span style="color: #709870;">{</span>
                <span style="color: #228b22;">HttpSession</span> <span style="color: #a0522d;">session</span> = req.getSession<span style="color: #907373;">()</span>;
                session.setAttribute<span style="color: #907373;">(</span><span style="color: #8b2252;">"account"</span>, account<span style="color: #907373;">)</span>;

                req.setAttribute<span style="color: #907373;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#30331;&#24405;&#25104;&#21151;!!!"</span><span style="color: #907373;">)</span>;
                req.setAttribute<span style="color: #907373;">(</span><span style="color: #8b2252;">"page"</span>, <span style="color: #8b2252;">"/book/list"</span><span style="color: #907373;">)</span>;
                req.getRequestDispatcher<span style="color: #907373;">(</span><span style="color: #8b2252;">"/login/result.jsp"</span><span style="color: #907373;">)</span>.forward<span style="color: #907373;">(</span>req, resp<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            e.printStackTrace<span style="color: #709870;">()</span>;

            req.getSession<span style="color: #709870;">()</span>.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"account"</span>, <span style="color: #008b8b;">null</span><span style="color: #709870;">)</span>;

            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, e.getLocalizedMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/login/result.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
Form 表单页面 (从 regist.jsp 复制而来，然后修改而成):
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>%@ page <span style="color: #a0522d;">language</span>=<span style="color: #8b2252;">"java"</span> <span style="color: #a0522d;">contentType</span>=<span style="color: #8b2252;">"text/html; charset=UTF-8"</span>
    <span style="color: #a0522d;">pageEncoding</span>=<span style="color: #8b2252;">"UTF-8"</span>%<span style="color: #707183;">&gt;</span>
&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span><span style="font-weight: bold; text-decoration: underline;">&#30331;&#24405;&#39029;&#38754;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">style</span><span style="color: #707183;">&gt;</span>
    <span style="color: #0000ff;">label </span><span style="color: #707183;">{</span>
        <span style="color: #a020f0;">display</span>: flex;
    <span style="color: #707183;">}</span>
    <span style="color: #0000ff;">label span </span><span style="color: #707183;">{</span>
        <span style="color: #a020f0;">width</span>: 100px;
    <span style="color: #707183;">}</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">style</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span><span style="font-style: italic; text-decoration: underline;">&#30331;&#24405;&#39029;&#38754;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"/book/login"</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">"post"</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>&#29992;&#25143;&#21517;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"username"</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>&#23494;&#30721;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"password"</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>&#30331;&#24405;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">form</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div>

<p>
结果页面 (result.jsp):
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>%@ page <span style="color: #a0522d;">language</span>=<span style="color: #8b2252;">"java"</span> <span style="color: #a0522d;">contentType</span>=<span style="color: #8b2252;">"text/html; charset=UTF-8"</span>
    <span style="color: #a0522d;">pageEncoding</span>=<span style="color: #8b2252;">"UTF-8"</span>%<span style="color: #707183;">&gt;</span>
&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span><span style="font-weight: bold; text-decoration: underline;">&#30331;&#24405;&#39029;&#38754;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">style</span><span style="color: #707183;">&gt;</span>
    <span style="color: #0000ff;">label </span><span style="color: #707183;">{</span>
        <span style="color: #a020f0;">display</span>: flex;
    <span style="color: #707183;">}</span>
    <span style="color: #0000ff;">label span </span><span style="color: #707183;">{</span>
        <span style="color: #a020f0;">width</span>: 100px;
    <span style="color: #707183;">}</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">style</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span><span style="font-style: italic; text-decoration: underline;">&#30331;&#24405;&#39029;&#38754;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"/book/login"</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">"post"</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>&#29992;&#25143;&#21517;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"username"</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>&#23494;&#30721;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"password"</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">label</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>&#30331;&#24405;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">form</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org513e0cd" class="outline-4">
<h4 id="org513e0cd"><span class="section-number-4">14.2.5.</span> 最后，在其他页面上，建立到登录的入口</h4>
<div class="outline-text-4" id="text-14-2-5">
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span><span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"utf-8"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">link</span> <span style="color: #a0522d;">rel</span>=<span style="color: #8b2252;">"stylesheet"</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"css/xxx.css"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">style</span><span style="color: #707183;">&gt;</span>
        <span style="color: #0000ff;">form </span><span style="color: #707183;">{</span>
            <span style="color: #a020f0;">padding-bottom</span>: 1em;
            <span style="color: #a020f0;">width</span>: 98%;
            <span style="color: #a020f0;">display</span>: flex;
            <span style="color: #a020f0;">justify-content</span>: space-between;
        <span style="color: #707183;">}</span>
        <span style="color: #0000ff;">header </span><span style="color: #707183;">{</span>
            <span style="color: #a020f0;">display</span>: grid;
            <span style="color: #a020f0;">grid-template-columns</span>: 1fr auto;
        <span style="color: #707183;">}</span>
        <span style="color: #0000ff;">header span </span><span style="color: #707183;">{</span>
            <span style="color: #a020f0;">padding</span>: 1em 2em;
        <span style="color: #707183;">}</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">style</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">header</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span><span style="font-style: italic; text-decoration: underline;">163 &#20070;&#31821;&#31649;&#29702;&#31995;&#32479;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>%
            Object o = session.getAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"account"</span><span style="color: #7388d6;">)</span>;

            if <span style="color: #7388d6;">(</span>o == null<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
                out.print<span style="color: #909183;">(</span><span style="color: #8b2252;">"&lt;a href='/book/login'&gt;&#30331;&#24405;&lt;/a&gt;"</span><span style="color: #909183;">)</span>;
            <span style="color: #7388d6;">}</span> else <span style="color: #7388d6;">{</span>
                Account account = <span style="color: #909183;">(</span>Account<span style="color: #909183;">)</span> o;
                out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#27426;&#36814;&#24744; "</span>
                    + account.getUsername<span style="color: #709870;">()</span>
                    + <span style="color: #8b2252;">" ("</span> + account.getGender<span style="color: #709870;">()</span> + <span style="color: #8b2252;">")   &lt;a href='/book/logout'&gt;&#27880;&#38144;&lt;/a&gt;"</span><span style="color: #909183;">)</span>;
            <span style="color: #7388d6;">}</span>
        %<span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">header</span><span style="color: #707183;">&gt;</span>
    ....
    ....
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
</pre>
</div>

<p>
提示:
</p>
<ul class="org-ul">
<li>在 JSP 中，可以直接使用 session 表示 Session 对象</li>
<li>通过校验 session 中是否存在 account 来判断是否已经登录</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orga0c1901" class="outline-3">
<h3 id="orga0c1901"><span class="section-number-3">14.3.</span> 注销</h3>
<div class="outline-text-3" id="text-14-3">
<p>
就是发送一个请求到服务器，然后，服务器将会把保存在 Session 中的值给清空！
</p>

<p>
然后刷新下页面就可以啦。
</p>

<p>
我们需要:
</p>
<ul class="org-ul">
<li>写一个 GET /logout 的 Servlet，用来处理上述逻辑</li>
</ul>
</div>
</div>

<div id="outline-container-org250a3b0" class="outline-3">
<h3 id="org250a3b0"><span class="section-number-3">14.4.</span> 按照是否有登录，来限制某些业务</h3>
<div class="outline-text-3" id="text-14-4">
<p>
分析:
</p>
<ol class="org-ol">
<li>判断: session.getAttrubite("account");</li>
<li>如果没有登录，相关的一些链接和按钮不显示: /book/list</li>
<li>如果没有登录，对 /book/del 等的请求，会被服务器阻止</li>
</ol>

<p>
第 2 个问题，只需要定位到 /bookList.jsp，添加显示的条件即可:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>% if <span style="color: #7388d6;">(</span>session.getAttribute<span style="color: #909183;">(</span><span style="color: #8b2252;">"account"</span><span style="color: #909183;">)</span> != null<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span> %<span style="color: #88090B;">&gt;</span>
<span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>
  <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/book/del?id=&lt;%= book.id %&gt;'</span><span style="color: #7388d6;">&gt;</span>&#21024;&#38500;<span style="color: #7388d6;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #7388d6;">&gt;</span>
  <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/book/edit?id=&lt;%= book.id %&gt;'</span><span style="color: #7388d6;">&gt;</span>&#20462;&#25913;<span style="color: #7388d6;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #7388d6;">&gt;</span>
<span style="color: #7388d6;">&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>
<span style="color: #7388d6;">&lt;</span>% <span style="color: #88090B;">}</span> %<span style="color: #707183;">&gt;</span>
</pre>
</div>

<p>
第 3 个问题，适合使用过滤器来批量处理。即如果没登录，显示错误页面，然后返回，从而避免业务继续进行:
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebFilter</span><span style="color: #707183;">(</span><span style="color: #7388d6;">{</span><span style="color: #8b2252;">"/del"</span>, <span style="color: #8b2252;">"/add"</span>, <span style="color: #8b2252;">"/edit"</span><span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">PrivFilter</span> <span style="color: #a020f0;">implements</span> <span style="color: #228b22;">Filter</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doFilter</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">ServletRequest</span> <span style="color: #a0522d;">request</span>, <span style="color: #228b22;">ServletResponse</span> <span style="color: #a0522d;">response</span>, <span style="color: #228b22;">FilterChain</span> <span style="color: #a0522d;">chain</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">IOException</span>, <span style="color: #228b22;">ServletException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span> = <span style="color: #909183;">(</span><span style="color: #228b22;">HttpServletRequest</span><span style="color: #909183;">)</span> request;

        <span style="color: #a020f0;">if</span> <span style="color: #909183;">(</span>req.getSession<span style="color: #709870;">()</span>.getAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"account"</span><span style="color: #709870;">)</span> == <span style="color: #008b8b;">null</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#24744;&#27809;&#26377;&#26435;&#38480;&#20570;&#36825;&#26679;&#30340;&#20107;&#24773;"</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/bookResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>request, response<span style="color: #709870;">)</span>;
            <span style="color: #a020f0;">return</span>;
        <span style="color: #909183;">}</span>

        chain.doFilter<span style="color: #909183;">(</span>request, response<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">init</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">FilterConfig</span> <span style="color: #a0522d;">filterConfig</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span> <span style="color: #7388d6;">{</span>
    <span style="color: #7388d6;">}</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">destroy</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-orgec1af96" class="outline-2">
<h2 id="orgec1af96"><span class="section-number-2">15.</span> <span class="done CANCEL">CANCEL</span> 案例分析 (购物车的实现逻辑)</h2>
<div class="outline-text-2" id="text-15">
<p>
留作后续。
</p>
</div>
</section>

<section id="outline-container-org36f11b7" class="outline-2">
<h2 id="org36f11b7"><span class="section-number-2">16.</span> 案例分析 (↳ 简化JSP，EL表达式+JSTL 标签)</h2>
<div class="outline-text-2" id="text-16">
<p>
修改示例:
</p>
</div>

<div id="outline-container-orgf5a1eab" class="outline-3">
<h3 id="orgf5a1eab"><span class="section-number-3">16.1.</span> bookList.jsp 中的登录、注册</h3>
<div class="outline-text-3" id="text-16-1">
<p>
从:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span><span style="color: #0000ff;">header</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span><span style="font-style: italic; text-decoration: underline;">163 &#20070;&#31821;&#31649;&#29702;&#31995;&#32479;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>%
        Object o = session.getAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"account"</span><span style="color: #7388d6;">)</span>;

        if <span style="color: #7388d6;">(</span>o == null<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
            out.print<span style="color: #909183;">(</span><span style="color: #8b2252;">"&lt;a href='/book/login'&gt;&#30331;&#24405;&lt;/a&gt;"</span><span style="color: #909183;">)</span>;
        <span style="color: #7388d6;">}</span> else <span style="color: #7388d6;">{</span>
            Account account = <span style="color: #909183;">(</span>Account<span style="color: #909183;">)</span> o;
            out.println<span style="color: #909183;">(</span><span style="color: #8b2252;">"&#27426;&#36814;&#24744; "</span>
                + account.getUsername<span style="color: #709870;">()</span>
                + <span style="color: #8b2252;">" ("</span> + account.getGender<span style="color: #709870;">()</span> + <span style="color: #8b2252;">")&lt;a href='/book/logout'&gt;  &#27880;&#38144;&lt;/a&gt;"</span><span style="color: #909183;">)</span>;
        <span style="color: #7388d6;">}</span>
    %<span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">header</span><span style="color: #707183;">&gt;</span>
</pre>
</div>

<p>
到:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span><span style="color: #0000ff;">header</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span><span style="font-style: italic; text-decoration: underline;">163 &#20070;&#31821;&#31649;&#29702;&#31995;&#32479;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #483d8b;">c</span>:<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"${empty sessionScope.account}"</span><span style="color: #707183;">&gt;</span>
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"${pageContext.request.contextPath}/login"</span><span style="color: #707183;">&gt;</span>&#30331;&#24405;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>/<span style="color: #483d8b;">c</span>:<span style="color: #0000ff;">if</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #483d8b;">c</span>:<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"${sessionScope.account != null}"</span><span style="color: #707183;">&gt;</span>
            &#27426;&#36814;&#24744; $<span style="color: #707183;">{</span>account.username<span style="color: #707183;">}</span> !
            <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">"${pageContext.request.contextPath}/logout"</span><span style="color: #707183;">&gt;</span>&#27880;&#38144;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>/<span style="color: #483d8b;">c</span>:<span style="color: #0000ff;">if</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">header</span><span style="color: #707183;">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org382672e" class="outline-3">
<h3 id="org382672e"><span class="section-number-3">16.2.</span> bookList.jsp 中的表格渲染</h3>
<div class="outline-text-3" id="text-16-2">
<p>
从:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>%
  List<span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">Book</span><span style="color: #7388d6;">&gt;</span> books = <span style="color: #7388d6;">(</span>List<span style="color: #909183;">&lt;</span><span style="color: #0000ff;">Book</span><span style="color: #909183;">&gt;</span><span style="color: #7388d6;">)</span> request.getAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"xxx"</span><span style="color: #7388d6;">)</span>;
%<span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span>% for <span style="color: #7388d6;">(</span>Book book : books<span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span> %<span style="color: #88090B;">&gt;</span>
<span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">tr</span><span style="color: #7388d6;">&gt;</span>
    <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;&lt;</span>%= book.id %<span style="color: #7388d6;">&gt;&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>
    <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;&lt;</span>%= book.bookName %<span style="color: #7388d6;">&gt;&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>
    <span style="color: #7388d6;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;&lt;</span>%= book.price %<span style="color: #7388d6;">&gt;&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #7388d6;">&gt;</span>

    <span style="color: #7388d6;">&lt;</span>% if <span style="color: #909183;">(</span>session.getAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"account"</span><span style="color: #709870;">)</span> != null<span style="color: #909183;">)</span> <span style="color: #909183;">{</span> %<span style="color: #88090B;">&gt;</span>

    <span style="color: #909183;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #909183;">&gt;</span>
        <span style="color: #909183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/book/del?id=&lt;%= book.id %&gt;'</span><span style="color: #909183;">&gt;</span>&#21024;&#38500;<span style="color: #909183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #909183;">&gt;</span>
        <span style="color: #909183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/book/edit?id=&lt;%= book.id %&gt;'</span><span style="color: #909183;">&gt;</span>&#20462;&#25913;<span style="color: #909183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #909183;">&gt;</span>
    <span style="color: #909183;">&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #909183;">&gt;</span>

    <span style="color: #909183;">&lt;</span>% <span style="color: #88090B;">}</span> %<span style="color: #7388d6;">&gt;</span>

<span style="color: #7388d6;">&lt;</span>/<span style="color: #0000ff;">tr</span><span style="color: #7388d6;">&gt;</span>
<span style="color: #7388d6;">&lt;</span>% <span style="color: #88090B;">}</span> %<span style="color: #707183;">&gt;</span>
</pre>
</div>

<p>
到:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span><span style="color: #483d8b;">c</span>:<span style="color: #0000ff;">forEach</span> <span style="color: #a0522d;">var</span>=<span style="color: #8b2252;">"book"</span> <span style="color: #a0522d;">items</span>=<span style="color: #8b2252;">"${xxx}"</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">tr</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #707183;">&gt;</span>$<span style="color: #707183;">{</span>book.id<span style="color: #707183;">}&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #707183;">&gt;</span>$<span style="color: #707183;">{</span>book.bookName<span style="color: #707183;">}&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #707183;">&gt;</span>$<span style="color: #707183;">{</span>book.price<span style="color: #707183;">}&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #483d8b;">c</span>:<span style="color: #0000ff;">if</span> <span style="color: #a0522d;">test</span>=<span style="color: #8b2252;">"${sessionScope.account != null}"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">td</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'${pageContext.request.contextPath}/del?id=${book.id}'</span><span style="color: #707183;">&gt;</span>&#21024;&#38500;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'${pageContext.request.contextPath}/edit?id=${book.id}'</span><span style="color: #707183;">&gt;</span>&#20462;&#25913;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">td</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #483d8b;">c</span>:<span style="color: #0000ff;">if</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">tr</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #483d8b;">c</span>:<span style="color: #0000ff;">forEach</span><span style="color: #707183;">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f1a828" class="outline-3">
<h3 id="org6f1a828"><span class="section-number-3">16.3.</span> login/result.jsp 页面</h3>
<div class="outline-text-3" id="text-16-3">
<p>
从:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span><span style="color: #0000ff;">div</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'width: 400px; margin: 1em auto; background: #eee; padding: 2em;'</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'margin-right: 2em'</span><span style="color: #707183;">&gt;</span>
     <span style="color: #707183;">&lt;</span>%= request.getAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"message"</span><span style="color: #7388d6;">)</span> %<span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'&lt;%</span>
<span style="color: #8b2252;">    Object o = request.getAttribute("page");</span>
<span style="color: #8b2252;">    if (o == null) {</span>
<span style="color: #8b2252;">        out.print("/book/login");</span>
<span style="color: #8b2252;">    } else {</span>
<span style="color: #8b2252;">        out.print(o);</span>
<span style="color: #8b2252;">    }</span>
<span style="color: #8b2252;">    %&gt;'</span><span style="color: #707183;">&gt;</span>&#36820;&#22238;&#39318;&#39029;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>
</pre>
</div>

<p>
到:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span><span style="color: #0000ff;">div</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'width: 400px; margin: 1em auto; background: #eee; padding: 2em;'</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'margin-right: 2em'</span><span style="color: #707183;">&gt;</span>
       $<span style="color: #707183;">{</span>message <span style="color: #707183;">}</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'${pageContext.request.contextPath}${empty page ? "/list" : page }'</span><span style="color: #707183;">&gt;</span>&#36820;&#22238;&#39318;&#39029;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-org9cfc9c2" class="outline-2">
<h2 id="org9cfc9c2"><span class="section-number-2">17.</span> 案例分析 (● 结束)</h2>
<div class="outline-text-2" id="text-17">
<ul class="org-ul">
<li>仓库: <a href="https://github.com/yaollllllsan/3-book">https://github.com/yaollllllsan/3-book</a></li>
<li>代码: <a href="https://github.com/yaollllllsan/3-book/archive/master.zip">https://github.com/yaollllllsan/3-book/archive/master.zip</a></li>
</ul>
</div>
</section>

<section id="outline-container-org56794cc" class="outline-2">
<h2 id="org56794cc"><span class="section-number-2">18.</span> 注册和登录 (复盘)</h2>
<div class="outline-text-2" id="text-18">
<p>
B(浏览器) S(服务器)
</p>

<p>
准备工具:
</p>
<ul class="org-ul">
<li>浏览器 (Chome/Edge)</li>
<li>Tomcat/JDK (tomcat8/jdk8)</li>
<li>Eclipse JEE (企业版)</li>
<li>数据库 (SQLServer)</li>
</ul>

<p>
技术准备:
</p>
<ul class="org-ul">
<li>一点点点的 CSS (锦上添花)</li>
<li>一点点的 html (基础)</li>
<li>一点的 JS</li>
<li>一点的 Java</li>
<li>JDBC 的基本使用!!!</li>
<li>一点的 Java Web (Servlet+CRUD)</li>
</ul>
</div>

<div id="outline-container-orgb1de8a6" class="outline-3">
<h3 id="orgb1de8a6"><span class="section-number-3">18.1.</span> 预览</h3>
<div class="outline-text-3" id="text-18-1">
<p>
<a href="https://github.com/yaollllllsan/4-regandlog/archive/master.zip">https://github.com/yaollllllsan/4-regandlog/archive/master.zip</a>
</p>


<figure id="org0f69d8b">
<img src="img/oimg_20200728_035835.png" alt="oimg_20200728_035835.png">

</figure>
</div>
</div>

<div id="outline-container-orga8590e8" class="outline-3">
<h3 id="orga8590e8"><span class="section-number-3">18.2.</span> 首先第一步，要分析题目</h3>
<div class="outline-text-3" id="text-18-2">
<p>
两个功能，注册 + 登录。
</p>

<p>
需要一张表，user，用来保存用户信息。
</p>

<p>
需要两个 Servlet，分别用来处理注册和登录。
</p>

<p>
注册的主要逻辑，是向数据库插入一条用户信息。
</p>

<p>
登录的主要逻辑，是向数据库查询用户信息，并将结果保存到 Session。
</p>
</div>
</div>

<div id="outline-container-org0402a46" class="outline-3">
<h3 id="org0402a46"><span class="section-number-3">18.3.</span> 创建一个动态 Web 项目，复制一些必要文件</h3>
<div class="outline-text-3" id="text-18-3">
<p>
src/regandlog/
</p>
<ul class="org-ul">
<li>filter/EncodingFilter.java</li>
<li>util/DBHelper.java</li>
<li>bean/</li>
<li>dao/</li>
<li>web/</li>
</ul>

<p>
WebContent/
</p>
<ul class="org-ul">
<li>WEB-INF
<ul class="org-ul">
<li>lib/jdbc.jar</li>
</ul></li>
</ul>

<p>
注意，不要落下 JDBC 驱动包。
</p>
</div>
</div>

<div id="outline-container-orgbaf2a3f" class="outline-3">
<h3 id="orgbaf2a3f"><span class="section-number-3">18.4.</span> 然后，创建所需要的表</h3>
<div class="outline-text-3" id="text-18-4">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">myuser</span>
<span style="color: #707183;">(</span>
    username <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>100<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>,
    password <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>100<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>,
    usertype <span style="color: #228b22;">int</span> <span style="color: #a020f0;">default</span> 1
<span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org185d6a8" class="outline-3">
<h3 id="org185d6a8"><span class="section-number-3">18.5.</span> 之后，在 bean 包下创建 User.java</h3>
<div class="outline-text-3" id="text-18-5">
<p>
结构跟数据库的 myuser 是对应的。
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">package</span> regandlog.<span style="color: #008b8b;">bean</span>;

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">User</span> <span style="color: #707183;">{</span>
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span>;
    <span style="color: #a020f0;">private</span> <span style="color: #228b22;">int</span> <span style="color: #a0522d;">userType</span>;

    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">getUsername</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> username;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">setUsername</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">this</span>.username = username;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">String</span> <span style="color: #0000ff;">getPassword</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> password;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">setPassword</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">this</span>.password = password;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">int</span> <span style="color: #0000ff;">getUserType</span><span style="color: #7388d6;">()</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">return</span> userType;
    <span style="color: #7388d6;">}</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">setUserType</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">int</span> <span style="color: #a0522d;">userType</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">{</span>
        <span style="color: #a020f0;">this</span>.userType = userType;
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orge040de5" class="outline-3">
<h3 id="orge040de5"><span class="section-number-3">18.6.</span> 随后，为接下来的业务，封装数据库操作的逻辑 (dao)</h3>
<div class="outline-text-3" id="text-18-6">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">package</span> regandlog.<span style="color: #008b8b;">dao</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">sql</span>.<span style="color: #228b22;">Connection</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">sql</span>.<span style="color: #228b22;">PreparedStatement</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">sql</span>.<span style="color: #228b22;">ResultSet</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">regandlog</span>.<span style="color: #008b8b;">bean</span>.<span style="color: #228b22;">User</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">regandlog</span>.<span style="color: #008b8b;">util</span>.<span style="color: #228b22;">DBHelper</span>;

<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">UserDAO</span> <span style="color: #707183;">{</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20026;&#20102;&#27880;&#20876;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#26681;&#25454;&#20256;&#20837;&#30340; User&#65292;&#21521;&#25968;&#25454;&#24211;&#25554;&#20837;&#19968;&#26465;&#25968;&#25454;</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">insert</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"insert into myuser (username, password, usertype) values (?,?,?)"</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">conn</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = conn.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            statement.setString<span style="color: #709870;">(</span>1, user.getUsername<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            statement.setString<span style="color: #709870;">(</span>2, user.getPassword<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            statement.setInt<span style="color: #709870;">(</span>3, user.getUserType<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            statement.executeUpdate<span style="color: #709870;">()</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>

    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#20026;&#20102;&#30331;&#24405;</span>
    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36319;&#25968;&#25454;&#24211;&#26657;&#39564;&#65292;&#26377;&#27809;&#26377;&#27492; username&#12289;password &#30340;&#29992;&#25143;&#65292;&#22914;&#26524;&#26377;&#65292;&#21462;&#20986;&#26469;</span>
    <span style="color: #a020f0;">public</span> <span style="color: #228b22;">User</span> <span style="color: #0000ff;">get</span> <span style="color: #7388d6;">(</span><span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span>, <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">Exception</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">sql</span> = <span style="color: #8b2252;">"select usertype from myuser where username = ? and password = ?"</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Connection</span> <span style="color: #a0522d;">conn</span> = DBHelper.getConnection<span style="color: #709870;">()</span>;
                <span style="color: #228b22;">PreparedStatement</span> <span style="color: #a0522d;">statement</span> = conn.prepareStatement<span style="color: #709870;">(</span>sql<span style="color: #709870;">)</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            statement.setString<span style="color: #709870;">(</span>1, username<span style="color: #709870;">)</span>;
            statement.setString<span style="color: #709870;">(</span>2, password<span style="color: #709870;">)</span>;

            <span style="color: #a020f0;">try</span> <span style="color: #709870;">(</span><span style="color: #228b22;">ResultSet</span> <span style="color: #a0522d;">rs</span> = statement.executeQuery<span style="color: #907373;">()</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                <span style="color: #b22222;">// </span><span style="color: #b22222;">&#25968;&#25454;&#26597;&#21040;&#20102;&#65292;&#35828;&#26126;&#29992;&#25143;&#21517;&#12289;&#23494;&#30721;&#26159;&#23545;&#30340;&#65292;&#37027;&#20040;&#23553;&#35013;&#36820;&#22238;</span>
                <span style="color: #a020f0;">if</span> <span style="color: #907373;">(</span>rs.next<span style="color: #6276ba;">()</span><span style="color: #907373;">)</span> <span style="color: #907373;">{</span>
                    <span style="color: #228b22;">int</span> <span style="color: #a0522d;">userType</span> = rs.getInt<span style="color: #6276ba;">(</span>1<span style="color: #6276ba;">)</span>;

                    <span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">User</span><span style="color: #6276ba;">()</span>;
                    user.setUsername<span style="color: #6276ba;">(</span>username<span style="color: #6276ba;">)</span>;
                    user.setPassword<span style="color: #6276ba;">(</span>password<span style="color: #6276ba;">)</span>;
                    user.setUserType<span style="color: #6276ba;">(</span>userType<span style="color: #6276ba;">)</span>;

                    <span style="color: #a020f0;">return</span> user;
                <span style="color: #907373;">}</span> <span style="color: #a020f0;">else</span> <span style="color: #907373;">{</span>
                    <span style="color: #b22222;">// </span><span style="color: #b22222;">&#27809;&#26377;&#26597;&#21040;&#65292;&#36820;&#22238; null&#65292;&#35828;&#26126;&#29992;&#25143;&#21517;&#25110;&#23494;&#30721;&#38169;&#20102;</span>
                    <span style="color: #a020f0;">return</span> <span style="color: #008b8b;">null</span>;
                <span style="color: #907373;">}</span>
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org63ade75" class="outline-3">
<h3 id="org63ade75"><span class="section-number-3">18.7.</span> 准备工作完成，实现注册</h3>
<div class="outline-text-3" id="text-18-7">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">package</span> regandlog.<span style="color: #008b8b;">web</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">io</span>.<span style="color: #228b22;">IOException</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #228b22;">ServletException</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #008b8b;">annotation</span>.<span style="color: #228b22;">WebServlet</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #008b8b;">http</span>.<span style="color: #228b22;">HttpServlet</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #008b8b;">http</span>.<span style="color: #228b22;">HttpServletRequest</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #008b8b;">http</span>.<span style="color: #228b22;">HttpServletResponse</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">regandlog</span>.<span style="color: #008b8b;">bean</span>.<span style="color: #228b22;">User</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">regandlog</span>.<span style="color: #008b8b;">dao</span>.<span style="color: #228b22;">UserDAO</span>;

<span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/regist"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">RegistServlet</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36820;&#22238;&#21253;&#21547; form &#34920;&#21333;&#30340;&#39029;&#38754;</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doGet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        req.getRequestDispatcher<span style="color: #909183;">(</span><span style="color: #8b2252;">"/regist.jsp"</span><span style="color: #909183;">)</span>.forward<span style="color: #909183;">(</span>req, resp<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span> <span style="color: #b22222;">// </span><span style="color: #b22222;">&#36827;&#34892;&#25968;&#25454;&#24211;&#30340;&#25554;&#20837;&#65292;&#28982;&#21518;&#36820;&#22238;&#25104;&#21151;&#39029;&#38754;</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doPost</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"username"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"password"</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">{</span>
            <span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">User</span><span style="color: #709870;">()</span>;
            user.setUsername<span style="color: #709870;">(</span>username<span style="color: #709870;">)</span>;
            user.setPassword<span style="color: #709870;">(</span>password<span style="color: #709870;">)</span>;
            user.setUserType<span style="color: #709870;">(</span>1<span style="color: #709870;">)</span>;

            <span style="color: #a020f0;">new</span> <span style="color: #228b22;">UserDAO</span><span style="color: #709870;">()</span>.insert<span style="color: #709870;">(</span>user<span style="color: #709870;">)</span>;

            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#27880;&#20876;&#25104;&#21151;"</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/registResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#27880;&#20876;&#22833;&#36133;: "</span> + e.getLocalizedMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/registResult.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
页面:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>%@page <span style="color: #a0522d;">language</span>=<span style="color: #8b2252;">"java"</span> <span style="color: #a0522d;">contentType</span>=<span style="color: #8b2252;">"text/html; charset=utf-8"</span> <span style="color: #a0522d;">pageEncoding</span>=<span style="color: #8b2252;">"utf-8"</span>%<span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
  <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"/regandlog/regist"</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">"post"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"username"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#29992;&#25143;&#21517;"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#23494;&#30721;"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>&#27880;&#20876;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>
  <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">form</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div>

<p>
失败或成功的页面:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>%@ page <span style="color: #a0522d;">language</span>=<span style="color: #8b2252;">"java"</span> <span style="color: #a0522d;">contentType</span>=<span style="color: #8b2252;">"text/html; charset=UTF-8"</span> <span style="color: #a0522d;">pageEncoding</span>=<span style="color: #8b2252;">"UTF-8"</span>%<span style="color: #707183;">&gt;</span>
&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
  <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span><span style="font-weight: bold; text-decoration: underline;">&#32467;&#26524;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span>
  <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
  <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>

    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">div</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'width: 400px; margin: 1em auto; background: #eee; padding: 2em;'</span><span style="color: #707183;">&gt;</span>
      <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'margin-right: 2em'</span><span style="color: #707183;">&gt;</span>
        <span style="color: #707183;">&lt;</span>%= request.getAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"message"</span><span style="color: #7388d6;">)</span> %<span style="color: #707183;">&gt;</span>
      <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
      <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/regandlog/regist'</span><span style="color: #707183;">&gt;</span>&#36820;&#22238;&#39318;&#39029;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>

  <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org793ab7f" class="outline-3">
<h3 id="org793ab7f"><span class="section-number-3">18.8.</span> 最后，是登录的逻辑</h3>
<div class="outline-text-3" id="text-18-8">
<p>
要善于使用 Ctrl-C 和 Ctrl-V!
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #a020f0;">package</span> regandlog.<span style="color: #008b8b;">web</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">java</span>.<span style="color: #008b8b;">io</span>.<span style="color: #228b22;">IOException</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #228b22;">ServletException</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #008b8b;">annotation</span>.<span style="color: #228b22;">WebServlet</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #008b8b;">http</span>.<span style="color: #228b22;">HttpServlet</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #008b8b;">http</span>.<span style="color: #228b22;">HttpServletRequest</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">javax</span>.<span style="color: #008b8b;">servlet</span>.<span style="color: #008b8b;">http</span>.<span style="color: #228b22;">HttpServletResponse</span>;

<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">regandlog</span>.<span style="color: #008b8b;">bean</span>.<span style="color: #228b22;">User</span>;
<span style="color: #a020f0;">import</span> <span style="color: #008b8b;">regandlog</span>.<span style="color: #008b8b;">dao</span>.<span style="color: #228b22;">UserDAO</span>;

<span style="color: #008b8b;">@WebServlet</span><span style="color: #707183;">(</span><span style="color: #8b2252;">"/login"</span><span style="color: #707183;">)</span>
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">LoginServlet</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span> <span style="color: #707183;">{</span>
    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doGet</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        req.getRequestDispatcher<span style="color: #909183;">(</span><span style="color: #8b2252;">"/login.jsp"</span><span style="color: #909183;">)</span>.forward<span style="color: #909183;">(</span>req, resp<span style="color: #909183;">)</span>;
    <span style="color: #7388d6;">}</span>

    <span style="color: #008b8b;">@Override</span>
    <span style="color: #a020f0;">protected</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doPost</span><span style="color: #7388d6;">(</span><span style="color: #228b22;">HttpServletRequest</span> <span style="color: #a0522d;">req</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #a0522d;">resp</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span> <span style="color: #7388d6;">{</span>
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">username</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"username"</span><span style="color: #909183;">)</span>;
        <span style="color: #228b22;">String</span> <span style="color: #a0522d;">password</span> = req.getParameter<span style="color: #909183;">(</span><span style="color: #8b2252;">"password"</span><span style="color: #909183;">)</span>;

        <span style="color: #a020f0;">try</span> <span style="color: #909183;">{</span>
            <span style="color: #228b22;">User</span> <span style="color: #a0522d;">user</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">UserDAO</span><span style="color: #709870;">()</span>.get<span style="color: #709870;">(</span>username, password<span style="color: #709870;">)</span>;

            <span style="color: #a020f0;">if</span> <span style="color: #709870;">(</span>user != <span style="color: #008b8b;">null</span><span style="color: #709870;">)</span> <span style="color: #709870;">{</span>
                req.getSession<span style="color: #907373;">()</span>.setAttribute<span style="color: #907373;">(</span><span style="color: #8b2252;">"user"</span>, user<span style="color: #907373;">)</span>;
                req.getRequestDispatcher<span style="color: #907373;">(</span><span style="color: #8b2252;">"/loginCG.jsp"</span><span style="color: #907373;">)</span>.forward<span style="color: #907373;">(</span>req, resp<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span> <span style="color: #a020f0;">else</span> <span style="color: #709870;">{</span>
                req.setAttribute<span style="color: #907373;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#29992;&#25143;&#21517;&#25110;&#23494;&#30721;&#38169;&#35823;"</span><span style="color: #907373;">)</span>;
                req.getRequestDispatcher<span style="color: #907373;">(</span><span style="color: #8b2252;">"/loginSB.jsp"</span><span style="color: #907373;">)</span>.forward<span style="color: #907373;">(</span>req, resp<span style="color: #907373;">)</span>;
            <span style="color: #709870;">}</span>
        <span style="color: #909183;">}</span> <span style="color: #a020f0;">catch</span> <span style="color: #909183;">(</span><span style="color: #228b22;">Exception</span> <span style="color: #a0522d;">e</span><span style="color: #909183;">)</span> <span style="color: #909183;">{</span>
            req.setAttribute<span style="color: #709870;">(</span><span style="color: #8b2252;">"message"</span>, <span style="color: #8b2252;">"&#30331;&#24405;&#22833;&#36133;: "</span> + e.getLocalizedMessage<span style="color: #907373;">()</span><span style="color: #709870;">)</span>;
            req.getRequestDispatcher<span style="color: #709870;">(</span><span style="color: #8b2252;">"/loginSB.jsp"</span><span style="color: #709870;">)</span>.forward<span style="color: #709870;">(</span>req, resp<span style="color: #709870;">)</span>;
        <span style="color: #909183;">}</span>
    <span style="color: #7388d6;">}</span>
<span style="color: #707183;">}</span>
</pre>
</div>

<p>
登录页面:
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>%@page <span style="color: #a0522d;">language</span>=<span style="color: #8b2252;">"java"</span> <span style="color: #a0522d;">contentType</span>=<span style="color: #8b2252;">"text/html; charset=utf-8"</span> <span style="color: #a0522d;">pageEncoding</span>=<span style="color: #8b2252;">"utf-8"</span>%<span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
  <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span><span style="font-style: italic; text-decoration: underline;">&#30331;&#24405;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">h3</span><span style="color: #707183;">&gt;</span>
  <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">form</span> <span style="color: #a0522d;">action</span>=<span style="color: #8b2252;">"/regandlog/login"</span> <span style="color: #a0522d;">method</span>=<span style="color: #8b2252;">"post"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"username"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#29992;&#25143;&#21517;"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #a0522d;">name</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">type</span>=<span style="color: #8b2252;">"password"</span> <span style="color: #a0522d;">placeholder</span>=<span style="color: #8b2252;">"&#23494;&#30721;"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>&#30331;&#24405;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">button</span><span style="color: #707183;">&gt;</span>
  <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">form</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div>

<p>
登录成功 (loginCG.jsp):
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>%@page <span style="color: #a0522d;">import</span>=<span style="color: #8b2252;">"regandlog.bean.User"</span>%<span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>%@ page <span style="color: #a0522d;">language</span>=<span style="color: #8b2252;">"java"</span> <span style="color: #a0522d;">contentType</span>=<span style="color: #8b2252;">"text/html; charset=UTF-8"</span> <span style="color: #a0522d;">pageEncoding</span>=<span style="color: #8b2252;">"UTF-8"</span>%<span style="color: #707183;">&gt;</span>
&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span><span style="font-weight: bold; text-decoration: underline;">&#32467;&#26524;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">div</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'width: 400px; margin: 1em auto; background: #eee; padding: 2em;'</span><span style="color: #707183;">&gt;</span>
    &#30331;&#24405;&#25104;&#21151;&#65281;&#65281;&#65281;&#65281;
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">p</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">"color: red"</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>%
    User user = <span style="color: #7388d6;">(</span>User<span style="color: #7388d6;">)</span> session.getAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"user"</span><span style="color: #7388d6;">)</span>;
    out.println<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"&#27426;&#36814;&#24744; "</span> + user.getUsername<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>;
    %<span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">p</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div>

<p>
登录失败 (loginSB.jsp):
</p>
<div class="org-src-container">
<pre class="src src-html"><span style="color: #707183;">&lt;</span>%@ page <span style="color: #a0522d;">language</span>=<span style="color: #8b2252;">"java"</span> <span style="color: #a0522d;">contentType</span>=<span style="color: #8b2252;">"text/html; charset=UTF-8"</span> <span style="color: #a0522d;">pageEncoding</span>=<span style="color: #8b2252;">"UTF-8"</span>%<span style="color: #707183;">&gt;</span>
&lt;<span style="color: #a020f0;">!DOCTYPE</span> html&gt;
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">meta</span> <span style="color: #a0522d;">charset</span>=<span style="color: #8b2252;">"UTF-8"</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span><span style="font-weight: bold; text-decoration: underline;">&#32467;&#26524;</span><span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">title</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">head</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span><span style="color: #0000ff;">div</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'width: 400px; margin: 1em auto; background: #eee; padding: 2em;'</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">span</span> <span style="color: #a0522d;">style</span>=<span style="color: #8b2252;">'margin-right: 2em'</span><span style="color: #707183;">&gt;</span>
     <span style="color: #707183;">&lt;</span>%= request.getAttribute<span style="color: #7388d6;">(</span><span style="color: #8b2252;">"message"</span><span style="color: #7388d6;">)</span> %<span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">span</span><span style="color: #707183;">&gt;</span>
    <span style="color: #707183;">&lt;</span><span style="color: #0000ff;">a</span> <span style="color: #a0522d;">href</span>=<span style="color: #8b2252;">'/regandlog/login'</span><span style="color: #707183;">&gt;</span>&#36820;&#22238;&#39318;&#39029;<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">a</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">div</span><span style="color: #707183;">&gt;</span>

<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">body</span><span style="color: #707183;">&gt;</span>
<span style="color: #707183;">&lt;</span>/<span style="color: #0000ff;">html</span><span style="color: #707183;">&gt;</span>
</pre>
</div>
</div>
</div>
</section>

<section id="outline-container-orgd2549e9" class="outline-2">
<h2 id="orgd2549e9"><span class="section-number-2">19.</span> 手机的增删改查 (复盘)</h2>
<div class="outline-text-2" id="text-19">
</div>
<div id="outline-container-org1693c2b" class="outline-3">
<h3 id="org1693c2b"><span class="section-number-3">19.1.</span> 综述</h3>
<div class="outline-text-3" id="text-19-1">
<p>
盘点:
</p>
<ul class="org-ul">
<li>主体: 手机 (Phone)</li>
<li>操作: 增删改查 (CRUD)</li>
</ul>

<p>
准备工作:
</p>
<ul class="org-ul">
<li>创建一个 Web 项目 (phone)</li>
<li>在数据库中创建一张表 phone
<ul class="org-ul">
<li>id</li>
<li>name</li>
<li>price</li>
</ul></li>
<li>创建相应的文件夹 (包)，C-c C-v 相应类
<ul class="org-ul">
<li>bean</li>
<li>dao</li>
<li>listener+filter (编码/Startup)</li>
<li>utils (DBHelper.java)</li>
<li>web</li>
</ul></li>
<li>C-c C-v 两个 jar 包 (jdbc/jstl)</li>
</ul>

<p>
正式完成:
</p>
<ul class="org-ul">
<li>为 Phone 表，在项目中创建相应的 bean/Phone.java
<ul class="org-ul">
<li>要写上 get/set 方法</li>
</ul></li>
<li>为接下来的业务，创建数据库的操作类 dao/PhoneDAO.java:
<ul class="org-ul">
<li>insert(name, price)</li>
<li>delete(id)</li>
<li><del>update(name, price)</del></li>
<li>list/get()</li>
</ul></li>
<li>创建相应的 web/XxxServlet 和 jsp/xxx.jsp 然后完成相应功能
<ul class="org-ul">
<li>PhoneListServlet (/list)</li>
<li>PhoneAddServlet (/add)</li>
<li>PhoneDelServlet (/del)</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org3b43673" class="outline-3">
<h3 id="org3b43673"><span class="section-number-3">19.2.</span> 视频步骤</h3>
<div class="outline-text-3" id="text-19-2">
<video preload="metadata" controls="controls" width="600">
  <source src="../videos/phone_crud.mp4" />
</video>
</div>
</div>

<div id="outline-container-orge230ba0" class="outline-3">
<h3 id="orge230ba0"><span class="section-number-3">19.3.</span> 修改功能</h3>
<div class="outline-text-3" id="text-19-3">
<ul class="org-ul">
<li>EditServlet (get/post)</li>
<li>edit.jsp</li>
<li><del>message.jsp</del></li>
</ul>


<video preload="metadata" controls="controls" width="600">
  <source src="../videos/phone_edit.mp4" />
</video>
</div>
</div>

<div id="outline-container-orge79334d" class="outline-3">
<h3 id="orge79334d"><span class="section-number-3">19.4.</span> 搜索功能</h3>
<div class="outline-text-3" id="text-19-4">
<ul class="org-ul">
<li>复用 ListServlet</li>
<li>在 list.jsp 中添加一个 form 表单</li>
</ul>

<video preload="metadata" controls="controls" width="600">
  <source src="../videos/phone_search.mp4" />
</video>
</div>
</div>

<div id="outline-container-orgd983be8" class="outline-3">
<h3 id="orgd983be8"><span class="section-number-3">19.5.</span> 仓库及代码</h3>
<div class="outline-text-3" id="text-19-5">
<ul class="org-ul">
<li>仓库: <a href="https://github.com/yaollllllsan/5-phone">https://github.com/yaollllllsan/5-phone</a></li>
<li>代码: <a href="https://github.com/yaollllllsan/5-phone/archive/master.zip">https://github.com/yaollllllsan/5-phone/archive/master.zip</a></li>
</ul>
</div>
</div>
</section>

<section id="outline-container-org6141a6e" class="outline-2">
<h2 id="org6141a6e"><span class="section-number-2">20.</span> 考试上机</h2>
<div class="outline-text-2" id="text-20">
<ul class="org-ul">
<li>SQL 的文件一定要记得打包进去，否则 10 分没了
<ul class="org-ul">
<li>创建表的语句</li>
<li>插入若干行的示例数据</li>
</ul></li>
<li>拷贝示例项目，在其基础上修改是可行的。但是一定要将需要改的地方都改好</li>
<li>一定要按照题目要求来</li>
</ul>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 悟饭</p>
<p class="date">Created: 2021-05-20</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
