<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2021-12-27 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SQL 语句</title>
<meta name="generator" content="Org mode">
<meta name="author" content="悟饭">
<link rel='stylesheet' href='/html/asset/common.css?3344' />
<link rel='stylesheet' href='/yaoliuyao/html/asset/common.css?3344' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/html/asset/common.js'></script>
<script src='/yaoliuyao/html/asset/common.js'></script>

<style>
 /* From: https://endlessparentheses.com/public/css/endless.css */
 .special-kbd {
   color: #333;
   background-color: #f7f7f7;
   border: 1px solid #ccc;
   border-radius: 6px;
   box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
   display: inline-block;
   font-family: 'Droid Sans Mono', monospace;
   font-size: 80%;
   font-weight: normal;
   line-height: inherit;
   margin: 2px .1em;
   padding: .04em .4em;
   text-shadow: 0 1px 0 #fff;
   word-spacing: -3px;
 }
</style>
</head>
<body>
<div id="content">
<header>
<h1 class="title">SQL 语句</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org6d01a37">1. SQL 是什么</a></li>
<li><a href="#org7e7eca7">2. SQL 的分类</a>
<ul>
<li><a href="#org1118f92">2.1. DDL (Data Definition Language) 数据定义语言</a></li>
<li><a href="#org30e315c">2.2. DML (Data Manipulation Language) 数据操纵语言</a></li>
<li><a href="#org08e8165">2.3. DCL (Data Control Language) 数据控制语言</a></li>
<li><a href="#orgb0c5ce7">2.4. TCL (Transaction Control Language) 事务控制语言</a></li>
</ul>
</li>
<li><a href="#org0d1d5cf">3. SQLServer 中的 SQL 语句</a>
<ul>
<li><a href="#org95e415e">3.1. database 的创建和删除</a></li>
<li><a href="#org76054f3">3.2. table 的创建</a></li>
<li><a href="#orga0b377a">3.3. 常见数据类型</a>
<ul>
<li><a href="#org71e829e">3.3.1. 数值</a></li>
<li><a href="#org5d722f5">3.3.2. 字符串</a></li>
<li><a href="#org8ea4c34">3.3.3. 日期/时间</a></li>
<li><a href="#orgb9ab735">3.3.4. 其他类型</a></li>
<li><a href="#org046ff95">3.3.5. 使用例子</a></li>
</ul>
</li>
<li><a href="#orgb337c95">3.4. table 的修改</a></li>
<li><a href="#org6119365">3.5. table 的删除</a></li>
<li><a href="#orgfb6d19b">3.6. constraint 的管理</a></li>
<li><a href="#org4b2a0b7">3.7. insert 插入</a></li>
<li><a href="#org80bc96e">3.8. delete/truncate 删除</a></li>
<li><a href="#orgd070207">3.9. update 更新</a></li>
<li><a href="#org4576516">3.10. select 查询</a>
<ul>
<li><a href="#org9a4da80">3.10.1. 测试数据</a></li>
<li><a href="#org28560d2">3.10.2. 基本查询</a></li>
<li><a href="#org29028c0">3.10.3. 子查询 (subquery)</a>
<ul>
<li><a href="#org90a70a9">3.10.3.1. 作为临时表存在</a></li>
<li><a href="#org19acf45">3.10.3.2. 作为字段存在</a></li>
<li><a href="#org2518bce">3.10.3.3. 作为条件存在</a></li>
<li><a href="#orgc1c163a">3.10.3.4. 阶段性作业 (subquery)</a></li>
</ul>
</li>
<li><a href="#org3a6ee8c">3.10.4. 连接查询 (join)</a></li>
<li><a href="#orgcf501e0">3.10.5. 合并 (union)</a></li>
<li><a href="#orge2ee714">3.10.6. 分组、窗口查询 (group by/over)</a></li>
<li><a href="#orga5fa186">3.10.7. 分页查询 (top/row_number/fetch-offset)</a></li>
</ul>
</li>
<li><a href="#org0d5b1d4">3.11. Transaction 事务</a>
<ul>
<li><a href="#org61b0733">3.11.1. 什么是事务 (ACID)</a></li>
<li><a href="#orgb9b9933">3.11.2. 事务的状态</a></li>
<li><a href="#orgc0615ba">3.11.3. SQLServer 中的事务</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6c4ea5c">4. MySQL 中的 SQL 语句</a>
<ul>
<li><a href="#org8260f91">4.1. create</a></li>
<li><a href="#org14c2a03">4.2. 分页</a></li>
</ul>
</li>
</ul>
</div>
</nav>


<section id="outline-container-org6d01a37" class="outline-2">
<h2 id="org6d01a37"><span class="section-number-2">1.</span> SQL 是什么</h2>
<div class="outline-text-2" id="text-1">
<p>
Structured Query Language, 结构化查询语言。
</p>

<p>
它是操作<a href="../roam/20200826034745-关系型数据库.html">关系型数据</a>的标准语言。
</p>

<p>
发展简史:
</p>
<ul class="org-ul">
<li>1976 左右，IBM 发表了想法</li>
<li>1979 左右，Oracle 给出了实现</li>
<li>1990 左右，SQL 成了工业标准</li>
</ul>
</div>
</section>

<section id="outline-container-org7e7eca7" class="outline-2">
<h2 id="org7e7eca7"><span class="section-number-2">2.</span> SQL 的分类</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org1118f92" class="outline-3">
<h3 id="org1118f92"><span class="section-number-3">2.1.</span> DDL (Data Definition Language) 数据定义语言</h3>
<div class="outline-text-3" id="text-2-1">
<p>
用来对数据的对象进行定义的一些语句:
</p>
<ul class="org-ul">
<li>创建: <code>create 类型 名字 详细定义</code> 例: <code>create table xxx ()</code></li>
<li>修改: <code>alter 类型 名字 你要修改的东西</code> 例: <code>alter table xxx add column (yyy int)</code></li>
<li>删掉: <code>drop 类型 名字</code> 例: <code>drop table xxx</code></li>
</ul>
</div>
</div>

<div id="outline-container-org30e315c" class="outline-3">
<h3 id="org30e315c"><span class="section-number-3">2.2.</span> DML (Data Manipulation Language) 数据操纵语言</h3>
<div class="outline-text-3" id="text-2-2">
<p>
对数据的操作:
</p>
<ul class="org-ul">
<li>增(C): <code>insert into</code></li>
<li>删(D): <code>delete from</code></li>
<li>改(U): <code>update</code></li>
<li>查(R): <code>select from</code>  <b>-</b>-</li>
</ul>
</div>
</div>

<div id="outline-container-org08e8165" class="outline-3">
<h3 id="org08e8165"><span class="section-number-3">2.3.</span> DCL (Data Control Language) 数据控制语言</h3>
<div class="outline-text-3" id="text-2-3">
<ul class="org-ul">
<li>授予权限: <code>grant to</code></li>
<li>撤回权限: <code>revoke from</code></li>
</ul>
</div>
</div>

<div id="outline-container-orgb0c5ce7" class="outline-3">
<h3 id="orgb0c5ce7"><span class="section-number-3">2.4.</span> TCL (Transaction Control Language) 事务控制语言</h3>
<div class="outline-text-3" id="text-2-4">
<ul class="org-ul">
<li>设置保存点: <code>savepoint xxx</code></li>
<li>撤回: <code>rollback [xxx]</code></li>
<li>提交: <code>commit</code></li>
</ul>
</div>
</div>
</section>

<section id="outline-container-org0d1d5cf" class="outline-2">
<h2 id="org0d1d5cf"><span class="section-number-2">3.</span> SQLServer 中的 SQL 语句</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org95e415e" class="outline-3">
<h3 id="org95e415e"><span class="section-number-3">3.1.</span> database 的创建和删除</h3>
<div class="outline-text-3" id="text-3-1">
<p>
最基本的创建语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">create</span> database demo;
<span style="color: #a020f0;">go</span>
</pre>
</div>

<p>
带各种参数的创建语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">create</span> database school
<span style="color: #a020f0;">on</span>
<span style="color: #707183;">(</span>
   <span style="color: #a020f0;">name</span> = school,                   <span style="color: #b22222;">-- &#20027;&#25968;&#25454;&#25991;&#20214;&#30340;&#36923;&#36753;&#21517;&#31216;</span>
   filename = <span style="color: #8b2252;">'d:\data\school.mdf'</span>, <span style="color: #b22222;">-- &#20027;&#25968;&#25454;&#25991;&#20214;&#25968;&#25454;&#20445;&#23384;&#30340;&#20301;&#32622;</span>
   <span style="color: #a020f0;">size</span> = 10,                       <span style="color: #b22222;">-- &#20027;&#25968;&#25454;&#25991;&#20214;&#30340;&#21021;&#22987;&#21270;&#22823;&#23567;&#20026; 10M</span>
   maxsize = 500,                   <span style="color: #b22222;">-- &#20027;&#25968;&#25454;&#25991;&#20214;&#30340;&#26368;&#22823;&#20540;&#20026; 500M</span>
   filegrowth = 10%                 <span style="color: #b22222;">-- &#20027;&#25968;&#25454;&#25991;&#20214;&#30340;&#22686;&#38271;&#31574;&#30053;</span>
<span style="color: #707183;">)</span>
log <span style="color: #a020f0;">on</span>
<span style="color: #707183;">(</span>
   <span style="color: #a020f0;">name</span> = school_log,                   <span style="color: #b22222;">-- &#26085;&#24535;&#25991;&#20214;&#30340;&#36923;&#36753;&#21517;&#23383;</span>
   filename = <span style="color: #8b2252;">'d:\data\school_log.ldf'</span>, <span style="color: #b22222;">-- &#26085;&#24535;&#25991;&#20214;&#30340;&#20445;&#23384;&#20301;&#32622;</span>
   <span style="color: #a020f0;">size</span> = 10,
   maxsize = 100,
   filegrowth = 2
<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">go</span>
</pre>
</div>

<p>
删除的语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">drop</span> database school;
<span style="color: #a020f0;">drop</span> database home;
<span style="color: #a020f0;">drop</span> database demo;
</pre>
</div>
</div>
</div>

<div id="outline-container-org76054f3" class="outline-3">
<h3 id="org76054f3"><span class="section-number-3">3.2.</span> table 的创建</h3>
<div class="outline-text-3" id="text-3-2">
<p>
基本的创建示例:
</p>
<div class="org-src-container">
<pre class="src src-sql">use xxx;
<span style="color: #a020f0;">go</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">room_type</span>
<span style="color: #707183;">(</span>
   type_number <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>4<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>,
   type_name <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>40<span style="color: #7388d6;">)</span>,
   pricE money,
   <span style="color: #7388d6;">[</span>coPrice<span style="color: #7388d6;">]</span> money,
   total_number <span style="color: #228b22;">decimal</span><span style="color: #7388d6;">(</span>3, 0<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span> <span style="color: #a020f0;">default</span> 0
<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">go</span>
</pre>
</div>

<p>
稍复杂一点的例子:
</p>
<div class="org-src-container">
<pre class="src src-sql">use xxx;
<span style="color: #a020f0;">go</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">stuInfo</span>
<span style="color: #707183;">(</span>
   stuNo <span style="color: #228b22;">int</span> <span style="color: #a020f0;">identity</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>,         <span style="color: #b22222;">-- &#20027;&#38190;+&#33258;&#22686;</span>
   stuName <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>12<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>,           <span style="color: #b22222;">-- &#38750;&#31354;&#32422;&#26463;</span>
   stuAge <span style="color: #228b22;">int</span>                              <span style="color: #b22222;">-- &#26377;&#38382;&#39064;!!!</span>
     <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>                              <span style="color: #b22222;">-- &#38750;&#31354;&#32422;&#26463;</span>
     <span style="color: #a020f0;">check</span><span style="color: #7388d6;">(</span>stuAge &gt;= 0 <span style="color: #a020f0;">and</span> stuAge &lt;= 100<span style="color: #7388d6;">)</span>, <span style="color: #b22222;">-- &#26816;&#26597;&#32422;&#26463;</span>
   stuSex <span style="color: #228b22;">nchar</span><span style="color: #7388d6;">(</span>1<span style="color: #7388d6;">)</span>
     <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>                              <span style="color: #b22222;">-- &#38750;&#31354;&#32422;&#26463;</span>
     <span style="color: #a020f0;">check</span><span style="color: #7388d6;">(</span>stuSex = <span style="color: #8b2252;">'&#30007;'</span> <span style="color: #a020f0;">or</span> stuSex = <span style="color: #8b2252;">'&#22899;'</span><span style="color: #7388d6;">)</span> <span style="color: #b22222;">-- &#26816;&#26597;&#32422;&#26463;</span>
     <span style="color: #a020f0;">default</span> <span style="color: #7388d6;">(</span><span style="color: #8b2252;">'&#30007;'</span><span style="color: #7388d6;">)</span>,                       <span style="color: #b22222;">-- &#40664;&#35748;&#20540;</span>
   stuTel <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>15<span style="color: #7388d6;">)</span>,
   stuAddress <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>50<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">default</span> <span style="color: #7388d6;">(</span><span style="color: #8b2252;">'&#22320;&#22336;&#19981;&#35814;'</span><span style="color: #7388d6;">)</span>,
   className <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>12<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>
<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">go</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">exam</span>
<span style="color: #707183;">(</span>
  examNo <span style="color: #228b22;">int</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span> <span style="color: #a020f0;">identity</span><span style="color: #7388d6;">(</span>1, 1<span style="color: #7388d6;">)</span>,
  stuNo <span style="color: #228b22;">int</span> <span style="color: #a020f0;">foreign</span> <span style="color: #a020f0;">key</span> <span style="color: #a020f0;">references</span> stuInfo<span style="color: #7388d6;">(</span>stuNo<span style="color: #7388d6;">)</span>,       <span style="color: #b22222;">-- &#22806;&#38190;&#32422;&#26463;</span>
  written <span style="color: #228b22;">float</span> <span style="color: #a020f0;">check</span> <span style="color: #7388d6;">(</span>written &gt;= 0 <span style="color: #a020f0;">and</span> written &lt;= 100<span style="color: #7388d6;">)</span>, <span style="color: #b22222;">-- &#31508;&#35797;</span>
  lab <span style="color: #228b22;">float</span> <span style="color: #a020f0;">check</span> <span style="color: #7388d6;">(</span>lab &gt;= 0 <span style="color: #a020f0;">and</span> lab &lt;= 100<span style="color: #7388d6;">)</span>              <span style="color: #b22222;">-- &#26426;&#35797;</span>
<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">go</span>
</pre>
</div>

<p>
Question:
</p>
<ul class="org-ul">
<li><p>
char/nchar/varchar/nvarchar 类型的区别
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">x</span> <span style="color: #707183;">(</span>s <span style="color: #228b22;">char</span><span style="color: #7388d6;">(</span>1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">y</span> <span style="color: #707183;">(</span>s <span style="color: #228b22;">nchar</span><span style="color: #7388d6;">(</span>1<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> y <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'&#30007;'</span><span style="color: #707183;">)</span>;
</pre>
</div></li>
<li>GBK/UTF8/UTF16 的区别</li>
<li>什么是外键，它有什么作用，是不是必须的? 外键有哪些添加方式?</li>
</ul>

<p>
小结:
</p>
<ul class="org-ul">
<li>默认情况下，字段的大小写不敏感，可以使用 <code>[xxx]</code> 方式强制其敏感</li>
<li>在数据库中，字段/表名字使用的是下划线分割的命名规则</li>
<li>数据应该是静态的，年龄 (Age) 不适合作为一个字段，用 birth 代替</li>
<li>建议使用 <b>代理主键</b> 代替 *自然主键*，即主键不应与业务有关</li>
<li><p>
表跟列的命名，有不同风格:
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">student</span> <span style="color: #707183;">(</span>id, <span style="color: #a020f0;">name</span>, tel, addr<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">t_student</span> <span style="color: #707183;">(</span>stu_id, stu_name, stu_tel, stu_addr<span style="color: #707183;">)</span>;
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orga0b377a" class="outline-3">
<h3 id="orga0b377a"><span class="section-number-3">3.3.</span> 常见数据类型</h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-org71e829e" class="outline-4">
<h4 id="org71e829e"><span class="section-number-4">3.3.1.</span> 数值</h4>
<div class="outline-text-4" id="text-3-3-1">
<p>
整数:
</p>
<ul class="org-ul">
<li>tinyint</li>
<li>smallint</li>
<li>int</li>
<li>bigint</li>
</ul>

<p>
浮点:
</p>
<ul class="org-ul">
<li>real</li>
<li>float</li>
<li>decimal(5,2)</li>
</ul>

<p>
另外:
</p>
<ul class="org-ul">
<li>smallmoney</li>
<li>money</li>
</ul>
</div>
</div>

<div id="outline-container-org5d722f5" class="outline-4">
<h4 id="org5d722f5"><span class="section-number-4">3.3.2.</span> 字符串</h4>
<div class="outline-text-4" id="text-3-3-2">
<ul class="org-ul">
<li>char/nchar</li>
<li>varchar/nvarchar，有存储上限的 8000</li>
<li>text/ntext，表示巨大的存储</li>
</ul>
</div>
</div>

<div id="outline-container-org8ea4c34" class="outline-4">
<h4 id="org8ea4c34"><span class="section-number-4">3.3.3.</span> 日期/时间</h4>
<div class="outline-text-4" id="text-3-3-3">
<ul class="org-ul">
<li>date</li>
<li>time</li>
<li>datetime</li>
<li>datetime2</li>
<li>getdate()</li>
</ul>
</div>
</div>

<div id="outline-container-orgb9ab735" class="outline-4">
<h4 id="orgb9ab735"><span class="section-number-4">3.3.4.</span> 其他类型</h4>
<div class="outline-text-4" id="text-3-3-4">
<ul class="org-ul">
<li>image</li>
<li>binary</li>
<li>varbinary</li>
</ul>
</div>
</div>

<div id="outline-container-org046ff95" class="outline-4">
<h4 id="org046ff95"><span class="section-number-4">3.3.5.</span> 使用例子</h4>
<div class="outline-text-4" id="text-3-3-5">
<div class="org-src-container">
<pre class="src src-sql">use xxx;
<span style="color: #a020f0;">go</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">xx13</span> <span style="color: #707183;">(</span>aaa datetime2 <span style="color: #a020f0;">default</span> getdate<span style="color: #7388d6;">()</span>, b <span style="color: #228b22;">int</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> xx13 <span style="color: #707183;">(</span>b<span style="color: #707183;">)</span> <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>1<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">go</span>

<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> xx13;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb337c95" class="outline-3">
<h3 id="orgb337c95"><span class="section-number-3">3.4.</span> table 的修改</h3>
<div class="outline-text-3" id="text-3-4">
<p>
基本修改:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#28155;&#21152;&#23383;&#27573;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">stuinfo</span> <span style="color: #a020f0;">add</span> stuEmail <span style="color: #228b22;">varchar</span><span style="color: #707183;">(</span>50<span style="color: #707183;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>;

<span style="color: #b22222;">-- &#20462;&#25913;&#23383;&#27573;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">stuinfo</span> <span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">column</span> stuname nvarchar<span style="color: #707183;">(</span>9<span style="color: #707183;">)</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>;

<span style="color: #b22222;">-- &#21024;&#38500;&#23383;&#27573;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">stuinfo</span> <span style="color: #a020f0;">drop</span> <span style="color: #a020f0;">column</span> stuEmail;

<span style="color: #b22222;">-- &#32422;&#26463;&#30340;&#28155;&#21152;&#21644;&#21024;&#38500;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">stuinfo</span> <span style="color: #a020f0;">add</span> <span style="color: #a020f0;">constraint</span> pk_stuno <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span> <span style="color: #707183;">(</span>stuno<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">stuinfo</span> <span style="color: #a020f0;">drop</span> <span style="color: #a020f0;">constraint</span> pk_stuno;
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">stuinfo</span> <span style="color: #a020f0;">add</span> <span style="color: #a020f0;">constraint</span> fk_stuno <span style="color: #a020f0;">foreign</span> <span style="color: #a020f0;">key</span> <span style="color: #707183;">(</span>stuno<span style="color: #707183;">)</span> <span style="color: #a020f0;">references</span> xxx<span style="color: #707183;">(</span><span style="color: #a020f0;">no</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">stuinfo</span> <span style="color: #a020f0;">drop</span> <span style="color: #a020f0;">constraint</span> fk_stuno;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6119365" class="outline-3">
<h3 id="org6119365"><span class="section-number-3">3.5.</span> table 的删除</h3>
<div class="outline-text-3" id="text-3-5">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">drop</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">xxx</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfb6d19b" class="outline-3">
<h3 id="orgfb6d19b"><span class="section-number-3">3.6.</span> constraint 的管理</h3>
<div class="outline-text-3" id="text-3-6">
<p>
分类:
</p>
<ul class="org-ul">
<li>主键约束 (Primary Key)</li>
<li>唯一约束 (Unique)</li>
<li>检查约束 (Check)</li>
<li>默认约束 (Default)</li>
<li>外键约束 (Foreign Key)</li>
</ul>

<p>
到底使用外键否? 取决于 <b>场景</b> 和 *权衡*。
</p>

<p>
添加到列上的约束:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">demo_constraint</span>
<span style="color: #707183;">(</span>
   aaa <span style="color: #228b22;">int</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>,
   bbb <span style="color: #228b22;">int</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>,
   ccc <span style="color: #228b22;">int</span> <span style="color: #a020f0;">default</span> 1,
   ddd <span style="color: #228b22;">int</span> <span style="color: #a020f0;">check</span> <span style="color: #7388d6;">(</span>ddd &gt; 5<span style="color: #7388d6;">)</span>,
   eee <span style="color: #228b22;">int</span> <span style="color: #a020f0;">unique</span>,
   fff <span style="color: #228b22;">int</span> <span style="color: #a020f0;">references</span> xxx<span style="color: #7388d6;">(</span><span style="color: #a020f0;">number</span><span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;
<span style="color: #b22222;">-- &#22914;&#26524;&#20462;&#25913;&#65292;&#21487;&#20197;&#20351;&#29992; alter table ... alter column ...</span>
</pre>
</div>

<p>
表级约束 (建表的时候添加):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">demo_constraint</span>
<span style="color: #707183;">(</span>
   aaa <span style="color: #228b22;">int</span>,
   bbb <span style="color: #228b22;">int</span>,
   ccc <span style="color: #228b22;">int</span>,
   ddd <span style="color: #228b22;">int</span>,
   eee <span style="color: #228b22;">int</span>,
   fff <span style="color: #228b22;">int</span>,
   <span style="color: #7388d6;">[</span><span style="color: #a020f0;">constraint</span> pk_aaa<span style="color: #7388d6;">]</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span> <span style="color: #7388d6;">(</span>aaa<span style="color: #7388d6;">)</span>,
   <span style="color: #7388d6;">[</span><span style="color: #a020f0;">constraint</span> fk_fff<span style="color: #7388d6;">]</span> <span style="color: #a020f0;">foreign</span> <span style="color: #a020f0;">key</span> <span style="color: #7388d6;">(</span>fff<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">references</span> xxx<span style="color: #7388d6;">(</span><span style="color: #a020f0;">number</span><span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">demo_constraint</span> <span style="color: #a020f0;">drop</span> <span style="color: #a020f0;">constraint</span> pk_aaa;
</pre>
</div>

<p>
表级约束 (建完表之后添加，在实际中更常用):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">demo_constraint</span>
<span style="color: #707183;">(</span>
   aaa <span style="color: #228b22;">int</span>,
   bbb <span style="color: #228b22;">int</span>,
   ccc <span style="color: #228b22;">int</span>,
   ddd <span style="color: #228b22;">int</span>,
   eee <span style="color: #228b22;">int</span>,
   fff <span style="color: #228b22;">int</span>
<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">demo_constraint</span> <span style="color: #a020f0;">add</span> <span style="color: #a020f0;">constraint</span> pk_aaa <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span> <span style="color: #707183;">(</span>aaa<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">demo_constraint</span> <span style="color: #a020f0;">add</span> <span style="color: #a020f0;">constraint</span> fk_fff <span style="color: #a020f0;">foreign</span> <span style="color: #a020f0;">key</span> <span style="color: #707183;">(</span>fff<span style="color: #707183;">)</span> <span style="color: #a020f0;">references</span> xxx<span style="color: #707183;">(</span><span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
在实际中，可能要综合使用:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">demo_constraint</span>
<span style="color: #707183;">(</span>
   aaa <span style="color: #228b22;">int</span>,
   bbb <span style="color: #228b22;">int</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>,
   ccc <span style="color: #228b22;">int</span> <span style="color: #a020f0;">unique</span>,
   ddd <span style="color: #228b22;">int</span> <span style="color: #a020f0;">default</span> 2,
   eee <span style="color: #228b22;">int</span> <span style="color: #a020f0;">check</span> <span style="color: #7388d6;">(</span>eee &gt; 4<span style="color: #7388d6;">)</span>,
   fff <span style="color: #228b22;">int</span>,
   <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span> <span style="color: #7388d6;">(</span>aaa<span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">demo_constraint</span> <span style="color: #a020f0;">add</span> <span style="color: #a020f0;">constraint</span> fk_fff <span style="color: #a020f0;">foreign</span> <span style="color: #a020f0;">key</span> <span style="color: #707183;">(</span>fff<span style="color: #707183;">)</span> <span style="color: #a020f0;">references</span> xxx<span style="color: #707183;">(</span><span style="color: #a020f0;">number</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b2a0b7" class="outline-3">
<h3 id="org4b2a0b7"><span class="section-number-3">3.7.</span> insert 插入</h3>
<div class="outline-text-3" id="text-3-7">
<p>
基本写法:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">zzz</span> <span style="color: #707183;">(</span>a <span style="color: #228b22;">int</span>, b text, c <span style="color: #228b22;">date</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#25353;&#29031;&#39034;&#24207;&#23545;&#24212;&#34920;&#20013;&#30340;&#23383;&#27573; (&#19981;&#25512;&#33616;)</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> zzz <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>111, <span style="color: #8b2252;">'abc'</span>, <span style="color: #8b2252;">'2009-02-13'</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#22914;&#26524;&#21457;&#29983;&#34920;&#30340;&#23383;&#27573;&#22686;&#21152;&#30340;&#24773;&#20917;&#65292;&#19978;&#36848;&#30340;&#35821;&#21477;&#20250;&#20986;&#38169;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">zzz</span> <span style="color: #a020f0;">add</span> ddd <span style="color: #228b22;">varchar</span><span style="color: #707183;">(</span>20<span style="color: #707183;">)</span> <span style="color: #a020f0;">default</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'bossisevil'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> zzz <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>111, <span style="color: #8b2252;">'abc'</span>, <span style="color: #8b2252;">'2009-02-13'</span><span style="color: #707183;">)</span>; <span style="color: #b22222;">-- &#20986;&#38169;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> zzz <span style="color: #707183;">(</span>a, b, c<span style="color: #707183;">)</span> <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>111, <span style="color: #8b2252;">'abc'</span>, <span style="color: #8b2252;">'2009-02-13'</span><span style="color: #707183;">)</span>; <span style="color: #b22222;">-- &#27491;&#30830;&#20889;&#27861;!</span>

<span style="color: #b22222;">-- &#20026;&#25968;&#25454;&#34920;&#65292;&#22686;&#21152;&#19968;&#20010;&#40664;&#35748;&#25554;&#20837;&#26102;&#38388;&#30340;&#23383;&#27573;</span>
<span style="color: #a020f0;">alter</span> <span style="color: #a020f0;">table</span> zzz <span style="color: #a020f0;">add</span> created_at datetime <span style="color: #a020f0;">default</span> <span style="color: #0000ff;">getdate</span><span style="color: #707183;">()</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> zzz <span style="color: #707183;">(</span>a, b, c<span style="color: #707183;">)</span> <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>111, <span style="color: #8b2252;">'abc'</span>, <span style="color: #8b2252;">'2009-02-13'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> zzz; <span style="color: #b22222;">-- created_at &#23383;&#27573;&#34987;&#22635;&#20805;&#20102;&#20540;</span>
</pre>
</div>

<p>
复制表的数据:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#22797;&#21046;&#34920;&#30340;&#32467;&#26524;&#65292;&#20197;&#21450;&#25968;&#25454;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">into</span> zzzzz <span style="color: #a020f0;">from</span> zzz;

<span style="color: #b22222;">-- &#21482;&#26159;&#22797;&#21046;&#25968;&#25454;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> zzzz <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> zzz <span style="color: #a020f0;">where</span> ddd <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org80bc96e" class="outline-3">
<h3 id="org80bc96e"><span class="section-number-3">3.8.</span> delete/truncate 删除</h3>
<div class="outline-text-3" id="text-3-8">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#21024;&#38500; zzz &#20013;&#25152;&#26377;&#25968;&#25454;</span>
<span style="color: #a020f0;">delete</span> <span style="color: #a020f0;">from</span> zzz;

<span style="color: #b22222;">-- &#21024;&#38500; zzz &#20013;&#37096;&#20998;&#25968;&#25454;</span>
<span style="color: #a020f0;">delete</span> <span style="color: #a020f0;">from</span> zzz <span style="color: #a020f0;">where</span> ddd <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">null</span>;

<span style="color: #b22222;">-- &#21024;&#38500;&#25152;&#26377;&#25968;&#25454;</span>
<span style="color: #b22222;">-- &#27604; delete &#26356;&#39640;&#25928; (&#19981;&#29992;&#35760;&#24405;&#26085;&#24535;)</span>
<span style="color: #b22222;">-- truncate &#19981;&#33021;&#21152;&#26465;&#20214;</span>
<span style="color: #b22222;">-- &#23646;&#20110; DDL &#35821;&#21477;</span>
<span style="color: #b22222;">-- &#22362;&#20915;&#35201;&#24910;&#29992;&#27492;&#35821;&#21477;</span>
truncate <span style="color: #a020f0;">table</span> zzz;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd070207" class="outline-3">
<h3 id="orgd070207"><span class="section-number-3">3.9.</span> update 更新</h3>
<div class="outline-text-3" id="text-3-9">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#19968;&#23450;&#19981;&#35201;&#33853;&#19979; where &#26465;&#20214;</span>
<span style="color: #b22222;">-- &#22312;&#26356;&#26032;&#21069;&#65292;&#19968;&#23450;&#20808;&#36890;&#36807; select &#30830;&#23450;&#35201;&#20462;&#25913;&#30340;&#25968;&#25454;&#26465;&#30446;</span>
<span style="color: #a020f0;">update</span> zzz <span style="color: #a020f0;">set</span> a = 2 <span style="color: #a020f0;">where</span> a = 1;
<span style="color: #a020f0;">update</span> zzz <span style="color: #a020f0;">set</span> a = a + 2 <span style="color: #a020f0;">where</span> a = 1;
</pre>
</div>
</div>
</div>

<div id="outline-container-org4576516" class="outline-3">
<h3 id="org4576516"><span class="section-number-3">3.10.</span> select 查询</h3>
<div class="outline-text-3" id="text-3-10">
</div>
<div id="outline-container-org9a4da80" class="outline-4">
<h4 id="org9a4da80"><span class="section-number-4">3.10.1.</span> 测试数据</h4>
<div class="outline-text-4" id="text-3-10-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">CREATE</span> DATABASE oa;
use oa;

<span style="color: #a020f0;">CREATE</span> <span style="color: #a020f0;">TABLE</span> <span style="color: #0000ff;">dept</span> <span style="color: #707183;">(</span> <span style="color: #b22222;">-- department</span>
  deptno <span style="color: #228b22;">int</span>,
  dname  <span style="color: #228b22;">VARCHAR</span><span style="color: #7388d6;">(</span>14<span style="color: #7388d6;">)</span>,
  loc    <span style="color: #228b22;">VARCHAR</span><span style="color: #7388d6;">(</span>13<span style="color: #7388d6;">)</span>, <span style="color: #b22222;">-- location/address</span>
  <span style="color: #a020f0;">CONSTRAINT</span> pk_dept <span style="color: #a020f0;">PRIMARY</span> <span style="color: #a020f0;">KEY</span> <span style="color: #7388d6;">(</span>deptno<span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">CREATE</span> <span style="color: #a020f0;">TABLE</span> <span style="color: #0000ff;">emp</span> <span style="color: #707183;">(</span> <span style="color: #b22222;">-- employee</span>
  empno    <span style="color: #228b22;">int</span>,
  ename    <span style="color: #228b22;">VARCHAR</span><span style="color: #7388d6;">(</span>10<span style="color: #7388d6;">)</span>,
  job      <span style="color: #228b22;">VARCHAR</span><span style="color: #7388d6;">(</span>9<span style="color: #7388d6;">)</span>,
  mgr      <span style="color: #228b22;">int</span>,
  hiredate <span style="color: #228b22;">DATE</span>,
  sal      <span style="color: #228b22;">float</span>,
  comm     <span style="color: #228b22;">float</span>,
  deptno   <span style="color: #228b22;">int</span>,
  <span style="color: #a020f0;">CONSTRAINT</span> pk_emp <span style="color: #a020f0;">PRIMARY</span> <span style="color: #a020f0;">KEY</span> <span style="color: #7388d6;">(</span>empno<span style="color: #7388d6;">)</span>,
  <span style="color: #a020f0;">CONSTRAINT</span> fk_deptno <span style="color: #a020f0;">FOREIGN</span> <span style="color: #a020f0;">KEY</span> <span style="color: #7388d6;">(</span>deptno<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">REFERENCES</span> dept <span style="color: #7388d6;">(</span>deptno<span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">CREATE</span> <span style="color: #a020f0;">TABLE</span> <span style="color: #0000ff;">bonus</span> <span style="color: #707183;">(</span> <span style="color: #b22222;">-- bonus</span>
  ename <span style="color: #228b22;">VARCHAR</span><span style="color: #7388d6;">(</span>10<span style="color: #7388d6;">)</span>,
  job   <span style="color: #228b22;">VARCHAR</span><span style="color: #7388d6;">(</span>9<span style="color: #7388d6;">)</span>,
  sal   <span style="color: #228b22;">float</span>,
  comm  <span style="color: #228b22;">float</span>
<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">CREATE</span> <span style="color: #a020f0;">TABLE</span> <span style="color: #0000ff;">salgrade</span> <span style="color: #707183;">(</span> <span style="color: #b22222;">-- salary grade</span>
  grade <span style="color: #228b22;">int</span>,
  losal <span style="color: #228b22;">float</span>,
  hisal <span style="color: #228b22;">float</span>
<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> dept <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span>10, <span style="color: #8b2252;">'ACCOUNTING'</span>, <span style="color: #8b2252;">'NEW YORK'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> dept <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span>20, <span style="color: #8b2252;">'RESEARCH'</span>, <span style="color: #8b2252;">'DALLAS'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> dept <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span>30, <span style="color: #8b2252;">'SALES'</span>, <span style="color: #8b2252;">'CHICAGO'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> dept <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span>40, <span style="color: #8b2252;">'OPERATIONS'</span>, <span style="color: #8b2252;">'BOSTON'</span><span style="color: #707183;">)</span>;

<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> emp <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span> 7839, <span style="color: #8b2252;">'KING'</span>, <span style="color: #8b2252;">'PRESIDENT'</span>, <span style="color: #a020f0;">null</span>, <span style="color: #8b2252;">'1981-11-17'</span>, 5000, <span style="color: #a020f0;">null</span>, 10 <span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> emp <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span> 7698, <span style="color: #8b2252;">'BLAKE'</span>, <span style="color: #8b2252;">'MANAGER'</span>, 7839, <span style="color: #8b2252;">'1981-05-01'</span>, 2850, <span style="color: #a020f0;">null</span>, 30<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> emp <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span> 7782, <span style="color: #8b2252;">'CLARK'</span>, <span style="color: #8b2252;">'MANAGER'</span>, 7839, <span style="color: #8b2252;">'1981-06-09'</span>, 2450, <span style="color: #a020f0;">null</span>, 10<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> emp <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span> 7566, <span style="color: #8b2252;">'JONES'</span>, <span style="color: #8b2252;">'MANAGER'</span>, 7839, <span style="color: #8b2252;">'1981-04-02'</span>, 2975, <span style="color: #a020f0;">null</span>, 20<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> emp <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span> 7788, <span style="color: #8b2252;">'SCOTT'</span>, <span style="color: #8b2252;">'ANALYST'</span>, 7566, <span style="color: #8b2252;">'1987-07-13'</span>, 3000, <span style="color: #a020f0;">null</span>, 20<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> emp <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span> 7902, <span style="color: #8b2252;">'FORD'</span>, <span style="color: #8b2252;">'ANALYST'</span>, 7566, <span style="color: #8b2252;">'1981-12-03'</span>, 3000, <span style="color: #a020f0;">null</span>, 20 <span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> emp <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span> 7369, <span style="color: #8b2252;">'SMITH'</span>, <span style="color: #8b2252;">'CLERK'</span>, 7902, <span style="color: #8b2252;">'1980-12-17'</span>, 800, <span style="color: #a020f0;">null</span>, 20 <span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> emp <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span> 7499, <span style="color: #8b2252;">'ALLEN'</span>, <span style="color: #8b2252;">'SALESMAN'</span>, 7698, <span style="color: #8b2252;">'1981-02-20'</span>, 1600, 300, 30<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> emp <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span> 7521, <span style="color: #8b2252;">'WARD'</span>, <span style="color: #8b2252;">'SALESMAN'</span>, 7698, <span style="color: #8b2252;">'1981-02-22'</span>, 1250, 500, 30 <span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> emp <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span> 7654, <span style="color: #8b2252;">'MARTIN'</span>, <span style="color: #8b2252;">'SALESMAN'</span>, 7698, <span style="color: #8b2252;">'1981-09-28'</span>, 1250, 1400, 30 <span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> emp <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span> 7844, <span style="color: #8b2252;">'TURNER'</span>, <span style="color: #8b2252;">'SALESMAN'</span>, 7698, <span style="color: #8b2252;">'1981-09-08'</span>, 1500, 0, 30<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> emp <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span> 7876, <span style="color: #8b2252;">'ADAMS'</span>, <span style="color: #8b2252;">'CLERK'</span>, 7788, <span style="color: #8b2252;">'1987-07-13'</span>, 1100, <span style="color: #a020f0;">null</span>, 20 <span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> emp <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span> 7900, <span style="color: #8b2252;">'JAMES'</span>, <span style="color: #8b2252;">'CLERK'</span>, 7698, <span style="color: #8b2252;">'1981-12-03'</span>, 950, <span style="color: #a020f0;">null</span>, 30 <span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> emp <span style="color: #a020f0;">VALUES</span><span style="color: #707183;">(</span> 7934, <span style="color: #8b2252;">'MILLER'</span>, <span style="color: #8b2252;">'CLERK'</span>, 7782, <span style="color: #8b2252;">'1982-01-23'</span>, 1300, <span style="color: #a020f0;">null</span>, 10 <span style="color: #707183;">)</span>;

<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> salgrade <span style="color: #a020f0;">VALUES</span> <span style="color: #707183;">(</span>1, 700, 1200<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> salgrade <span style="color: #a020f0;">VALUES</span> <span style="color: #707183;">(</span>2, 1201, 1400<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> salgrade <span style="color: #a020f0;">VALUES</span> <span style="color: #707183;">(</span>3, 1401, 2000<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> salgrade <span style="color: #a020f0;">VALUES</span> <span style="color: #707183;">(</span>4, 2001, 3000<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">INSERT</span> <span style="color: #a020f0;">INTO</span> salgrade <span style="color: #a020f0;">VALUES</span> <span style="color: #707183;">(</span>5, 3001, 9999<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">go</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org28560d2" class="outline-4">
<h4 id="org28560d2"><span class="section-number-4">3.10.2.</span> 基本查询</h4>
<div class="outline-text-4" id="text-3-10-2">
<p>
基本句式:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">select</span> &#23383;&#27573;&#20204;
  <span style="color: #a020f0;">from</span> &#34920;&#21517;
  <span style="color: #a020f0;">where</span> &#26465;&#20214; <span style="color: #a020f0;">or</span>/<span style="color: #a020f0;">and</span>/<span style="color: #a020f0;">not</span> &#20854;&#20182;&#26465;&#20214;
  <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> &#32452;
  <span style="color: #a020f0;">having</span> &#20998;&#32452;&#22522;&#30784;&#19978;&#30340;&#26465;&#20214;
  <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> &#25490;&#24207;&#30340;&#20381;&#25454;;
</pre>
</div>

<p>
基本使用:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#26368;&#31616;&#21333;&#30340;&#26597;&#35810;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp;

<span style="color: #b22222;">-- &#25351;&#23450;&#23383;&#27573;</span>
<span style="color: #a020f0;">select</span> empno, ename <span style="color: #a020f0;">from</span> emp;

<span style="color: #b22222;">-- &#28155;&#21152;&#26465;&#20214;</span>
<span style="color: #a020f0;">select</span> empno, ename, sal, comm <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> sal &lt; 1500;

<span style="color: #b22222;">-- &#32452;&#21512;&#26465;&#20214;</span>
<span style="color: #a020f0;">select</span> empno, ename, sal, comm <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> sal &lt; 1500 <span style="color: #a020f0;">and</span> comm <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">null</span>;
<span style="color: #a020f0;">select</span> empno, ename, sal, comm <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> <span style="color: #707183;">(</span>sal &lt; 1500 <span style="color: #a020f0;">and</span> comm <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">null</span><span style="color: #707183;">)</span> <span style="color: #a020f0;">or</span> sal &lt; 1300;
<span style="color: #a020f0;">select</span> empno, ename, sal, comm <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> sal + isnull<span style="color: #707183;">(</span>comm, 0<span style="color: #707183;">)</span> &lt; 1800;

<span style="color: #b22222;">-- &#20351;&#29992;&#21035;&#21517;</span>
<span style="color: #a020f0;">select</span> empno, ename, sal - 200 <span style="color: #a020f0;">as</span> sal, comm <span style="color: #a020f0;">from</span> emp;
<span style="color: #a020f0;">select</span> empno, ename, sal - 200 + isnull<span style="color: #707183;">(</span>comm, 0<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> total_sal <span style="color: #a020f0;">from</span> emp;

<span style="color: #b22222;">-- &#36827;&#34892;&#35745;&#31639;</span>
<span style="color: #a020f0;">select</span> empno,
       ename + <span style="color: #8b2252;">' - '</span> + job <span style="color: #a020f0;">as</span> who,
       sal - 200 + isnull<span style="color: #707183;">(</span>comm, 0<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> total_sal
  <span style="color: #a020f0;">from</span> emp;

<span style="color: #b22222;">-- &#36827;&#34892;&#25490;&#24207;</span>
<span style="color: #a020f0;">select</span> empno,
         ename + <span style="color: #8b2252;">' - '</span> + job <span style="color: #a020f0;">as</span> who,
         sal - 200 + isnull<span style="color: #707183;">(</span>comm, 0<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> total_sal
    <span style="color: #a020f0;">from</span> emp
    <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> total_sal;

<span style="color: #b22222;">-- &#21453;&#21521;&#25490;&#24207;</span>
<span style="color: #a020f0;">select</span> empno,
         ename + <span style="color: #8b2252;">' - '</span> + job <span style="color: #a020f0;">as</span> who,
         sal - 200 + isnull<span style="color: #707183;">(</span>comm, 0<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> total_sal
    <span style="color: #a020f0;">from</span> emp
    <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> total_sal <span style="color: #a020f0;">desc</span>; <span style="color: #b22222;">-- Ascending</span>

<span style="color: #b22222;">-- &#22810;&#20010;&#25490;&#24207;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> sal + isnull<span style="color: #707183;">(</span>comm, 0<span style="color: #707183;">)</span> <span style="color: #a020f0;">desc</span>,
           hiredate <span style="color: #a020f0;">desc</span>;

<span style="color: #b22222;">-- &#32467;&#21512; where&#65292;&#27880;&#24847;&#39034;&#24207;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> empno &lt;&gt; 7839
  <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> sal + isnull<span style="color: #707183;">(</span>comm, 0<span style="color: #707183;">)</span> <span style="color: #a020f0;">desc</span>,
           hiredate <span style="color: #a020f0;">desc</span>;
</pre>
</div>

<p>
统计查询:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">select</span> <span style="color: #483d8b;">count</span><span style="color: #707183;">(</span>*<span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> emp;
<span style="color: #a020f0;">select</span> <span style="color: #483d8b;">count</span><span style="color: #707183;">(</span>1<span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> emp;     <span style="color: #b22222;">-- &#19981;&#25512;&#33616;</span>
<span style="color: #a020f0;">select</span> <span style="color: #483d8b;">count</span><span style="color: #707183;">(</span>empno<span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> emp; <span style="color: #b22222;">-- &#19981;&#25512;&#33616;</span>

<span style="color: #a020f0;">select</span> <span style="color: #483d8b;">max</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> emp;
<span style="color: #a020f0;">select</span> <span style="color: #483d8b;">min</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> emp;
<span style="color: #a020f0;">select</span> <span style="color: #483d8b;">avg</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> deptno = 20;
</pre>
</div>

<p>
快捷方式:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#23436;&#20840;&#31561;&#25928;&#65292;&#34920;&#31034;&#21306;&#38388;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> student <span style="color: #a020f0;">where</span> score &gt;= 60 <span style="color: #a020f0;">and</span> score &lt;= 90;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> student <span style="color: #a020f0;">where</span> score <span style="color: #a020f0;">between</span> 60 <span style="color: #a020f0;">and</span> 90;

<span style="color: #b22222;">-- &#23436;&#20840;&#31561;&#25928;&#65292;&#34920;&#31034;&#36873;&#39033;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> student <span style="color: #a020f0;">where</span> <span style="color: #a020f0;">class</span>=<span style="color: #8b2252;">'163'</span> <span style="color: #a020f0;">or</span> <span style="color: #a020f0;">class</span>=<span style="color: #8b2252;">'165'</span> <span style="color: #a020f0;">or</span> <span style="color: #a020f0;">class</span>=<span style="color: #8b2252;">'168'</span>;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> student <span style="color: #a020f0;">where</span> <span style="color: #a020f0;">class</span> <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'163'</span>, <span style="color: #8b2252;">'165'</span>, <span style="color: #8b2252;">'168'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> student <span style="color: #a020f0;">where</span> <span style="color: #a020f0;">class</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'163'</span>, <span style="color: #8b2252;">'165'</span>, <span style="color: #8b2252;">'168'</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
小结:
</p>
<ul class="org-ul">
<li>使用 * 代表所有字段，结果会按照定义的顺序返回</li>
<li>使用 count(*) 来统计总数</li>
<li>注意 where/group/order-by 的顺序</li>
<li>使用 != 或 &lt;&gt; 来表示不等于</li>
<li>使用 is null 或 is not null 表示空或非空</li>
<li>SQLServer 中使用 + 连接字符串</li>
</ul>
</div>
</div>

<div id="outline-container-org29028c0" class="outline-4">
<h4 id="org29028c0"><span class="section-number-4">3.10.3.</span> 子查询 (subquery)</h4>
<div class="outline-text-4" id="text-3-10-3">
</div>
<div id="outline-container-org90a70a9" class="outline-5">
<h5 id="org90a70a9"><span class="section-number-5">3.10.3.1.</span> 作为临时表存在</h5>
<div class="outline-text-5" id="text-3-10-3-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#23454;&#38469;&#19978;&#65292;&#23601;&#26159;&#20869;&#23384;&#20013;&#30340;&#20020;&#26102;&#34920;</span>
<span style="color: #a020f0;">select</span> ename, job <span style="color: #a020f0;">from</span> <span style="color: #707183;">(</span>
    <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> sal &gt; 2000
  <span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> a1
  <span style="color: #a020f0;">where</span> sal &lt; 5000;

<span style="color: #b22222;">-- &#30127;&#29378;&#27169;&#24335;</span>
<span style="color: #a020f0;">select</span> ename <span style="color: #a020f0;">from</span> <span style="color: #707183;">(</span>
  <span style="color: #a020f0;">select</span> ename <span style="color: #a020f0;">from</span> <span style="color: #7388d6;">(</span>
    <span style="color: #a020f0;">select</span> ename <span style="color: #a020f0;">from</span> <span style="color: #909183;">(</span>
      <span style="color: #a020f0;">select</span> ename <span style="color: #a020f0;">from</span> <span style="color: #709870;">(</span>
        <span style="color: #a020f0;">select</span> ename, job <span style="color: #a020f0;">from</span> <span style="color: #907373;">(</span>
          <span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> sal &gt; 2000
        <span style="color: #907373;">)</span> <span style="color: #a020f0;">as</span> a1
        <span style="color: #a020f0;">where</span> sal &lt; 5000<span style="color: #709870;">)</span>
      <span style="color: #a020f0;">as</span> a2 <span style="color: #909183;">)</span>
    <span style="color: #a020f0;">as</span> a3<span style="color: #7388d6;">)</span>
  <span style="color: #a020f0;">as</span> a4<span style="color: #707183;">)</span>
<span style="color: #a020f0;">as</span> a5;
</pre>
</div>
</div>
</div>

<div id="outline-container-org19acf45" class="outline-5">
<h5 id="org19acf45"><span class="section-number-5">3.10.3.2.</span> 作为字段存在</h5>
<div class="outline-text-5" id="text-3-10-3-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">select</span> empno, ename,
       job, sal, comm,
       deptno,
       sal - <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> <span style="color: #483d8b;">avg</span><span style="color: #7388d6;">(</span>sal<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">from</span> emp<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> chaju <span style="color: #b22222;">-- &#21333;&#34892;&#21333;&#23383;&#27573;</span>
   <span style="color: #a020f0;">from</span> emp
   <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> job;
</pre>
</div>
</div>
</div>

<div id="outline-container-org2518bce" class="outline-5">
<h5 id="org2518bce"><span class="section-number-5">3.10.3.3.</span> 作为条件存在</h5>
<div class="outline-text-5" id="text-3-10-3-3">
<p>
基本使用:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#26597;&#35810;&#25152;&#26377;&#24037;&#36164;&#25302;&#21518;&#33151;&#30340;&#20154;</span>

<span style="color: #b22222;">-- &#39318;&#20808;&#65292;&#25105;&#20204;&#26597;:</span>
<span style="color: #b22222;">--   select * from emp;</span>
<span style="color: #b22222;">-- &#20854;&#27425;&#65292;&#35201;&#36807;&#28388;&#65292;&#24037;&#36164;&#20302;</span>
<span style="color: #b22222;">--   select * from emp where sal &lt; ?;</span>
<span style="color: #b22222;">-- &#28982;&#21518;&#65292;&#23569;&#20110;&#22810;&#23569;&#21602;&#65311;&#24179;&#22343;&#24037;&#36164;</span>
<span style="color: #b22222;">--   select avg(sal) from emp;</span>
<span style="color: #b22222;">-- &#26368;&#21518;&#65292;&#32467;&#21512;&#36215;&#26469;:</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> sal &lt; <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> <span style="color: #483d8b;">avg</span><span style="color: #7388d6;">(</span>sal<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">from</span> emp<span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#22686;&#24378;&#29256;: &#23454;&#38469;&#25910;&#20837;&#25302;&#21518;&#33151;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> sal + ISNULL<span style="color: #707183;">(</span>comm,0<span style="color: #707183;">)</span> &lt; <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> <span style="color: #483d8b;">AVG</span><span style="color: #7388d6;">(</span>sal +ISNULL<span style="color: #909183;">(</span>comm,0<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">from</span> emp<span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#26597;&#35810;&#25152;&#26377;&#30340;&#38750; ANALYST &#20013;&#24037;&#36164;&#27604; ANALYST &#26368;&#20302;&#24037;&#36164;&#36824;&#39640;&#30340;&#20154;</span>
<span style="color: #b22222;">-- &#26597;&#35810;&#25152;&#26377;[&#30340;[&#38750; ANALYST &#20013;][&#24037;&#36164;&#27604; [ANALYST &#26368;&#20302;&#24037;&#36164;]&#36824;&#39640;]]&#30340;&#20154;</span>
<span style="color: #b22222;">-- &#27493;&#39588;&#25286;&#35299;:</span>
<span style="color: #b22222;">-- 1. &#26368;&#20302;&#24037;&#36164;&#26159;&#22810;&#23569;?</span>
<span style="color: #a020f0;">select</span> <span style="color: #483d8b;">min</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> job = <span style="color: #8b2252;">'ANALYST'</span>;
<span style="color: #b22222;">-- 2. &#36807;&#28388;&#31532;&#19968;&#27493;: &#38750; ANALYST</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> job &lt;&gt; <span style="color: #8b2252;">'ANALYST'</span>;
<span style="color: #b22222;">-- 3. &#36807;&#28388;&#31532;&#20108;&#27493;: &#24037;&#36164;&#27604; ? &#39640;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> sal &gt; <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> <span style="color: #483d8b;">min</span><span style="color: #7388d6;">(</span>sal<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> job = <span style="color: #8b2252;">'ANALYST'</span><span style="color: #707183;">)</span>;
<span style="color: #b22222;">-- 4. &#25972;&#21512;&#25152;&#26377;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> job &lt;&gt; <span style="color: #8b2252;">'ANALYST'</span>
    <span style="color: #a020f0;">and</span> sal &gt; <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> <span style="color: #483d8b;">min</span><span style="color: #7388d6;">(</span>sal<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> job = <span style="color: #8b2252;">'ANALYST'</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
IN 语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#20351;&#29992; in &#32467;&#21512; subquery &#23558;&#26465;&#20214;&#21160;&#24577;&#21270; (&#22810;&#34892;&#21333;&#21015;)</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> student <span style="color: #a020f0;">where</span> <span style="color: #a020f0;">class</span> <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span>163, 165, 169<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> student <span style="color: #a020f0;">where</span> <span style="color: #a020f0;">class</span> <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> classname <span style="color: #a020f0;">from</span> <span style="color: #a020f0;">class</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#35831;&#24744;&#26597;&#25214;&#25152;&#26377; Research &#37096;&#38376;&#30340;&#20154;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp;          <span style="color: #b22222;">-- &#24754;&#20652;&#30340;&#26159;&#65292;emp &#34920;&#20013;&#27809;&#26377; dname &#23383;&#27573;; &#27427;&#21916;&#30340;&#26159;&#65292;&#23427;&#26377; deptno &#23383;&#27573;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> dname = <span style="color: #8b2252;">'RESEARCH'</span>; <span style="color: #b22222;">-- &#36890;&#36807;&#36825;&#27493;&#65292;&#21487;&#20197;&#24471;&#21040; RESEARCH &#37096;&#38376;&#30340;&#32534;&#21495;&#20026; 20</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> deptno = 20;         <span style="color: #b22222;">-- &#32467;&#21512;&#19978;&#19968;&#27493;&#65292;&#31579;&#36873;&#20986;&#31526;&#21512;&#26465;&#20214;&#30340;&#20154;&#21363;&#21487;</span>

<span style="color: #b22222;">-- &#26597;&#25214;&#25152;&#26377;&#30340;&#20154;; &#20854; deptno &#23646;&#20110; dept &#34920;&#20013; dname &#20026; Research &#30340;&#37027;&#20123; dept</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> deptno <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> deptno <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> dname = <span style="color: #8b2252;">'RESEARCH'</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#22686;&#24378;&#29256;: &#26597;&#25214;&#25152;&#26377; RESEARCH &#37096;&#38376;&#36824;&#26377;&#22312; BOSTON &#24037;&#20316;&#30340;&#20154;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> deptno <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> deptno <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> dname = <span style="color: #8b2252;">'RESEARCH'</span> <span style="color: #a020f0;">or</span> loc = <span style="color: #8b2252;">'BOSTON'</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#22686;&#24378;&#29256;: &#26597;&#25214;&#25152;&#26377; RESEARCH &#37096;&#38376;&#36824;&#26377;&#22312; BOSTON &#24037;&#20316;&#30340;&#65292;&#24182;&#19988;&#24037;&#36164;&#31561;&#32423;&#20026; 4 &#25110; 5 &#30340;&#20154;</span>
<span style="color: #b22222;">-- &#26029;&#21477;: &#26597;&#25214;&#25152;&#26377;[( RESEARCH &#37096;&#38376;&#36824;&#26377;&#22312; BOSTON &#24037;&#20316;&#30340;)&#65292;&#24182;&#19988;(&#24037;&#36164;&#31561;&#32423;&#20026; 4 &#25110; 5 &#30340;)]&#20154;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> deptno <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> deptno <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> dname = <span style="color: #8b2252;">'RESEARCH'</span> <span style="color: #a020f0;">or</span> loc = <span style="color: #8b2252;">'BOSTON'</span><span style="color: #707183;">)</span>
    <span style="color: #a020f0;">and</span> sal &gt;= 2001;
<span style="color: #b22222;">-- &#20351;&#29992; subquery &#21160;&#24577;&#21270;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> deptno <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> deptno <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> dname = <span style="color: #8b2252;">'RESEARCH'</span> <span style="color: #a020f0;">or</span> loc = <span style="color: #8b2252;">'BOSTON'</span><span style="color: #707183;">)</span>
    <span style="color: #a020f0;">and</span> sal &gt;= <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> losal <span style="color: #a020f0;">from</span> salgrade <span style="color: #a020f0;">where</span> grade = 4<span style="color: #707183;">)</span>;
<span style="color: #b22222;">-- &#35753;&#20107;&#24773;&#26356;&#32454;&#33268;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> deptno <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> deptno <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> dname = <span style="color: #8b2252;">'RESEARCH'</span> <span style="color: #a020f0;">or</span> loc = <span style="color: #8b2252;">'BOSTON'</span><span style="color: #707183;">)</span>
    <span style="color: #a020f0;">and</span> sal <span style="color: #a020f0;">between</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> losal <span style="color: #a020f0;">from</span> salgrade <span style="color: #a020f0;">where</span> grade = 4<span style="color: #707183;">)</span>
                <span style="color: #a020f0;">and</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> hisal <span style="color: #a020f0;">from</span> salgrade <span style="color: #a020f0;">where</span> grade = 5<span style="color: #707183;">)</span>;
</pre>
</div>

<p>
EXISTS 语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#19979;&#38754;&#20004;&#21477;&#21151;&#33021;&#19978;&#26159;&#31561;&#25928;&#30340;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> deptno <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> deptno <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> loc = <span style="color: #8b2252;">'CHICAGO'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> <span style="color: #a020f0;">exists</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> emp.deptno = dept.deptno
                                     <span style="color: #a020f0;">and</span> dept.loc = <span style="color: #8b2252;">'CHICAGO'</span><span style="color: #707183;">)</span>;
<span style="color: #b22222;">-- &#24615;&#33021;&#27604;&#36739; (&#33041;&#34917;)</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> student <span style="color: #a020f0;">where</span> cardid <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> id <span style="color: #a020f0;">from</span> renkou <span style="color: #a020f0;">where</span> shengfen=<span style="color: #8b2252;">'&#24191;&#19996;'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> student <span style="color: #a020f0;">where</span> <span style="color: #a020f0;">exists</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> id <span style="color: #a020f0;">from</span> renkou <span style="color: #a020f0;">where</span> renkou.id = student.cardid <span style="color: #a020f0;">and</span> shenfen = <span style="color: #8b2252;">'&#24191;&#19996;'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> student s <span style="color: #a020f0;">where</span> <span style="color: #a020f0;">exists</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> id <span style="color: #a020f0;">from</span> renkou r <span style="color: #a020f0;">where</span> r.id = s.cardid <span style="color: #a020f0;">and</span> r.shenfen = <span style="color: #8b2252;">'&#24191;&#19996;'</span><span style="color: #707183;">)</span>;
</pre>
</div>

<p>
ALL/ANY/SOME 语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> student s
  <span style="color: #a020f0;">where</span> stuno = <span style="color: #a020f0;">any</span><span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> stuno <span style="color: #a020f0;">from</span> exam e <span style="color: #a020f0;">where</span> written &gt;= 60 <span style="color: #a020f0;">and</span> lab &gt;= 60<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> student s
  <span style="color: #a020f0;">where</span> stuno <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> stuno <span style="color: #a020f0;">from</span> exam e <span style="color: #a020f0;">where</span> written &gt;= 60 <span style="color: #a020f0;">and</span> lab &gt;= 60<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> student s
  <span style="color: #a020f0;">where</span> <span style="color: #a020f0;">exists</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> exam e <span style="color: #a020f0;">where</span> s.stuno = e.stuno <span style="color: #a020f0;">and</span> e.written &gt;= 60 <span style="color: #a020f0;">and</span> e.lab &gt;= 60<span style="color: #707183;">)</span>;

<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">t1</span> <span style="color: #707183;">(</span>n <span style="color: #228b22;">int</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">t2</span> <span style="color: #707183;">(</span>n <span style="color: #228b22;">int</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> t1 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>2<span style="color: #707183;">)</span>, <span style="color: #707183;">(</span>3<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> t2 <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span>1<span style="color: #707183;">)</span>, <span style="color: #707183;">(</span>2<span style="color: #707183;">)</span>, <span style="color: #707183;">(</span>3<span style="color: #707183;">)</span>, <span style="color: #707183;">(</span>4<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> t2 <span style="color: #a020f0;">where</span> n &gt; <span style="color: #a020f0;">all</span><span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> t1<span style="color: #707183;">)</span>;   <span style="color: #b22222;">-- 4</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> t2 <span style="color: #a020f0;">where</span> n &gt; <span style="color: #a020f0;">some</span><span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> t1<span style="color: #707183;">)</span>;  <span style="color: #b22222;">-- 3, 4</span>
</pre>
</div>

<p>
小结:
</p>
<ul class="org-ul">
<li>很多人不愿意用 exists，而是喜欢用 in，因为 in 更容易理解并且语句更简短</li>
<li><p>
实际上，更推荐使用 exists，因为在很多场合 exists 更有效率
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#39640;&#39069;&#30340;&#31354;&#38388;&#21344;&#29992;</span>
<span style="color: #b22222;">-- &#24040;&#22823;&#30340;&#23545;&#27604;&#27425;&#25968;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> student <span style="color: #a020f0;">where</span> cardid <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> id <span style="color: #a020f0;">from</span> renkoubiao <span style="color: #a020f0;">where</span> shengfen=<span style="color: #8b2252;">'&#24191;&#19996;'</span><span style="color: #707183;">)</span>;
</pre>
</div></li>
<li>ANY/SOME/ALL 是 exists 的语法糖，在某些场景之下，更加直观</li>
</ul>
</div>
</div>

<div id="outline-container-orgc1c163a" class="outline-5">
<h5 id="orgc1c163a"><span class="section-number-5">3.10.3.4.</span> 阶段性作业 (subquery)</h5>
<div class="outline-text-5" id="text-3-10-3-4">
<p>
查询出芝加哥工作的工资最高的人的上司的工资，超出平均工资的数目:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#26597;&#35810;&#33437;&#21152;&#21733;&#24037;&#20316;&#30340;&#25152;&#26377;&#20154;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> deptno = <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> deptno <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> loc = <span style="color: #8b2252;">'CHICAGO'</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#26597;&#35810;&#33437;&#21152;&#21733;&#24037;&#36164;&#26368;&#39640;&#30340;&#37027;&#20010;&#20154;</span>
<span style="color: #b22222;">-- &#20998;&#35299;&#39064;&#30446;:</span>
<span style="color: #b22222;">-- 1. &#23450;&#20301;&#21040;&#33437;&#21152;&#21733;&#22478;&#24066;&#30340;&#37096;&#38376;&#32534;&#21495; (select deptno from dept where loc = 'CHICAGO');</span>
<span style="color: #b22222;">-- 2. &#26597;&#25214;&#25152;&#26377;&#22312;&#33437;&#21152;&#21733;&#24037;&#20316;&#30340;&#20154; (&#26681;&#25454;&#19978;&#36848;&#30340;&#37096;&#38376;&#32534;&#21495;) (select * from emp where deptno = ?);</span>
<span style="color: #b22222;">-- 3. &#35745;&#31639;&#25152;&#26377;&#33437;&#21152;&#21733;&#24037;&#20316;&#30340;&#20154;&#30340;&#26368;&#39640;&#24037;&#36164; (select max(sal) from emp where deptno = ?);</span>
<span style="color: #b22222;">-- 4. &#33719;&#21462;&#24037;&#36164;&#26368;&#39640;&#30340;&#20154;&#30340;&#20449;&#24687; (select * from emp where deptno = ? and sal = ?);</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> deptno = <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> deptno <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> loc = <span style="color: #8b2252;">'CHICAGO'</span><span style="color: #707183;">)</span>
    <span style="color: #a020f0;">and</span> sal = <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> <span style="color: #483d8b;">max</span><span style="color: #7388d6;">(</span>sal<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> deptno = <span style="color: #7388d6;">(</span><span style="color: #a020f0;">select</span> deptno <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> loc = <span style="color: #8b2252;">'CHICAGO'</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>;
<span style="color: #b22222;">-- &#20511;&#21161;&#25490;&#24207;&#21644; top &#36827;&#34892;&#23454;&#29616;</span>
<span style="color: #a020f0;">select</span> top 1 * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> deptno = <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> deptno <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> loc = <span style="color: #8b2252;">'CHICAGO'</span><span style="color: #707183;">)</span>
  <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> sal <span style="color: #a020f0;">desc</span>;

<span style="color: #b22222;">-- &#26597;&#35810;&#33437;&#21152;&#21733;&#24037;&#36164;&#26368;&#39640;&#30340;&#37027;&#20010;&#20154;&#30340;&#19978;&#21496;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> empno = <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> top 1 mgr <span style="color: #a020f0;">from</span> emp
                   <span style="color: #a020f0;">where</span> deptno = <span style="color: #7388d6;">(</span><span style="color: #a020f0;">select</span> deptno <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> loc = <span style="color: #8b2252;">'CHICAGO'</span><span style="color: #7388d6;">)</span>
                   <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> sal <span style="color: #a020f0;">desc</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#26597;&#35810;&#33437;&#21152;&#21733;&#24037;&#36164;&#26368;&#39640;&#30340;&#37027;&#20010;&#20154;&#30340;&#19978;&#21496;&#24037;&#36164;&#36319;&#24179;&#22343;&#24037;&#36164;&#30340;&#24046;&#36317;</span>
<span style="color: #a020f0;">select</span> *, sal - <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> <span style="color: #483d8b;">AVG</span><span style="color: #7388d6;">(</span>sal<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">from</span> emp<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> chaju <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> empno = <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> top 1 mgr <span style="color: #a020f0;">from</span> emp
                   <span style="color: #a020f0;">where</span> deptno = <span style="color: #7388d6;">(</span><span style="color: #a020f0;">select</span> deptno <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> loc = <span style="color: #8b2252;">'CHICAGO'</span><span style="color: #7388d6;">)</span>
                   <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> sal <span style="color: #a020f0;">desc</span><span style="color: #707183;">)</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3a6ee8c" class="outline-4">
<h4 id="org3a6ee8c"><span class="section-number-4">3.10.4.</span> 连接查询 (join)</h4>
<div class="outline-text-4" id="text-3-10-4">
<ul class="org-ul">
<li>emp
<ul class="org-ul">
<li>ename</li>
<li>sal</li>
<li>deptno</li>
</ul></li>
<li>dept
<ul class="org-ul">
<li>deptno</li>
<li>dname</li>
<li>loc</li>
</ul></li>
</ul>

<p>
这其实是三种解决问题的思路:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">---- &#26597;&#35810;&#20986;&#25152;&#26377;&#22312;&#33437;&#21152;&#21733;&#24037;&#20316;&#30340;&#21592;&#24037;</span>

<span style="color: #b22222;">-- 1. &#25105;&#30340;&#32534;&#21495;&#65292;&#22312;&#20320;&#30340;&#32534;&#21495;&#20043;&#20869;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> deptno <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> deptno <span style="color: #a020f0;">from</span> dept <span style="color: #a020f0;">where</span> loc=<span style="color: #8b2252;">'xxx'</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- 2. &#25105;&#30340;&#25968;&#25454;&#65292;&#35201;&#36880;&#26465;&#36319;&#20320;&#30340;&#27604;&#23545;&#65292;&#36880;&#27493;&#36807;&#28388;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp e
  <span style="color: #a020f0;">where</span> <span style="color: #a020f0;">exists</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> dept d <span style="color: #a020f0;">where</span> d.deptno = e.deptno <span style="color: #a020f0;">and</span> d.loc = <span style="color: #8b2252;">'xxx'</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- 3. &#20808;&#25289;&#20320;&#21019;&#24314;&#20020;&#26102;&#34920;&#65292;&#20877;&#32771;&#34385;&#26465;&#20214;&#30340;&#20107;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
   <span style="color: #a020f0;">join</span> dept <span style="color: #a020f0;">on</span> emp.deptno = dept.deptno
   <span style="color: #a020f0;">where</span> loc = <span style="color: #8b2252;">'CHICAGO'</span> <span style="color: #a020f0;">or</span> dname = <span style="color: #8b2252;">'RESEARCH'</span>;
</pre>
</div>

<p>
查找所有 Research 部门的人:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#26681;&#25454;&#25152;&#26377;&#26465;&#20214;&#21019;&#24314;&#19968;&#20010;&#20020;&#26102;&#34920;</span>
<span style="color: #a020f0;">select</span> a.*,b.dname,b.loc <span style="color: #a020f0;">from</span> emp a
   <span style="color: #a020f0;">join</span> dept b <span style="color: #a020f0;">on</span> a.deptno = b.deptno <span style="color: #a020f0;">and</span> b.dname=<span style="color: #8b2252;">'Research'</span>;

<span style="color: #b22222;">-- &#20808;&#21019;&#31435;&#19968;&#24352;&#20020;&#26102;&#34920;&#28982;&#21518;&#26681;&#25454;&#26465;&#20214;&#36827;&#34892;&#31579;&#36873;</span>
<span style="color: #a020f0;">select</span> a.*,b.dname,b.loc <span style="color: #a020f0;">from</span> emp a
   <span style="color: #a020f0;">join</span> dept b <span style="color: #a020f0;">on</span> a.deptno = b.deptno
   <span style="color: #a020f0;">where</span> b.dname=<span style="color: #8b2252;">'Research'</span>;

<span style="color: #b22222;">-- &#38750;&#35268;&#33539;&#26041;&#24335;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp e, dept d
   <span style="color: #a020f0;">where</span> e.deptno = d.deptno <span style="color: #a020f0;">and</span> d.dname = <span style="color: #8b2252;">'Research'</span>;
</pre>
</div>

<p>
左、右、全连接 (Left/Right/Full Join):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#31034;&#20363;&#25968;&#25454;</span>
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">t_student</span>
<span style="color: #707183;">(</span>
  id <span style="color: #228b22;">int</span> <span style="color: #a020f0;">identity</span> <span style="color: #a020f0;">primary</span> <span style="color: #a020f0;">key</span>,
  <span style="color: #a020f0;">name</span> <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>200<span style="color: #7388d6;">)</span>,
  classname <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>200<span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">create</span> <span style="color: #a020f0;">table</span> <span style="color: #0000ff;">t_class</span>
<span style="color: #707183;">(</span>
  classname <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>200<span style="color: #7388d6;">)</span>,
  loc <span style="color: #228b22;">varchar</span><span style="color: #7388d6;">(</span>200<span style="color: #7388d6;">)</span>
<span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> t_class
       <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'163'</span>, <span style="color: #8b2252;">'201'</span><span style="color: #707183;">)</span>,
              <span style="color: #707183;">(</span><span style="color: #8b2252;">'164'</span>, <span style="color: #8b2252;">'202'</span><span style="color: #707183;">)</span>,
              <span style="color: #707183;">(</span><span style="color: #8b2252;">'165'</span>, <span style="color: #8b2252;">'404'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> t_student <span style="color: #707183;">(</span><span style="color: #a020f0;">name</span>, classname<span style="color: #707183;">)</span>
       <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'zhangsan'</span>, <span style="color: #8b2252;">'164'</span><span style="color: #707183;">)</span>,
              <span style="color: #707183;">(</span><span style="color: #8b2252;">'lisi'</span>, <span style="color: #8b2252;">'165'</span><span style="color: #707183;">)</span>,
              <span style="color: #707183;">(</span><span style="color: #8b2252;">'wangwu'</span>, <span style="color: #8b2252;">'165'</span><span style="color: #707183;">)</span>,
              <span style="color: #707183;">(</span><span style="color: #8b2252;">'zhaoliu'</span>, <span style="color: #8b2252;">'165'</span><span style="color: #707183;">)</span>,
              <span style="color: #707183;">(</span><span style="color: #8b2252;">'sunqi'</span>, <span style="color: #8b2252;">''</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#26597;&#25214;&#25152;&#26377;&#23398;&#29983;&#65292;&#20197;&#21450;&#20182;&#30340;&#29677;&#32423;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> t_student s
  <span style="color: #a020f0;">join</span> t_class c <span style="color: #a020f0;">on</span> s.classname = c.classname;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> t_student s
  <span style="color: #707183;">[</span><span style="color: #a020f0;">inner</span><span style="color: #707183;">]</span> <span style="color: #a020f0;">join</span> t_class c <span style="color: #a020f0;">on</span> s.classname = c.classname;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> t_student s
  <span style="color: #707183;">[</span><span style="color: #a020f0;">left</span><span style="color: #707183;">]</span> <span style="color: #a020f0;">join</span> t_class c <span style="color: #a020f0;">on</span> s.classname = c.classname;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> t_student s
  <span style="color: #707183;">[</span><span style="color: #a020f0;">right</span><span style="color: #707183;">]</span> <span style="color: #a020f0;">join</span> t_class c <span style="color: #a020f0;">on</span> s.classname = c.classname;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> t_student s
  <span style="color: #707183;">[</span><span style="color: #a020f0;">full</span><span style="color: #707183;">]</span> <span style="color: #a020f0;">join</span> t_class c <span style="color: #a020f0;">on</span> s.classname = c.classname;
</pre>
</div>

<p>
笛卡儿积 (叉乘):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#24418;&#25104;&#30340;&#25968;&#25454;&#26159;&#27809;&#26377;&#24847;&#24605;&#30340;&#65292;&#22240;&#20026;&#24456;&#22810;&#25968;&#25454;&#26159;&#19981;&#23545;&#30340;</span>
<span style="color: #b22222;">-- &#20294;&#26159;&#65292;&#23427;&#21364;&#26159;&#20854;&#23427;&#26377;&#24847;&#20041;&#30340;&#36830;&#25509;&#30340;&#20869;&#22312;&#22522;&#30784;  </span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp, dept;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp
  <span style="color: #707183;">[</span><span style="color: #a020f0;">cross</span><span style="color: #707183;">]</span> <span style="color: #a020f0;">join</span> dept;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf501e0" class="outline-4">
<h4 id="orgcf501e0"><span class="section-number-4">3.10.5.</span> 合并 (union)</h4>
<div class="outline-text-4" id="text-3-10-5">
<p>
Union 可以连接一切，有意义的，还有无意义的。
</p>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#27627;&#26080;&#24847;&#20041;&#65288;&#65311;&#65289;&#30340; Union</span>
<span style="color: #a020f0;">select</span> empno <span style="color: #a020f0;">from</span> emp
<span style="color: #a020f0;">union</span>
<span style="color: #a020f0;">select</span> deptno, dname <span style="color: #a020f0;">from</span> dept;

<span style="color: #b22222;">-- &#31245;&#24494;&#26377;&#28857;&#24847;&#20041;&#30340; Union</span>
<span style="color: #b22222;">-- &#23558;&#25152;&#26377;&#23398;&#29983;&#21644;&#21592;&#24037;&#37117;&#21015;&#20986;&#26469;</span>
<span style="color: #a020f0;">select</span> <span style="color: #a020f0;">name</span> <span style="color: #a020f0;">from</span> t_student
<span style="color: #a020f0;">union</span>
<span style="color: #a020f0;">select</span> ename <span style="color: #a020f0;">from</span> emp;

<span style="color: #b22222;">-- &#20063;&#21487;&#20197;&#36830;&#25509;&#33258;&#36523;&#34920;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> sal &gt; 2000 <span style="color: #a020f0;">or</span> sal &lt; 1000;
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> sal &gt; 2000
<span style="color: #a020f0;">union</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> sal &lt; 1000;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2ee714" class="outline-4">
<h4 id="orge2ee714"><span class="section-number-4">3.10.6.</span> 分组、窗口查询 (group by/over)</h4>
<div class="outline-text-4" id="text-3-10-6">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#21487;&#20197;&#20351;&#29992; union &#25163;&#21160;&#20998;&#32452;</span>
<span style="color: #a020f0;">select</span> 10, <span style="color: #483d8b;">avg</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> deptno = 10
<span style="color: #a020f0;">union</span>
<span style="color: #a020f0;">select</span> 20, <span style="color: #483d8b;">avg</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> deptno = 20
<span style="color: #a020f0;">union</span>
<span style="color: #a020f0;">select</span> 30, <span style="color: #483d8b;">avg</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">where</span> deptno = 30;

<span style="color: #b22222;">-- &#20351;&#29992;&#20998;&#32452;&#26469;&#31616;&#21270;&#35821;&#21477;&#12290;&#25968;&#25454;&#24211;&#20869;&#37096;&#30340;&#23454;&#29616;&#36923;&#36753;&#36319;&#19978;&#36848; union &#29256;&#26412;&#31867;&#20284;</span>
<span style="color: #a020f0;">select</span> deptno, <span style="color: #483d8b;">AVG</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span>, <span style="color: #483d8b;">MAX</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span>, <span style="color: #483d8b;">MIN</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> deptno;

<span style="color: #b22222;">-- &#22914;&#26524;&#24819;&#22522;&#20110;&#20998;&#23436;&#30340;&#32452;&#36827;&#34892;&#36807;&#28388;&#65292;&#19979;&#38754;&#20889;&#27861;&#26159; **&#38169;&#30340;**</span>
<span style="color: #a020f0;">select</span> deptno, <span style="color: #483d8b;">AVG</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> a, <span style="color: #483d8b;">MAX</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> d, <span style="color: #483d8b;">MIN</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> x <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> deptno
  <span style="color: #a020f0;">where</span> <span style="color: #483d8b;">AVG</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> &gt; 1000;

<span style="color: #b22222;">-- &#21487;&#20197;&#20351;&#29992;&#23376;&#26597;&#35810;&#30340;&#24418;&#24335;&#65292;&#35299;&#20915;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span>
<span style="color: #707183;">(</span> <span style="color: #a020f0;">select</span> deptno, <span style="color: #483d8b;">AVG</span><span style="color: #7388d6;">(</span>sal<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">as</span> a, <span style="color: #483d8b;">MAX</span><span style="color: #7388d6;">(</span>sal<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">as</span> d, <span style="color: #483d8b;">MIN</span><span style="color: #7388d6;">(</span>sal<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">as</span> x <span style="color: #a020f0;">from</span> emp
        <span style="color: #a020f0;">where</span> mgr <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>
        <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> deptno
<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> v <span style="color: #a020f0;">where</span> a &gt; 2000;

<span style="color: #b22222;">-- &#19978;&#36848;&#20889;&#27861;&#34429;&#28982;&#26377;&#25928;&#65292;&#21487;&#26159;&#24182;&#19981;&#22815;&#31616;&#27905;&#65292;&#20110;&#26159;&#26377;&#20102; having &#20851;&#38190;&#35789;</span>
<span style="color: #b22222;">-- having &#26159;&#36319; group by &#25645;&#37197;&#30340; `where`</span>
<span style="color: #b22222;">-- &#20110;&#26159; where -&gt; group by -&gt; having</span>
<span style="color: #b22222;">-- &#20808;&#36807;&#28388;&#65292;&#20877;&#20998;&#32452;&#65292;&#20877;&#22312;&#20998;&#32452;&#32467;&#26524;&#30340;&#22522;&#30784;&#19978;&#36807;&#28388;</span>
<span style="color: #a020f0;">select</span> deptno, <span style="color: #483d8b;">AVG</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> a, <span style="color: #483d8b;">MAX</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> d, <span style="color: #483d8b;">MIN</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> x <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> mgr <span style="color: #a020f0;">is</span> <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">null</span>
  <span style="color: #a020f0;">group</span> <span style="color: #a020f0;">by</span> deptno
  <span style="color: #a020f0;">having</span> <span style="color: #483d8b;">AVG</span><span style="color: #707183;">(</span>sal<span style="color: #707183;">)</span> &gt; 2000;
</pre>
</div>

<p>
查询所有部门最高工资的人:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span>
  <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> row_number<span style="color: #7388d6;">()</span> over <span style="color: #7388d6;">(</span>partition <span style="color: #a020f0;">by</span> deptno <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> sal <span style="color: #a020f0;">desc</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">as</span> rn, * <span style="color: #a020f0;">from</span> emp<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> s
  <span style="color: #a020f0;">where</span> rn = 1;

<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span>
  <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> rank<span style="color: #7388d6;">()</span> over <span style="color: #7388d6;">(</span>partition <span style="color: #a020f0;">by</span> deptno <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> sal <span style="color: #a020f0;">desc</span><span style="color: #7388d6;">)</span> <span style="color: #a020f0;">as</span> rn, * <span style="color: #a020f0;">from</span> emp<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> s
  <span style="color: #a020f0;">where</span> rn = 1;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga5fa186" class="outline-4">
<h4 id="orga5fa186"><span class="section-number-4">3.10.7.</span> 分页查询 (top/row_number/fetch-offset)</h4>
<div class="outline-text-4" id="text-3-10-7">
<p>
只拿出分数据。
</p>

<p>
最经典的分页语句 (top):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">select</span> top 2 * <span style="color: #a020f0;">from</span> emp;

<span style="color: #b22222;">-- 2 - 4</span>
<span style="color: #b22222;">-- 1. &#21069; 4 &#34892;</span>
<span style="color: #b22222;">-- 2. &#21453;&#21521;</span>
<span style="color: #b22222;">-- 3. &#21069;&#20004;&#26465;</span>
<span style="color: #b22222;">-- 4. &#21453;&#21521;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> top 3 * <span style="color: #a020f0;">from</span> <span style="color: #7388d6;">(</span><span style="color: #a020f0;">select</span> top 4 * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> empno<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">as</span> t <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> empno <span style="color: #a020f0;">desc</span><span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> x <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> empno <span style="color: #a020f0;">desc</span>;

<span style="color: #b22222;">-- &#21478;&#19968;&#31181;&#24605;&#36335;</span>
<span style="color: #a020f0;">select</span> top 3 * <span style="color: #a020f0;">from</span> emp
  <span style="color: #a020f0;">where</span> empno <span style="color: #a020f0;">not</span> <span style="color: #a020f0;">in</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> top 1 empno <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> empno<span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#20854;&#20182;&#25968;&#25454;&#24211;&#23545;&#27604;</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">limit</span> 3 offset 4; <span style="color: #b22222;">-- mysql/sqlite/postgresql</span>
<span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> *, rownum <span style="color: #a020f0;">as</span> rn <span style="color: #a020f0;">from</span> emp<span style="color: #707183;">)</span> rn <span style="color: #a020f0;">between</span> 3 <span style="color: #a020f0;">and</span> 5; <span style="color: #b22222;">-- oracle</span>
</pre>
</div>

<p>
借助窗口函数进行选取 (<b>row_number</b>):
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span>
   <span style="color: #707183;">(</span><span style="color: #a020f0;">select</span> row_number<span style="color: #7388d6;">()</span> over <span style="color: #7388d6;">(</span><span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> empno<span style="color: #7388d6;">)</span> <span style="color: #a020f0;">as</span> rn, * <span style="color: #a020f0;">from</span> emp<span style="color: #707183;">)</span> <span style="color: #a020f0;">as</span> s
   <span style="color: #a020f0;">where</span> rn <span style="color: #a020f0;">between</span> 2 <span style="color: #a020f0;">and</span> 5;
</pre>
</div>

<p>
SQLServer 2012 以后，开始支持标准的 fetch-offset 写法:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">select</span> * <span style="color: #a020f0;">from</span> emp <span style="color: #a020f0;">fetch</span> <span style="color: #a020f0;">next</span> 5 <span style="color: #a020f0;">rows</span> offset 4 <span style="color: #a020f0;">rows</span> <span style="color: #a020f0;">only</span> <span style="color: #a020f0;">order</span> <span style="color: #a020f0;">by</span> empno;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0d5b1d4" class="outline-3">
<h3 id="org0d5b1d4"><span class="section-number-3">3.11.</span> Transaction 事务</h3>
<div class="outline-text-3" id="text-3-11">
</div>
<div id="outline-container-org61b0733" class="outline-4">
<h4 id="org61b0733"><span class="section-number-4">3.11.1.</span> 什么是事务 (ACID)</h4>
<div class="outline-text-4" id="text-3-11-1">
<blockquote>
<p>
要么都成，否则都不成。
</p>
</blockquote>

<p>
事务有哪些属性 (ACID, 酸) <b>[这是一个非常常见的面试题]</b>:
</p>
<ol class="org-ol">
<li>Atomicity (原子性)</li>
<li>Consistency (一致性) 结果上</li>
<li>Isolation (隔离性) 并发访问</li>
<li>Durability (持久性)</li>
</ol>
</div>
</div>

<div id="outline-container-orgb9b9933" class="outline-4">
<h4 id="orgb9b9933"><span class="section-number-4">3.11.2.</span> 事务的状态</h4>
<div class="outline-text-4" id="text-3-11-2">
<ul class="org-ul">
<li>活动状态 (active)</li>
<li>部分提交状态 (partially committed)</li>
<li>失败/中止/提交 (failed/abort/commit)</li>
</ul>
</div>
</div>

<div id="outline-container-orgc0615ba" class="outline-4">
<h4 id="orgc0615ba"><span class="section-number-4">3.11.3.</span> SQLServer 中的事务</h4>
<div class="outline-text-4" id="text-3-11-3">
<p>
首先，默认情况下，SQLServer 中每条语句都会被自动提交。
也就是，任何语句都是一个单独事务，不需要加 commit:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> x <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'xxx'</span><span style="color: #707183;">)</span>;
<span style="color: #b22222;">-- &#36825;&#37324;&#19981;&#38656;&#35201;&#21152; commit &#23601;&#33021;&#25554;&#20837;&#25104;&#21151;</span>
</pre>
</div>

<p>
但是，上述行为存在非常严重的安全隐患，建议关掉。
然后，需要手动使用 commit/rollback 进行事务的终结:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b22222;">-- &#20851;&#38381;&#33258;&#21160;&#25552;&#20132;</span>
<span style="color: #a020f0;">set</span> implicit_transactions <span style="color: #a020f0;">off</span>;

<span style="color: #b22222;">-- &#22240;&#27492;&#65292;&#25152;&#26377;&#30340;&#35821;&#21477;&#37117;&#20250;&#22312;&#21516;&#19968;&#20010;&#20107;&#21153;&#20013;</span>
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> x <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'aaa'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> x <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'zzz'</span><span style="color: #707183;">)</span>;

<span style="color: #b22222;">-- &#38500;&#38750;&#20320;&#35843;&#29992;&#20102; commit/rollback &#21542;&#21017;&#19978;&#36848;&#30340;&#35821;&#21477;&#37117;&#19981;&#20250;&#30495;&#27491;&#20837;&#24211;</span>
<span style="color: #a020f0;">commit</span>/<span style="color: #a020f0;">rollback</span>;
</pre>
</div>

<p>
另外，如果你想更精细控制事务的范围，可以使用显式的 begin 语句:
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #a020f0;">begin</span> <span style="color: #a020f0;">transaction</span>
  <span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> x <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'222'</span><span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> x <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'212'</span>, 2<span style="color: #707183;">)</span>;
  <span style="color: #a020f0;">insert</span> <span style="color: #a020f0;">into</span> x <span style="color: #a020f0;">values</span> <span style="color: #707183;">(</span><span style="color: #8b2252;">'232'</span><span style="color: #707183;">)</span>;
<span style="color: #a020f0;">commit</span> <span style="color: #a020f0;">transaction</span>;
</pre>
</div>
</div>
</div>
</div>
</section>

<section id="outline-container-org6c4ea5c" class="outline-2">
<h2 id="org6c4ea5c"><span class="section-number-2">4.</span> MySQL 中的 SQL 语句</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org8260f91" class="outline-3">
<h3 id="org8260f91"><span class="section-number-3">4.1.</span> create</h3>
</div>

<div id="outline-container-org14c2a03" class="outline-3">
<h3 id="org14c2a03"><span class="section-number-3">4.2.</span> 分页</h3>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 悟饭</p>
<p class="date">Created: 2021-12-27</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
