<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2021-05-20 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>数据库的设计</title>
<meta name="generator" content="Org mode">
<meta name="author" content="悟饭">
<link rel='stylesheet' href='/html/asset/common.css?3344' />
<link rel='stylesheet' href='/yaoliuyao/html/asset/common.css?3344' />
<script src='https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js'></script>
<script src='https://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js'></script>
<script src='/html/asset/common.js'></script>
<script src='/yaoliuyao/html/asset/common.js'></script>

<style>
 /* From: https://endlessparentheses.com/public/css/endless.css */
 .special-kbd {
   color: #333;
   background-color: #f7f7f7;
   border: 1px solid #ccc;
   border-radius: 6px;
   box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
   display: inline-block;
   font-family: 'Droid Sans Mono', monospace;
   font-size: 80%;
   font-weight: normal;
   line-height: inherit;
   margin: 2px .1em;
   padding: .04em .4em;
   text-shadow: 0 1px 0 #fff;
   word-spacing: -3px;
 }
</style>
</head>
<body>
<div id="content">
<header>
<h1 class="title">数据库的设计</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org1ec4331">1. 主流数据库简介</a></li>
<li><a href="#org3d93bc6">2. 设计工具/网站</a></li>
<li><a href="#org5b24abc">3. 项目的生命周期</a></li>
<li><a href="#org9d2240b">4. 概要设计·实体关系图</a></li>
<li><a href="#org13b02b0">5. 设计的理论依据: 范式</a>
<ul>
<li><a href="#org5a90ebf">5.1. 示例设计</a></li>
<li><a href="#orgff2b3f2">5.2. 第一范式 (所有的列都是原子性的)</a></li>
<li><a href="#org6f08f51">5.3. 第二范式 (消除对主键的部分依赖)</a></li>
<li><a href="#org7f1fdac">5.4. 第三范式 (消除对主键的传递依赖)</a></li>
</ul>
</li>
</ul>
</div>
</nav>


<section id="outline-container-org1ec4331" class="outline-2">
<h2 id="org1ec4331"><span class="section-number-2">1.</span> 主流数据库简介</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>IBM 研究部门。关系型数据库的构思论文《R 系统：数据库关系理论》</li>
<li><a href="https://baike.baidu.com/item/%E6%8B%89%E9%87%8C%C2%B7%E5%9F%83%E9%87%8C%E6%A3%AE">拉里·埃里森</a>。Oracle</li>
<li>IBM: db2 (破甲行动)</li>
<li>微软: SQLServer</li>
<li>Sun: MySQL &lt;小。灵活。开源免费&gt;</li>
<li>去 IOE 化</li>
<li>MariaDB</li>
<li>ANSI 提出了 SQL (Structured Query Language) 标准</li>
<li>扩展阅读: <a href="https://www.chainnews.com/articles/140615952914.htm">励志的埃里森</a></li>
</ul>

<p>
为什么要学 SQLServer:
</p>
<ol class="org-ol">
<li>它有图形界面，上手简单</li>
<li>数据库的底层原理是相通的，SQL 语句遵循相同标准</li>
</ol>

<p>
学习哪些数据库:
</p>
<ul class="org-ul">
<li>基于 SQLServer 了解数据库的基本知识</li>
<li>熟悉 MySQL/Oracle 的基本操作</li>
</ul>
</div>
</section>

<section id="outline-container-org3d93bc6" class="outline-2">
<h2 id="org3d93bc6"><span class="section-number-2">2.</span> 设计工具/网站</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li>纸和笔</li>
<li>Windows 画图工具</li>
<li>visio</li>
<li>StarUML</li>
<li><a href="https://www.processon.com/">https://www.processon.com/</a></li>
</ul>
</div>
</section>

<section id="outline-container-org5b24abc" class="outline-2">
<h2 id="org5b24abc"><span class="section-number-2">3.</span> 项目的生命周期</h2>
<div class="outline-text-2" id="text-3">

<figure id="org2a383d0">
<object type="image/svg+xml" data="img/software-flow.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>

</figure>
</div>
</section>

<section id="outline-container-org9d2240b" class="outline-2">
<h2 id="org9d2240b"><span class="section-number-2">4.</span> 概要设计·实体关系图</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li>Entity-Relationship Graph</li>
<li>E-R 图</li>
</ul>

<p>
基本要素:
</p>
<ul class="org-ul">
<li>用方框的方式表示 <b>实体</b></li>
<li>用连线的方式表示 <b>联系</b></li>
<li>用圆圈的方式表示 <b>属性</b></li>
<li>在连线上可以标明 <b>具体关系</b></li>
</ul>

<p>
要求:
</p>
<ul class="org-ul">
<li>熟悉 E-R 图中各种元素的表示方式</li>
<li>能够 <b>上手一款</b> 画图软件，并能将一些简单的关系用软件表示出来</li>
</ul>

<p>
示例:
</p>

<figure id="org8523ca1">
<img src="img/er-demo.png" alt="er-demo.png" width="400">

</figure>
</div>
</section>

<section id="outline-container-org13b02b0" class="outline-2">
<h2 id="org13b02b0"><span class="section-number-2">5.</span> 设计的理论依据: 范式</h2>
<div class="outline-text-2" id="text-5">
<p>
范式 (Normal Form) 是什么:
</p>
<ul class="org-ul">
<li>如何使用关系型的理论创建表？在长时间的实践中，大家累计的一些经验的荟萃</li>
<li>范式并不是强制性的，而是我们在创建表的时候的一些参考</li>
<li>虽然是一种参考，但是为了能够更加合理创建表，我们应该需要遵守一些范式</li>
<li>最重要的是前三个范式</li>
</ul>

<p>
使用范式主要的意图，吸取前人的经验:
</p>
<ul class="org-ul">
<li>让表的结构更合理</li>
<li>减少表中数据的冗余</li>
<li>能够保证后期数据检索的效率</li>
</ul>
</div>

<div id="outline-container-org5a90ebf" class="outline-3">
<h3 id="org5a90ebf"><span class="section-number-3">5.1.</span> 示例设计</h3>
<div class="outline-text-3" id="text-5-1">
<p>
学生管理系统:
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">姓名</th>
<th scope="col" class="org-left">性别</th>
<th scope="col" class="org-left">地址</th>
<th scope="col" class="org-left">班级</th>
<th scope="col" class="org-left">成绩</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">张三</td>
<td class="org-left">女</td>
<td class="org-left">广东省珠海市</td>
<td class="org-left">169 老王</td>
<td class="org-left">语文: 98 数学:89</td>
</tr>

<tr>
<td class="org-left">李四</td>
<td class="org-left">男</td>
<td class="org-left">江西省赣州市</td>
<td class="org-left">169 老王</td>
<td class="org-left">语文: 69 数学:99</td>
</tr>

<tr>
<td class="org-left">王五</td>
<td class="org-left">男</td>
<td class="org-left">广西省柳州市</td>
<td class="org-left">189 老王妈</td>
<td class="org-left">语文: 69 数学:99</td>
</tr>
</tbody>
</table>

<p>
不合理的地方:
</p>
<ul class="org-ul">
<li>班级需要拆分，因为拆完关系比较明确</li>
<li>比如，上表中，如何查询 "找出所有老王的学生"?</li>
<li>比如，上表中，如何查询 "找出所有学生的成绩在 80 以上的学生"?</li>
</ul>
</div>
</div>

<div id="outline-container-orgff2b3f2" class="outline-3">
<h3 id="orgff2b3f2"><span class="section-number-3">5.2.</span> 第一范式 (所有的列都是原子性的)</h3>
<div class="outline-text-3" id="text-5-2">
<p>
根据第一范式，修改为:
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">姓名</th>
<th scope="col" class="org-left">性别</th>
<th scope="col" class="org-left">省</th>
<th scope="col" class="org-left">市</th>
<th scope="col" class="org-right">班级</th>
<th scope="col" class="org-left">班主任</th>
<th scope="col" class="org-left">科目</th>
<th scope="col" class="org-right">成绩</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">张三</td>
<td class="org-left">女</td>
<td class="org-left">广东省</td>
<td class="org-left">珠海市</td>
<td class="org-right">169</td>
<td class="org-left">老王</td>
<td class="org-left">语文</td>
<td class="org-right">98</td>
</tr>

<tr>
<td class="org-left">张三</td>
<td class="org-left">女</td>
<td class="org-left">广东省</td>
<td class="org-left">珠海市</td>
<td class="org-right">169</td>
<td class="org-left">老王</td>
<td class="org-left">数学</td>
<td class="org-right">98</td>
</tr>

<tr>
<td class="org-left">李四</td>
<td class="org-left">男</td>
<td class="org-left">江西省</td>
<td class="org-left">赣州市</td>
<td class="org-right">169</td>
<td class="org-left">老王</td>
<td class="org-left">语文</td>
<td class="org-right">69</td>
</tr>

<tr>
<td class="org-left">李四</td>
<td class="org-left">男</td>
<td class="org-left">江西省</td>
<td class="org-left">赣州市</td>
<td class="org-right">169</td>
<td class="org-left">老王</td>
<td class="org-left">数学</td>
<td class="org-right">69</td>
</tr>

<tr>
<td class="org-left">王五</td>
<td class="org-left">男</td>
<td class="org-left">广西省</td>
<td class="org-left">柳州市</td>
<td class="org-right">189</td>
<td class="org-left">老王妈</td>
<td class="org-left">英语</td>
<td class="org-right">69</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org6f08f51" class="outline-3">
<h3 id="org6f08f51"><span class="section-number-3">5.3.</span> 第二范式 (消除对主键的部分依赖)</h3>
<div class="outline-text-3" id="text-5-3">
<p>
所有的行必须要有主键:
</p>
<table>


<colgroup>
<col  class="org-right">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">学号</th>
<th scope="col" class="org-left">姓名</th>
<th scope="col" class="org-left">性别</th>
<th scope="col" class="org-left">省</th>
<th scope="col" class="org-left">市</th>
<th scope="col" class="org-right">班级</th>
<th scope="col" class="org-left">班主任</th>
<th scope="col" class="org-left">科目</th>
<th scope="col" class="org-right">成绩</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">100</td>
<td class="org-left">张三</td>
<td class="org-left">女</td>
<td class="org-left">广东省</td>
<td class="org-left">珠海市</td>
<td class="org-right">169</td>
<td class="org-left">老王</td>
<td class="org-left">语文</td>
<td class="org-right">98</td>
</tr>

<tr>
<td class="org-right">100</td>
<td class="org-left">张三</td>
<td class="org-left">女</td>
<td class="org-left">广东省</td>
<td class="org-left">珠海市</td>
<td class="org-right">169</td>
<td class="org-left">老王</td>
<td class="org-left">数学</td>
<td class="org-right">98</td>
</tr>

<tr>
<td class="org-right">102</td>
<td class="org-left">李四</td>
<td class="org-left">男</td>
<td class="org-left">江西省</td>
<td class="org-left">赣州市</td>
<td class="org-right">169</td>
<td class="org-left">老王</td>
<td class="org-left">语文</td>
<td class="org-right">69</td>
</tr>

<tr>
<td class="org-right">102</td>
<td class="org-left">李四</td>
<td class="org-left">男</td>
<td class="org-left">江西省</td>
<td class="org-left">赣州市</td>
<td class="org-right">169</td>
<td class="org-left">老王</td>
<td class="org-left">数学</td>
<td class="org-right">69</td>
</tr>

<tr>
<td class="org-right">110</td>
<td class="org-left">王五</td>
<td class="org-left">男</td>
<td class="org-left">广西省</td>
<td class="org-left">柳州市</td>
<td class="org-right">189</td>
<td class="org-left">老王妈</td>
<td class="org-left">英语</td>
<td class="org-right">69</td>
</tr>
</tbody>
</table>

<p>
上表目前的主键是 (学号 + 科目):
</p>
<pre class="example">
select 这张表 where 学号 = xxx and 科目 = xx 会得到唯一一个结果
</pre>


<p>
可以看到:
</p>
<ul class="org-ul">
<li>成绩这一栏是完全依赖 (学号 + 科目) 这个主键的</li>
<li>姓名等栏，却只是依赖 (学号)，它是主键的一部分</li>
</ul>

<p>
所以，要消除部分依赖，只需要拆分为:
</p>

<table>


<colgroup>
<col  class="org-right">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">学号</th>
<th scope="col" class="org-left">姓名</th>
<th scope="col" class="org-left">性别</th>
<th scope="col" class="org-left">省</th>
<th scope="col" class="org-left">市</th>
<th scope="col" class="org-right">班级</th>
<th scope="col" class="org-left">班主任</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">100</td>
<td class="org-left">张三</td>
<td class="org-left">女</td>
<td class="org-left">广东省</td>
<td class="org-left">珠海市</td>
<td class="org-right">169</td>
<td class="org-left">老王</td>
</tr>

<tr>
<td class="org-right">102</td>
<td class="org-left">李四</td>
<td class="org-left">男</td>
<td class="org-left">江西省</td>
<td class="org-left">赣州市</td>
<td class="org-right">169</td>
<td class="org-left">老王</td>
</tr>

<tr>
<td class="org-right">110</td>
<td class="org-left">王五</td>
<td class="org-left">男</td>
<td class="org-left">广西省</td>
<td class="org-left">柳州市</td>
<td class="org-right">189</td>
<td class="org-left">老王妈</td>
</tr>
</tbody>
</table>

<table>


<colgroup>
<col  class="org-right">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">学号</th>
<th scope="col" class="org-left">科目</th>
<th scope="col" class="org-right">成绩</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">100</td>
<td class="org-left">语文</td>
<td class="org-right">98</td>
</tr>

<tr>
<td class="org-right">100</td>
<td class="org-left">数学</td>
<td class="org-right">98</td>
</tr>

<tr>
<td class="org-right">102</td>
<td class="org-left">语文</td>
<td class="org-right">69</td>
</tr>

<tr>
<td class="org-right">102</td>
<td class="org-left">数学</td>
<td class="org-right">69</td>
</tr>

<tr>
<td class="org-right">110</td>
<td class="org-left">英语</td>
<td class="org-right">69</td>
</tr>
</tbody>
</table>

<p>
仍然存在的问题:
</p>
<ul class="org-ul">
<li>数据冗余</li>
<li>我想，将老王辞退，换成老李: update 第一张 set 班主任=老李 where 班主任=老王</li>
</ul>
</div>
</div>

<div id="outline-container-org7f1fdac" class="outline-3">
<h3 id="org7f1fdac"><span class="section-number-3">5.4.</span> 第三范式 (消除对主键的传递依赖)</h3>
<div class="outline-text-3" id="text-5-4">
<p>
张三的班主任是老王，是因为:
</p>
<ol class="org-ol">
<li>张三属于 169 班</li>
<li>169 班的班主任是老王</li>
</ol>

<p>
因此，这属于传递依赖，需要消除掉。
</p>

<table>
<caption class="t-above"><span class="table-number">Table 1:</span> 学生表</caption>

<colgroup>
<col  class="org-right">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">学号</th>
<th scope="col" class="org-left">姓名</th>
<th scope="col" class="org-left">性别</th>
<th scope="col" class="org-left">省</th>
<th scope="col" class="org-left">市</th>
<th scope="col" class="org-right">班级</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">100</td>
<td class="org-left">张三</td>
<td class="org-left">女</td>
<td class="org-left">广东省</td>
<td class="org-left">珠海市</td>
<td class="org-right">169</td>
</tr>

<tr>
<td class="org-right">102</td>
<td class="org-left">李四</td>
<td class="org-left">男</td>
<td class="org-left">江西省</td>
<td class="org-left">赣州市</td>
<td class="org-right">169</td>
</tr>

<tr>
<td class="org-right">110</td>
<td class="org-left">王五</td>
<td class="org-left">男</td>
<td class="org-left">广西省</td>
<td class="org-left">柳州市</td>
<td class="org-right">189</td>
</tr>
</tbody>
</table>

<table>
<caption class="t-above"><span class="table-number">Table 2:</span> 班级表</caption>

<colgroup>
<col  class="org-right">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">班级</th>
<th scope="col" class="org-left">班主任</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">169</td>
<td class="org-left">老王</td>
</tr>

<tr>
<td class="org-right">189</td>
<td class="org-left">老王妈</td>
</tr>

<tr>
<td class="org-right">180</td>
<td class="org-left">老赵</td>
</tr>
</tbody>
</table>

<table>
<caption class="t-above"><span class="table-number">Table 3:</span> 成绩表</caption>

<colgroup>
<col  class="org-right">

<col  class="org-left">

<col  class="org-right">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">学号</th>
<th scope="col" class="org-left">科目</th>
<th scope="col" class="org-right">成绩</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">100</td>
<td class="org-left">语文</td>
<td class="org-right">98</td>
</tr>

<tr>
<td class="org-right">100</td>
<td class="org-left">数学</td>
<td class="org-right">98</td>
</tr>

<tr>
<td class="org-right">102</td>
<td class="org-left">语文</td>
<td class="org-right">69</td>
</tr>

<tr>
<td class="org-right">102</td>
<td class="org-left">数学</td>
<td class="org-right">69</td>
</tr>

<tr>
<td class="org-right">110</td>
<td class="org-left">英语</td>
<td class="org-right">69</td>
</tr>
</tbody>
</table>

<p>
现在，整个设计就合理多了。
</p>
</div>
</div>
</section>
</div>
<div id="postamble" class="status">
<p class="author">Author: 悟饭</p>
<p class="date">Created: 2021-05-20</p>
<p class="validation">Go ahead, never stop.</p>
</div>
</body>
</html>
